/* Functions for the advlink plugin popup */
function preinit(){var e;(e=tinyMCEPopup.getParam("external_link_list_url"))&&document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(e)+'"></script>')}function changeClass(){var e=document.forms[0];e.classes.value=getSelectValue(e,"classlist")}function init(){tinyMCEPopup.resizeToInnerSize();var e=document.forms[0],t=tinyMCEPopup.editor,n=t.selection.getNode(),r="insert",i;document.getElementById("hrefbrowsercontainer").innerHTML=getBrowserHTML("hrefbrowser","href","file","advlink"),document.getElementById("popupurlbrowsercontainer").innerHTML=getBrowserHTML("popupurlbrowser","popupurl","file","advlink"),document.getElementById("targetlistcontainer").innerHTML=getTargetListHTML("targetlist","target"),i=getLinkListHTML("linklisthref","href"),i==""?document.getElementById("linklisthrefrow").style.display="none":document.getElementById("linklisthrefcontainer").innerHTML=i,i=getAnchorListHTML("anchorlist","href"),i==""?document.getElementById("anchorlistrow").style.display="none":document.getElementById("anchorlistcontainer").innerHTML=i,isVisible("hrefbrowser")&&(document.getElementById("href").style.width="260px"),isVisible("popupurlbrowser")&&(document.getElementById("popupurl").style.width="180px"),n=t.dom.getParent(n,"A"),n!=null&&n.nodeName=="A"&&(r="update"),e.insert.value=tinyMCEPopup.getLang(r,"Insert",!0),setPopupControlsDisabled(!0);if(r=="update"){var s=t.dom.getAttrib(n,"href"),o=t.dom.getAttrib(n,"onclick");setFormValue("href",s),setFormValue("title",t.dom.getAttrib(n,"title")),setFormValue("id",t.dom.getAttrib(n,"id")),setFormValue("style",t.dom.getAttrib(n,"style")),setFormValue("rel",t.dom.getAttrib(n,"rel")),setFormValue("rev",t.dom.getAttrib(n,"rev")),setFormValue("charset",t.dom.getAttrib(n,"charset")),setFormValue("hreflang",t.dom.getAttrib(n,"hreflang")),setFormValue("dir",t.dom.getAttrib(n,"dir")),setFormValue("lang",t.dom.getAttrib(n,"lang")),setFormValue("tabindex",t.dom.getAttrib(n,"tabindex",typeof n.tabindex!="undefined"?n.tabindex:"")),setFormValue("accesskey",t.dom.getAttrib(n,"accesskey",typeof n.accesskey!="undefined"?n.accesskey:"")),setFormValue("type",t.dom.getAttrib(n,"type")),setFormValue("onfocus",t.dom.getAttrib(n,"onfocus")),setFormValue("onblur",t.dom.getAttrib(n,"onblur")),setFormValue("onclick",o),setFormValue("ondblclick",t.dom.getAttrib(n,"ondblclick")),setFormValue("onmousedown",t.dom.getAttrib(n,"onmousedown")),setFormValue("onmouseup",t.dom.getAttrib(n,"onmouseup")),setFormValue("onmouseover",t.dom.getAttrib(n,"onmouseover")),setFormValue("onmousemove",t.dom.getAttrib(n,"onmousemove")),setFormValue("onmouseout",t.dom.getAttrib(n,"onmouseout")),setFormValue("onkeypress",t.dom.getAttrib(n,"onkeypress")),setFormValue("onkeydown",t.dom.getAttrib(n,"onkeydown")),setFormValue("onkeyup",t.dom.getAttrib(n,"onkeyup")),setFormValue("target",t.dom.getAttrib(n,"target")),setFormValue("classes",t.dom.getAttrib(n,"class")),o!=null&&o.indexOf("window.open")!=-1?parseWindowOpen(o):parseFunction(o),selectByValue(e,"dir",t.dom.getAttrib(n,"dir")),selectByValue(e,"rel",t.dom.getAttrib(n,"rel")),selectByValue(e,"rev",t.dom.getAttrib(n,"rev")),selectByValue(e,"linklisthref",s),s.charAt(0)=="#"&&selectByValue(e,"anchorlist",s),addClassesToList("classlist","advlink_styles"),selectByValue(e,"classlist",t.dom.getAttrib(n,"class"),!0),selectByValue(e,"targetlist",t.dom.getAttrib(n,"target"),!0)}else addClassesToList("classlist","advlink_styles")}function checkPrefix(e){e.value&&Validator.isEmail(e)&&!/^\s*mailto:/i.test(e.value)&&confirm(tinyMCEPopup.getLang("advlink_dlg.is_email"))&&(e.value="mailto:"+e.value),/^\s*www\./i.test(e.value)&&confirm(tinyMCEPopup.getLang("advlink_dlg.is_external"))&&(e.value="http://"+e.value)}function setFormValue(e,t){document.forms[0].elements[e].value=t}function parseWindowOpen(e){var t=document.forms[0];e.indexOf("return false;")!=-1?(t.popupreturn.checked=!0,e=e.replace("return false;","")):t.popupreturn.checked=!1;var n=parseLink(e);if(n!=null){t.ispopup.checked=!0,setPopupControlsDisabled(!1);var r=parseOptions(n.options),i=n.url;t.popupname.value=n.target,t.popupurl.value=i,t.popupwidth.value=getOption(r,"width"),t.popupheight.value=getOption(r,"height"),t.popupleft.value=getOption(r,"left"),t.popuptop.value=getOption(r,"top"),t.popupleft.value.indexOf("screen")!=-1&&(t.popupleft.value="c"),t.popuptop.value.indexOf("screen")!=-1&&(t.popuptop.value="c"),t.popuplocation.checked=getOption(r,"location")=="yes",t.popupscrollbars.checked=getOption(r,"scrollbars")=="yes",t.popupmenubar.checked=getOption(r,"menubar")=="yes",t.popupresizable.checked=getOption(r,"resizable")=="yes",t.popuptoolbar.checked=getOption(r,"toolbar")=="yes",t.popupstatus.checked=getOption(r,"status")=="yes",t.popupdependent.checked=getOption(r,"dependent")=="yes",buildOnClick()}}function parseFunction(e){var t=document.forms[0],n=parseLink(e)}function getOption(e,t){return typeof e[t]=="undefined"?"":e[t]}function setPopupControlsDisabled(e){var t=document.forms[0];t.popupname.disabled=e,t.popupurl.disabled=e,t.popupwidth.disabled=e,t.popupheight.disabled=e,t.popupleft.disabled=e,t.popuptop.disabled=e,t.popuplocation.disabled=e,t.popupscrollbars.disabled=e,t.popupmenubar.disabled=e,t.popupresizable.disabled=e,t.popuptoolbar.disabled=e,t.popupstatus.disabled=e,t.popupreturn.disabled=e,t.popupdependent.disabled=e,setBrowserDisabled("popupurlbrowser",e)}function parseLink(e){e=e.replace(new RegExp("&#39;","g"),"'");var t=e.replace(new RegExp("\\s*([A-Za-z0-9.]*)\\s*\\(.*","gi"),"$1"),n=templates[t];if(n){var r=n.match(new RegExp("'?\\$\\{[A-Za-z0-9.]*\\}'?","gi")),i="\\s*[A-Za-z0-9.]*\\s*\\(",s="";for(var o=0;o<r.length;o++)r[o].indexOf("'${")!=-1?i+="'(.*)'":i+="([0-9]*)",s+="$"+(o+1),r[o]=r[o].replace(new RegExp("[^A-Za-z0-9]","gi"),""),o!=r.length-1?(i+="\\s*,\\s*",s+="<delim>"):i+=".*";i+="\\);?";var u=[];u._function=t;var a=e.replace(new RegExp(i,"gi"),s).split("<delim>");for(var o=0;o<r.length;o++)u[r[o]]=a[o];return u}return null}function parseOptions(e){if(e==null||e=="")return[];e=e.toLowerCase(),e=e.replace(/;/g,","),e=e.replace(/[^0-9a-z=,]/g,"");var t=e.split(","),n=[];for(var r=0;r<t.length;r++){var i=t[r].split("=");i.length==2&&(n[i[0]]=i[1])}return n}function buildOnClick(){var e=document.forms[0];if(!e.ispopup.checked){e.onclick.value="";return}var t="window.open('",n=e.popupurl.value;t+=n+"','",t+=e.popupname.value+"','",e.popuplocation.checked&&(t+="location=yes,"),e.popupscrollbars.checked&&(t+="scrollbars=yes,"),e.popupmenubar.checked&&(t+="menubar=yes,"),e.popupresizable.checked&&(t+="resizable=yes,"),e.popuptoolbar.checked&&(t+="toolbar=yes,"),e.popupstatus.checked&&(t+="status=yes,"),e.popupdependent.checked&&(t+="dependent=yes,"),e.popupwidth.value!=""&&(t+="width="+e.popupwidth.value+","),e.popupheight.value!=""&&(t+="height="+e.popupheight.value+","),e.popupleft.value!=""&&(e.popupleft.value!="c"?t+="left="+e.popupleft.value+",":t+="left='+(screen.availWidth/2-"+e.popupwidth.value/2+")+',"),e.popuptop.value!=""&&(e.popuptop.value!="c"?t+="top="+e.popuptop.value+",":t+="top='+(screen.availHeight/2-"+e.popupheight.value/2+")+',"),t.charAt(t.length-1)==","&&(t=t.substring(0,t.length-1)),t+="');",e.popupreturn.checked&&(t+="return false;"),e.onclick.value=t,e.href.value==""&&(e.href.value=n)}function setAttrib(e,t,n){var r=document.forms[0],i=r.elements[t.toLowerCase()],s=tinyMCEPopup.editor.dom;if(typeof n=="undefined"||n==null)n="",i&&(n=i.value);t=="style"&&(n=s.serializeStyle(s.parseStyle(n),"a")),s.setAttrib(e,t,n)}function getAnchorListHTML(e,t){var n=tinyMCEPopup.editor,r=n.dom.select("a"),i,s,o,u="";for(s=0,o=r.length;s<o;s++)(i=n.dom.getAttrib(r[s],"name"))!=""&&(u+='<option value="#'+i+'">'+i+"</option>");return u==""?"":(u='<select id="'+e+'" name="'+e+'" class="mceAnchorList"'+' onchange="this.form.'+t+'.value=this.options[this.selectedIndex].value"'+">"+'<option value="">---</option>'+u+"</select>",u)}function insertAction(){var e=tinyMCEPopup.editor,t,n,r;t=e.selection.getNode(),checkPrefix(document.forms[0].href),t=e.dom.getParent(t,"A");if(!document.forms[0].href.value){r=e.selection.getBookmark(),e.dom.remove(t,1),e.selection.moveToBookmark(r),tinyMCEPopup.execCommand("mceEndUndoLevel"),tinyMCEPopup.close();return}if(t==null){e.getDoc().execCommand("unlink",!1,null),tinyMCEPopup.execCommand("mceInsertLink",!1,"#mce_temp_url#",{skip_undo:1}),n=tinymce.grep(e.dom.select("a"),function(t){return e.dom.getAttrib(t,"href")=="#mce_temp_url#"});for(r=0;r<n.length;r++)setAllAttribs(t=n[r])}else setAllAttribs(t);if(t.childNodes.length!=1||t.firstChild.nodeName!="IMG")e.focus(),e.selection.select(t),e.selection.collapse(0),tinyMCEPopup.storeSelection();tinyMCEPopup.execCommand("mceEndUndoLevel"),tinyMCEPopup.close()}function setAllAttribs(e){var t=document.forms[0],n=t.href.value.replace(/ /g,"%20"),r=getSelectValue(t,"targetlist");setAttrib(e,"href",n),setAttrib(e,"title"),setAttrib(e,"target",r=="_self"?"":r),setAttrib(e,"id"),setAttrib(e,"style"),setAttrib(e,"class",getSelectValue(t,"classlist")),setAttrib(e,"rel"),setAttrib(e,"rev"),setAttrib(e,"charset"),setAttrib(e,"hreflang"),setAttrib(e,"dir"),setAttrib(e,"lang"),setAttrib(e,"tabindex"),setAttrib(e,"accesskey"),setAttrib(e,"type"),setAttrib(e,"onfocus"),setAttrib(e,"onblur"),setAttrib(e,"onclick"),setAttrib(e,"ondblclick"),setAttrib(e,"onmousedown"),setAttrib(e,"onmouseup"),setAttrib(e,"onmouseover"),setAttrib(e,"onmousemove"),setAttrib(e,"onmouseout"),setAttrib(e,"onkeypress"),setAttrib(e,"onkeydown"),setAttrib(e,"onkeyup"),tinyMCE.isMSIE5&&(e.outerHTML=e.outerHTML)}function getSelectValue(e,t){var n=e.elements[t];return!n||n.options==null||n.selectedIndex==-1?"":n.options[n.selectedIndex].value}function getLinkListHTML(e,t,n){if(typeof tinyMCELinkList=="undefined"||tinyMCELinkList.length==0)return"";var r="";r+='<select id="'+e+'" name="'+e+'"',r+=' class="mceLinkList" onfoc2us="tinyMCE.addSelectAccessibility(event, this, window);" onchange="this.form.'+t+".value=",r+="this.options[this.selectedIndex].value;",typeof n!="undefined"&&(r+=n+"('"+t+"',this.options[this.selectedIndex].text,this.options[this.selectedIndex].value);"),r+='"><option value="">---</option>';for(var i=0;i<tinyMCELinkList.length;i++)r+='<option value="'+tinyMCELinkList[i][1]+'">'+tinyMCELinkList[i][0]+"</option>";return r+="</select>",r}function getTargetListHTML(e,t){var n=tinyMCEPopup.getParam("theme_advanced_link_targets","").split(";"),r="";r+='<select id="'+e+'" name="'+e+'" onf2ocus="tinyMCE.addSelectAccessibility(event, this, window);" onchange="this.form.'+t+".value=",r+='this.options[this.selectedIndex].value;">',r+='<option value="_self">'+tinyMCEPopup.getLang("advlink_dlg.target_same")+"</option>",r+='<option value="_blank">'+tinyMCEPopup.getLang("advlink_dlg.target_blank")+" (_blank)</option>",r+='<option value="_parent">'+tinyMCEPopup.getLang("advlink_dlg.target_parent")+" (_parent)</option>",r+='<option value="_top">'+tinyMCEPopup.getLang("advlink_dlg.target_top")+" (_top)</option>";for(var i=0;i<n.length;i++){var s,o;if(n[i]=="")continue;s=n[i].split("=")[0],o=n[i].split("=")[1],r+='<option value="'+s+'">'+o+" ("+s+")</option>"}return r+="</select>",r}tinyMCEPopup.requireLangPack();var templates={"window.open":"window.open('${url}','${target}','${options}')"};preinit(),tinyMCEPopup.onInit.add(init);