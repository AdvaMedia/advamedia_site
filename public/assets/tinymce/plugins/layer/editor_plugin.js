(function(){function e(e){do if(e.className&&e.className.indexOf("mceItemLayer")!=-1)return e;while(e=e.parentNode)}tinymce.create("tinymce.plugins.Layer",{init:function(t,n){var r=this;r.editor=t,t.addCommand("mceInsertLayer",r._insertLayer,r),t.addCommand("mceMoveForward",function(){r._move(1)}),t.addCommand("mceMoveBackward",function(){r._move(-1)}),t.addCommand("mceMakeAbsolute",function(){r._toggleAbsolute()}),t.addButton("moveforward",{title:"layer.forward_desc",cmd:"mceMoveForward"}),t.addButton("movebackward",{title:"layer.backward_desc",cmd:"mceMoveBackward"}),t.addButton("absolute",{title:"layer.absolute_desc",cmd:"mceMakeAbsolute"}),t.addButton("insertlayer",{title:"layer.insertlayer_desc",cmd:"mceInsertLayer"}),t.onInit.add(function(){var e=t.dom;tinymce.isIE&&t.getDoc().execCommand("2D-Position",!1,!0)}),t.onMouseUp.add(function(t,n){var r=e(n.target);r&&t.dom.setAttrib(r,"data-mce-style","")}),t.onMouseDown.add(function(t,n){var r=n.target,i=t.getDoc(),s;tinymce.isGecko&&(e(r)?i.designMode!=="on"&&(i.designMode="on",r=i.body,s=r.parentNode,s.removeChild(r),s.appendChild(r)):i.designMode=="on"&&(i.designMode="off"))}),t.onNodeChange.add(r._nodeChange,r),t.onVisualAid.add(r._visualAid,r)},getInfo:function(){return{longname:"Layer",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/layer",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_nodeChange:function(e,t,n){var r,i;r=this._getParentLayer(n),i=e.dom.getParent(n,"DIV,P,IMG"),i?(t.setDisabled("absolute",0),t.setDisabled("moveforward",!r),t.setDisabled("movebackward",!r),t.setActive("absolute",r&&r.style.position.toLowerCase()=="absolute")):(t.setDisabled("absolute",1),t.setDisabled("moveforward",1),t.setDisabled("movebackward",1))},_visualAid:function(e,t,n){var r=e.dom;tinymce.each(r.select("div,p",t),function(e){/^(absolute|relative|fixed)$/i.test(e.style.position)&&(n?r.addClass(e,"mceItemVisualAid"):r.removeClass(e,"mceItemVisualAid"),r.addClass(e,"mceItemLayer"))})},_move:function(e){var t=this.editor,n,r=[],i=this._getParentLayer(t.selection.getNode()),s=-1,o=-1,u;u=[],tinymce.walk(t.getBody(),function(e){e.nodeType==1&&/^(absolute|relative|static)$/i.test(e.style.position)&&u.push(e)},"childNodes");for(n=0;n<u.length;n++)r[n]=u[n].style.zIndex?parseInt(u[n].style.zIndex):0,s<0&&u[n]==i&&(s=n);if(e<0){for(n=0;n<r.length;n++)if(r[n]<r[s]){o=n;break}o>-1?(u[s].style.zIndex=r[o],u[o].style.zIndex=r[s]):r[s]>0&&(u[s].style.zIndex=r[s]-1)}else{for(n=0;n<r.length;n++)if(r[n]>r[s]){o=n;break}o>-1?(u[s].style.zIndex=r[o],u[o].style.zIndex=r[s]):u[s].style.zIndex=r[s]+1}t.execCommand("mceRepaint")},_getParentLayer:function(e){return this.editor.dom.getParent(e,function(e){return e.nodeType==1&&/^(absolute|relative|static)$/i.test(e.style.position)})},_insertLayer:function(){var e=this.editor,t=e.dom,n=t.getPos(t.getParent(e.selection.getNode(),"*")),r=e.getBody();e.dom.add(r,"div",{style:{position:"absolute",left:n.x,top:n.y>20?n.y:20,width:100,height:100},"class":"mceItemVisualAid mceItemLayer"},e.selection.getContent()||e.getLang("layer.content")),tinymce.isIE&&t.setHTML(r,r.innerHTML)},_toggleAbsolute:function(){var e=this.editor,t=this._getParentLayer(e.selection.getNode());t||(t=e.dom.getParent(e.selection.getNode(),"DIV,P,IMG")),t&&(t.style.position.toLowerCase()=="absolute"?(e.dom.setStyles(t,{position:"",left:"",top:"",width:"",height:""}),e.dom.removeClass(t,"mceItemVisualAid"),e.dom.removeClass(t,"mceItemLayer")):(t.style.left==""&&(t.style.left="20px"),t.style.top==""&&(t.style.top="20px"),t.style.width==""&&(t.style.width=t.width?t.width+"px":"100px"),t.style.height==""&&(t.style.height=t.height?t.height+"px":"100px"),t.style.position="absolute",e.dom.setAttrib(t,"data-mce-style",""),e.addVisual(e.getBody())),e.execCommand("mceRepaint"),e.nodeChanged())}}),tinymce.PluginManager.add("layer",tinymce.plugins.Layer)})();