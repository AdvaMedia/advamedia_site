(function(){tinymce.create("tinymce.plugins.AutolinkPlugin",{init:function(e,t){var n=this;if(tinyMCE.isIE)return;e.onKeyDown.add(function(e,t){if(t.keyCode==13)return n.handleEnter(e)}),e.onKeyPress.add(function(e,t){if(t.which==41)return n.handleEclipse(e)}),e.onKeyUp.add(function(e,t){if(t.keyCode==32)return n.handleSpacebar(e)})},handleEclipse:function(e){this.parseCurrentLine(e,-1,"(",!0)},handleSpacebar:function(e){this.parseCurrentLine(e,0,"",!0)},handleEnter:function(e){this.parseCurrentLine(e,-1,"",!1)},parseCurrentLine:function(e,t,n,r){var i,s,o,u,a,f,l,c,h;i=e.selection.getRng().cloneRange();if(i.startOffset<5){c=i.endContainer.previousSibling;if(c==null){if(i.endContainer.firstChild==null||i.endContainer.firstChild.nextSibling==null)return;c=i.endContainer.firstChild.nextSibling}h=c.length,i.setStart(c,h),i.setEnd(c,h);if(i.endOffset<5)return;s=i.endOffset,u=c}else{u=i.endContainer;if(u.nodeType!=3&&u.firstChild){while(u.nodeType!=3&&u.firstChild)u=u.firstChild;i.setStart(u,0),i.setEnd(u,u.nodeValue.length)}i.endOffset==1?s=2:s=i.endOffset-1-t}o=s;do i.setStart(u,s-2),i.setEnd(u,s-1),s-=1;while(i.toString()!=" "&&i.toString()!=""&&i.toString().charCodeAt(0)!=160&&s-2>=0&&i.toString()!=n);i.toString()==n||i.toString().charCodeAt(0)==160?(i.setStart(u,s),i.setEnd(u,o),s+=1):i.startOffset==0?(i.setStart(u,0),i.setEnd(u,o)):(i.setStart(u,s),i.setEnd(u,o)),f=i.toString(),l=f.match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)(.+)$/i);if(l){l[1]=="www."&&(l[1]="http://www."),a=e.selection.getBookmark(),e.selection.setRng(i),tinyMCE.execCommand("createlink",!1,l[1]+l[2]),e.selection.moveToBookmark(a);if(tinyMCE.isWebKit){e.selection.collapse(!1);var p=Math.min(u.length,o+1);i.setStart(u,p),i.setEnd(u,p),e.selection.setRng(i)}}},getInfo:function(){return{longname:"Autolink",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/autolink",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("autolink",tinymce.plugins.AutolinkPlugin)})();