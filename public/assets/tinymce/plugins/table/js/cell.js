function init(){ed=tinyMCEPopup.editor,tinyMCEPopup.resizeToInnerSize(),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("bordercolor_pickcontainer").innerHTML=getColorPickerHTML("bordercolor_pick","bordercolor"),document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor");var e=ed,t=ed.dom.getParent(ed.selection.getStart(),"td,th"),n=document.forms[0],r=ed.dom.parseStyle(ed.dom.getAttrib(t,"style")),i=t.nodeName.toLowerCase(),s=ed.dom.getAttrib(t,"align"),o=ed.dom.getAttrib(t,"valign"),u=trimSize(getStyle(t,"width","width")),a=trimSize(getStyle(t,"height","height")),f=convertRGBToHex(getStyle(t,"bordercolor","borderLeftColor")),l=convertRGBToHex(getStyle(t,"bgcolor","backgroundColor")),c=ed.dom.getAttrib(t,"class"),h=getStyle(t,"background","backgroundImage").replace(new RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"),p=ed.dom.getAttrib(t,"id"),d=ed.dom.getAttrib(t,"lang"),v=ed.dom.getAttrib(t,"dir"),m=ed.dom.getAttrib(t,"scope");addClassesToList("class","table_cell_styles"),TinyMCE_EditableSelects.init(),ed.dom.hasClass(t,"mceSelected")?tinyMCEPopup.dom.hide("action"):(n.bordercolor.value=f,n.bgcolor.value=l,n.backgroundimage.value=h,n.width.value=u,n.height.value=a,n.id.value=p,n.lang.value=d,n.style.value=ed.dom.serializeStyle(r),selectByValue(n,"align",s),selectByValue(n,"valign",o),selectByValue(n,"class",c,!0,!0),selectByValue(n,"celltype",i),selectByValue(n,"dir",v),selectByValue(n,"scope",m),isVisible("backgroundimagebrowser")&&(document.getElementById("backgroundimage").style.width="180px"),updateColor("bordercolor_pick","bordercolor"),updateColor("bgcolor_pick","bgcolor"))}function updateAction(){var e,t=ed,n,r,i,s=document.forms[0];if(!AutoValidator.validate(s))return tinyMCEPopup.alert(AutoValidator.getErrorMessages(s).join(". ")+"."),!1;tinyMCEPopup.restoreSelection(),e=ed.selection.getStart(),n=ed.dom.getParent(e,"td,th"),r=ed.dom.getParent(e,"tr"),i=ed.dom.getParent(e,"table");if(ed.dom.hasClass(n,"mceSelected")){tinymce.each(ed.dom.select("td.mceSelected,th.mceSelected"),function(e){updateCell(e)}),ed.addVisual(),ed.nodeChanged(),t.execCommand("mceEndUndoLevel"),tinyMCEPopup.close();return}switch(getSelectValue(s,"action")){case"cell":var o=getSelectValue(s,"celltype"),u=getSelectValue(s,"scope");function a(e){e&&(updateCell(n),ed.addVisual(),ed.nodeChanged(),t.execCommand("mceEndUndoLevel"),tinyMCEPopup.close())}if(ed.getParam("accessibility_warnings",1)){o=="th"&&u==""?tinyMCEPopup.confirm(ed.getLang("table_dlg.missing_scope","",!0),a):a(1);return}updateCell(n);break;case"row":var f=r.firstChild;f.nodeName!="TD"&&f.nodeName!="TH"&&(f=nextCell(f));do f=updateCell(f,!0);while((f=nextCell(f))!=null);break;case"col":var l,c=0,f=r.firstChild,h=i.getElementsByTagName("tr");f.nodeName!="TD"&&f.nodeName!="TH"&&(f=nextCell(f));do{if(f==n)break;c+=f.getAttribute("colspan")}while((f=nextCell(f))!=null);for(var p=0;p<h.length;p++){f=h[p].firstChild,f.nodeName!="TD"&&f.nodeName!="TH"&&(f=nextCell(f)),l=0;do{if(l==c){f=updateCell(f,!0);break}l+=f.getAttribute("colspan")}while((f=nextCell(f))!=null)}break;case"all":var h=i.getElementsByTagName("tr");for(var p=0;p<h.length;p++){var f=h[p].firstChild;f.nodeName!="TD"&&f.nodeName!="TH"&&(f=nextCell(f));do f=updateCell(f,!0);while((f=nextCell(f))!=null)}}ed.addVisual(),ed.nodeChanged(),t.execCommand("mceEndUndoLevel"),tinyMCEPopup.close()}function nextCell(e){while((e=e.nextSibling)!=null)if(e.nodeName=="TD"||e.nodeName=="TH")return e;return null}function updateCell(e,t){var n=ed,r=document.forms[0],i=e.nodeName.toLowerCase(),s=getSelectValue(r,"celltype"),o=n.getDoc(),u=ed.dom;t||u.setAttrib(e,"id",r.id.value),u.setAttrib(e,"align",r.align.value),u.setAttrib(e,"vAlign",r.valign.value),u.setAttrib(e,"lang",r.lang.value),u.setAttrib(e,"dir",getSelectValue(r,"dir")),u.setAttrib(e,"style",ed.dom.serializeStyle(ed.dom.parseStyle(r.style.value))),u.setAttrib(e,"scope",r.scope.value),u.setAttrib(e,"class",getSelectValue(r,"class")),ed.dom.setAttrib(e,"width",""),ed.dom.setAttrib(e,"height",""),ed.dom.setAttrib(e,"bgColor",""),ed.dom.setAttrib(e,"borderColor",""),ed.dom.setAttrib(e,"background",""),e.style.width=getCSSSize(r.width.value),e.style.height=getCSSSize(r.height.value),r.bordercolor.value!=""?(e.style.borderColor=r.bordercolor.value,e.style.borderStyle=e.style.borderStyle==""?"solid":e.style.borderStyle,e.style.borderWidth=e.style.borderWidth==""?"1px":e.style.borderWidth):e.style.borderColor="",e.style.backgroundColor=r.bgcolor.value,r.backgroundimage.value!=""?e.style.backgroundImage="url('"+r.backgroundimage.value+"')":e.style.backgroundImage="";if(i!=s){var a=o.createElement(s);for(var f=0;f<e.childNodes.length;f++)a.appendChild(e.childNodes[f].cloneNode(1));for(var l=0;l<e.attributes.length;l++)ed.dom.setAttrib(a,e.attributes[l].name,ed.dom.getAttrib(e,e.attributes[l].name));e.parentNode.replaceChild(a,e),e=a}return u.setAttrib(e,"style",u.serializeStyle(u.parseStyle(e.style.cssText))),e}function changedBackgroundImage(){var e=document.forms[0],t=ed.dom.parseStyle(e.style.value);t["background-image"]="url('"+e.backgroundimage.value+"')",e.style.value=ed.dom.serializeStyle(t)}function changedSize(){var e=document.forms[0],t=ed.dom.parseStyle(e.style.value),n=e.width.value;n!=""?t.width=getCSSSize(n):t.width="";var r=e.height.value;r!=""?t.height=getCSSSize(r):t.height="",e.style.value=ed.dom.serializeStyle(t)}function changedColor(){var e=document.forms[0],t=ed.dom.parseStyle(e.style.value);t["background-color"]=e.bgcolor.value,t["border-color"]=e.bordercolor.value,e.style.value=ed.dom.serializeStyle(t)}function changedStyle(){var e=document.forms[0],t=ed.dom.parseStyle(e.style.value);t["background-image"]?e.backgroundimage.value=t["background-image"].replace(new RegExp("url\\('?([^']*)'?\\)","gi"),"$1"):e.backgroundimage.value="",t.width&&(e.width.value=trimSize(t.width)),t.height&&(e.height.value=trimSize(t.height)),t["background-color"]&&(e.bgcolor.value=t["background-color"],updateColor("bgcolor_pick","bgcolor")),t["border-color"]&&(e.bordercolor.value=t["border-color"],updateColor("bordercolor_pick","bordercolor"))}tinyMCEPopup.requireLangPack();var ed;tinyMCEPopup.onInit.add(init);