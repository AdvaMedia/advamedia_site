/**
 * editor_plugin_src.js
 *
 * Copyright 2009, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http://tinymce.moxiecode.com/license
 * Contributing: http://tinymce.moxiecode.com/contributing
 */
(function(){var e=tinymce.each;tinymce.create("tinymce.plugins.TemplatePlugin",{init:function(t,n){var r=this;r.editor=t,t.addCommand("mceTemplate",function(e){t.windowManager.open({file:n+"/template.htm",width:t.getParam("template_popup_width",750),height:t.getParam("template_popup_height",600),inline:1},{plugin_url:n})}),t.addCommand("mceInsertTemplate",r._insertTemplate,r),t.addButton("template",{title:"template.desc",cmd:"mceTemplate"}),t.onPreProcess.add(function(t,n){var i=t.dom;e(i.select("div",n.node),function(n){i.hasClass(n,"mceTmpl")&&(e(i.select("*",n),function(e){i.hasClass(e,t.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(e.innerHTML=r._getDateTime(new Date,t.getParam("template_mdate_format",t.getLang("template.mdate_format"))))}),r._replaceVals(n))})})},getInfo:function(){return{longname:"Template plugin",author:"Moxiecode Systems AB",authorurl:"http://www.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/template",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_insertTemplate:function(t,r){function l(e,t){return(new RegExp("\\b"+t+"\\b","g")).test(e.className)}var i=this,s=i.editor,o,u,a=s.dom,f=s.selection.getContent();o=r.content,e(i.editor.getParam("template_replace_values"),function(e,t){typeof e!="function"&&(o=o.replace(new RegExp("\\{\\$"+t+"\\}","g"),e))}),u=a.create("div",null,o),n=a.select(".mceTmpl",u),n&&n.length>0&&(u=a.create("div",null),u.appendChild(n[0].cloneNode(!0))),e(a.select("*",u),function(e){l(e,s.getParam("template_cdate_classes","cdate").replace(/\s+/g,"|"))&&(e.innerHTML=i._getDateTime(new Date,s.getParam("template_cdate_format",s.getLang("template.cdate_format")))),l(e,s.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(e.innerHTML=i._getDateTime(new Date,s.getParam("template_mdate_format",s.getLang("template.mdate_format")))),l(e,s.getParam("template_selected_content_classes","selcontent").replace(/\s+/g,"|"))&&(e.innerHTML=f)}),i._replaceVals(u),s.execCommand("mceInsertContent",!1,u.innerHTML),s.addVisual()},_replaceVals:function(t){var n=this.editor.dom,r=this.editor.getParam("template_replace_values");e(n.select("*",t),function(t){e(r,function(e,i){n.hasClass(t,i)&&typeof r[i]=="function"&&r[i](t)})})},_getDateTime:function(e,t){function n(e,t){var n;e=""+e;if(e.length<t)for(n=0;n<t-e.length;n++)e="0"+e;return e}return t?(t=t.replace("%D","%m/%d/%y"),t=t.replace("%r","%I:%M:%S %p"),t=t.replace("%Y",""+e.getFullYear()),t=t.replace("%y",""+e.getYear()),t=t.replace("%m",n(e.getMonth()+1,2)),t=t.replace("%d",n(e.getDate(),2)),t=t.replace("%H",""+n(e.getHours(),2)),t=t.replace("%M",""+n(e.getMinutes(),2)),t=t.replace("%S",""+n(e.getSeconds(),2)),t=t.replace("%I",""+((e.getHours()+11)%12+1)),t=t.replace("%p",""+(e.getHours()<12?"AM":"PM")),t=t.replace("%B",""+this.editor.getLang("template_months_long").split(",")[e.getMonth()]),t=t.replace("%b",""+this.editor.getLang("template_months_short").split(",")[e.getMonth()]),t=t.replace("%A",""+this.editor.getLang("template_day_long").split(",")[e.getDay()]),t=t.replace("%a",""+this.editor.getLang("template_day_short").split(",")[e.getDay()]),t=t.replace("%%","%"),t):""}}),tinymce.PluginManager.add("template",tinymce.plugins.TemplatePlugin)})();