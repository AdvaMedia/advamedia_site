/**
 * editor_plugin_src.js
 *
 * Copyright 2011, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http://tinymce.moxiecode.com/license
 * Contributing: http://tinymce.moxiecode.com/contributing
 */
(function(){function r(e,t){while(e&&(e.nodeType===8||e.nodeType===3&&/^[ \t\n\r]*$/.test(e.nodeValue)))e=t(e);return e}function i(e){return r(e,function(e){return e.previousSibling})}function s(e){return r(e,function(e){return e.nextSibling})}function o(e,t,n){return e.dom.getParent(t,function(e){return tinymce.inArray(n,e)!==-1})}function u(e){return e&&(e.tagName==="OL"||e.tagName==="UL")}function a(e,t){var n,r,s;n=i(e.lastChild);while(u(n))r=n,n=i(r.previousSibling);return r&&(s=t.create("li",{style:"list-style-type: none;"}),t.split(e,r),t.insertAfter(s,r),s.appendChild(r),s.appendChild(r),e=s.previousSibling),e}function f(e,t,n){return e=l(e,t,n),c(e,t,n)}function l(e,t,n){var r=i(e.previousSibling);return r?h(r,e,t?r:!1,n):e}function c(e,t,n){var r=s(e.nextSibling);return r?h(e,r,t?r:!1,n):e}function h(e,t,n,r){return p(e,t,!!n,r)?m(e,t,n):(e&&e.tagName==="LI"&&u(t)&&e.appendChild(t),t)}function p(e,t,n,r){return!e||!t?!1:e.tagName==="LI"&&t.tagName==="LI"?t.style.listStyleType==="none"||v(t):u(e)?e.tagName===t.tagName&&(n||e.style.listStyleType===t.style.listStyleType)||d(t):r&&e.tagName==="P"&&t.tagName==="P"}function d(e){var t=s(e.firstChild),n=i(e.lastChild);return t&&n&&u(e)&&t===n&&(u(t)||t.style.listStyleType==="none"||v(t))}function v(e){var t=s(e.firstChild),n=i(e.lastChild);return t&&n&&t===n&&u(t)}function m(e,t,n){var r=i(e.lastChild),o=s(t.firstChild);e.tagName==="P"&&e.appendChild(e.ownerDocument.createElement("br"));while(t.firstChild)e.appendChild(t.firstChild);return n&&(e.style.listStyleType=n.style.listStyleType),t.parentNode.removeChild(t),h(r,o,!1),e}function g(e,t){var n;return t.is(e,"li,ol,ul")||(n=t.getParent(e,"li"),n&&(e=n)),e}var e=tinymce.each,t=tinymce.dom.Event,n;tinymce.create("tinymce.plugins.Lists",{init:function(e){function f(t){return t.keyCode===tinymce.VK.TAB&&!t.altKey&&!t.ctrlKey&&(e.queryCommandState("InsertUnorderedList")||e.queryCommandState("InsertOrderedList"))}function l(){var t=e.selection.getRng(),n=t.startContainer;return n.nodeType==3?t.endOffset==n.nodeValue.length:n.nodeType==1?t.endOffset==n.childNodes.length:!1}function c(){var t=e.selection.getNode(),n=t.tagName==="P"&&t.parentNode.tagName==="LI"&&t.parentNode.lastChild===t;return e.selection.isCollapsed()&&n&&l()}function h(){var e=v(),t=e.parentNode.parentNode,n=e.parentNode.lastChild===e;return n&&!p(t)&&m(e)}function p(e){return u(e)?e.parentNode&&e.parentNode.tagName==="LI":e.tagName==="LI"}function d(){return e.selection.isCollapsed()&&m(v())}function v(){var t=e.selection.getStart();return t.tagName!="BR"&&t.tagName!=""||t.parentNode.tagName!="LI"?t:t.parentNode}function m(e){var t=e.childNodes.length;return e.tagName==="LI"?t==0?!0:t==1&&(e.firstChild.tagName==""||e.firstChild.tagName=="BR"||g(e)):!1}function g(e){var t=tinymce.grep(e.parentNode.childNodes,function(e){return e.tagName=="LI"}),n=e==t[t.length-1],r=e.firstChild;return tinymce.isIE9&&n&&(r.nodeValue==String.fromCharCode(160)||r.nodeValue==String.fromCharCode(32))}function y(e){return e.keyCode===tinymce.VK.ENTER}function b(e){return y(e)&&!e.shiftKey}function w(e){return f(e)?n:b(e)&&h()?i:b(e)&&d()?r:b(e)&&c()?s:o}function E(e,s){(a==n||a==r||tinymce.isGecko&&a==i)&&t.cancel(s)}function S(e,n){if(a==s){var r=e.selection.getNode(),i=e.dom.create("li"),o=e.dom.getParent(r,"li");e.dom.insertAfter(i,o),tinyMCE.isIE8?(i.appendChild(e.dom.create("&nbsp;")),e.selection.setCursorLocation(i,1)):tinyMCE.isGecko?setTimeout(function(){var t=e.getDoc().createTextNode("﻿");i.appendChild(t),e.selection.setCursorLocation(i,0)},0):e.selection.setCursorLocation(i,0),t.cancel(n)}}function x(e,t){function i(e){var t=e.firstChild,n=null;do{if(!t)break;t.tagName==="LI"&&(n=t)}while(t=t.nextSibling);return n}function s(e,t){while(e.childNodes.length>0)t.appendChild(e.childNodes[0])}var n;if(!tinymce.isGecko)return;var r=e.selection.getStart();if(t.keyCode!=tinymce.VK.BACKSPACE||r.tagName!=="IMG")return;n=r.parentNode.previousSibling;if(!n)return;var o;if(n.tagName==="UL"||n.tagName==="OL")o=n;else{if(!n.previousSibling||n.previousSibling.tagName!=="UL"&&n.previousSibling.tagName!=="OL")return;o=n.previousSibling}var u=i(o),a=e.dom.createRng();a.setStart(u,1),a.setEnd(u,1),e.selection.setRng(a),e.selection.collapse(!0);var f=e.selection.getBookmark(),l=r.parentNode.cloneNode(!0);l.tagName==="P"||l.tagName==="DIV"?s(l,u):u.appendChild(l),r.parentNode.parentNode.removeChild(r.parentNode),e.selection.moveToBookmark(f)}function T(t){var n=e.dom.getParent(t,"ol,ul");if(n!=null){var r=n.lastChild;r.appendChild(e.getDoc().createElement("")),e.selection.setCursorLocation(r,0)}}function N(t,n){var r=e.getDoc().createTextNode("﻿");t.insertBefore(r,n),e.selection.setCursorLocation(r,0),e.execCommand("mceRepaint")}function C(e,t){if(y(t)){var n=v();if(n){var r=n.parentNode,i=r&&r.parentNode;i&&i.nodeName=="LI"&&i.firstChild==r&&n==r.firstChild&&N(i,r)}}}function k(e,t){if(y(t)){var n=v();if(e.dom.select("ul li",n).length===1){var r=n.firstChild;N(n,r)}}}function L(e,n){function r(t,n){var r=[],i=new tinymce.dom.TreeWalker(n,t);for(var s=i.current();s;s=i.next())e.dom.is(s,"ol,ul,li")&&r.push(s);return r}if(n.keyCode==tinymce.VK.BACKSPACE){var i=v();if(i){var s=e.dom.getParent(i,"ol,ul");if(s&&s.firstChild===i){var o=r(s,i);return e.execCommand("Outdent",!1,o),e.undoManager.add(),t.cancel(n)}}}}var n="TABBING",r="EMPTY",i="ESCAPE",s="PARAGRAPH",o="UNKNOWN",a=o;this.ed=e,e.addCommand("Indent",this.indent,this),e.addCommand("Outdent",this.outdent,this),e.addCommand("InsertUnorderedList",function(){this.applyList("UL","OL")},this),e.addCommand("InsertOrderedList",function(){this.applyList("OL","UL")},this),e.onInit.add(function(){e.editorCommands.addCommands({outdent:function(){function r(t){return t=n.getParent(t,n.isBlock),t&&parseInt(e.dom.getStyle(t,"margin-left")||0,10)+parseInt(e.dom.getStyle(t,"padding-left")||0,10)>0}var t=e.selection,n=e.dom;return r(t.getStart())||r(t.getEnd())||e.queryCommandState("InsertOrderedList")||e.queryCommandState("InsertUnorderedList")}},"state")}),e.onKeyUp.add(function(e,s){if(a==n)return e.execCommand(s.shiftKey?"Outdent":"Indent",!0,null),a=o,t.cancel(s);if(a==r){var u=v(),f=e.settings.list_outdent_on_enter===!0||s.shiftKey;return e.execCommand(f?"Outdent":"Indent",!0,null),tinymce.isIE&&T(u),t.cancel(s)}if(a==i)if(tinymce.isIE8){var l=e.getDoc().createTextNode("﻿");e.selection.getNode().appendChild(l)}else if(tinymce.isIE9||tinymce.isGecko)return e.execCommand("Outdent"),t.cancel(s)}),e.onKeyDown.add(function(e,t){a=w(t)}),e.onKeyDown.add(E),e.onKeyDown.add(x),e.onKeyDown.add(S),tinymce.isGecko&&e.onKeyUp.add(C),tinymce.isIE8&&e.onKeyUp.add(k),(tinymce.isGecko||tinymce.isWebKit)&&e.onKeyDown.add(L)},applyList:function(t,r){function m(e){e&&e.tagName==="BR"&&o.remove(e)}function y(e){function s(e){(e.style.marginLeft||e.style.paddingLeft)&&i.adjustPaddingFunction(!1)(e)}var n=o.create(t),r;if(e.tagName!=="LI"){if(e.tagName==="P"||e.tagName==="DIV"||e.tagName==="BODY"){w(e,function(t,n){b(t,n,e.tagName==="BODY"?null:t.parentNode),r=t.parentNode,s(r),m(n)}),r&&(r.tagName==="LI"&&(e.tagName==="P"||v.length>1)&&o.split(r.parentNode.parentNode,r.parentNode),f(r.parentNode,!0));return}r=o.create("li"),o.insertAfter(r,e),r.appendChild(e),s(e),e=r}o.insertAfter(n,e),n.appendChild(e),f(n,!0),u.push(e)}function b(e,t,n){var r,i=e,s;while(!o.isBlock(e.parentNode)&&e.parentNode!==o.getRoot())e=o.split(e.parentNode,e.previousSibling),e=e.nextSibling,i=e;if(n){r=n.cloneNode(!0),e.parentNode.insertBefore(r,e);while(r.firstChild)o.remove(r.firstChild);r=o.rename(r,"li")}else r=o.create("li"),e.parentNode.insertBefore(r,e);while(i&&i!=t)s=i.nextSibling,r.appendChild(i),i=s;r.childNodes.length===0&&(r.innerHTML='<br _mce_bogus="1" />'),y(r)}function w(t,r){function c(e,t){var r=o.createRng(),i;return n.keep=!0,s.selection.moveToBookmark(n),n.keep=!1,i=s.selection.getRng(!0),t||(t=e.parentNode.lastChild),r.setStartBefore(e),r.setEndAfter(t),!(r.compareBoundaryPoints(a,i)>0||r.compareBoundaryPoints(f,i)<=0)}function h(e){if(e.nextSibling)return e.nextSibling;if(!o.isBlock(e.parentNode)&&e.parentNode!==o.getRoot())return h(e.parentNode)}var i,u,a=3,f=1,l="br,ul,ol,p,div,h1,h2,h3,h4,h5,h6,table,blockquote,address,pre,form,center,dl";i=t.firstChild;var p=!1;e(o.select(l,t),function(e){if(e.hasAttribute&&e.hasAttribute("_mce_bogus"))return!0;c(i,e)&&(o.addClass(e,"_mce_tagged_br"),i=h(e))}),p=i&&c(i,undefined),i=t.firstChild,e(o.select(l,t),function(e){var t=h(e);if(e.hasAttribute&&e.hasAttribute("_mce_bogus"))return!0;o.hasClass(e,"_mce_tagged_br")?(r(i,e,u),u=null):u=e,i=t}),p&&r(i,undefined,u)}function E(e){w(e,function(e,t,n){b(e,t),m(t),m(n)})}function S(e){if(tinymce.inArray(u,e)!==-1)return;e.parentNode.tagName===r&&(o.split(e.parentNode,e),y(e),c(e.parentNode,!1)),u.push(e)}function x(e){var t,n,r,i;if(tinymce.inArray(u,e)!==-1)return;e=a(e,o);while(o.is(e.parentNode,"ol,ul,li"))o.split(e.parentNode,e);u.push(e),e=o.rename(e,"p"),r=f(e,!1,s.settings.force_br_newlines);if(r===e){t=e.firstChild;while(t)o.isBlock(t)?(t=o.split(t.parentNode,t),i=!0,n=t.nextSibling&&t.nextSibling.firstChild):(n=t.nextSibling,i&&t.tagName==="BR"&&o.remove(t),i=!1),t=n}}var i=this,s=i.ed,o=s.dom,u=[],l=!1,h=!1,p=!1,d,v=s.selection.getSelectedBlocks();e(v,function(e){e=g(e,o),e.tagName===r||e.tagName==="LI"&&e.parentNode.tagName===r?h=!0:e.tagName===t||e.tagName==="LI"&&e.parentNode.tagName===t?l=!0:p=!0}),p&&!l||h||v.length===0?d={LI:S,H1:y,H2:y,H3:y,H4:y,H5:y,H6:y,P:y,BODY:y,DIV:v.length>1?y:E,defaultAction:E,elements:this.selectedBlocks()}:d={defaultAction:x,elements:this.selectedBlocks()},this.process(d)},indent:function(){function r(e){var n=t.create("li",{style:"list-style-type: none;"});return t.insertAfter(n,e),n}function i(e){var n=r(e),i=t.getParent(e,"ol,ul"),s=i.tagName,o=t.getStyle(i,"list-style-type"),u={},a;return o!==""&&(u.style="list-style-type: "+o+";"),a=t.create(s,u),n.appendChild(a),a}function s(r){if(!o(e,r,n)){r=a(r,t);var s=i(r);s.appendChild(r),f(s.parentNode,!1),f(s,!1),n.push(r)}}var e=this.ed,t=e.dom,n=[];this.process({LI:s,defaultAction:this.adjustPaddingFunction(!0),elements:this.selectedBlocks()})},outdent:function(t,n){function l(e){var t,n,f;if(!o(i,e,u)){if(s.getStyle(e,"margin-left")!==""||s.getStyle(e,"padding-left")!=="")return r.adjustPaddingFunction(!1)(e);f=s.getStyle(e,"text-align",!0);if(f==="center"||f==="right"){s.setStyle(e,"text-align","left");return}e=a(e,s),t=e.parentNode,n=e.parentNode.parentNode,n.tagName==="P"?s.split(n,e.parentNode):(s.split(t,e),n.tagName==="LI"?s.split(n,e):s.is(n,"ol,ul")||s.rename(e,"p")),u.push(e)}}var r=this,i=r.ed,s=i.dom,u=[],c=n&&tinymce.is(n,"array")?n:this.selectedBlocks();this.process({LI:l,defaultAction:this.adjustPaddingFunction(!1),elements:c}),e(u,f)},process:function(e){function u(e){var t=tinymce.grep(e.childNodes,function(e){return e.nodeName!=="BR"&&(e.nodeName!=="SPAN"||i.getAttrib(e,"data-mce-type")!="bookmark")&&(e.nodeType!=3||e.nodeValue!=String.fromCharCode(160)&&e.nodeValue!="")});return t.length===0}function a(t){i.removeClass(t,"_mce_act_on");if(!t||t.nodeType!==1||s.length>1&&u(t))return;t=g(t,i);var n=e[t.tagName];n||(n=e.defaultAction),n(t)}function f(e){t.splitSafeEach(e.childNodes,a)}function l(e,t){return t>=0&&e.hasChildNodes()&&t<e.childNodes.length&&e.childNodes[t].tagName==="BR"}function c(){var e=r.getNode(),t=i.getParent(e,"td");return t!==null}var t=this,r=t.ed.selection,i=t.ed.dom,s,o;s=e.elements,o=r.getRng(!0),o.collapsed||(l(o.endContainer,o.endOffset-1)&&(o.setEnd(o.endContainer,o.endOffset-1),r.setRng(o)),l(o.startContainer,o.startOffset)&&(o.setStart(o.startContainer,o.startOffset+1),r.setRng(o)));if(tinymce.isIE8){var h=t.ed.selection.getNode();if(h.tagName==="LI"&&h.parentNode.lastChild!==h){var p=t.ed.getDoc().createTextNode("﻿");h.appendChild(p)}}n=r.getBookmark(),e.OL=e.UL=f,t.splitSafeEach(s,a),r.moveToBookmark(n),n=null,c()||t.ed.execCommand("mceRepaint")},splitSafeEach:function(t,n){tinymce.isGecko&&(/Firefox\/[12]\.[0-9]/.test(navigator.userAgent)||/Firefox\/3\.[0-4]/.test(navigator.userAgent))?this.classBasedEach(t,n):e(t,n)},classBasedEach:function(t,n){var r=this.ed.dom,i,s;e(t,function(e){r.addClass(e,"_mce_act_on")}),i=r.select("._mce_act_on");while(i.length>0)s=i.shift(),r.removeClass(s,"_mce_act_on"),n(s),i=r.select("._mce_act_on")},adjustPaddingFunction:function(e){var t,n,r=this.ed;return t=r.settings.indentation,n=/[a-z%]+/i.exec(t),t=parseInt(t,10),function(i){var s,o;s=parseInt(r.dom.getStyle(i,"margin-left")||0,10)+parseInt(r.dom.getStyle(i,"padding-left")||0,10),e?o=s+t:o=s-t,r.dom.setStyle(i,"padding-left",""),r.dom.setStyle(i,"margin-left",o>0?o+n:"")}},selectedBlocks:function(){var e=this.ed,t=e.selection.getSelectedBlocks();return t.length==0?[e.dom.getRoot()]:t},getInfo:function(){return{longname:"Lists",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/lists",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("lists",tinymce.plugins.Lists)})();