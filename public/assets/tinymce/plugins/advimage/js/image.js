var ImageDialog={preInit:function(){var e;tinyMCEPopup.requireLangPack(),(e=tinyMCEPopup.getParam("external_image_list_url"))&&document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(e)+'"></script>')},init:function(e){var t=document.forms[0],n=t.elements,e=tinyMCEPopup.editor,r=e.dom,i=e.selection.getNode(),s=tinyMCEPopup.getParam("external_image_list","tinyMCEImageList");tinyMCEPopup.resizeToInnerSize(),this.fillClassList("class_list"),this.fillFileList("src_list",s),this.fillFileList("over_list",s),this.fillFileList("out_list",s),TinyMCE_EditableSelects.init(),i.nodeName=="IMG"&&(n.src.value=r.getAttrib(i,"src"),n.width.value=r.getAttrib(i,"width"),n.height.value=r.getAttrib(i,"height"),n.alt.value=r.getAttrib(i,"alt"),n.title.value=r.getAttrib(i,"title"),n.vspace.value=this.getAttrib(i,"vspace"),n.hspace.value=this.getAttrib(i,"hspace"),n.border.value=this.getAttrib(i,"border"),selectByValue(t,"align",this.getAttrib(i,"align")),selectByValue(t,"class_list",r.getAttrib(i,"class"),!0,!0),n.style.value=r.getAttrib(i,"style"),n.id.value=r.getAttrib(i,"id"),n.dir.value=r.getAttrib(i,"dir"),n.lang.value=r.getAttrib(i,"lang"),n.usemap.value=r.getAttrib(i,"usemap"),n.longdesc.value=r.getAttrib(i,"longdesc"),n.insert.value=e.getLang("update"),/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/.test(r.getAttrib(i,"onmouseover"))&&(n.onmouseoversrc.value=r.getAttrib(i,"onmouseover").replace(/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/,"$1")),/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/.test(r.getAttrib(i,"onmouseout"))&&(n.onmouseoutsrc.value=r.getAttrib(i,"onmouseout").replace(/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/,"$1")),e.settings.inline_styles&&(r.getAttrib(i,"align")&&this.updateStyle("align"),r.getAttrib(i,"hspace")&&this.updateStyle("hspace"),r.getAttrib(i,"border")&&this.updateStyle("border"),r.getAttrib(i,"vspace")&&this.updateStyle("vspace"))),document.getElementById("srcbrowsercontainer").innerHTML=getBrowserHTML("srcbrowser","src","image","theme_advanced_image"),isVisible("srcbrowser")&&(document.getElementById("src").style.width="260px"),document.getElementById("onmouseoversrccontainer").innerHTML=getBrowserHTML("overbrowser","onmouseoversrc","image","theme_advanced_image"),isVisible("overbrowser")&&(document.getElementById("onmouseoversrc").style.width="260px"),document.getElementById("onmouseoutsrccontainer").innerHTML=getBrowserHTML("outbrowser","onmouseoutsrc","image","theme_advanced_image"),isVisible("outbrowser")&&(document.getElementById("onmouseoutsrc").style.width="260px"),e.getParam("advimage_constrain_proportions",!0)&&(t.constrain.checked=!0),n.onmouseoversrc.value||n.onmouseoutsrc.value?this.setSwapImage(!0):this.setSwapImage(!1),this.changeAppearance(),this.showPreviewImage(n.src.value,1)},insert:function(e,t){var n=tinyMCEPopup.editor,r=this,i=document.forms[0];if(i.src.value===""){n.selection.getNode().nodeName=="IMG"&&(n.dom.remove(n.selection.getNode()),n.execCommand("mceRepaint")),tinyMCEPopup.close();return}if(tinyMCEPopup.getParam("accessibility_warnings",1)&&!i.alt.value){tinyMCEPopup.confirm(tinyMCEPopup.getLang("advimage_dlg.missing_alt"),function(e){e&&r.insertAndClose()});return}r.insertAndClose()},insertAndClose:function(){var e=tinyMCEPopup.editor,t=document.forms[0],n=t.elements,r,i={},s;tinyMCEPopup.restoreSelection(),tinymce.isWebKit&&e.getWin().focus(),e.settings.inline_styles?i={vspace:"",hspace:"",border:"",align:""}:i={vspace:n.vspace.value,hspace:n.hspace.value,border:n.border.value,align:getSelectValue(t,"align")},tinymce.extend(i,{src:n.src.value.replace(/ /g,"%20"),width:n.width.value,height:n.height.value,alt:n.alt.value,title:n.title.value,"class":getSelectValue(t,"class_list"),style:n.style.value,id:n.id.value,dir:n.dir.value,lang:n.lang.value,usemap:n.usemap.value,longdesc:n.longdesc.value}),i.onmouseover=i.onmouseout="",t.onmousemovecheck.checked&&(n.onmouseoversrc.value&&(i.onmouseover="this.src='"+n.onmouseoversrc.value+"';"),n.onmouseoutsrc.value&&(i.onmouseout="this.src='"+n.onmouseoutsrc.value+"';")),s=e.selection.getNode(),s&&s.nodeName=="IMG"?e.dom.setAttribs(s,i):(tinymce.each(i,function(e,t){e===""&&delete i[t]}),e.execCommand("mceInsertContent",!1,tinyMCEPopup.editor.dom.createHTML("img",i),{skip_undo:1}),e.undoManager.add()),tinyMCEPopup.editor.execCommand("mceRepaint"),tinyMCEPopup.editor.focus(),tinyMCEPopup.close()},getAttrib:function(e,t){var n=tinyMCEPopup.editor,r=n.dom,i,s;if(n.settings.inline_styles)switch(t){case"align":if(i=r.getStyle(e,"float"))return i;if(i=r.getStyle(e,"vertical-align"))return i;break;case"hspace":i=r.getStyle(e,"margin-left"),s=r.getStyle(e,"margin-right");if(i&&i==s)return parseInt(i.replace(/[^0-9]/g,""));break;case"vspace":i=r.getStyle(e,"margin-top"),s=r.getStyle(e,"margin-bottom");if(i&&i==s)return parseInt(i.replace(/[^0-9]/g,""));break;case"border":i=0,tinymce.each(["top","right","bottom","left"],function(t){t=r.getStyle(e,"border-"+t+"-width");if(!t||t!=i&&i!==0)return i=0,!1;t&&(i=t)});if(i)return parseInt(i.replace(/[^0-9]/g,""))}return(i=r.getAttrib(e,t))?i:""},setSwapImage:function(e){var t=document.forms[0];t.onmousemovecheck.checked=e,setBrowserDisabled("overbrowser",!e),setBrowserDisabled("outbrowser",!e),t.over_list&&(t.over_list.disabled=!e),t.out_list&&(t.out_list.disabled=!e),t.onmouseoversrc.disabled=!e,t.onmouseoutsrc.disabled=!e},fillClassList:function(e){var t=tinyMCEPopup.dom,n=t.get(e),r,i;(r=tinyMCEPopup.getParam("theme_advanced_styles"))?(i=[],tinymce.each(r.split(";"),function(e){var t=e.split("=");i.push({title:t[0],"class":t[1]})})):i=tinyMCEPopup.editor.dom.getClasses(),i.length>0?(n.options.length=0,n.options[n.options.length]=new Option(tinyMCEPopup.getLang("not_set"),""),tinymce.each(i,function(e){n.options[n.options.length]=new Option(e.title||e["class"],e["class"])})):t.remove(t.getParent(e,"tr"))},fillFileList:function(e,t){var n=tinyMCEPopup.dom,r=n.get(e),i,s;t=typeof t=="function"?t():window[t],r.options.length=0,t&&t.length>0?(r.options[r.options.length]=new Option("",""),tinymce.each(t,function(e){r.options[r.options.length]=new Option(e[0],e[1])})):n.remove(n.getParent(e,"tr"))},resetImageData:function(){var e=document.forms[0];e.elements.width.value=e.elements.height.value=""},updateImageData:function(e,t){var n=document.forms[0];t||(n.elements.width.value=e.width,n.elements.height.value=e.height),this.preloadImg=e},changeAppearance:function(){var e=tinyMCEPopup.editor,t=document.forms[0],n=document.getElementById("alignSampleImg");n&&(e.getParam("inline_styles")?e.dom.setAttrib(n,"style",t.style.value):(n.align=t.align.value,n.border=t.border.value,n.hspace=t.hspace.value,n.vspace=t.vspace.value))},changeHeight:function(){var e=document.forms[0],t,n=this;if(!e.constrain.checked||!n.preloadImg)return;if(e.width.value==""||e.height.value=="")return;t=parseInt(e.width.value)/parseInt(n.preloadImg.width)*n.preloadImg.height,e.height.value=t.toFixed(0)},changeWidth:function(){var e=document.forms[0],t,n=this;if(!e.constrain.checked||!n.preloadImg)return;if(e.width.value==""||e.height.value=="")return;t=parseInt(e.height.value)/parseInt(n.preloadImg.height)*n.preloadImg.width,e.width.value=t.toFixed(0)},updateStyle:function(e){var t=tinyMCEPopup.dom,n,r,i,s,o=tinymce.isIE,u=document.forms[0],a=t.create("img",{style:t.get("style").value});if(tinyMCEPopup.editor.settings.inline_styles){e=="align"&&(t.setStyle(a,"float",""),t.setStyle(a,"vertical-align",""),s=getSelectValue(u,"align"),s&&(s=="left"||s=="right"?t.setStyle(a,"float",s):a.style.verticalAlign=s));if(e=="border"){n=a.style.border?a.style.border.split(" "):[],r=t.getStyle(a,"border-style"),i=t.getStyle(a,"border-color"),t.setStyle(a,"border",""),s=u.border.value;if(s||s=="0")if(s=="0")a.style.border=o?"0":"0 none none";else{if(n.length==3&&n[o?2:1])r=n[o?2:1];else if(!r||r=="none")r="solid";if(n.length==3&&n[o?0:2])i=n[o?0:2];else if(!i||i=="none")i="black";a.style.border=s+"px "+r+" "+i}}e=="hspace"&&(t.setStyle(a,"marginLeft",""),t.setStyle(a,"marginRight",""),s=u.hspace.value,s&&(a.style.marginLeft=s+"px",a.style.marginRight=s+"px")),e=="vspace"&&(t.setStyle(a,"marginTop",""),t.setStyle(a,"marginBottom",""),s=u.vspace.value,s&&(a.style.marginTop=s+"px",a.style.marginBottom=s+"px")),t.get("style").value=t.serializeStyle(t.parseStyle(a.style.cssText),"img")}},changeMouseMove:function(){},showPreviewImage:function(e,t){if(!e){tinyMCEPopup.dom.setHTML("prev","");return}!t&&tinyMCEPopup.getParam("advimage_update_dimensions_onchange",!0)&&this.resetImageData(),e=tinyMCEPopup.editor.documentBaseURI.toAbsolute(e),t?tinyMCEPopup.dom.setHTML("prev",'<img id="previewImg" src="'+e+'" border="0" onload="ImageDialog.updateImageData(this, 1);" />'):tinyMCEPopup.dom.setHTML("prev",'<img id="previewImg" src="'+e+'" border="0" onload="ImageDialog.updateImageData(this);" onerror="ImageDialog.resetImageData();" />')}};ImageDialog.preInit(),tinyMCEPopup.onInit.add(ImageDialog.init,ImageDialog);