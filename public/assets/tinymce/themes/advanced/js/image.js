var ImageDialog={preInit:function(){var e;tinyMCEPopup.requireLangPack(),(e=tinyMCEPopup.getParam("external_image_list_url"))&&document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(e)+'"></script>')},init:function(){var t=document.forms[0],n=tinyMCEPopup.editor;document.getElementById("srcbrowsercontainer").innerHTML=getBrowserHTML("srcbrowser","src","image","theme_advanced_image"),isVisible("srcbrowser")&&(document.getElementById("src").style.width="180px"),e=n.selection.getNode(),this.fillFileList("image_list",tinyMCEPopup.getParam("external_image_list","tinyMCEImageList")),e.nodeName=="IMG"&&(t.src.value=n.dom.getAttrib(e,"src"),t.alt.value=n.dom.getAttrib(e,"alt"),t.border.value=this.getAttrib(e,"border"),t.vspace.value=this.getAttrib(e,"vspace"),t.hspace.value=this.getAttrib(e,"hspace"),t.width.value=n.dom.getAttrib(e,"width"),t.height.value=n.dom.getAttrib(e,"height"),t.insert.value=n.getLang("update"),this.styleVal=n.dom.getAttrib(e,"style"),selectByValue(t,"image_list",t.src.value),selectByValue(t,"align",this.getAttrib(e,"align")),this.updateStyle())},fillFileList:function(e,t){var n=tinyMCEPopup.dom,r=n.get(e),i,s;t=typeof t=="function"?t():window[t],t&&t.length>0?(r.options[r.options.length]=new Option("",""),tinymce.each(t,function(e){r.options[r.options.length]=new Option(e[0],e[1])})):n.remove(n.getParent(e,"tr"))},update:function(){var e=document.forms[0],t=e.elements,n=tinyMCEPopup.editor,r={},i;tinyMCEPopup.restoreSelection();if(e.src.value===""){n.selection.getNode().nodeName=="IMG"&&(n.dom.remove(n.selection.getNode()),n.execCommand("mceRepaint")),tinyMCEPopup.close();return}n.settings.inline_styles?r.style=this.styleVal:r=tinymce.extend(r,{vspace:t.vspace.value,hspace:t.hspace.value,border:t.border.value,align:getSelectValue(e,"align")}),tinymce.extend(r,{src:e.src.value.replace(/ /g,"%20"),alt:e.alt.value,width:e.width.value,height:e.height.value}),i=n.selection.getNode(),i&&i.nodeName=="IMG"?(n.dom.setAttribs(i,r),tinyMCEPopup.editor.execCommand("mceRepaint"),tinyMCEPopup.editor.focus()):(tinymce.each(r,function(e,t){e===""&&delete r[t]}),n.execCommand("mceInsertContent",!1,tinyMCEPopup.editor.dom.createHTML("img",r),{skip_undo:1}),n.undoManager.add()),tinyMCEPopup.close()},updateStyle:function(){var e=tinyMCEPopup.dom,t,n,r=document.forms[0];tinyMCEPopup.editor.settings.inline_styles&&(t=tinyMCEPopup.dom.parseStyle(this.styleVal),n=getSelectValue(r,"align"),n?n=="left"||n=="right"?(t["float"]=n,delete t["vertical-align"]):(t["vertical-align"]=n,delete t["float"]):(delete t["float"],delete t["vertical-align"]),n=r.border.value,n||n=="0"?n=="0"?t.border="0":t.border=n+"px solid black":delete t.border,n=r.hspace.value,n?(delete t.margin,t["margin-left"]=n+"px",t["margin-right"]=n+"px"):(delete t["margin-left"],delete t["margin-right"]),n=r.vspace.value,n?(delete t.margin,t["margin-top"]=n+"px",t["margin-bottom"]=n+"px"):(delete t["margin-top"],delete t["margin-bottom"]),t=tinyMCEPopup.dom.parseStyle(e.serializeStyle(t),"img"),this.styleVal=e.serializeStyle(t,"img"))},getAttrib:function(e,t){var n=tinyMCEPopup.editor,r=n.dom,i,s;if(n.settings.inline_styles)switch(t){case"align":if(i=r.getStyle(e,"float"))return i;if(i=r.getStyle(e,"vertical-align"))return i;break;case"hspace":i=r.getStyle(e,"margin-left"),s=r.getStyle(e,"margin-right");if(i&&i==s)return parseInt(i.replace(/[^0-9]/g,""));break;case"vspace":i=r.getStyle(e,"margin-top"),s=r.getStyle(e,"margin-bottom");if(i&&i==s)return parseInt(i.replace(/[^0-9]/g,""));break;case"border":i=0,tinymce.each(["top","right","bottom","left"],function(t){t=r.getStyle(e,"border-"+t+"-width");if(!t||t!=i&&i!==0)return i=0,!1;t&&(i=t)});if(i)return parseInt(i.replace(/[^0-9]/g,""))}return(i=r.getAttrib(e,t))?i:""},resetImageData:function(){var e=document.forms[0];e.width.value=e.height.value=""},updateImageData:function(){var e=document.forms[0],t=ImageDialog;e.width.value==""&&(e.width.value=t.preloadImg.width),e.height.value==""&&(e.height.value=t.preloadImg.height)},getImageData:function(){var e=document.forms[0];this.preloadImg=new Image,this.preloadImg.onload=this.updateImageData,this.preloadImg.onerror=this.resetImageData,this.preloadImg.src=tinyMCEPopup.editor.documentBaseURI.toAbsolute(e.src.value)}};ImageDialog.preInit(),tinyMCEPopup.onInit.add(ImageDialog.init,ImageDialog);