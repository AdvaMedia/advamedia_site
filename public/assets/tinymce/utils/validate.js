/**
 * validate.js
 *
 * Copyright 2009, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http://tinymce.moxiecode.com/license
 * Contributing: http://tinymce.moxiecode.com/contributing
 */
/**
	// String validation:

	if (!Validator.isEmail('myemail'))
		alert('Invalid email.');

	// Form validation:

	var f = document.forms['myform'];

	if (!Validator.isEmail(f.myemail))
		alert('Invalid email.');
*/
var Validator={isEmail:function(e){return this.test(e,"^[-!#$%&'*+\\./0-9=?A-Z^_`a-z{|}~]+@[-!#$%&'*+\\/0-9=?A-Z^_`a-z{|}~]+.[-!#$%&'*+\\./0-9=?A-Z^_`a-z{|}~]+$")},isAbsUrl:function(e){return this.test(e,"^(news|telnet|nttp|file|http|ftp|https)://[-A-Za-z0-9\\.]+\\/?.*$")},isSize:function(e){return this.test(e,"^[0-9.]+(%|in|cm|mm|em|ex|pt|pc|px)?$")},isId:function(e){return this.test(e,"^[A-Za-z_]([A-Za-z0-9_])*$")},isEmpty:function(e){var t,n;if(e.nodeName=="SELECT"&&e.selectedIndex<1)return!0;if(e.type=="checkbox"&&!e.checked)return!0;if(e.type=="radio"){for(n=0,t=e.form.elements;n<t.length;n++)if(t[n].type=="radio"&&t[n].name==e.name&&t[n].checked)return!1;return!0}return(new RegExp("^\\s*$")).test(e.nodeType==1?e.value:e)},isNumber:function(e,t){return!isNaN(e.nodeType==1?e.value:e)&&(!t||!this.test(e,"^-?[0-9]*\\.[0-9]*$"))},test:function(e,t){return e=e.nodeType==1?e.value:e,e==""||(new RegExp(t)).test(e)}},AutoValidator={settings:{id_cls:"id",int_cls:"int",url_cls:"url",number_cls:"number",email_cls:"email",size_cls:"size",required_cls:"required",invalid_cls:"invalid",min_cls:"min",max_cls:"max"},init:function(e){var t;for(t in e)this.settings[t]=e[t]},validate:function(e){var t,n,r=this.settings,i=0;n=this.tags(e,"label");for(t=0;t<n.length;t++)this.removeClass(n[t],r.invalid_cls),n[t].setAttribute("aria-invalid",!1);return i+=this.validateElms(e,"input"),i+=this.validateElms(e,"select"),i+=this.validateElms(e,"textarea"),i==3},invalidate:function(e){this.mark(e.form,e)},getErrorMessages:function(e){var t,n,r=this.settings,i,s,o,u=[],a=tinyMCEPopup.editor;t=this.tags(e,"label");for(n=0;n<t.length;n++)this.hasClass(t[n],r.invalid_cls)&&(i=document.getElementById(t[n].getAttribute("for")),o={field:t[n].textContent},this.hasClass(i,r.min_cls,!0)?(message=a.getLang("invalid_data_min"),o.min=this.getNum(i,r.min_cls)):this.hasClass(i,r.number_cls)?message=a.getLang("invalid_data_number"):this.hasClass(i,r.size_cls)?message=a.getLang("invalid_data_size"):message=a.getLang("invalid_data"),message=message.replace(/{\#([^}]+)\}/g,function(e,t){return o[t]||"{#"+t+"}"}),u.push(message));return u},reset:function(e){var t=["label","input","select","textarea"],n,r,i,s=this.settings;if(e==null)return;for(n=0;n<t.length;n++){i=this.tags(e.form?e.form:e,t[n]);for(r=0;r<i.length;r++)this.removeClass(i[r],s.invalid_cls),i[r].setAttribute("aria-invalid",!1)}},validateElms:function(e,t){var n,r,i,s=this.settings,o=!0,u=Validator,a;n=this.tags(e,t);for(r=0;r<n.length;r++){i=n[r],this.removeClass(i,s.invalid_cls),this.hasClass(i,s.required_cls)&&u.isEmpty(i)&&(o=this.mark(e,i)),this.hasClass(i,s.number_cls)&&!u.isNumber(i)&&(o=this.mark(e,i)),this.hasClass(i,s.int_cls)&&!u.isNumber(i,!0)&&(o=this.mark(e,i)),this.hasClass(i,s.url_cls)&&!u.isAbsUrl(i)&&(o=this.mark(e,i)),this.hasClass(i,s.email_cls)&&!u.isEmail(i)&&(o=this.mark(e,i)),this.hasClass(i,s.size_cls)&&!u.isSize(i)&&(o=this.mark(e,i)),this.hasClass(i,s.id_cls)&&!u.isId(i)&&(o=this.mark(e,i));if(this.hasClass(i,s.min_cls,!0)){a=this.getNum(i,s.min_cls);if(isNaN(a)||parseInt(i.value)<parseInt(a))o=this.mark(e,i)}if(this.hasClass(i,s.max_cls,!0)){a=this.getNum(i,s.max_cls);if(isNaN(a)||parseInt(i.value)>parseInt(a))o=this.mark(e,i)}}return o},hasClass:function(e,t,n){return(new RegExp("\\b"+t+(n?"[0-9]+":"")+"\\b","g")).test(e.className)},getNum:function(e,t){return t=e.className.match(new RegExp("\\b"+t+"([0-9]+)\\b","g"))[0],t=t.replace(/[^0-9]/g,""),t},addClass:function(e,t,n){var r=this.removeClass(e,t);e.className=n?t+(r!=""?" "+r:""):(r!=""?r+" ":"")+t},removeClass:function(e,t){return t=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," "),e.className=t!=" "?t:""},tags:function(e,t){return e.getElementsByTagName(t)},mark:function(e,t){var n=this.settings;return this.addClass(t,n.invalid_cls),t.setAttribute("aria-invalid","true"),this.markLabels(e,t,n.invalid_cls),!1},markLabels:function(e,t,n){var r,i;r=this.tags(e,"label");for(i=0;i<r.length;i++)(r[i].getAttribute("for")==t.id||r[i].htmlFor==t.id)&&this.addClass(r[i],n);return null}};