/*!
* Aloha Editor
* Author & Copyright (c) 2010 Gentics Software GmbH
* aloha-sales@gentics.com
* Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
define(["aloha","aloha/jquery","aloha/contenthandlermanager"],function(a,b,c){var d=window.GENTICS,e=c.createHandler({handleContent:function(a){typeof a=="string"?a=b("<div>"+a+"</div>"):a instanceof b&&(a=b("<div>").append(a));if(a.find(".aloha-block").length>0)return;return this.cleanLists(a),this.transformTables(a),this.removeComments(a),this.unwrapTags(a),this.removeStyles(a),this.removeNamespacedElements(a),this.transformFormattings(a),a.html()},cleanLists:function(a){a.find("ul,ol").each(function(){var a=b(this);a.contents(":not(li,ul,ol)").each(function(){b(this).remove()}),a.children("li").each(function(){var a=b(this);a.contents().each(function(){this.nodeType===3&&(this.data=b.trim(this.data))})})})},transformTables:function(a){a.find("table").each(function(){b(this).removeAttr("border").removeAttr("cellspacing").removeAttr("cellpadding")}),a.find("td").each(function(){b(this).removeAttr("width").removeAttr("height").removeAttr("valign"),this.innerHTML.replace(/[\s\xA0]+/g,"")==="<p><br></p>"&&(this.innerHTML="&nbsp;"),b(this).find("p").length==1&&b(this).find("p").contents().unwrap()}),a.find("tr").each(function(){b(this).removeAttr("width").removeAttr("height").removeAttr("valign")}),a.find("colgroup").remove()},transformFormattings:function(c){c.find("strong,em,s,u").each(function(){this.nodeName.toLowerCase()=="strong"?a.Markup.transformDomObject(b(this),"b"):this.nodeName.toLowerCase()=="em"?a.Markup.transformDomObject(b(this),"i"):this.nodeName.toLowerCase()=="s"?a.Markup.transformDomObject(b(this),"del"):this.nodeName.toLowerCase()=="u"&&b(this).contents().unwrap()})},transformLinks:function(a){a.find("a").each(function(){typeof b(this).attr("href")=="undefined"&&b(this).contents().unwrap()})},removeComments:function(a){var c=this;a.contents().each(function(){this.nodeType==8?b(this).remove():c.removeComments(b(this))})},unwrapTags:function(c){var d=this;c.children("span,font,div").filter(function(){return this.contentEditable!="false"}).each(function(){this.nodeName=="DIV"?this.innerHTML=="<br>"?b(this).contents().unwrap():b(a.Markup.transformDomObject(b(this),"p").append("<br>")).contents().unwrap():b(this).contents().unwrap(),d.unwrapTags(b(this))})},removeStyles:function(a){var c=this;a.children("style").filter(function(){return this.contentEditable!="false"}).remove(),a.children().filter(function(){return this.contentEditable!="false"}).each(function(){b(this).removeAttr("style").removeClass(),c.removeStyles(b(this))})},removeNamespacedElements:function(a){a.find("*").each(function(){var a=this.prefix?this.prefix:this.scopeName?this.scopeName:undefined;if(a&&a!="HTML"||this.nodeName.indexOf(":")>=0){var c=b(this),d=c.contents();d.length?d.unwrap():c.remove()}})}});return e});