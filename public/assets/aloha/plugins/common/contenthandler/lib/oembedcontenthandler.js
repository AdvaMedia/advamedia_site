/*!
* Aloha Editor
* Author & Copyright (c) 2010 Gentics Software GmbH
* aloha-sales@gentics.com
* Licensed unter the terms of http://www.aloha-editor.com/license.html
* Uses jquery-oEmbed
* Made by Thomas LÃ©tÃ© for Aloha Editor
*/
define(["aloha","aloha/jquery","aloha/contenthandlermanager"],function(a,b,c){var d=window.GENTICS,e=window.escape,f,g,h,i;g=function(a){for(var b=0;b<f.length;b++)if(f[b].matches(a))return f[b];return null},h=function(a){var b={},c;if(a==null)return null;for(c in a)c!=null&&(b[c.toLowerCase()]=a[c]);return b},i=function(a,c,d,f){this.name=a,this.urlPattern=c,this.oEmbedUrl=d!=null?d:"http://oohembed.com/oohembed/",this.callbackparameter=f!=null?f:"callback",this.maxWidth=500,this.maxHeight=400,this.matches=function(a){return a.indexOf(this.urlPattern)>=0},this.getRequestUrl=function(a){var b=this.oEmbedUrl,c="",d;b.indexOf("?")<=0?b+="?":b+="&",this.maxWidth!=null&&this.params.maxwidth==null&&(this.params.maxwidth=this.maxWidth),this.maxHeight!=null&&this.params.maxheight==null&&(this.params.maxheight=this.maxHeight);for(d in this.params){if(d==this.callbackparameter)continue;this.params[d]!=null&&(c+="&"+e(d)+"="+this.params[d])}return b+="format=json&url="+e(a)+c+"&"+this.callbackparameter+"=?",b},this.embedCode=function(a,c,d){var e=this.getRequestUrl(c);b.getJSON(e,function(e){var f=e,g,h=e.type;switch(h){case"photo":f.code=b.fn.oembed.getPhotoCode(c,e);break;case"video":f.code=b.fn.oembed.getVideoCode(c,e);break;case"rich":f.code=b.fn.oembed.getRichCode(c,e);break;default:f.code=b.fn.oembed.getGenericCode(c,e)}d(a,f)})}},f=[new i("fivemin","5min.com"),new i("amazon","amazon.com"),new i("flickr","flickr","http://flickr.com/services/oembed","jsoncallback"),new i("googlevideo","video.google."),new i("hulu","hulu.com"),new i("imdb","imdb.com"),new i("metacafe","metacafe.com"),new i("qik","qik.com"),new i("revision3","revision3.com"),new i("slideshare","slideshare.net"),new i("twitpic","twitpic.com"),new i("viddler","viddler.com"),new i("vimeo","vimeo.com","http://vimeo.com/api/oembed.json"),new i("wikipedia","wikipedia.org"),new i("wordpress","wordpress.com"),new i("youtube","youtube.com"),new i("vids.myspace.com","vids.myspace.com","http://vids.myspace.com/index.cfm?fuseaction=oembed"),new i("screenr","screenr.com","http://screenr.com/api/oembed.json")],b.fn.oembed=function(a,c,d){return c=b.extend(!0,b.fn.oembed.defaults,c),this.each(function(){var e=b(this),f=a!=null?a:e.attr("href"),i;d||(d=function(a,d){b.fn.oembed.insertCode(a,c.embedMethod,d)});if(f!=null){i=g(f);if(i!=null){i.params=h(c[i.name])||{},i.maxWidth=c.maxWidth,i.maxHeight=c.maxHeight,i.embedCode(e,f,d);return}}d(e,null)})},b.fn.oembed.defaults={maxWidth:null,maxHeight:null,embedMethod:"fill"},b.fn.oembed.insertCode=function(a,c,d){if(d==null)return;switch(c){case"auto":a.attr("href")!=null?b.fn.oembed.insertCode(a,"append",d):b.fn.oembed.insertCode(a,"replace",d);break;case"replace":a.replaceWith(d.code);break;case"fill":a.html(d.code);break;case"append":var e=a.next();if(e==null||!e.hasClass("oembed-container"))e=a.after('<div class="oembed-container"></div>').next(".oembed-container"),d!=null&&d.provider_name!=null&&e.toggleClass("oembed-container-"+d.provider_name);e.html(d.code)}},b.fn.oembed.getPhotoCode=function(a,b){var c=b.title?b.title:"",d;return c+=b.author_name?" - "+b.author_name:"",c+=b.provider_name?" - "+b.provider_name:"",d='<div><a href="'+a+'" target="_blank"><img src="'+b.url+'" alt="'+c+'"/></a></div>',b.html&&(d+="<div>"+b.html+"</div>"),d},b.fn.oembed.getVideoCode=function(a,b){var c=b.html;return c},b.fn.oembed.getRichCode=function(a,b){var c=b.html;return c},b.fn.oembed.getGenericCode=function(a,b){var c=b.title!=null?b.title:a,d='<a href="'+a+'">'+c+"</a>";return b.html&&(d+="<div>"+b.html+"</div>"),d},b.fn.oembed.isAvailable=function(a){var b=g(a);return b!=null};var j=c.createHandler({handleContent:function(a){return typeof a=="string"?a=b("<div>"+a+"</div>"):a instanceof b&&(a=b("<div>").append(a)),this.replaceoEmbedContent(a),a.html()},replaceoEmbedContent:function(a){a.contents().each(function(){var a=b(this);a.oembed(a.text())})}});return j});