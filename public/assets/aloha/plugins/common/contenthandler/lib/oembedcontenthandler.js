/*!
* Aloha Editor
* Author & Copyright (c) 2010 Gentics Software GmbH
* aloha-sales@gentics.com
* Licensed unter the terms of http://www.aloha-editor.com/license.html
* Uses jquery-oEmbed
* Made by Thomas LÃ©tÃ© for Aloha Editor
*/
define(["aloha","aloha/jquery","aloha/contenthandlermanager"],function(e,t,n){var r=window.GENTICS,i=window.escape,s,o,u,a;o=function(e){for(var t=0;t<s.length;t++)if(s[t].matches(e))return s[t];return null},u=function(e){var t={},n;if(e==null)return null;for(n in e)n!=null&&(t[n.toLowerCase()]=e[n]);return t},a=function(e,n,r,s){this.name=e,this.urlPattern=n,this.oEmbedUrl=r!=null?r:"http://oohembed.com/oohembed/",this.callbackparameter=s!=null?s:"callback",this.maxWidth=500,this.maxHeight=400,this.matches=function(e){return e.indexOf(this.urlPattern)>=0},this.getRequestUrl=function(e){var t=this.oEmbedUrl,n="",r;t.indexOf("?")<=0?t+="?":t+="&",this.maxWidth!=null&&this.params.maxwidth==null&&(this.params.maxwidth=this.maxWidth),this.maxHeight!=null&&this.params.maxheight==null&&(this.params.maxheight=this.maxHeight);for(r in this.params){if(r==this.callbackparameter)continue;this.params[r]!=null&&(n+="&"+i(r)+"="+this.params[r])}return t+="format=json&url="+i(e)+n+"&"+this.callbackparameter+"=?",t},this.embedCode=function(e,n,r){var i=this.getRequestUrl(n);t.getJSON(i,function(i){var s=i,o,u=i.type;switch(u){case"photo":s.code=t.fn.oembed.getPhotoCode(n,i);break;case"video":s.code=t.fn.oembed.getVideoCode(n,i);break;case"rich":s.code=t.fn.oembed.getRichCode(n,i);break;default:s.code=t.fn.oembed.getGenericCode(n,i)}r(e,s)})}},s=[new a("fivemin","5min.com"),new a("amazon","amazon.com"),new a("flickr","flickr","http://flickr.com/services/oembed","jsoncallback"),new a("googlevideo","video.google."),new a("hulu","hulu.com"),new a("imdb","imdb.com"),new a("metacafe","metacafe.com"),new a("qik","qik.com"),new a("revision3","revision3.com"),new a("slideshare","slideshare.net"),new a("twitpic","twitpic.com"),new a("viddler","viddler.com"),new a("vimeo","vimeo.com","http://vimeo.com/api/oembed.json"),new a("wikipedia","wikipedia.org"),new a("wordpress","wordpress.com"),new a("youtube","youtube.com"),new a("vids.myspace.com","vids.myspace.com","http://vids.myspace.com/index.cfm?fuseaction=oembed"),new a("screenr","screenr.com","http://screenr.com/api/oembed.json")],t.fn.oembed=function(e,n,r){return n=t.extend(!0,t.fn.oembed.defaults,n),this.each(function(){var i=t(this),s=e!=null?e:i.attr("href"),a;r||(r=function(e,r){t.fn.oembed.insertCode(e,n.embedMethod,r)});if(s!=null){a=o(s);if(a!=null){a.params=u(n[a.name])||{},a.maxWidth=n.maxWidth,a.maxHeight=n.maxHeight,a.embedCode(i,s,r);return}}r(i,null)})},t.fn.oembed.defaults={maxWidth:null,maxHeight:null,embedMethod:"fill"},t.fn.oembed.insertCode=function(e,n,r){if(r==null)return;switch(n){case"auto":e.attr("href")!=null?t.fn.oembed.insertCode(e,"append",r):t.fn.oembed.insertCode(e,"replace",r);break;case"replace":e.replaceWith(r.code);break;case"fill":e.html(r.code);break;case"append":var i=e.next();if(i==null||!i.hasClass("oembed-container"))i=e.after('<div class="oembed-container"></div>').next(".oembed-container"),r!=null&&r.provider_name!=null&&i.toggleClass("oembed-container-"+r.provider_name);i.html(r.code)}},t.fn.oembed.getPhotoCode=function(e,t){var n=t.title?t.title:"",r;return n+=t.author_name?" - "+t.author_name:"",n+=t.provider_name?" - "+t.provider_name:"",r='<div><a href="'+e+'" target="_blank"><img src="'+t.url+'" alt="'+n+'"/></a></div>',t.html&&(r+="<div>"+t.html+"</div>"),r},t.fn.oembed.getVideoCode=function(e,t){var n=t.html;return n},t.fn.oembed.getRichCode=function(e,t){var n=t.html;return n},t.fn.oembed.getGenericCode=function(e,t){var n=t.title!=null?t.title:e,r='<a href="'+e+'">'+n+"</a>";return t.html&&(r+="<div>"+t.html+"</div>"),r},t.fn.oembed.isAvailable=function(e){var t=o(e);return t!=null};var f=n.createHandler({handleContent:function(e){return typeof e=="string"?e=t("<div>"+e+"</div>"):e instanceof t&&(e=t("<div>").append(e)),this.replaceoEmbedContent(e),e.html()},replaceoEmbedContent:function(e){e.contents().each(function(){var e=t(this);e.oembed(e.text())})}});return f});