/**
 * Diff Match and Patch
 *
 * Copyright 2006 Google Inc.
 * http://code.google.com/p/google-diff-match-patch/
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @fileoverview Computes the difference between two texts to create a patch.
 * Applies the patch onto another text, allowing for errors.
 * @author fraser@google.com (Neil Fraser)
 */
/**
 * Class containing the diff, match and patch methods.
 * @constructor
 */
function diff_match_patch(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}function patch_obj(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0}var DIFF_DELETE=-1,DIFF_INSERT=1,DIFF_EQUAL=0;diff_match_patch.Diff,diff_match_patch.prototype.diff_main=function(a,b,c,d){typeof d=="undefined"&&(this.Diff_Timeout<=0?d=Number.MAX_VALUE:d=(new Date).getTime()+this.Diff_Timeout*1e3);var e=d;if(a==null||b==null)throw new Error("Null input. (diff_main)");if(a==b)return a?[[DIFF_EQUAL,a]]:[];typeof c=="undefined"&&(c=!0);var f=c,g=this.diff_commonPrefix(a,b),h=a.substring(0,g);a=a.substring(g),b=b.substring(g),g=this.diff_commonSuffix(a,b);var i=a.substring(a.length-g);a=a.substring(0,a.length-g),b=b.substring(0,b.length-g);var j=this.diff_compute_(a,b,f,e);return h&&j.unshift([DIFF_EQUAL,h]),i&&j.push([DIFF_EQUAL,i]),this.diff_cleanupMerge(j),j},diff_match_patch.prototype.diff_compute_=function(a,b,c,d){var e;if(!a)return[[DIFF_INSERT,b]];if(!b)return[[DIFF_DELETE,a]];var f=a.length>b.length?a:b,g=a.length>b.length?b:a,h=f.indexOf(g);if(h!=-1)return e=[[DIFF_INSERT,f.substring(0,h)],[DIFF_EQUAL,g],[DIFF_INSERT,f.substring(h+g.length)]],a.length>b.length&&(e[0][0]=e[2][0]=DIFF_DELETE),e;if(g.length==1)return[[DIFF_DELETE,a],[DIFF_INSERT,b]];f=g=null;var i=this.diff_halfMatch_(a,b);if(i){var j=i[0],k=i[1],l=i[2],m=i[3],n=i[4],o=this.diff_main(j,l,c,d),p=this.diff_main(k,m,c,d);return o.concat([[DIFF_EQUAL,n]],p)}return c&&a.length>100&&b.length>100?this.diff_lineMode_(a,b,d):this.diff_bisect_(a,b,d)},diff_match_patch.prototype.diff_lineMode_=function(a,b,c){var d=this.diff_linesToChars_(a,b);a=d[0],b=d[1];var e=d[2],f=this.diff_bisect_(a,b,c);this.diff_charsToLines_(f,e),this.diff_cleanupSemantic(f),f.push([DIFF_EQUAL,""]);var g=0,h=0,i=0,j="",k="";while(g<f.length){switch(f[g][0]){case DIFF_INSERT:i++,k+=f[g][1];break;case DIFF_DELETE:h++,j+=f[g][1];break;case DIFF_EQUAL:if(h>=1&&i>=1){var d=this.diff_main(j,k,!1,c);f.splice(g-h-i,h+i),g=g-h-i;for(var l=d.length-1;l>=0;l--)f.splice(g,0,d[l]);g+=d.length}i=0,h=0,j="",k=""}g++}return f.pop(),f},diff_match_patch.prototype.diff_bisect_=function(a,b,c){var d=a.length,e=b.length,f=Math.ceil((d+e)/2),g=f,h=2*f,i=new Array(h),j=new Array(h);for(var k=0;k<h;k++)i[k]=-1,j[k]=-1;i[g+1]=0,j[g+1]=0;var l=d-e,m=l%2!=0,n=0,o=0,p=0,q=0;for(var r=0;r<f;r++){if((new Date).getTime()>c)break;for(var s=-r+n;s<=r-o;s+=2){var t=g+s,u;s==-r||s!=r&&i[t-1]<i[t+1]?u=i[t+1]:u=i[t-1]+1;var v=u-s;while(u<d&&v<e&&a.charAt(u)==b.charAt(v))u++,v++;i[t]=u;if(u>d)o+=2;else if(v>e)n+=2;else if(m){var w=g+l-s;if(w>=0&&w<h&&j[w]!=-1){var x=d-j[w];if(u>=x)return this.diff_bisectSplit_(a,b,u,v,c)}}}for(var y=-r+p;y<=r-q;y+=2){var w=g+y,x;y==-r||y!=r&&j[w-1]<j[w+1]?x=j[w+1]:x=j[w-1]+1;var z=x-y;while(x<d&&z<e&&a.charAt(d-x-1)==b.charAt(e-z-1))x++,z++;j[w]=x;if(x>d)q+=2;else if(z>e)p+=2;else if(!m){var t=g+l-y;if(t>=0&&t<h&&i[t]!=-1){var u=i[t],v=g+u-t;x=d-x;if(u>=x)return this.diff_bisectSplit_(a,b,u,v,c)}}}}return[[DIFF_DELETE,a],[DIFF_INSERT,b]]},diff_match_patch.prototype.diff_bisectSplit_=function(a,b,c,d,e){var f=a.substring(0,c),g=b.substring(0,d),h=a.substring(c),i=b.substring(d),j=this.diff_main(f,g,!1,e),k=this.diff_main(h,i,!1,e);return j.concat(k)},diff_match_patch.prototype.diff_linesToChars_=function(a,b){function e(a){var b="",e=0,f=-1,g=c.length;while(f<a.length-1){f=a.indexOf("\n",e),f==-1&&(f=a.length-1);var h=a.substring(e,f+1);e=f+1,(d.hasOwnProperty?d.hasOwnProperty(h):d[h]!==undefined)?b+=String.fromCharCode(d[h]):(b+=String.fromCharCode(g),d[h]=g,c[g++]=h)}return b}var c=[],d={};c[0]="";var f=e(a),g=e(b);return[f,g,c]},diff_match_patch.prototype.diff_charsToLines_=function(a,b){for(var c=0;c<a.length;c++){var d=a[c][1],e=[];for(var f=0;f<d.length;f++)e[f]=b[d.charCodeAt(f)];a[c][1]=e.join("")}},diff_match_patch.prototype.diff_commonPrefix=function(a,b){if(!a||!b||a.charAt(0)!=b.charAt(0))return 0;var c=0,d=Math.min(a.length,b.length),e=d,f=0;while(c<e)a.substring(f,e)==b.substring(f,e)?(c=e,f=c):d=e,e=Math.floor((d-c)/2+c);return e},diff_match_patch.prototype.diff_commonSuffix=function(a,b){if(!a||!b||a.charAt(a.length-1)!=b.charAt(b.length-1))return 0;var c=0,d=Math.min(a.length,b.length),e=d,f=0;while(c<e)a.substring(a.length-e,a.length-f)==b.substring(b.length-e,b.length-f)?(c=e,f=c):d=e,e=Math.floor((d-c)/2+c);return e},diff_match_patch.prototype.diff_commonOverlap_=function(a,b){var c=a.length,d=b.length;if(c==0||d==0)return 0;c>d?a=a.substring(c-d):c<d&&(b=b.substring(0,c));var e=Math.min(c,d);if(a==b)return e;var f=0,g=1;for(;;){var h=a.substring(e-g),i=b.indexOf(h);if(i==-1)return f;g+=i;if(i==0||a.substring(e-g)==b.substring(0,g))f=g,g++}},diff_match_patch.prototype.diff_halfMatch_=function(a,b){function f(a,b,c){var d=a.substring(c,c+Math.floor(a.length/4)),f=-1,g="",h,i,j,k;while((f=b.indexOf(d,f+1))!=-1){var l=e.diff_commonPrefix(a.substring(c),b.substring(f)),m=e.diff_commonSuffix(a.substring(0,c),b.substring(0,f));g.length<m+l&&(g=b.substring(f-m,f)+b.substring(f,f+l),h=a.substring(0,c-m),i=a.substring(c+l),j=b.substring(0,f-m),k=b.substring(f+l))}return g.length*2>=a.length?[h,i,j,k,g]:null}if(this.Diff_Timeout<=0)return null;var c=a.length>b.length?a:b,d=a.length>b.length?b:a;if(c.length<4||d.length*2<c.length)return null;var e=this,g=f(c,d,Math.ceil(c.length/4)),h=f(c,d,Math.ceil(c.length/2)),i;if(!g&&!h)return null;h?g?i=g[4].length>h[4].length?g:h:i=h:i=g;var j,k,l,m;a.length>b.length?(j=i[0],k=i[1],l=i[2],m=i[3]):(l=i[0],m=i[1],j=i[2],k=i[3]);var n=i[4];return[j,k,l,m,n]},diff_match_patch.prototype.diff_cleanupSemantic=function(a){var b=!1,c=[],d=0,e=null,f=0,g=0,h=0,i=0,j=0;while(f<a.length)a[f][0]==DIFF_EQUAL?(c[d++]=f,g=i,h=j,i=0,j=0,e=a[f][1]):(a[f][0]==DIFF_INSERT?i+=a[f][1].length:j+=a[f][1].length,e!==null&&e.length<=Math.max(g,h)&&e.length<=Math.max(i,j)&&(a.splice(c[d-1],0,[DIFF_DELETE,e]),a[c[d-1]+1][0]=DIFF_INSERT,d--,d--,f=d>0?c[d-1]:-1,g=0,h=0,i=0,j=0,e=null,b=!0)),f++;b&&this.diff_cleanupMerge(a),this.diff_cleanupSemanticLossless(a),f=1;while(f<a.length){if(a[f-1][0]==DIFF_DELETE&&a[f][0]==DIFF_INSERT){var k=a[f-1][1],l=a[f][1],m=this.diff_commonOverlap_(k,l);m&&(a.splice(f,0,[DIFF_EQUAL,l.substring(0,m)]),a[f-1][1]=k.substring(0,k.length-m),a[f+1][1]=l.substring(m),f++),f++}f++}},diff_match_patch.prototype.diff_cleanupSemanticLossless=function(a){function g(a,g){if(!a||!g)return 5;var h=0;if(a.charAt(a.length-1).match(b)||g.charAt(0).match(b)){h++;if(a.charAt(a.length-1).match(c)||g.charAt(0).match(c)){h++;if(a.charAt(a.length-1).match(d)||g.charAt(0).match(d))h++,(a.match(e)||g.match(f))&&h++}}return h}var b=/[^a-zA-Z0-9]/,c=/\s/,d=/[\r\n]/,e=/\n\r?\n$/,f=/^\r?\n\r?\n/,h=1;while(h<a.length-1){if(a[h-1][0]==DIFF_EQUAL&&a[h+1][0]==DIFF_EQUAL){var i=a[h-1][1],j=a[h][1],k=a[h+1][1],l=this.diff_commonSuffix(i,j);if(l){var m=j.substring(j.length-l);i=i.substring(0,i.length-l),j=m+j.substring(0,j.length-l),k=m+k}var n=i,o=j,p=k,q=g(i,j)+g(j,k);while(j.charAt(0)===k.charAt(0)){i+=j.charAt(0),j=j.substring(1)+k.charAt(0),k=k.substring(1);var r=g(i,j)+g(j,k);r>=q&&(q=r,n=i,o=j,p=k)}a[h-1][1]!=n&&(n?a[h-1][1]=n:(a.splice(h-1,1),h--),a[h][1]=o,p?a[h+1][1]=p:(a.splice(h+1,1),h--))}h++}},diff_match_patch.prototype.diff_cleanupEfficiency=function(a){var b=!1,c=[],d=0,e="",f=0,g=!1,h=!1,i=!1,j=!1;while(f<a.length)a[f][0]==DIFF_EQUAL?(a[f][1].length<this.Diff_EditCost&&(i||j)?(c[d++]=f,g=i,h=j,e=a[f][1]):(d=0,e=""),i=j=!1):(a[f][0]==DIFF_DELETE?j=!0:i=!0,e&&(g&&h&&i&&j||e.length<this.Diff_EditCost/2&&g+h+i+j==3)&&(a.splice(c[d-1],0,[DIFF_DELETE,e]),a[c[d-1]+1][0]=DIFF_INSERT,d--,e="",g&&h?(i=j=!0,d=0):(d--,f=d>0?c[d-1]:-1,i=j=!1),b=!0)),f++;b&&this.diff_cleanupMerge(a)},diff_match_patch.prototype.diff_cleanupMerge=function(a){a.push([DIFF_EQUAL,""]);var b=0,c=0,d=0,e="",f="",g;while(b<a.length)switch(a[b][0]){case DIFF_INSERT:d++,f+=a[b][1],b++;break;case DIFF_DELETE:c++,e+=a[b][1],b++;break;case DIFF_EQUAL:c+d>1?(c!==0&&d!==0&&(g=this.diff_commonPrefix(f,e),g!==0&&(b-c-d>0&&a[b-c-d-1][0]==DIFF_EQUAL?a[b-c-d-1][1]+=f.substring(0,g):(a.splice(0,0,[DIFF_EQUAL,f.substring(0,g)]),b++),f=f.substring(g),e=e.substring(g)),g=this.diff_commonSuffix(f,e),g!==0&&(a[b][1]=f.substring(f.length-g)+a[b][1],f=f.substring(0,f.length-g),e=e.substring(0,e.length-g))),c===0?a.splice(b-c-d,c+d,[DIFF_INSERT,f]):d===0?a.splice(b-c-d,c+d,[DIFF_DELETE,e]):a.splice(b-c-d,c+d,[DIFF_DELETE,e],[DIFF_INSERT,f]),b=b-c-d+(c?1:0)+(d?1:0)+1):b!==0&&a[b-1][0]==DIFF_EQUAL?(a[b-1][1]+=a[b][1],a.splice(b,1)):b++,d=0,c=0,e="",f=""}a[a.length-1][1]===""&&a.pop();var h=!1;b=1;while(b<a.length-1)a[b-1][0]==DIFF_EQUAL&&a[b+1][0]==DIFF_EQUAL&&(a[b][1].substring(a[b][1].length-a[b-1][1].length)==a[b-1][1]?(a[b][1]=a[b-1][1]+a[b][1].substring(0,a[b][1].length-a[b-1][1].length),a[b+1][1]=a[b-1][1]+a[b+1][1],a.splice(b-1,1),h=!0):a[b][1].substring(0,a[b+1][1].length)==a[b+1][1]&&(a[b-1][1]+=a[b+1][1],a[b][1]=a[b][1].substring(a[b+1][1].length)+a[b+1][1],a.splice(b+1,1),h=!0)),b++;h&&this.diff_cleanupMerge(a)},diff_match_patch.prototype.diff_xIndex=function(a,b){var c=0,d=0,e=0,f=0,g;for(g=0;g<a.length;g++){a[g][0]!==DIFF_INSERT&&(c+=a[g][1].length),a[g][0]!==DIFF_DELETE&&(d+=a[g][1].length);if(c>b)break;e=c,f=d}return a.length!=g&&a[g][0]===DIFF_DELETE?f:f+(b-e)},diff_match_patch.prototype.diff_prettyHtml=function(a){var b=[],c=0,d=/&/g,e=/</g,f=/>/g,g=/\n/g;for(var h=0;h<a.length;h++){var i=a[h][0],j=a[h][1],k=j.replace(d,"&amp;").replace(e,"&lt;").replace(f,"&gt;").replace(g,"&para;<br>");switch(i){case DIFF_INSERT:b[h]='<ins style="background:#e6ffe6;">'+k+"</ins>";break;case DIFF_DELETE:b[h]='<del style="background:#ffe6e6;">'+k+"</del>";break;case DIFF_EQUAL:b[h]="<span>"+k+"</span>"}i!==DIFF_DELETE&&(c+=j.length)}return b.join("")},diff_match_patch.prototype.diff_text1=function(a){var b=[];for(var c=0;c<a.length;c++)a[c][0]!==DIFF_INSERT&&(b[c]=a[c][1]);return b.join("")},diff_match_patch.prototype.diff_text2=function(a){var b=[];for(var c=0;c<a.length;c++)a[c][0]!==DIFF_DELETE&&(b[c]=a[c][1]);return b.join("")},diff_match_patch.prototype.diff_levenshtein=function(a){var b=0,c=0,d=0;for(var e=0;e<a.length;e++){var f=a[e][0],g=a[e][1];switch(f){case DIFF_INSERT:c+=g.length;break;case DIFF_DELETE:d+=g.length;break;case DIFF_EQUAL:b+=Math.max(c,d),c=0,d=0}}return b+=Math.max(c,d),b},diff_match_patch.prototype.diff_toDelta=function(a){var b=[];for(var c=0;c<a.length;c++)switch(a[c][0]){case DIFF_INSERT:b[c]="+"+encodeURI(a[c][1]);break;case DIFF_DELETE:b[c]="-"+a[c][1].length;break;case DIFF_EQUAL:b[c]="="+a[c][1].length}return b.join("	").replace(/%20/g," ")},diff_match_patch.prototype.diff_fromDelta=function(a,b){var c=[],d=0,e=0,f=b.split(/\t/g);for(var g=0;g<f.length;g++){var h=f[g].substring(1);switch(f[g].charAt(0)){case"+":try{c[d++]=[DIFF_INSERT,decodeURI(h)]}catch(i){throw new Error("Illegal escape in diff_fromDelta: "+h)}break;case"-":case"=":var j=parseInt(h,10);if(isNaN(j)||j<0)throw new Error("Invalid number in diff_fromDelta: "+h);var k=a.substring(e,e+=j);f[g].charAt(0)=="="?c[d++]=[DIFF_EQUAL,k]:c[d++]=[DIFF_DELETE,k];break;default:if(f[g])throw new Error("Invalid diff operation in diff_fromDelta: "+f[g])}}if(e!=a.length)throw new Error("Delta length ("+e+") does not equal source text length ("+a.length+").");return c},diff_match_patch.prototype.match_main=function(a,b,c){if(a==null||b==null||c==null)throw new Error("Null input. (match_main)");return c=Math.max(0,Math.min(c,a.length)),a==b?0:a.length?a.substring(c,c+b.length)==b?c:this.match_bitap_(a,b,c):-1},diff_match_patch.prototype.match_bitap_=function(a,b,c){function f(a,d){var f=a/b.length,g=Math.abs(c-d);return e.Match_Distance?f+g/e.Match_Distance:g?1:f}if(b.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var d=this.match_alphabet_(b),e=this,g=this.Match_Threshold,h=a.indexOf(b,c);h!=-1&&(g=Math.min(f(0,h),g),h=a.lastIndexOf(b,c+b.length),h!=-1&&(g=Math.min(f(0,h),g)));var i=1<<b.length-1;h=-1;var j,k,l=b.length+a.length,m;for(var n=0;n<b.length;n++){j=0,k=l;while(j<k)f(n,c+k)<=g?j=k:l=k,k=Math.floor((l-j)/2+j);l=k;var o=Math.max(1,c-k+1),p=Math.min(c+k,a.length)+b.length,q=Array(p+2);q[p+1]=(1<<n)-1;for(var r=p;r>=o;r--){var s=d[a.charAt(r-1)];n===0?q[r]=(q[r+1]<<1|1)&s:q[r]=(q[r+1]<<1|1)&s|((m[r+1]|m[r])<<1|1)|m[r+1];if(q[r]&i){var t=f(n,r-1);if(t<=g){g=t,h=r-1;if(!(h>c))break;o=Math.max(1,2*c-h)}}}if(f(n+1,c)>g)break;m=q}return h},diff_match_patch.prototype.match_alphabet_=function(a){var b={};for(var c=0;c<a.length;c++)b[a.charAt(c)]=0;for(var c=0;c<a.length;c++)b[a.charAt(c)]|=1<<a.length-c-1;return b},diff_match_patch.prototype.patch_addContext_=function(a,b){if(b.length==0)return;var c=b.substring(a.start2,a.start2+a.length1),d=0;while(b.indexOf(c)!=b.lastIndexOf(c)&&c.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin)d+=this.Patch_Margin,c=b.substring(a.start2-d,a.start2+a.length1+d);d+=this.Patch_Margin;var e=b.substring(a.start2-d,a.start2);e&&a.diffs.unshift([DIFF_EQUAL,e]);var f=b.substring(a.start2+a.length1,a.start2+a.length1+d);f&&a.diffs.push([DIFF_EQUAL,f]),a.start1-=e.length,a.start2-=e.length,a.length1+=e.length+f.length,a.length2+=e.length+f.length},diff_match_patch.prototype.patch_make=function(a,b,c){var d,e;if(typeof a=="string"&&typeof b=="string"&&typeof c=="undefined")d=a,e=this.diff_main(d,b,!0),e.length>2&&(this.diff_cleanupSemantic(e),this.diff_cleanupEfficiency(e));else if(a&&typeof a=="object"&&typeof b=="undefined"&&typeof c=="undefined")e=a,d=this.diff_text1(e);else if(typeof a=="string"&&b&&typeof b=="object"&&typeof c=="undefined")d=a,e=b;else{if(typeof a!="string"||typeof b!="string"||!c||typeof c!="object")throw new Error("Unknown call format to patch_make.");d=a,e=c}if(e.length===0)return[];var f=[],g=new patch_obj,h=0,i=0,j=0,k=d,l=d;for(var m=0;m<e.length;m++){var n=e[m][0],o=e[m][1];!h&&n!==DIFF_EQUAL&&(g.start1=i,g.start2=j);switch(n){case DIFF_INSERT:g.diffs[h++]=e[m],g.length2+=o.length,l=l.substring(0,j)+o+l.substring(j);break;case DIFF_DELETE:g.length1+=o.length,g.diffs[h++]=e[m],l=l.substring(0,j)+l.substring(j+o.length);break;case DIFF_EQUAL:o.length<=2*this.Patch_Margin&&h&&e.length!=m+1?(g.diffs[h++]=e[m],g.length1+=o.length,g.length2+=o.length):o.length>=2*this.Patch_Margin&&h&&(this.patch_addContext_(g,k),f.push(g),g=new patch_obj,h=0,k=l,i=j)}n!==DIFF_INSERT&&(i+=o.length),n!==DIFF_DELETE&&(j+=o.length)}return h&&(this.patch_addContext_(g,k),f.push(g)),f},diff_match_patch.prototype.patch_deepCopy=function(a){var b=[];for(var c=0;c<a.length;c++){var d=a[c],e=new patch_obj;e.diffs=[];for(var f=0;f<d.diffs.length;f++)e.diffs[f]=d.diffs[f].slice();e.start1=d.start1,e.start2=d.start2,e.length1=d.length1,e.length2=d.length2,b[c]=e}return b},diff_match_patch.prototype.patch_apply=function(a,b){if(a.length==0)return[b,[]];a=this.patch_deepCopy(a);var c=this.patch_addPadding(a);b=c+b+c,this.patch_splitMax(a);var d=0,e=[];for(var f=0;f<a.length;f++){var g=a[f].start2+d,h=this.diff_text1(a[f].diffs),i,j=-1;if(h.length>this.Match_MaxBits){i=this.match_main(b,h.substring(0,this.Match_MaxBits),g);if(i!=-1){j=this.match_main(b,h.substring(h.length-this.Match_MaxBits),g+h.length-this.Match_MaxBits);if(j==-1||i>=j)i=-1}}else i=this.match_main(b,h,g);if(i==-1)e[f]=!1,d-=a[f].length2-a[f].length1;else{e[f]=!0,d=i-g;var k;j==-1?k=b.substring(i,i+h.length):k=b.substring(i,j+this.Match_MaxBits);if(h==k)b=b.substring(0,i)+this.diff_text2(a[f].diffs)+b.substring(i+h.length);else{var l=this.diff_main(h,k,!1);if(h.length>this.Match_MaxBits&&this.diff_levenshtein(l)/h.length>this.Patch_DeleteThreshold)e[f]=!1;else{this.diff_cleanupSemanticLossless(l);var m=0,n;for(var o=0;o<a[f].diffs.length;o++){var p=a[f].diffs[o];p[0]!==DIFF_EQUAL&&(n=this.diff_xIndex(l,m)),p[0]===DIFF_INSERT?b=b.substring(0,i+n)+p[1]+b.substring(i+n):p[0]===DIFF_DELETE&&(b=b.substring(0,i+n)+b.substring(i+this.diff_xIndex(l,m+p[1].length))),p[0]!==DIFF_DELETE&&(m+=p[1].length)}}}}}return b=b.substring(c.length,b.length-c.length),[b,e]},diff_match_patch.prototype.patch_addPadding=function(a){var b=this.Patch_Margin,c="";for(var d=1;d<=b;d++)c+=String.fromCharCode(d);for(var d=0;d<a.length;d++)a[d].start1+=b,a[d].start2+=b;var e=a[0],f=e.diffs;if(f.length==0||f[0][0]!=DIFF_EQUAL)f.unshift([DIFF_EQUAL,c]),e.start1-=b,e.start2-=b,e.length1+=b,e.length2+=b;else if(b>f[0][1].length){var g=b-f[0][1].length;f[0][1]=c.substring(f[0][1].length)+f[0][1],e.start1-=g,e.start2-=g,e.length1+=g,e.length2+=g}e=a[a.length-1],f=e.diffs;if(f.length==0||f[f.length-1][0]!=DIFF_EQUAL)f.push([DIFF_EQUAL,c]),e.length1+=b,e.length2+=b;else if(b>f[f.length-1][1].length){var g=b-f[f.length-1][1].length;f[f.length-1][1]+=c.substring(0,g),e.length1+=g,e.length2+=g}return c},diff_match_patch.prototype.patch_splitMax=function(a){var b=this.Match_MaxBits;for(var c=0;c<a.length;c++)if(a[c].length1>b){var d=a[c];a.splice(c--,1);var e=d.start1,f=d.start2,g="";while(d.diffs.length!==0){var h=new patch_obj,i=!0;h.start1=e-g.length,h.start2=f-g.length,g!==""&&(h.length1=h.length2=g.length,h.diffs.push([DIFF_EQUAL,g]));while(d.diffs.length!==0&&h.length1<b-this.Patch_Margin){var j=d.diffs[0][0],k=d.diffs[0][1];j===DIFF_INSERT?(h.length2+=k.length,f+=k.length,h.diffs.push(d.diffs.shift()),i=!1):j===DIFF_DELETE&&h.diffs.length==1&&h.diffs[0][0]==DIFF_EQUAL&&k.length>2*b?(h.length1+=k.length,e+=k.length,i=!1,h.diffs.push([j,k]),d.diffs.shift()):(k=k.substring(0,b-h.length1-this.Patch_Margin),h.length1+=k.length,e+=k.length,j===DIFF_EQUAL?(h.length2+=k.length,f+=k.length):i=!1,h.diffs.push([j,k]),k==d.diffs[0][1]?d.diffs.shift():d.diffs[0][1]=d.diffs[0][1].substring(k.length))}g=this.diff_text2(h.diffs),g=g.substring(g.length-this.Patch_Margin);var l=this.diff_text1(d.diffs).substring(0,this.Patch_Margin);l!==""&&(h.length1+=l.length,h.length2+=l.length,h.diffs.length!==0&&h.diffs[h.diffs.length-1][0]===DIFF_EQUAL?h.diffs[h.diffs.length-1][1]+=l:h.diffs.push([DIFF_EQUAL,l])),i||a.splice(++c,0,h)}}},diff_match_patch.prototype.patch_toText=function(a){var b=[];for(var c=0;c<a.length;c++)b[c]=a[c];return b.join("")},diff_match_patch.prototype.patch_fromText=function(a){var b=[];if(!a)return b;var c=a.split("\n"),d=0,e=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;while(d<c.length){var f=c[d].match(e);if(!f)throw new Error("Invalid patch string: "+c[d]);var g=new patch_obj;b.push(g),g.start1=parseInt(f[1],10),f[2]===""?(g.start1--,g.length1=1):f[2]=="0"?g.length1=0:(g.start1--,g.length1=parseInt(f[2],10)),g.start2=parseInt(f[3],10),f[4]===""?(g.start2--,g.length2=1):f[4]=="0"?g.length2=0:(g.start2--,g.length2=parseInt(f[4],10)),d++;while(d<c.length){var h=c[d].charAt(0);try{var i=decodeURI(c[d].substring(1))}catch(j){throw new Error("Illegal escape in patch_fromText: "+i)}if(h=="-")g.diffs.push([DIFF_DELETE,i]);else if(h=="+")g.diffs.push([DIFF_INSERT,i]);else if(h==" ")g.diffs.push([DIFF_EQUAL,i]);else{if(h=="@")break;if(h!=="")throw new Error('Invalid patch mode "'+h+'" in: '+i)}d++}}return b},patch_obj.prototype.toString=function(){var a,b;this.length1===0?a=this.start1+",0":this.length1==1?a=this.start1+1:a=this.start1+1+","+this.length1,this.length2===0?b=this.start2+",0":this.length2==1?b=this.start2+1:b=this.start2+1+","+this.length2;var c=["@@ -"+a+" +"+b+" @@\n"],d;for(var e=0;e<this.diffs.length;e++){switch(this.diffs[e][0]){case DIFF_INSERT:d="+";break;case DIFF_DELETE:d="-";break;case DIFF_EQUAL:d=" "}c[e+1]=d+encodeURI(this.diffs[e][1])+"\n"}return c.join("").replace(/%20/g," ")},window.diff_match_patch=diff_match_patch,window.patch_obj=patch_obj,window.DIFF_DELETE=DIFF_DELETE,window.DIFF_INSERT=DIFF_INSERT,window.DIFF_EQUAL=DIFF_EQUAL;