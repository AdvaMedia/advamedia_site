define(["aloha/jquery"],function(e){var t={cellIndexToGridColumn:function(e,n,r){var i=null;return t.walkCells(e,function(e,t,s,o,u){if(e===n&&t===r)return i=s,!1}),i},walkCells:function(e,n){var r=[];for(var i=0;i<e.length;i++){var s=e[i].cells,o=0;for(var u=0;u<s.length;u++){var a=s[u],f=t.colspan(a),l=t.rowspan(a);while(r[u+o])r[u+o]-=1,o+=1;if(!1===n(i,u,u+o,f,l))return;for(var c=0;c<f;c++){if(r[u+o+c])throw"an impossible case has occurred";r[u+o+c]=l-1}o+=f-1}for(;u+o<r.length;o++)r[u+o]&&(r[u+o]-=1)}},makeGrid:function(e){var n=[];return t.walkCells(e,function(t,r,i,s,o){var u=e[t].cells[r];for(var a=0;a<o;a++){n[t+a]=n[t+a]||[];for(var f=0;f<s;f++)n[t+a][i+f]={cell:u,colspan:s,rowspan:o,spannedX:f,spannedY:a}}}),n},containsDomCell:function(e){return 0===e.spannedX&&0===e.spannedY},leftDomCell:function(e,t,n){do{var r=e[t][n];if(0===r.spannedY)return r.cell;n-=r.spannedX+1}while(n>=0);return null},splitCell:function(n,r){var i=e(n),s=t.colspan(n),o=t.rowspan(n);if(1===s&&1===o)return;var u=i.parent(),a=u.parent().children(),f=u.index(),l=i.index(),c=t.makeGrid(a),h=t.cellIndexToGridColumn(a,f,l);for(var p=0;p<o;p++)for(var d=0===p?1:0;d<s;d++){var v=t.leftDomCell(c,f+p,h);null==v?a.eq(f+p).prepend(r()):e(v).after(r())}i.removeAttr("colspan"),i.removeAttr("rowspan")},rowspan:function(t){return parseInt(e(t).attr("rowspan"))||1},colspan:function(t){return parseInt(e(t).attr("colspan"))||1},walkGrid:function(e,t){for(var n=0;n<e.length;n++)for(var r=0;r<e[n].length;r++)if(!1===t(e[n][r],r,n))return},walkGridInsideRect:function(e,n,r){t.walkGrid(e,function(e,t,i){if(i>=n.top&&i<n.bottom&&t>=n.left&&t<n.right)return r(e,t,i)})},leftTrimArray:function(e){for(var t=0;t<e.length;t++)if(null!=e[t])return e.slice(t,e.length);return[]},makeContour:function(e,n){var r=[],i=[],s=[],o=[];return t.walkGrid(e,function(e,t,u){if(n(e,t,u)){if(null==r[u]||t<r[u])r[u]=t;if(null==i[u]||t>i[u])i[u]=t;if(null==s[t]||u<s[t])s[t]=u;if(null==o[t]||u>o[t])o[t]=u}}),r=t.leftTrimArray(r),i=t.leftTrimArray(i),s=t.leftTrimArray(s),o=t.leftTrimArray(o),{left:r,right:i,top:s,bottom:o}},indexOfAnyBut:function(e,t){for(var n=0;n<e.length;n++)if(t!==e[n])return n;return-1},isConsecutive:function(e){for(var t=1;t<e.length;t++)if(1!==Math.abs(e[t]-e[t-1]))return!1;return!0}};return t});