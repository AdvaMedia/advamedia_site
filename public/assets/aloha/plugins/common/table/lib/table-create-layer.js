define(["aloha/jquery"],function(e){return CreateLayer=function(e){this.TablePlugin=e},CreateLayer.prototype.parameters={elemId:"aloha-table-createLayer",className:"aloha-table-createdialog",numX:10,numY:10,layer:undefined,target:undefined},CreateLayer.prototype.config=new Object,CreateLayer.prototype.visible=!1,CreateLayer.prototype.show=function(){var e=this.get("layer");e==null?this.create():(this.setPosition(e),e.find("td").removeClass("hover"),e.show()),this.visible=!0},CreateLayer.prototype.create=function(){var t=this,n=e("<div></div>");n.id=this.get("elemId"),n.addClass(this.get("className"));var r=e("<table></table>");r.css("width",(this.get("numX")+6)*15);var i,s;for(var o=0;o<this.get("numY");o++){i=e("<tr></tr>");for(var u=0;u<this.get("numX");u++)s=e("<td>Â </td>"),o==0&&u==0&&s.addClass("hover"),s.bind("mouseover",{rowId:o,colId:u},function(e){t.handleMouseOver(e,r)}),s.bind("click",{rowId:o,colId:u},function(e){var n=e.data.rowId+1,r=e.data.colId+1;t.TablePlugin.createTable(r,n),t.hide()}),i.append(s);r.append(i)}n.append(r),this.set("layer",n),this.setPosition(),n.bind("click",function(e){e.stopPropagation()}).mousedown(function(e){e.stopPropagation()}),e("body").append(n).bind("click",function(e){e.target!=t.get("target")&&t.visible&&t.hide()})},CreateLayer.prototype.handleMouseOver=function(t,n){var r=t.data.rowId,i=t.data.colId,s=n.find("tr");for(var o=0;o<=s.length;o++){var u=e(s[o]).find("td");for(var a=0;a<=u.length;a++)o<=r&&a<=i?e(u[a]).addClass("hover"):e(u[a]).removeClass("hover")}},CreateLayer.prototype.setPosition=function(){var t=e(this.get("target")),n=t.offset();this.get("layer").css("left",n.left+"px"),this.get("layer").css("top",n.top+t.height()+"px")},CreateLayer.prototype.hide=function(){this.get("layer").hide(),this.visible=!1},CreateLayer.prototype.get=function(e){return this.config[e]?this.config[e]:this.parameters[e]?this.parameters[e]:undefined},CreateLayer.prototype.set=function(e,t){this.config[e]?this.config[e]=t:this.parameters[e]=t},CreateLayer});