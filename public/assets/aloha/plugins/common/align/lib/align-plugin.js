/*
* Aloha Align Plugin - Allow text alignment in Aloha Editor
* Copyright (C) 2010 by Thomas LÃ©tÃ© - http://twitter.com/taoma_k
* Licensed unter the terms of LGPL http://www.gnu.org/copyleft/lesser.html
*
*/
define(["aloha","aloha/plugin","aloha/floatingmenu","i18n!align/nls/i18n","i18n!aloha/nls/i18n","aloha/jquery","css!align/css/align.css"],function(a,b,c,d,e,f){var g=window.GENTICS;return b.create("align",{_constructor:function(){this._super("align")},languages:["en","fr"],config:{alignment:["right","left","center","justify"]},alignment:"",lastAlignment:"",init:function(){this.createButtons();var b=this;a.bind("aloha-editable-activated",function(a,c){b.applyButtonConfig(c.editable.obj)}),a.bind("aloha-selection-changed",function(c,d){a.activeEditable&&b.buttonPressed(d)})},buttonPressed:function(b){var c=this;b.findMarkup(function(){c.alignment=f(this).css("text-align")},a.activeEditable.obj);if(this.alignment!=this.lastAlignment){switch(this.lastAlignment){case"right":this.alignRightButton.setPressed(!1);break;case"left":this.alignLeftButton.setPressed(!1);break;case"center":this.alignCenterButton.setPressed(!1);break;case"justify":this.alignJustifyButton.setPressed(!1)}switch(this.alignment){case"right":this.alignRightButton.setPressed(!0);break;case"center":this.alignCenterButton.setPressed(!0);break;case"justify":this.alignJustifyButton.setPressed(!0);break;default:this.alignLeftButton.setPressed(!0),this.alignment="left"}}this.lastAlignment=this.alignment},applyButtonConfig:function(a){if(typeof this.settings.alignment=="undefined")var b=this.config.alignment;else var b=this.settings.alignment;f.inArray("right",b)!=-1?this.alignRightButton.show():this.alignRightButton.hide(),f.inArray("left",b)!=-1?this.alignLeftButton.show():this.alignLeftButton.hide(),f.inArray("center",b)!=-1?this.alignCenterButton.show():this.alignCenterButton.hide(),f.inArray("justify",b)!=-1?this.alignJustifyButton.show():this.alignJustifyButton.hide()},createButtons:function(){var b=this;this.alignLeftButton=new a.ui.Button({name:"alignLeft",iconClass:"aloha-button-align aloha-button-align-left",size:"small",onclick:function(){b.align("left")},tooltip:d.t("button.alignleft.tooltip"),toggle:!0}),c.addButton("Aloha.continuoustext",this.alignLeftButton,e.t("floatingmenu.tab.format"),1),this.alignCenterButton=new a.ui.Button({name:"alignCenter",iconClass:"aloha-button-align aloha-button-align-center",size:"small",onclick:function(){b.align("center")},tooltip:d.t("button.aligncenter.tooltip"),toggle:!0}),c.addButton("Aloha.continuoustext",this.alignCenterButton,e.t("floatingmenu.tab.format"),1),this.alignRightButton=new a.ui.Button({name:"alignRight",iconClass:"aloha-button-align aloha-button-align-right",size:"small",onclick:function(){b.align("right")},tooltip:d.t("button.alignright.tooltip"),toggle:!0}),c.addButton("Aloha.continuoustext",this.alignRightButton,e.t("floatingmenu.tab.format"),1),this.alignJustifyButton=new a.ui.Button({name:"alignJustify",iconClass:"aloha-button-align aloha-button-align-justify",size:"small",onclick:function(){b.align("justify")},tooltip:d.t("button.alignjustify.tooltip"),toggle:!0}),c.addButton("Aloha.continuoustext",this.alignJustifyButton,e.t("floatingmenu.tab.format"),1)},findAlignMarkup:function(b){var c=this;if(typeof b=="undefined")var b=a.Selection.getRangeObject();return a.activeEditable?b.findMarkup(function(){return f(this).css("text-align")==c.alignment},a.activeEditable.obj):null},align:function(b){var c=a.Selection.getRangeObject();this.lastAlignment=this.alignment,this.alignment=b,a.activeEditable&&(this.findAlignMarkup(c)?this.removeAlign():this.insertAlign())},insertAlign:function(){var b=this;if(this.findAlignMarkup(c))return;var c=a.Selection.getRangeObject();f.each(a.Selection.getRangeObject().getSelectionTree(),function(){this.selection!=="none"&&this.domobj.nodeType!==3&&f(this.domobj).css("text-align",b.alignment)}),g.Utils.Dom.isEditingHost(c.getCommonAncestorContainer())?f.each(a.Selection.getRangeObject().getSelectionTree(),function(){this.selection!=="none"&&this.domobj.nodeType!==3&&f(this.domobj).css("text-align",b.alignment)}):f(c.getCommonAncestorContainer()).css("text-align",this.alignment);if(this.alignment!=this.lastAlignment)switch(this.lastAlignment){case"right":this.alignRightButton.setPressed(!1);break;case"left":this.alignLeftButton.setPressed(!1);break;case"center":this.alignCenterButton.setPressed(!1);break;case"justify":this.alignJustifyButton.setPressed(!1)}c.select()},removeAlign:function(){var b=a.Selection.getRangeObject();this.findAlignMarkup(b)&&(b.findMarkup(function(){f(this).css("text-align","")},a.activeEditable.obj),b.select())}})});