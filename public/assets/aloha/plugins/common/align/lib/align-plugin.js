/*
* Aloha Align Plugin - Allow text alignment in Aloha Editor
* Copyright (C) 2010 by Thomas LÃ©tÃ© - http://twitter.com/taoma_k
* Licensed unter the terms of LGPL http://www.gnu.org/copyleft/lesser.html
*
*/
define(["aloha","aloha/plugin","aloha/floatingmenu","i18n!align/nls/i18n","i18n!aloha/nls/i18n","aloha/jquery","css!align/css/align.css"],function(e,t,n,r,i,s){var o=window.GENTICS;return t.create("align",{_constructor:function(){this._super("align")},languages:["en","fr"],config:{alignment:["right","left","center","justify"]},alignment:"",lastAlignment:"",init:function(){this.createButtons();var t=this;e.bind("aloha-editable-activated",function(e,n){t.applyButtonConfig(n.editable.obj)}),e.bind("aloha-selection-changed",function(n,r){e.activeEditable&&t.buttonPressed(r)})},buttonPressed:function(t){var n=this;t.findMarkup(function(){n.alignment=s(this).css("text-align")},e.activeEditable.obj);if(this.alignment!=this.lastAlignment){switch(this.lastAlignment){case"right":this.alignRightButton.setPressed(!1);break;case"left":this.alignLeftButton.setPressed(!1);break;case"center":this.alignCenterButton.setPressed(!1);break;case"justify":this.alignJustifyButton.setPressed(!1)}switch(this.alignment){case"right":this.alignRightButton.setPressed(!0);break;case"center":this.alignCenterButton.setPressed(!0);break;case"justify":this.alignJustifyButton.setPressed(!0);break;default:this.alignLeftButton.setPressed(!0),this.alignment="left"}}this.lastAlignment=this.alignment},applyButtonConfig:function(e){if(typeof this.settings.alignment=="undefined")var t=this.config.alignment;else var t=this.settings.alignment;s.inArray("right",t)!=-1?this.alignRightButton.show():this.alignRightButton.hide(),s.inArray("left",t)!=-1?this.alignLeftButton.show():this.alignLeftButton.hide(),s.inArray("center",t)!=-1?this.alignCenterButton.show():this.alignCenterButton.hide(),s.inArray("justify",t)!=-1?this.alignJustifyButton.show():this.alignJustifyButton.hide()},createButtons:function(){var t=this;this.alignLeftButton=new e.ui.Button({name:"alignLeft",iconClass:"aloha-button-align aloha-button-align-left",size:"small",onclick:function(){t.align("left")},tooltip:r.t("button.alignleft.tooltip"),toggle:!0}),n.addButton("Aloha.continuoustext",this.alignLeftButton,i.t("floatingmenu.tab.format"),1),this.alignCenterButton=new e.ui.Button({name:"alignCenter",iconClass:"aloha-button-align aloha-button-align-center",size:"small",onclick:function(){t.align("center")},tooltip:r.t("button.aligncenter.tooltip"),toggle:!0}),n.addButton("Aloha.continuoustext",this.alignCenterButton,i.t("floatingmenu.tab.format"),1),this.alignRightButton=new e.ui.Button({name:"alignRight",iconClass:"aloha-button-align aloha-button-align-right",size:"small",onclick:function(){t.align("right")},tooltip:r.t("button.alignright.tooltip"),toggle:!0}),n.addButton("Aloha.continuoustext",this.alignRightButton,i.t("floatingmenu.tab.format"),1),this.alignJustifyButton=new e.ui.Button({name:"alignJustify",iconClass:"aloha-button-align aloha-button-align-justify",size:"small",onclick:function(){t.align("justify")},tooltip:r.t("button.alignjustify.tooltip"),toggle:!0}),n.addButton("Aloha.continuoustext",this.alignJustifyButton,i.t("floatingmenu.tab.format"),1)},findAlignMarkup:function(t){var n=this;if(typeof t=="undefined")var t=e.Selection.getRangeObject();return e.activeEditable?t.findMarkup(function(){return s(this).css("text-align")==n.alignment},e.activeEditable.obj):null},align:function(t){var n=e.Selection.getRangeObject();this.lastAlignment=this.alignment,this.alignment=t,e.activeEditable&&(this.findAlignMarkup(n)?this.removeAlign():this.insertAlign())},insertAlign:function(){var t=this;if(this.findAlignMarkup(n))return;var n=e.Selection.getRangeObject();s.each(e.Selection.getRangeObject().getSelectionTree(),function(){this.selection!=="none"&&this.domobj.nodeType!==3&&s(this.domobj).css("text-align",t.alignment)}),o.Utils.Dom.isEditingHost(n.getCommonAncestorContainer())?s.each(e.Selection.getRangeObject().getSelectionTree(),function(){this.selection!=="none"&&this.domobj.nodeType!==3&&s(this.domobj).css("text-align",t.alignment)}):s(n.getCommonAncestorContainer()).css("text-align",this.alignment);if(this.alignment!=this.lastAlignment)switch(this.lastAlignment){case"right":this.alignRightButton.setPressed(!1);break;case"left":this.alignLeftButton.setPressed(!1);break;case"center":this.alignCenterButton.setPressed(!1);break;case"justify":this.alignJustifyButton.setPressed(!1)}n.select()},removeAlign:function(){var t=e.Selection.getRangeObject();this.findAlignMarkup(t)&&(t.findMarkup(function(){s(this).css("text-align","")},e.activeEditable.obj),t.select())}})});