/*
* Aloha Image Plugin - Allow image manipulation in Aloha Editor
*
* Author & Copyright (c) 2011 Gentics Software GmbH
* aloha-sales@gentics.com
* Contributors
*       Johannes SchÃ¼th - http://jotschi.de
*     Nicolas karageuzian - http://nka.me/
*     Benjamin Athur Lupton - http://www.balupton.com/
*     Thomas Lete
*     Nils Dehl
*     Christopher Hlubek
*     Edward Tsech
*     Haymo Meran
*
* Licensed under the terms of http://www.aloha-editor.com/license.html
*/
define(["aloha/jquery","aloha/plugin","aloha/floatingmenu","i18n!aloha/nls/i18n","i18n!image/nls/i18n","jquery-plugin!image/vendor/ui/jquery-ui-1.8.10.custom.min","jquery-plugin!image/vendor/jcrop/jquery.jcrop.min","jquery-plugin!image/vendor/mousewheel/mousewheel","css!image/css/image.css","css!image/vendor/ui/ui-lightness/jquery-ui-1.8.10.cropnresize.css","css!image/vendor/jcrop/jquery.jcrop.css"],function(b,c,d,e,f){var g=b,h=b,i=window.GENTICS,j=window.Aloha;return String.prototype.toInteger=String.prototype.toInteger||function(){return parseInt(String(this).replace(/px$/,"")||0,10)},String.prototype.toFloat=String.prototype.toInteger||function(){return parseFloat(String(this).replace(/px$/,"")||0,10)},Number.prototype.toInteger=Number.prototype.toInteger||String.prototype.toInteger,Number.prototype.toFloat=Number.prototype.toFloat||String.prototype.toFloat,g.extend(!0,g.fn,{increase:g.fn.increase||function(a){var b=g(this),c,d;return b.length?(c=b.css(a).toFloat(),d=Math.round((c||1)*1.2),c==d&&d++,b.css(a,d),b):b},decrease:g.fn.decrease||function(a){var b=g(this),c,d;return b.length?(c=b.css(a).toFloat(),d=Math.round((c||0)*.8),c==d&&d>0&&d--,b.css(a,d),b):b}}),c.create("image",{languages:["en","fr","de","ru","cz"],defaultSettings:{maxWidth:1600,minWidth:3,maxHeight:1200,minHeight:3,autoCorrectManualInput:!0,fixedAspectRatio:!1,autoResize:!1,ui:{oneTab:!1,insert:!0,reset:!0,aspectRatioToggle:!0,align:!0,resize:!0,meta:!0,margin:!0,crop:!0,resizable:!0,handles:"ne, se, sw, nw"},onCropped:function(a,b){j.Log.info("Default onCropped invoked",a,b)},onReset:function(a){return j.Log.info("Default onReset invoked",a),!1},onResize:function(a){j.Log.info("Default onResize invoked",a)},onResized:function(a){j.Log.info("Default onResized invoked",a)}},_onCropped:function(a,b){h("#"+this.imgResizeHeightField.id).val(a.height()),h("#"+this.imgResizeWidthField.id).val(a.width()),h("body").trigger("aloha-image-cropped",[a,b]),this.onCropped(a,b)},_onReset:function(a){return h("#"+this.imgResizeHeightField.id).val(a.height()),h("#"+this.imgResizeWidthField.id).val(a.width()),h("body").trigger("aloha-image-reset",a),this.onReset(a)},_onResize:function(a){h("#"+this.imgResizeHeightField.id).val(a.height()),h("#"+this.imgResizeWidthField.id).val(a.width()),h("body").trigger("aloha-image-resize",a),this.onResize(a)},_onResized:function(a){h("#"+this.imgResizeHeightField.id).val(a.height()),h("#"+this.imgResizeWidthField.id).val(a.width()),h("body").trigger("aloha-image-resized",a),this.onResized(a)},imageObj:null,jcAPI:null,keepAspectRatio:!1,startAspectRatio:!1,restoreProps:[],objectTypeFilter:[],init:function(){var a=this,b=j.getPluginUrl("image");this.startAspectRatio=this.settings.fixedAspectRatio,this.config=this.defaultSettings,this.settings=g.extend(!0,this.defaultSettings,this.settings),a.initializeButtons(),a.bindInteractions(),a.subscribeEvents()},initializeButtons:function(){var a=this,b=e.t("floatingmenu.tab.insert"),c=f.t("floatingmenu.tab.img"),g=f.t("floatingmenu.tab.formatting"),h=f.t("floatingmenu.tab.crop"),i=f.t("floatingmenu.tab.resize");d.createScope(this.name,"Aloha.empty");if(this.settings.ui.insert){var j=this.settings.ui.oneTab?c:b;a._addUIInsertButton(j)}if(this.settings.ui.meta){var j=this.settings.ui.oneTab?c:c;a._addUIMetaButtons(j)}if(this.settings.ui.reset){var j=this.settings.ui.reset?c:c;a._addUIResetButton(j)}if(this.settings.ui.align){var j=this.settings.ui.oneTab?c:g;a._addUIAlignButtons(j)}if(this.settings.ui.margin){var j=this.settings.ui.oneTab?c:g;a._addUIMarginButtons(j)}if(this.settings.ui.crop){var j=this.settings.ui.oneTab?c:h;a._addUICropButtons(j)}if(this.settings.ui.resize){var j=this.settings.ui.oneTab?c:i;a._addUIResizeButtons(j)}if(this.settings.ui.aspectRatioToggle){var j=this.settings.ui.oneTab?c:i;a.__addUIAspectRatioToggleButton(j)}},__addUIAspectRatioToggleButton:function(a){var b=this,c=new j.ui.Button({size:"small",tooltip:f.t("button.toggle.tooltip"),toggle:!0,iconClass:"cnr-ratio",onclick:function(a,c){b.toggleKeepAspectRatio()}});this.settings.fixedAspectRatio!=0&&(c.pressed=!0,this.keepAspectRatio=!0),d.addButton(b.name,c,a,20)},_addUIResetButton:function(a){var b=this,c=new j.ui.Button({size:"small",tooltip:f.t("Reset"),toggle:!1,iconClass:"cnr-reset",onclick:function(a,c){b.reset()}});d.addButton(b.name,c,a,2)},_addUIInsertButton:function(a){var b=this;this.insertImgButton=new j.ui.Button({name:"insertimage",iconClass:"aloha-button aloha-image-insert",size:"small",onclick:function(){b.insertImg()},tooltip:f.t("button.addimg.tooltip"),toggle:!1}),d.addButton("Aloha.continuoustext",this.insertImgButton,a,1)},_addUIMetaButtons:function(a){var b=this,c=new j.ui.Button({label:f.t("field.img.src.label"),tooltip:f.t("field.img.src.tooltip"),size:"small"});this.imgSrcField=new j.ui.AttributeField({name:"imgsrc"}),this.imgSrcField.setObjectTypeFilter(this.objectTypeFilter);var e=new j.ui.Button({label:f.t("field.img.title.label"),tooltip:f.t("field.img.title.tooltip"),size:"small"});this.imgTitleField=new j.ui.AttributeField,this.imgTitleField.setObjectTypeFilter(),d.addButton(this.name,this.imgSrcField,a,1)},_addUIAlignButtons:function(a){var b=this,c=new j.ui.Button({iconClass:"aloha-img aloha-image-align-left",size:"small",onclick:function(){var a=g(b.findImgMarkup());a.add(a.parent()).css("float","left")},tooltip:f.t("button.img.align.left.tooltip")});d.addButton(b.name,c,a,1);var e=new j.ui.Button({iconClass:"aloha-img aloha-image-align-right",size:"small",onclick:function(){var a=g(b.findImgMarkup());a.add(a.parent()).css("float","right")},tooltip:f.t("button.img.align.right.tooltip")});d.addButton(b.name,e,a,1);var h=new j.ui.Button({iconClass:"aloha-img aloha-image-align-none",size:"small",onclick:function(){var a=g(b.findImgMarkup());a.add(a.parent()).css({"float":"none",display:"inline-block"})},tooltip:f.t("button.img.align.none.tooltip")});d.addButton(b.name,h,a,1)},_addUIMarginButtons:function(a){var b=this,c=new j.ui.Button({iconClass:"aloha-img aloha-image-padding-increase",toggle:!1,size:"small",onclick:function(){g(b.findImgMarkup()).increase("padding")},tooltip:f.t("padding.increase")});d.addButton(b.name,c,a,2);var e=new j.ui.Button({iconClass:"aloha-img aloha-image-padding-decrease",toggle:!1,size:"small",onclick:function(){g(b.findImgMarkup()).decrease("padding")},tooltip:f.t("padding.decrease")});d.addButton(b.name,e,a,2)},_addUICropButtons:function(a){var b=this;d.createScope("Aloha.img",["Aloha.global"]),this.cropButton=new j.ui.Button({size:"small",tooltip:f.t("Crop"),toggle:!0,iconClass:"cnr-crop",onclick:function(a,c){a.pressed?b.crop():b.endCrop()}}),d.addButton(this.name,this.cropButton,a,3)},_addUIResizeButtons:function(a){var b=this;this.imgResizeHeightField=new j.ui.AttributeField,this.imgResizeHeightField.maxValue=b.settings.maxHeight,this.imgResizeHeightField.minValue=b.settings.minHeight,this.imgResizeWidthField=new j.ui.AttributeField,this.imgResizeWidthField.maxValue=b.settings.maxWidth,this.imgResizeWidthField.minValue=b.settings.minWidth,this.imgResizeWidthField.width=50,this.imgResizeHeightField.width=50;var c=new j.ui.Button({label:f.t("width"),tooltip:f.t("width"),size:"small"});d.addButton(this.name,c,a,30),d.addButton(this.name,this.imgResizeWidthField,a,40);var e=new j.ui.Button({label:f.t("height"),tooltip:f.t("height"),size:"small"});d.addButton(this.name,e,a,50),d.addButton(this.name,this.imgResizeHeightField,a,60)},_addNaturalSizeButton:function(){var a=this,b=new j.ui.Button({iconClass:"aloha-img aloha-image-size-natural",size:"small",toggle:!1,onclick:function(){var b=new Image;b.onload=function(){var c=a.findImgMarkup();a.settings.ui.resizable&&a.endResize(),g(c).css({width:b.width+"px",height:b.height+"px","max-width":"","max-height":""}),a.settings.ui.resizable&&a.resize()},b.src=a.findImgMarkup().src},tooltip:f.t("size.natural")});d.addButton(this.name,b,tabResize,2)},bindInteractions:function(){var a=this;if(this.settings.ui.resizable)try{document.execCommand("enableObjectResizing",!1,!1)}catch(b){j.Log.error(b,"Could not disable enableObjectResizing")}this.settings.ui.meta&&(this.imgSrcField.addListener("keyup",function(b,c){a.srcChange()}),this.imgSrcField.addListener("blur",function(a,b){var c=g(a.getTargetObject());c.attr("src")===""&&c.remove()})),this.settings.onCropped&&typeof this.settings.onCropped=="function"&&(this.onCropped=this.settings.onCropped),this.settings.onReset&&typeof this.settings.onReset=="function"&&(this.onReset=this.settings.onReset),this.settings.onResized&&typeof this.settings.onResized=="function"&&(this.onResized=this.settings.onResized),this.settings.onResize&&typeof this.settings.onResize=="function"&&(this.onResize=this.settings.onResize)},subscribeEvents:function(){var a=this,b=this.settings;g("img").filter(b.globalselector).unbind(),g("img").filter(b.globalselector).click(function(b){a.clickImage(b)}),j.bind("aloha-drop-files-in-editable",function(b,c){var d,e=c.filesObjs.length,f,h;while(--e>=0)f=c.filesObjs[e],f.file.type.match(/image\//)&&(h=a.getEditableConfig(c.editable),d=g("<img/>"),d.css({"max-width":a.maxWidth,"max-height":a.maxHeight}),d.attr("id",f.id),typeof f.src=="undefined"?d.attr("src",f.data):d.attr("src",f.src),i.Utils.Dom.insertIntoDOM(d,c.range,g(j.activeEditable.obj)))}),j.bind("aloha-selection-changed",function(b,c,e){var f,h;e&&e.target&&a.settings.ui.resizable&&!g(e.target).hasClass("ui-resizable-handle")&&a.endResize();if(j.activeEditable!==null){h=a.findImgMarkup(c),f=a.getEditableConfig(j.activeEditable.obj);if(a.settings.ui.insert){if(typeof f=="undefined"){a.insertImgButton.hide();return}a.insertImgButton.show()}h?(a.insertImgButton.hide(),d.setScope(a.name),a.settings.ui.meta&&(a.imgSrcField.setTargetObject(h,"src"),a.imgTitleField.setTargetObject(h,"title")),a.imgSrcField.focus(),d.activateTabOfButton("imgsrc")):a.settings.ui.meta&&a.imgSrcField.setTargetObject(null),d.doLayout()}}),j.bind("aloha-editable-created",function(b,c){try{document.execCommand("enableObjectResizing",!1,!1)}catch(d){j.Log.error(d,"Could not disable enableObjectResizing")}c.obj.delegate("img","mouseup",function(b){a.clickImage(b),b.stopPropagation()})}),a._subscribeToResizeFieldEvents()},autoResize:function(){var a=this,b=a.imageObj.width(),c=a.imageObj.height();return b<a.settings.minWidth||b>a.settings.maxWidth||c<a.settings.minHeight||c>a.settings.maxHeight?(a._setNormalizedFieldValues("width"),a.setSizeByFieldValue(),!0):!1},toggleKeepAspectRatio:function(){this.keepAspectRatio=!this.keepAspectRatio,this.endResize();if(!this.keepAspectRatio)this.startAspectRatio=!1;else if(typeof this.settings.fixedAspectRatio!="number"){var a=this.imageObj.width()/this.imageObj.height();this.startAspectRatio=a}else this.startAspectRatio=this.settings.fixedAspectRatio;this.startResize()},_subscribeToResizeFieldEvents:function(){function b(b,c,d,e){typeof e=="undefined"&&(e=0),typeof d=="undefined"&&(d=8e3);var f=parseInt(b.val());if(isNaN(f))return b.css("background-color","red"),!1;var g=f+c;return c>=0&&g>d?a.settings.autoCorrectManualInput?(b.val(d),!0):(b.css("background-color","red"),!1):c<=0&&g<e?a.settings.autoCorrectManualInput?(b.val(e),!0):(b.css("background-color","red"),!1):(b.css("background-color",""),b.val(f+c),!0)}function c(c){var d=c.data.minValue,e=c.data.maxValue,f=c.data.fieldName;if(c.keyCode==8||c.keyCode==46)h(this).val()>=d&&(typeof a.jcAPI!="undefined"&&a.jcAPI!=null?a.setCropAreaByFieldValue():(a._setNormalizedFieldValues(f),a.setSizeByFieldValue()));else if(c.keyCode<=57&&c.keyCode>=48||c.keyCode<=105&&c.keyCode>=96)h(this).val()>=d&&(typeof a.jcAPI!="undefined"&&a.jcAPI!=null?a.setCropAreaByFieldValue():(a._setNormalizedFieldValues(f),a.setSizeByFieldValue()));else{var g=0;if(c.keyCode==38||c.keyCode==107)g=1;else if(c.keyCode==40||c.keyCode==109)g=-1;if(c.shiftKey||c.metaKey||c.ctrlKey)g*=10;b(h(this),g,e,d)&&(typeof a.jcAPI!="undefined"&&a.jcAPI!=null?a.setCropAreaByFieldValue():(a._setNormalizedFieldValues(f),a.setSizeByFieldValue()))}return c.preventDefault(),!1}function d(c,d){var e=c.data.minValue,f=c.data.maxValue,g=c.data.fieldName;if(c.shiftKey||c.metaKey||c.ctrlKey)d*=10;return b(h(this),d,f,e)&&(typeof a.jcAPI!="undefined"&&a.jcAPI!=null?a.setCropAreaByFieldValue():(a._setNormalizedFieldValues(g),a.setSizeByFieldValue())),!1}var a=this,e=h("#"+a.imgResizeHeightField.id),f={fieldName:"height",maxValue:a.imgResizeHeightField.maxValue,minValue:a.imgResizeHeightField.minValue};e.live("keyup",f,c),e.live("mousewheel",f,d);var g=h("#"+a.imgResizeWidthField.id),i={fieldName:"width",maxValue:a.imgResizeWidthField.maxValue,minValue:a.imgResizeWidthField.minValue};g.live("keyup",i,c),g.live("mousewheel",i,d)},_setNormalizedFieldValues:function(a){var b=this,c=g("#"+b.imgResizeWidthField.id),d=g("#"+b.imgResizeHeightField.id),e=c.val(),f=d.val(),h=b._normalizeSize(e,f,a);c.val(h.width),d.val(h.height)},setSize:function(a,b){var c=this;this.imageObj.width(a),this.imageObj.height(b);var d=this.imageObj.closest(".Aloha_Image_Resize");d.height(b),d.width(a),this._onResize(this.imageObj),this._onResized(this.imageObj)},clickImage:function(a){var b=this;b.imageObj=g(a.target);var c=b.imageObj;d.setScope(b.name);var e=c.closest(".aloha-editable");g(e).contentEditable(!1),this.restoreProps.push({obj:a.srcElement,src:b.imageObj.attr("src"),width:b.imageObj.width(),height:b.imageObj.height()}),h("#"+b.imgResizeHeightField.id).val(b.imageObj.height()),h("#"+b.imgResizeWidthField.id).val(b.imageObj.width()),this.settings.ui.resizable&&this.startResize(),this.settings.autoResize&&this.autoResize()},findImgMarkup:function(a){var b=this,c=this.config,d,e;typeof a=="undefined"&&(a=j.Selection.getRangeObject()),e=g(a.startContainer);try{if(j.activeEditable)return typeof a.startContainer!="undefined"&&typeof a.startContainer.childNodes!="undefined"&&typeof a.startOffset!="undefined"&&typeof a.startContainer.childNodes[a.startOffset]!="undefined"&&a.startContainer.childNodes[a.startOffset].nodeName.toLowerCase()==="img"&&a.startOffset+1===a.endOffset||e.hasClass("Aloha_Image_Resize")?(d=e.find("img")[0],d.css||(d.css=""),d.title||(d.title=""),d.src||(d.src=""),d):null}catch(f){j.Log.debug(f,"Error finding img markup.")}return null},_normalizeSize:function(a,b,c){function e(c){if(b>d.settings.maxHeight){var e={org:b,"new":d.settings.maxHeight};h("body").trigger("aloha-image-resize-outofbounds",["height","max",e]),b=d.settings.maxHeight}else if(b<d.settings.minHeight){var e={org:b,"new":d.settings.minHeight};h("body").trigger("aloha-image-resize-outofbounds",["height","min",e]),b=d.settings.minHeight}d.keepAspectRatio&&(a=b*g,c&&f(!1))}function f(c){if(a>d.settings.maxWidth){var f={org:a,"new":d.settings.maxWidth};h("body").trigger("aloha-image-resize-outofbounds",["width","max",f]),a=d.settings.maxWidth}else if(a<d.settings.minWidth){var f={org:a,"new":d.settings.minWidth};h("body").trigger("aloha-image-resize-outofbounds",["width","min",f]),a=d.settings.minWidth}d.keepAspectRatio&&(b=a/g,c&&e(!1))}var d=this;a=parseInt(a),b=parseInt(b);var g=1.33333;return typeof d.startAspectRatio=="number"&&(g=d.startAspectRatio),c=="width"&&f(!0),c=="height"&&e(!0),{width:Math.floor(a),height:Math.floor(b)}},setSizeByFieldValue:function(){var a=this,b=h("#"+a.imgResizeWidthField.id).val(),c=h("#"+a.imgResizeHeightField.id).val();a.setSize(b,c)},setCropAreaByFieldValue:function(){var a=this,b=a.jcAPI.tellSelect(),c=h("#"+a.imgResizeWidthField.id).val();c=parseInt(c);var d=h("#"+a.imgResizeHeightField.id).val();d=parseInt(d);var e=[b.x,b.y,b.x+c,b.y+d];a.jcAPI.setSelect(e)},insertImg:function(){var a=j.Selection.getRangeObject(),b=this.getEditableConfig(j.activeEditable.obj),c=j.getPluginUrl("image"),d,e,f;a.isCollapsed()?(d="max-width: "+b.maxWidth+"; max-height: "+b.maxHeight,e='<img style="'+d+'" src="'+c+'/img/blank.jpg" title="" />',f=g(e),i.Utils.Dom.insertIntoDOM(f,a,g(j.activeEditable.obj))):j.Log.error("img cannot markup a selection")},srcChange:function(){this.imageObj.attr("src",this.imgSrcField.getQueryValue())},positionCropButtons:function(){var a=g(".jcrop-tracker:first"),b=a.offset(),c=b.top,d=b.left,e=a.height(),f=a.width(),h=0,i=0,j=g("#aloha-CropNResize-btns");c==0&&d==0&&j.hide(),c=parseInt(c+e+3,10),d=parseInt(d+f/2-j.width()/2+10,10),(h!=d||i!=c)&&j.offset({top:c,left:d}),h=d,i=c},initCropButtons:function(){var a=this,b;g("body").append('<div id="aloha-CropNResize-btns" display="none"><button class="cnr-crop-apply" title="'+f.t("Accept")+'"></button>'+'<button class="cnr-crop-cancel" title="'+f.t("Cancel")+'"></button>'+"</div>"),b=g("#aloha-CropNResize-btns"),b.find(".cnr-crop-apply").click(function(){a.acceptCrop()}),b.find(".cnr-crop-cancel").click(function(){a.endCrop()}),this.interval=setInterval(function(){a.positionCropButtons()},10)},destroyCropButtons:function(){g("#aloha-CropNResize-btns").remove(),clearInterval(this.interval)},_disableSelection:function(a){a.find("*").attr("unselectable","on").css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none"})},crop:function(){var a=this,b=this.config;this.initCropButtons(),this.settings.ui.resizable&&this.endResize(),this.jcAPI=g.Jcrop(this.imageObj,{onSelect:function(){a._onCropSelect(),setTimeout(function(){d.setScope(a.name)},10)}}),a._disableSelection(h(".jcrop-holder")),a._disableSelection(h("#imageContainer")),a._disableSelection(h("#aloha-CropNResize-btns")),h("body").trigger("aloha-image-crop-start",[this.imageObj])},_onCropSelect:function(){var a=this;g("#aloha-CropNResize-btns").fadeIn("slow"),g(".jcrop-handle").mousedown(function(){g("#aloha-CropNResize-btns").hide()}),g(".jcrop-tracker").mousedown(function(){g("#aloha-CropNResize-btns").hide()});if(typeof a.jcAPI!="undefined"&&a.jcAPI!=null){a.positionCropButtons();var b=a.jcAPI.tellSelect(),c=g("#"+a.imgResizeWidthField.id).val(b.w),d=g("#"+a.imgResizeHeightField.id).val(b.h)}},endCrop:function(){this.jcAPI&&(this.jcAPI.destroy(),this.jcAPI=null),this.destroyCropButtons(),this.cropButton.extButton.toggle(!1),this.settings.ui.resizable&&this.startResize();if(this.keepAspectRatio){var a=this.imageObj.width()/this.imageObj.height();this.startAspectRatio=a}h("body").trigger("aloha-image-crop-stop",[this.imageObj])},acceptCrop:function(){this._onCropped(this.imageObj,this.jcAPI.tellSelect()),this.endCrop()},startResize:function(){var a=this,b=this.imageObj;b=this.imageObj.css({height:this.imageObj.height(),width:this.imageObj.width(),position:"relative","max-height":"","max-width":""}),b.resizable({maxHeight:a.settings.maxHeight,minHeight:a.settings.minHeight,maxWidth:a.settings.maxWidth,minWidth:a.settings.minWidth,aspectRatio:a.startAspectRatio,handles:a.settings.handles,grid:a.settings.grid,resize:function(b,c){a._onResize(a.imageObj)},stop:function(b,c){a._onResized(a.imageObj),this.enableCrop&&setTimeout(function(){d.setScope(a.name),a.done(b)},10)}}),b.css("display","inline-block"),g(".ui-wrapper").attr("contentEditable",!1).addClass("aloha-image-box-active Aloha_Image_Resize aloha").css({position:"relative",display:"inline-block","float":a.imageObj.css("float")}).bind("resizestart",function(a){a.preventDefault()}).bind("mouseup",function(a){a.originalEvent.stopSelectionUpdate=!0})},endResize:function(){if(this.imageObj){var a=this.imageObj.closest(".aloha-editable");g(a).contentEditable(!0)}this.imageObj&&this.imageObj.resizable("destroy").css({top:0,left:0})},reset:function(){this.settings.ui.crop&&this.endCrop(),this.settings.ui.resizable&&this.endResize();if(this._onReset(this.imageObj))return;for(var a=0;a<this.restoreProps.length;a++)if(this.imageObj.get(0)===this.restoreProps[a].obj){this.imageObj.attr("src",this.restoreProps[a].src),this.imageObj.width(this.restoreProps[a].width),this.imageObj.height(this.restoreProps[a].height);return}}})});