/*!
 * Aloha Editor
 * Author & Copyright (c) 2011 Gentics Software GmbH
 * aloha-sales@gentics.com
 * Licensed unter the terms of http://www.aloha-editor.com/license.html
 *
 * Aloha Link List Repository
 * --------------------------
 * A simple demo repository of links, which is deliberatly slow, in order to
 * simulate lags when querying repositories.
 */
define(["aloha","aloha/jquery"],function(a,b){"use strict";var c=[{name:"Aloha Test",url:"#alohatest",type:"website"},{name:"Test One",url:"#test1",type:"website"},{name:"Test Two",url:"#test2",type:"website"},{name:"Test Three",url:"#test3",type:"website"},{name:"Test Four",url:"#test4",type:"image"}];new(a.AbstractRepository.extend({_constructor:function(){this._super("slowlinklist")},folder:[],init:function(){"filter"in Array.prototype||(c.filter=function(a,b){var c=[],d,e=0,f=this.length;for(;e<f;e++)e in this&&a.call(b,d=this[e],e,this)&&c.push(d);return c});var b=c.length;for(var d=0;d<b;++d){var e=c[d];e.repositoryId=this.repositoryId,e.id=e.id?e.id:e.url;var f=e.uri=this.parseUri(e.url),g=this.addFolder("",f.host),h=f.path.split("/");for(var i=0;i<h.length;i++)h[i]&&h[i].lastIndexOf(".")<0&&(g=this.addFolder(g,h[i]));e.parentId=g,c[d]=new a.RepositoryDocument(e)}this.repositoryName="Linklist"},addFolder:function(b,c){var d=b?"folder":"hostname",e=b?b+"/"+c:c;return c&&!this.folder[e]&&(this.folder[e]=new a.RepositoryFolder({id:e,name:c||e,parentId:b,type:"host",repositoryId:this.repositoryId})),e},query:function(a,d){var e=new RegExp(a.queryString,"i"),f=c.filter(function(c,d,f){return(!a.queryString||c.name.match(e)||c.url.match(e))&&(!a.objectTypeFilter||!a.objectTypeFilter.length||b.inArray(c.type,a.objectTypeFilter)>-1)&&!0});setTimeout(function(){d.call(this,f)},2e3)},getChildren:function(a,b){var c=[],d;for(d in this.folder){var e=this.folder[d].parentId;typeof this.folder[d]!="function"&&(this.folder[d].parentId==a.inFolderId||!this.folder[d].parentId&&a.inFolderId==this.repositoryId)&&c.push(this.folder[d])}setTimeout(function(){b.call(this,c)},2e3)},parseUri:function(a){var b={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},c=b.parser[b.strictMode?"strict":"loose"].exec(a),d={},e=14;while(e--)d[b.key[e]]=c[e]||"";return d[b.q.name]={},d[b.key[12]].replace(b.q.parser,function(a,c,e){c&&(d[b.q.name][c]=e)}),d},getObjectById:function(a,b){var d=0,e=c.length,f=[];for(;d<e;d++)c[d].id==a&&f.push(c[d]);b.call(this,f)}}))});