/*!
 * Aloha Editor
 * Author & Copyright (c) 2011 Gentics Software GmbH
 * aloha-sales@gentics.com
 * Licensed unter the terms of http://www.aloha-editor.com/license.html
 *
 * Aloha Link List Repository
 * --------------------------
 * A simple demo repository of links.
 */
define(["aloha","aloha/jquery"],function(e,t){var n=[{name:"Aloha Editor - The HTML5 Editor",url:"http://aloha-editor.com",type:"website"},{name:"Aloha Editor - Wiki",url:"http://www.aloha-editor.org/wiki/Main_Page",type:"website"},{name:"Aloha Editor - GitHub",url:"http://github.com/alohaeditor/Aloha-Editor",type:"website"},{name:"Aloha Logo",url:"http://www.aloha-editor.com/images/aloha-editor-logo.png",type:"image"}];new(e.AbstractRepository.extend({_constructor:function(){this._super("linklist")},folder:[],init:function(){typeof e.settings.repositories!="undefined"&&typeof e.settings.repositories.linklist!="undefined"&&typeof e.settings.repositories.linklist.data!="undefined"&&(n=e.settings.repositories.linklist.data),"filter"in Array.prototype||(n.filter=function(e,t){var n=[],r,i=0,s=this.length;for(;i<s;i++)i in this&&e.call(t,r=this[i],i,this)&&n.push(r);return n});var t=n.length;for(var r=0;r<t;++r){var i=n[r];i.repositoryId=this.repositoryId,i.id=i.id?i.id:i.url;var s=i.uri=this.parseUri(i.url),o=this.addFolder("",s.host),u=s.path.split("/");for(var a=0;a<u.length;a++)u[a]&&u[a].lastIndexOf(".")<0&&(o=this.addFolder(o,u[a]));i.parentId=o,n[r]=new e.RepositoryDocument(i)}this.repositoryName="Linklist"},addFolder:function(t,n){var r=t?"folder":"hostname",i=t?t+"/"+n:n;return n&&!this.folder[i]&&(this.folder[i]=new e.RepositoryFolder({id:i,name:n||i,parentId:t,type:"host",repositoryId:this.repositoryId})),i},query:function(e,r){var i=new RegExp(e.queryString,"i"),s=n.filter(function(n,r,s){return(!e.queryString||n.name.match(i)||n.url.match(i))&&(!e.objectTypeFilter||!e.objectTypeFilter.length||t.inArray(n.type,e.objectTypeFilter)>-1)&&!0});r.call(this,s)},getChildren:function(e,t){var n=[],r;for(r in this.folder){var i=this.folder[r].parentId;typeof this.folder[r]!="function"&&(this.folder[r].parentId==e.inFolderId||!this.folder[r].parentId&&e.inFolderId==this.repositoryId)&&n.push(this.folder[r])}t.call(this,n)},parseUri:function(e){var t={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=t.parser[t.strictMode?"strict":"loose"].exec(e),r={},i=14;while(i--)r[t.key[i]]=n[i]||"";return r[t.q.name]={},r[t.key[12]].replace(t.q.parser,function(e,n,i){n&&(r[t.q.name][n]=i)}),r},getObjectById:function(e,t){var r=0,i=n.length,s=[];for(;r<i;r++)n[r].id==e&&s.push(n[r]);t.call(this,s)}}))});