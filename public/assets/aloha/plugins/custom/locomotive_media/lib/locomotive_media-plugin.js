define(["aloha/jquery","aloha/plugin","aloha/floatingmenu","i18n!aloha/nls/i18n","i18n!locomotive_media/nls/i18n","css!locomotive_media/css/image.css"],function(a,b,c,d,e){var f=a,g=a,h=window.GENTICS,i=window.Aloha;return b.create("locomotive_media",{init:function(){c.createScope(this.name,"Aloha.continuoustext"),this._addUIInsertButton(d.t("floatingmenu.tab.insert"))},openDialog:function(){var a=this,b=window.parent.application_view.content_assets_picker_view;b.options.on_select=function(c){c.get("image")==1?a.insertImg(c):a.insertLink(c),b.close()},b.render()},insertImg:function(a){var b=i.Selection.getRangeObject(),c=a.get("url"),d,e,g;b.isCollapsed()?(d="max-width: "+a.get("width")+"; max-height: "+a.get("height"),e='<img style="'+d+'" src="'+c+'" title="" />',g=f(e),h.Utils.Dom.insertIntoDOM(g,b,f(i.activeEditable.obj))):i.Log.error("media cannot markup a selection")},insertLink:function(a){var b=i.Selection.getRangeObject(),c=a.get("filename"),d=a.get("url"),e,g;b.isCollapsed()?(e='<a href="'+d+'">'+c+"</a>",g=f(e),h.Utils.Dom.insertIntoDOM(g,b,f(i.activeEditable.obj)),b.startContainer=b.endContainer=g.contents().get(0),b.startOffset=0,b.endOffset=c.length):(e='<a href="'+d+'"></a>',g=f(e),h.Utils.Dom.addMarkup(b,g,!1))},_addUIInsertButton:function(a){var b=this;this.insertMediaButton=new i.ui.Button({name:"insertlocomotivemedia",iconClass:"aloha-button aloha-locomotive-media-insert",size:"small",onclick:function(){b.openDialog()},tooltip:e.t("button.addimg.tooltip"),toggle:!1}),c.addButton("Aloha.continuoustext",this.insertMediaButton,a,1)}})});