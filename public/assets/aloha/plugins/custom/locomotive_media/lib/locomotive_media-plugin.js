define(["aloha/jquery","aloha/plugin","aloha/floatingmenu","i18n!aloha/nls/i18n","i18n!locomotive_media/nls/i18n","css!locomotive_media/css/image.css"],function(e,t,n,r,i){var s=e,o=e,u=window.GENTICS,a=window.Aloha;return t.create("locomotive_media",{init:function(){n.createScope(this.name,"Aloha.continuoustext"),this._addUIInsertButton(r.t("floatingmenu.tab.insert"))},openDialog:function(){var e=this,t=window.parent.application_view.content_assets_picker_view;t.options.on_select=function(n){n.get("image")==1?e.insertImg(n):e.insertLink(n),t.close()},t.fetch_assets()},insertImg:function(e){var t=a.Selection.getRangeObject(),n=e.get("url"),r,i,o;t.isCollapsed()?(r="max-width: "+e.get("width")+"; max-height: "+e.get("height"),i='<img style="'+r+'" src="'+n+'" title="" />',o=s(i),u.Utils.Dom.insertIntoDOM(o,t,s(a.activeEditable.obj))):a.Log.error("media cannot markup a selection")},insertLink:function(e){var t=a.Selection.getRangeObject(),n=e.get("filename"),r=e.get("url"),i,o;t.isCollapsed()?(i='<a href="'+r+'">'+n+"</a>",o=s(i),u.Utils.Dom.insertIntoDOM(o,t,s(a.activeEditable.obj)),t.startContainer=t.endContainer=o.contents().get(0),t.startOffset=0,t.endOffset=n.length):(i='<a href="'+r+'"></a>',o=s(i),u.Utils.Dom.addMarkup(t,o,!1))},_addUIInsertButton:function(e){var t=this;this.insertMediaButton=new a.ui.Button({name:"insertlocomotivemedia",iconClass:"aloha-button aloha-locomotive-media-insert",size:"small",onclick:function(){t.openDialog()},tooltip:i.t("button.addimg.tooltip"),toggle:!1}),n.addButton("Aloha.continuoustext",this.insertMediaButton,e,1)}})});