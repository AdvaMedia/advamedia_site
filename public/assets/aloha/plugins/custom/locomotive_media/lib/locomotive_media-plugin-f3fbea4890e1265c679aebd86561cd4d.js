define(["aloha/jquery","aloha/plugin","ui/ui","ui/button","i18n!aloha/nls/i18n","i18n!locomotive_media/nls/i18n","css!locomotive_media/css/image.css"],function(t,e,i,n,o,a){var s=t,l=window.GENTICS,c=window.Aloha;return e.create("locomotive_media",{init:function(){this._addUIInsertButton()},openDialog:function(){var t=this,e=window.parent.application_view.content_assets_picker_view;e.options.on_select=function(i){1==i.get("image")?t.insertImg(i):t.insertLink(i),e.close()},e.fetch_assets()},insertImg:function(t){var e,i,n,o=c.Selection.getRangeObject(),a=t.get("url");o.isCollapsed()?(e="max-width: "+t.get("width")+"; max-height: "+t.get("height"),i='<img style="'+e+'" src="'+a+'" title="" />',n=s(i),l.Utils.Dom.insertIntoDOM(n,o,s(c.activeEditable.obj))):c.Log.error("media cannot markup a selection")},insertLink:function(t){var e,i,n=c.Selection.getRangeObject(),o=t.get("filename"),a=t.get("url");n.isCollapsed()?(e='<a href="'+a+'">'+o+"</a>",i=s(e),l.Utils.Dom.insertIntoDOM(i,n,s(c.activeEditable.obj)),n.startContainer=n.endContainer=i.contents().get(0),n.startOffset=0,n.endOffset=o.length):(e='<a href="'+a+'"></a>',i=s(e),l.Utils.Dom.addMarkup(n,i,!1))},_addUIInsertButton:function(){var t=this;i.adopt("insertlocomotivemedia",n,{tooltip:a.t("button.addimg.tooltip"),icon:"aloha-button aloha-locomotive-media-insert",scope:"Aloha.continuoustext",click:function(){t.openDialog()}})}})});