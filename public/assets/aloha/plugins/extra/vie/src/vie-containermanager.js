typeof VIE=="undefined"&&(VIE={}),VIE.ContainerManager={models:{},views:{},instances:[],instanceSingletons:{},findContainerProperties:function(e,t){return e.attr("typeof")||(e=e.children("[typeof][about]")),jQuery(e).find("[property]").add(jQuery(e).filter("[property]")).filter(function(){var n=jQuery(this).closest("[typeof][about]");return n.index(e)!==0&&n.length!==0?(console.log("Wrong entity",e,n,this),!1):t?!0:jQuery(this).parents("[property]").length?!1:!0})},_getContainerProperties:function(e,t){var n={};return VIE.ContainerManager.findContainerProperties(e,!0).each(function(){var e,r=jQuery(this);e=r.attr("property");if(typeof n[e]!="undefined"){if(n[e]instanceof Array){if(t)return;n[e].push(r.html());return}var i=n[e];n[e]=[];if(t)return;n[e].push(i),n[e].push(r.html());return}if(t){n[e]="";return}n[e]=r.html()}),n},_getContainerValue:function(e,t){return e=jQuery(e),typeof e.attr(t)!="undefined"?e.attr(t):e.find("["+t+"]").attr(t)},getContainerIdentifier:function(e){return VIE.ContainerManager._getContainerValue(e,"about")},cloneContainer:function(e){return e=jQuery(e).clone(!1),typeof e.attr("about")!="undefined"&&e.attr("about",""),e.find("[about]").attr("about",""),VIE.ContainerManager.findContainerProperties(e,!1).html(""),e},getViewForContainer:function(e){e=jQuery(e);var t=VIE.ContainerManager._getContainerValue(e,"typeof");if(typeof VIE.ContainerManager.views[t]!="undefined")return VIE.ContainerManager.views[t];var n={};return n.initialize=function(){_.bindAll(this,"render"),this.model.bind("change",this.render)},n.tagName=e.get(0).nodeName,n.make=function(t,n,r){return VIE.ContainerManager.cloneContainer(e)},n.render=function(){var e=this.model;return VIE.ContainerManager.findContainerProperties(this.el,!0).each(function(){var t=jQuery(this),n=t.attr("property");if(e.get(n)instanceof Array)return!0;t.html()!==e.get(n)&&t.html(e.get(n))}),this},VIE.ContainerManager.findAdditionalViewProperties(e,n),VIE.ContainerManager.views[t]=Backbone.View.extend(n),VIE.ContainerManager.views[t]},getModelForContainer:function(e){var t=VIE.ContainerManager._getContainerValue(e,"typeof");if(typeof VIE.ContainerManager.models[t]!="undefined")return VIE.ContainerManager.models[t];var n=VIE.ContainerManager._getContainerProperties(e,!0),r=jQuery.extend({},n);return r.getType=function(){return t},r.toJSONLD=function(){var e=this,t={"@":"<"+e.id+">"};t.a=e.getType();for(var n in e.attributes)e.attributes.hasOwnProperty(n)&&["id"].indexOf(n)==-1&&(t[n]=e.attributes[n]);return t},r.getInstanceForJSONLD=function(){},VIE.ContainerManager.findAdditionalModelProperties(e,r),VIE.ContainerManager.models[t]=Backbone.Model.extend(r),VIE.ContainerManager.models[t]},findAdditionalViewProperties:function(e,t){},findAdditionalModelProperties:function(e,t){},findAdditionalInstanceProperties:function(e,t){},registerInstance:function(e,t){e.views===undefined&&(e.views=[]);var n=!1;jQuery.each(e.views,function(){if(this.el.get(0)==t.get(0))return n=!0,!1});if(!n){var r=VIE.ContainerManager.getViewForContainer(t);e.views.push(new r({model:e,el:t}))}return VIE.ContainerManager.findAdditionalInstanceProperties(t,e),e.id&&(VIE.ContainerManager.instanceSingletons[e.id]=e),jQuery.inArray(e,VIE.ContainerManager.instances)===-1&&VIE.ContainerManager.instances.push(e),e},getInstanceForContainer:function(e){var t=VIE.ContainerManager.getModelForContainer(e),n=VIE.ContainerManager._getContainerProperties(e,!1);n.id=VIE.ContainerManager._getContainerValue(e,"about");if(!n.id||VIE.ContainerManager.instanceSingletons[n.id]===undefined)var r=new t(n);else{var r=VIE.ContainerManager.instanceSingletons[n.id];r.set(n)}return VIE.ContainerManager.registerInstance(r,e)},cleanup:function(){VIE.ContainerManager.instances=[]}};