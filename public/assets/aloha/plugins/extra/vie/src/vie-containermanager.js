typeof VIE=="undefined"&&(VIE={}),VIE.ContainerManager={models:{},views:{},instances:[],instanceSingletons:{},findContainerProperties:function(a,b){return a.attr("typeof")||(a=a.children("[typeof][about]")),jQuery(a).find("[property]").add(jQuery(a).filter("[property]")).filter(function(){var c=jQuery(this).closest("[typeof][about]");return c.index(a)!==0&&c.length!==0?(console.log("Wrong entity",a,c,this),!1):b?!0:jQuery(this).parents("[property]").length?!1:!0})},_getContainerProperties:function(a,b){var c={};return VIE.ContainerManager.findContainerProperties(a,!0).each(function(){var a,d=jQuery(this);a=d.attr("property");if(typeof c[a]!="undefined"){if(c[a]instanceof Array){if(b)return;c[a].push(d.html());return}var e=c[a];c[a]=[];if(b)return;c[a].push(e),c[a].push(d.html());return}if(b){c[a]="";return}c[a]=d.html()}),c},_getContainerValue:function(a,b){return a=jQuery(a),typeof a.attr(b)!="undefined"?a.attr(b):a.find("["+b+"]").attr(b)},getContainerIdentifier:function(a){return VIE.ContainerManager._getContainerValue(a,"about")},cloneContainer:function(a){return a=jQuery(a).clone(!1),typeof a.attr("about")!="undefined"&&a.attr("about",""),a.find("[about]").attr("about",""),VIE.ContainerManager.findContainerProperties(a,!1).html(""),a},getViewForContainer:function(a){a=jQuery(a);var b=VIE.ContainerManager._getContainerValue(a,"typeof");if(typeof VIE.ContainerManager.views[b]!="undefined")return VIE.ContainerManager.views[b];var c={};return c.initialize=function(){_.bindAll(this,"render"),this.model.bind("change",this.render)},c.tagName=a.get(0).nodeName,c.make=function(b,c,d){return VIE.ContainerManager.cloneContainer(a)},c.render=function(){var a=this.model;return VIE.ContainerManager.findContainerProperties(this.el,!0).each(function(){var b=jQuery(this),c=b.attr("property");if(a.get(c)instanceof Array)return!0;b.html()!==a.get(c)&&b.html(a.get(c))}),this},VIE.ContainerManager.findAdditionalViewProperties(a,c),VIE.ContainerManager.views[b]=Backbone.View.extend(c),VIE.ContainerManager.views[b]},getModelForContainer:function(a){var b=VIE.ContainerManager._getContainerValue(a,"typeof");if(typeof VIE.ContainerManager.models[b]!="undefined")return VIE.ContainerManager.models[b];var c=VIE.ContainerManager._getContainerProperties(a,!0),d=jQuery.extend({},c);return d.getType=function(){return b},d.toJSONLD=function(){var a=this,b={"@":"<"+a.id+">"};b.a=a.getType();for(var c in a.attributes)a.attributes.hasOwnProperty(c)&&["id"].indexOf(c)==-1&&(b[c]=a.attributes[c]);return b},d.getInstanceForJSONLD=function(){},VIE.ContainerManager.findAdditionalModelProperties(a,d),VIE.ContainerManager.models[b]=Backbone.Model.extend(d),VIE.ContainerManager.models[b]},findAdditionalViewProperties:function(a,b){},findAdditionalModelProperties:function(a,b){},findAdditionalInstanceProperties:function(a,b){},registerInstance:function(a,b){a.views===undefined&&(a.views=[]);var c=!1;jQuery.each(a.views,function(){if(this.el.get(0)==b.get(0))return c=!0,!1});if(!c){var d=VIE.ContainerManager.getViewForContainer(b);a.views.push(new d({model:a,el:b}))}return VIE.ContainerManager.findAdditionalInstanceProperties(b,a),a.id&&(VIE.ContainerManager.instanceSingletons[a.id]=a),jQuery.inArray(a,VIE.ContainerManager.instances)===-1&&VIE.ContainerManager.instances.push(a),a},getInstanceForContainer:function(a){var b=VIE.ContainerManager.getModelForContainer(a),c=VIE.ContainerManager._getContainerProperties(a,!1);c.id=VIE.ContainerManager._getContainerValue(a,"about");if(!c.id||VIE.ContainerManager.instanceSingletons[c.id]===undefined)var d=new b(c);else{var d=VIE.ContainerManager.instanceSingletons[c.id];d.set(c)}return VIE.ContainerManager.registerInstance(d,a)},cleanup:function(){VIE.ContainerManager.instances=[]}};