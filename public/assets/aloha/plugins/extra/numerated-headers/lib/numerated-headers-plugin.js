/*!
* Aloha Editor
* Author & Copyright (c) 2010 Gentics Software GmbH
* aloha-sales@gentics.com
* Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
define(["aloha/jquery","aloha/plugin","aloha/floatingmenu","i18n!numerated-headers/nls/i18n","i18n!aloha/nls/i18n","css!numerated-headers/css/numerated-headers.css"],function(a,b,c,d,e){var f=a,g=window.GENTICS,h=window.Aloha;return b.create("numerated-headers",{numeratedactive:!0,headingselector:"h1, h2, h3, h4, h5, h6",init:function(){var a=this;typeof this.settings.numeratedactive!="undefined"&&(this.numeratedactive=this.settings.numeratedactive),typeof this.settings.headingselector!="undefined"&&(this.headingselector=this.settings.headingselector),typeof this.settings.baseobjectSelector!="undefined"&&(this.baseobjectSelector=this.settings.baseobjectSelector),this.numeratedHeadersButton=new h.ui.Button({iconClass:"aloha-button aloha-button-numerated-headers",size:"small",onclick:function(){a.numeratedHeadersButton.isPressed()?a.removeNumerations():a.createNumeratedHeaders()},tooltip:d.t("button.numeratedHeaders.tooltip"),toggle:!0,pressed:this.numeratedactive}),c.addButton("Aloha.continuoustext",this.numeratedHeadersButton,e.t("floatingmenu.tab.format"),1),h.bind("aloha-selection-changed",function(b){a.numeratedHeadersButton.isPressed()&&a.createNumeratedHeaders()})},removeNumerations:function(){var b=this.getBaseElement();if(!b)return;var c=b.find(this.headingselector);c.each(function(){a(this).find("span[role=annotation]").each(function(){a(this).remove()})})},getBaseElement:function(){return typeof this.baseobjectSelector!="undefined"?a(this.baseobjectSelector).length>0?a(this.baseobjectSelector):!1:typeof h.activeEditable=="undefined"||h.activeEditable==null?!1:h.activeEditable.obj},hasNote:function(b){return!b||!a(b).length>0?!1:(b=a(b),b.find("span[role=annotation]").length>0?!0:!1)},hasContent:function(b){if(!b||!a(b).length>0)return!1;b=a(b);var c=b.clone().find("span[role=annotation]").remove().end();return c.text().trim().length>0?!0:!1},createNumeratedHeaders:function(){var b=this.getBaseElement();if(!b)return;var c=this,d=b.find(this.headingselector);if(typeof d=="undefined"||d.length==0)return;var e=parseInt(d[0].nodeName.substr(1)),f=null,g=[],h=0;for(var i=0;i<6-e+1;i++)g[i]=0;d.each(function(){if(c.hasContent(this)){var b=parseInt(this.nodeName.substr(1));if(f==null)g[h]++;else if(b>f)g[++h]++;else if(b==f)g[h]++;else if(b<f){var d=b-e;for(var i=h;i>d;i--)g[i]=0;h=d,g[h]++}f=b;var j=g[0];for(var k=1;k<g.length;k++)g[k]!=0&&(j+="."+g[k]);c.hasNote(this)?a(this).find("span[role=annotation]").html(j):a(this).prepend("<span role='annotation'>"+j+"</span> ")}else c.hasNote(this)&&a(this).find("span[role=annotation]").remove()})}})});