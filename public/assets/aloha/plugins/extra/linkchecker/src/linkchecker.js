/*!
* Aloha Editor
* Author & Copyright (c) 2010 Gentics Software GmbH
* aloha-sales@gentics.com
* Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
(function(e,t){var n=e.alohaQuery||e.jQuery,r=n,i=e.GENTICS,s=e.Aloha;s.LinkChecker=new s.Plugin("linkchecker"),s.LinkChecker.languages=["en"],s.LinkChecker.errorCodes=[400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,500,501,502,503,504,505,506],s.LinkChecker.warningCodes=[404,411,412,413,500,503,504,505],s.LinkChecker.init=function(){this.proxyUrl=null,typeof s.LinkChecker.settings.proxyUrl!="undefined"&&(this.proxyUrl=s.LinkChecker.settings.proxyUrl),this.timer={},this.xhr={};var e=this;s.EventRegistry.subscribe(s,"editableActivated",function(t,r){r.editable.obj.find("a").each(function(){e.checkLink(this,n(this).attr("href"),0)})}),s.EventRegistry.subscribe(s,"editableDeactivated",function(t,n){e.makeClean(n.editable.obj)}),s.EventRegistry.subscribe(s,"hrefChanged",function(t,n){e.checkLink(n.obj,"hrefChanged")})},s.LinkChecker.checkLink=function(e,r,i,s){var o=this,u,a;u=n(e).attr("href"),a=u;if(typeof u=="string"&&!/^http/.test(u.toLowerCase())){this.makeCleanLink(e);return}this.proxyUrl&&(u=this.proxyUrl+u),this.xhr[r]&&(this.xhr[r].abort(),this.xhr[r]=t),this.timer[r]=this.urlExists(u,function(t){o.makeCleanLink(e)},function(t){var r,i;e&&(n.inArray(t.status,o.errorCodes)>=0?r=t.status:r="0",i=n(e),i.attr("title")&&!i.attr("data-invalid")&&i.attr("data-title",i.attr("title")),i.attr("data-invalid","true"),i.attr("title",a+". "+o.i18n("error."+r)),n.inArray(t.status,o.warningCodes)>=0?i.addClass("aloha-link-warn"):i.addClass("aloha-link-error"))},r,s,i)},s.LinkChecker.urlExists=function(e,t,r,i,s,o){var u=this,a;return clearTimeout(this.timer[i]),o=o!=null&&typeof o!="undefined"?o:700,a=setTimeout(function(){u.xhr[i]=n.ajax({url:e,timeout:s?1e4:s,type:"HEAD",complete:function(e){clearTimeout(a);try{e.status<400?t.call(this,e):r.call(this,e)}catch(n){r.call(this,{status:0})}}})},o),a},s.LinkChecker.makeCleanLink=function(e){if(e){var t=n(e);t.attr("data-title")?t.attr("title",t.attr("data-title")):t.removeAttr("title"),t.removeAttr("data-title"),t.removeAttr("data-invalid"),t.removeClass("aloha-link-error"),t.removeClass("aloha-link-warn")}},s.LinkChecker.makeClean=function(e){var t=this;e.find("a").each(function(){t.makeCleanLink(this)})},s.LinkChecker.urlencode=function(e){return e=(e+"").toString(),encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")}})(window);