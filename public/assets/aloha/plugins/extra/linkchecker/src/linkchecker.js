/*!
* Aloha Editor
* Author & Copyright (c) 2010 Gentics Software GmbH
* aloha-sales@gentics.com
* Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
(function(a,b){var c=a.alohaQuery||a.jQuery,d=c,e=a.GENTICS,f=a.Aloha;f.LinkChecker=new f.Plugin("linkchecker"),f.LinkChecker.languages=["en"],f.LinkChecker.errorCodes=[400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,500,501,502,503,504,505,506],f.LinkChecker.warningCodes=[404,411,412,413,500,503,504,505],f.LinkChecker.init=function(){this.proxyUrl=null,typeof f.LinkChecker.settings.proxyUrl!="undefined"&&(this.proxyUrl=f.LinkChecker.settings.proxyUrl),this.timer={},this.xhr={};var a=this;f.EventRegistry.subscribe(f,"editableActivated",function(b,d){d.editable.obj.find("a").each(function(){a.checkLink(this,c(this).attr("href"),0)})}),f.EventRegistry.subscribe(f,"editableDeactivated",function(b,c){a.makeClean(c.editable.obj)}),f.EventRegistry.subscribe(f,"hrefChanged",function(b,c){a.checkLink(c.obj,"hrefChanged")})},f.LinkChecker.checkLink=function(a,d,e,f){var g=this,h,i;h=c(a).attr("href"),i=h;if(typeof h=="string"&&!/^http/.test(h.toLowerCase())){this.makeCleanLink(a);return}this.proxyUrl&&(h=this.proxyUrl+h),this.xhr[d]&&(this.xhr[d].abort(),this.xhr[d]=b),this.timer[d]=this.urlExists(h,function(b){g.makeCleanLink(a)},function(b){var d,e;a&&(c.inArray(b.status,g.errorCodes)>=0?d=b.status:d="0",e=c(a),e.attr("title")&&!e.attr("data-invalid")&&e.attr("data-title",e.attr("title")),e.attr("data-invalid","true"),e.attr("title",i+". "+g.i18n("error."+d)),c.inArray(b.status,g.warningCodes)>=0?e.addClass("aloha-link-warn"):e.addClass("aloha-link-error"))},d,f,e)},f.LinkChecker.urlExists=function(a,b,d,e,f,g){var h=this,i;return clearTimeout(this.timer[e]),g=g!=null&&typeof g!="undefined"?g:700,i=setTimeout(function(){h.xhr[e]=c.ajax({url:a,timeout:f?1e4:f,type:"HEAD",complete:function(a){clearTimeout(i);try{a.status<400?b.call(this,a):d.call(this,a)}catch(c){d.call(this,{status:0})}}})},g),i},f.LinkChecker.makeCleanLink=function(a){if(a){var b=c(a);b.attr("data-title")?b.attr("title",b.attr("data-title")):b.removeAttr("title"),b.removeAttr("data-title"),b.removeAttr("data-invalid"),b.removeClass("aloha-link-error"),b.removeClass("aloha-link-warn")}},f.LinkChecker.makeClean=function(a){var b=this;a.find("a").each(function(){b.makeCleanLink(this)})},f.LinkChecker.urlencode=function(a){return a=(a+"").toString(),encodeURIComponent(a).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")}})(window);