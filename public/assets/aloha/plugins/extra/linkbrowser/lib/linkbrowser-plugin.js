define(["aloha","aloha/jquery","aloha/plugin","aloha/pluginmanager","aloha/floatingmenu","link/link-plugin","browser/browser-plugin","i18n!linkbrowser/nls/i18n","i18n!aloha/nls/i18n"],function(e,t,n,r,i,s,o,u,a){var f=o.extend({init:function(t){this._super(t);var n=this,r=new e.ui.Button({iconClass:"aloha-button-big aloha-button-tree",size:"large",onclick:function(){n.show()},tooltip:u.t("button.addlink.tooltip"),toggle:!1});i.addButton("Aloha.continuoustext",r,u.t("floatingmenu.tab.link"),1),r.hide(),this.url=e.getAlohaUrl()+"/../plugins/extra/linkbrowser/",e.bind("aloha-link-selected",function(e,t){r.show(),i.doLayout()}),e.bind("aloha-link-unselected",function(e,t){r.hide(),i.doLayout()})},onSelect:function(t){s.hrefField.setItem(t);var n=e.Selection.getRangeObject(),r=n.startContainer=n.endContainer,i=n.startOffset=n.endOffset;n.select(),n.startContainer=n.endContainer=r,n.startOffset=n.endOffset=i,n.select(),e.trigger("aloha-link-selected-in-linkbrowser",t),this.close()},renderRowCols:function(e){var n={},r=this.url,i="__page__",s=e.id.match(/(\d+)\./);return t.each(this.columns,function(t,s){switch(t){case"icon":n.icon='<div class="aloha-browser-icon						aloha-browser-icon-'+i+'"></div>';break;case"translations":if(!e.renditions)break;var o=e.renditions,u=o.length,a=[],f;for(;u>0;--u)f=o[u],f.kind=="translation"&&a.push('<img src="'+r+"img/flags/"+f.language+'.png"									  alt="'+f.language+'"									  title="'+f.filename+'" />');n.translations=a.join("");break;case"language":n.language=e.language;break;default:n[t]=e[t]||"--"}}),n}}),l=n.create("linkbrowser",{dependencies:["link","browser"],browser:null,init:function(){var t={repositoryManager:e.RepositoryManager,repositoryFilter:[],objectTypeFilter:["website","file","image","language"],renditionFilter:["*"],filter:["language"],columns:{icon:{title:"",width:30,sortable:!1,resizable:!1},name:{title:"Name",width:320,sorttype:"text"},language:{title:"",width:30,sorttype:"text"},translations:{title:"",width:350,sorttype:"text"}},rootPath:e.getPluginUrl("browser")+"/"};this.browser=new f(t)}});return l});