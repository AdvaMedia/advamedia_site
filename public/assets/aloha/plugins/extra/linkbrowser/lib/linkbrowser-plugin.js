define(["aloha","aloha/jquery","aloha/plugin","aloha/pluginmanager","aloha/floatingmenu","link/link-plugin","browser/browser-plugin","i18n!linkbrowser/nls/i18n","i18n!aloha/nls/i18n"],function(a,b,c,d,e,f,g,h,i){var j=g.extend({init:function(b){this._super(b);var c=this,d=new a.ui.Button({iconClass:"aloha-button-big aloha-button-tree",size:"large",onclick:function(){c.show()},tooltip:h.t("button.addlink.tooltip"),toggle:!1});e.addButton("Aloha.continuoustext",d,h.t("floatingmenu.tab.link"),1),d.hide(),this.url=a.getAlohaUrl()+"/../plugins/extra/linkbrowser/",a.bind("aloha-link-selected",function(a,b){d.show(),e.doLayout()}),a.bind("aloha-link-unselected",function(a,b){d.hide(),e.doLayout()})},onSelect:function(b){f.hrefField.setItem(b);var c=a.Selection.getRangeObject(),d=c.startContainer=c.endContainer,e=c.startOffset=c.endOffset;c.select(),c.startContainer=c.endContainer=d,c.startOffset=c.endOffset=e,c.select(),a.trigger("aloha-link-selected-in-linkbrowser",b),this.close()},renderRowCols:function(a){var c={},d=this.url,e="__page__",f=a.id.match(/(\d+)\./);return b.each(this.columns,function(b,f){switch(b){case"icon":c.icon='<div class="aloha-browser-icon						aloha-browser-icon-'+e+'"></div>';break;case"translations":if(!a.renditions)break;var g=a.renditions,h=g.length,i=[],j;for(;h>0;--h)j=g[h],j.kind=="translation"&&i.push('<img src="'+d+"img/flags/"+j.language+'.png"									  alt="'+j.language+'"									  title="'+j.filename+'" />');c.translations=i.join("");break;case"language":c.language=a.language;break;default:c[b]=a[b]||"--"}}),c}}),k=c.create("linkbrowser",{dependencies:["link","browser"],browser:null,init:function(){var b={repositoryManager:a.RepositoryManager,repositoryFilter:[],objectTypeFilter:["website","file","image","language"],renditionFilter:["*"],filter:["language"],columns:{icon:{title:"",width:30,sortable:!1,resizable:!1},name:{title:"Name",width:320,sorttype:"text"},language:{title:"",width:30,sorttype:"text"},translations:{title:"",width:350,sorttype:"text"}},rootPath:a.getPluginUrl("browser")+"/"};this.browser=new j(b)}});return k});