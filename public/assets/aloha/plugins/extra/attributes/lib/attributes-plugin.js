/*!
* Aloha Editor
* Author & Copyright (c) 2010 Gentics Software GmbH
* aloha-sales@gentics.com
* Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
define(["aloha","aloha/plugin","aloha/floatingmenu","i18n!attributes/nls/i18n","i18n!aloha/nls/i18n","css!attributes/css/attributes.css"],function(a,b,c,d,e){var f=a.jQuery,g=f,h=window.GENTICS,a=window.Aloha;return b.create("attributes",{_constructor:function(){this._super("attributes")},ns:"aloha-attributes",uid:"attributes",nsClasses:{},supplant:function(a,b){return a.replace(/\{([a-z0-9\-\_]+)\}/ig,function(a,c,d,e){var f=b[c]||a;return typeof f=="function"?f():f})},renderTemplate:function(a){return typeof a=="string"?this.supplant(a,this.nsClasses):a},nsSel:function(){var a=[],b=this.ns;return g.each(arguments,function(){a.push("."+(this==""?b:b+"-"+this))}),a.join(" ").trim()},nsClass:function(){var a=[],b=this.ns;return g.each(arguments,function(){a.push(this==""?b:b+"-"+this)}),a.join(" ").trim()},config:["true"],activeOn:function(a){return typeof this.settings.disabled=="boolean"&&this.settings.disabled?!1:typeof a!="undefined"&&a!=null?!0:!1},init:function(){var b=this;this.nsClasses={newattributename:this.nsClass("newattributename"),newattributebutton:this.nsClass("newattributebutton"),newattributewert:this.nsClass("newattributewert"),container:this.nsClass("container"),attribcontainer:this.nsClass("attribcontainer"),newattribute:this.nsClass("newattribute"),item:this.nsClass("item"),element:this.nsClass("element"),iteminput:this.nsClass("iteminput")},typeof this.settings.activeOn!="undefined"&&(this.activeOn=this.settings.activeOn),a.ready(function(c,d){b.initSidebar(a.Sidebar.right)})},getSidebarContent:function(){return this.renderTemplate('<div class="{container}">						<h2 id="{element}">Element:</h2>						<h2>Vorhandene Attribute</h2>						<div class="{attribcontainer}">							attribcontainer						</div>												<div class="{newattribute}">						<h2>Neues Attribut</h2>						<label for="{newattributename}">Name:</label><input type="text" id="{newattributename}"/>						<label for="{newattributewert}">Wert:</label><input type="text" id="{newattributewert}"/>						<button id="{newattributebutton}">Hinzuf&uuml;gen</button>						</div>											</div>')},updateSidebarWithAttributes:function(){var a=this,b=this.effective[0],c=this.content.find(this.nsSel("attribcontainer"));c.html("");for(var d,e=0,g=b.attributes,h=g.length;e<h;e++){d=g.item(e);var i=f(this.renderTemplate('<div class="{item}"><label for="{iteminput}'+d.nodeName+'">'+d.nodeName+'</label><input id="{iteminput}'+d.nodeName+'" class="{iteminput}" data-attrname="'+d.nodeName+'" type="text" value="'+d.nodeValue+'"/></div>'));c.append(i)}c.find(this.nsSel("iteminput")).blur(function(){var c=f(this).val(),d=f(this).attr("data-attrname");typeof c=="undefined"||c==""?(f(this).parents(a.nsSel("item")).remove(),pl.correchtHeight()):f(b).attr(d,c)});var j=this.content.find("#"+this.nsClass("element"));j.html("Element: "+b.tagName)},correctHeight:function(){this.sidebar.correctHeight()},initSidebar:function(a){var b=this;b.sidebar=a;var c=this.getSidebarContent();a.addPanel({id:b.nsClass("sidebar-panel"),title:"Attribute",content:"",expanded:!0,activeOn:function(a){return b.activeOn(a)},onInit:function(){var a=this;b.content=this.setContent(c).content,b.content.find("#"+b.nsClass("newattributebutton")).click(function(){var a=f("#"+b.nsClass("newattributename")).val(),c=f("#"+b.nsClass("newattributewert")).val();f("#"+b.nsClass("newattributename")).val(""),f("#"+b.nsClass("newattributewert")).val(""),f(b.effective).attr(a,c),b.updateSidebarWithAttributes(),b.correchtHeight()})},onActivate:function(a){var c=this;c.effective=a,b.effective=a,b.updateSidebarWithAttributes(),b.correctHeight()}})}})});