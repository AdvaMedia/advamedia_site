/*!
* Aloha Editor
* Author & Copyright (c) 2010 Gentics Software GmbH
* aloha-sales@gentics.com
* Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
define(["aloha","aloha/plugin","aloha/floatingmenu","i18n!attributes/nls/i18n","i18n!aloha/nls/i18n","css!attributes/css/attributes.css"],function(e,t,n,r,i){var s=e.jQuery,o=s,u=window.GENTICS,e=window.Aloha;return t.create("attributes",{_constructor:function(){this._super("attributes")},ns:"aloha-attributes",uid:"attributes",nsClasses:{},supplant:function(e,t){return e.replace(/\{([a-z0-9\-\_]+)\}/ig,function(e,n,r,i){var s=t[n]||e;return typeof s=="function"?s():s})},renderTemplate:function(e){return typeof e=="string"?this.supplant(e,this.nsClasses):e},nsSel:function(){var e=[],t=this.ns;return o.each(arguments,function(){e.push("."+(this==""?t:t+"-"+this))}),e.join(" ").trim()},nsClass:function(){var e=[],t=this.ns;return o.each(arguments,function(){e.push(this==""?t:t+"-"+this)}),e.join(" ").trim()},config:["true"],activeOn:function(e){return typeof this.settings.disabled=="boolean"&&this.settings.disabled?!1:typeof e!="undefined"&&e!=null?!0:!1},init:function(){var t=this;this.nsClasses={newattributename:this.nsClass("newattributename"),newattributebutton:this.nsClass("newattributebutton"),newattributewert:this.nsClass("newattributewert"),container:this.nsClass("container"),attribcontainer:this.nsClass("attribcontainer"),newattribute:this.nsClass("newattribute"),item:this.nsClass("item"),element:this.nsClass("element"),iteminput:this.nsClass("iteminput")},typeof this.settings.activeOn!="undefined"&&(this.activeOn=this.settings.activeOn),e.ready(function(n,r){t.initSidebar(e.Sidebar.right)})},getSidebarContent:function(){return this.renderTemplate('<div class="{container}">						<h2 id="{element}">Element:</h2>						<h2>Vorhandene Attribute</h2>						<div class="{attribcontainer}">							attribcontainer						</div>												<div class="{newattribute}">						<h2>Neues Attribut</h2>						<label for="{newattributename}">Name:</label><input type="text" id="{newattributename}"/>						<label for="{newattributewert}">Wert:</label><input type="text" id="{newattributewert}"/>						<button id="{newattributebutton}">Hinzuf&uuml;gen</button>						</div>											</div>')},updateSidebarWithAttributes:function(){var e=this,t=this.effective[0],n=this.content.find(this.nsSel("attribcontainer"));n.html("");for(var r,i=0,o=t.attributes,u=o.length;i<u;i++){r=o.item(i);var a=s(this.renderTemplate('<div class="{item}"><label for="{iteminput}'+r.nodeName+'">'+r.nodeName+'</label><input id="{iteminput}'+r.nodeName+'" class="{iteminput}" data-attrname="'+r.nodeName+'" type="text" value="'+r.nodeValue+'"/></div>'));n.append(a)}n.find(this.nsSel("iteminput")).blur(function(){var n=s(this).val(),r=s(this).attr("data-attrname");typeof n=="undefined"||n==""?(s(this).parents(e.nsSel("item")).remove(),pl.correchtHeight()):s(t).attr(r,n)});var f=this.content.find("#"+this.nsClass("element"));f.html("Element: "+t.tagName)},correctHeight:function(){this.sidebar.correctHeight()},initSidebar:function(e){var t=this;t.sidebar=e;var n=this.getSidebarContent();e.addPanel({id:t.nsClass("sidebar-panel"),title:"Attribute",content:"",expanded:!0,activeOn:function(e){return t.activeOn(e)},onInit:function(){var e=this;t.content=this.setContent(n).content,t.content.find("#"+t.nsClass("newattributebutton")).click(function(){var e=s("#"+t.nsClass("newattributename")).val(),n=s("#"+t.nsClass("newattributewert")).val();s("#"+t.nsClass("newattributename")).val(""),s("#"+t.nsClass("newattributewert")).val(""),s(t.effective).attr(e,n),t.updateSidebarWithAttributes(),t.correchtHeight()})},onActivate:function(e){var n=this;n.effective=e,t.effective=e,t.updateSidebarWithAttributes(),t.correctHeight()}})}})});