/*!
* This file is part of Aloha Editor Project http://aloha-editor.org
* Copyright (c) 2010-2011 Gentics Software GmbH, aloha@gentics.com
* Contributors http://aloha-editor.org/contribution.php 
* Licensed unter the terms of http://www.aloha-editor.org/license.html
*
* Aloha Editor is free software: you can redistribute it and/or modify
* it under the terms of the GNU Affero General Public License as published by
* the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.*
*
* Aloha Editor is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
* GNU Affero General Public License for more details.
*
* You should have received a copy of the GNU Affero General Public License
* along with this program. If not, see <http://www.gnu.org/licenses/>.
*/
// define jquery and ext modules. They need to be available in global namespace
define("aloha/jquery",[],function(){return Aloha.jQuery.support.getSetAttribute||function(e){Aloha.jQuery.removeAttr=function(e,t){e.removeAttribute(t)}}(Aloha),Aloha.jQuery}),define("aloha/ext",[],function(){return Ext.QuickTips.init(),Ext}),define("util/json2",[],function(){});var JSON;JSON||(JSON={}),function(){function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("vendor/jquery.json-2.2.min",["aloha/jquery"],function($){$.toJSON=function(e){if(typeof JSON=="object"&&JSON.stringify)return JSON.stringify(e);var t=typeof e;if(e===null)return"null";if(t=="undefined")return undefined;if(t=="number"||t=="boolean")return e+"";if(t=="string")return $.quoteString(e);if(t=="object"){if(typeof e.toJSON=="function")return $.toJSON(e.toJSON());if(e.constructor===Date){var n=e.getUTCMonth()+1;n<10&&(n="0"+n);var r=e.getUTCDate();r<10&&(r="0"+r);var i=e.getUTCFullYear(),s=e.getUTCHours();s<10&&(s="0"+s);var o=e.getUTCMinutes();o<10&&(o="0"+o);var u=e.getUTCSeconds();u<10&&(u="0"+u);var a=e.getUTCMilliseconds();return a<100&&(a="0"+a),a<10&&(a="0"+a),'"'+i+"-"+n+"-"+r+"T"+s+":"+o+":"+u+"."+a+'Z"'}if(e.constructor===Array){var f=[];for(var l=0;l<e.length;l++)f.push($.toJSON(e[l])||"null");return"["+f.join(",")+"]"}var c=[];for(var h in e){var p,t=typeof h;if(t=="number")p='"'+h+'"';else{if(t!="string")continue;p=$.quoteString(h)}if(typeof e[h]=="function")continue;var d=$.toJSON(e[h]);c.push(p+":"+d)}return"{"+c.join(", ")+"}"}},$.evalJSON=function(src){return typeof JSON=="object"&&JSON.parse?JSON.parse(src):eval("("+src+")")},$.secureEvalJSON=function(src){if(typeof JSON=="object"&&JSON.parse)return JSON.parse(src);var filtered=src;filtered=filtered.replace(/\\["\\\/bfnrtu]/g,"@"),filtered=filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]"),filtered=filtered.replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered))return eval("("+src+")");throw new SyntaxError("Error parsing JSON, source is not valid.")},$.quoteString=function(e){return e.match(_escapeable)?'"'+e.replace(_escapeable,function(e){var t=_meta[e];return typeof t=="string"?t:(t=e.charCodeAt(),"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16))})+'"':'"'+e+'"'};var _escapeable=/["\\\x00-\x1f\x7f-\x9f]/g,_meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"}}),define("vendor/jquery.store",["aloha/jquery","util/json2"],function(e,t,n){e.store=function(t,n){var r=window.JSON;that=this;if(typeof t=="string"){if(!e.store.drivers[t])throw new Error("Unknown driver "+t);this.driver=e.store.drivers[t]}else if(typeof t=="object"){var i=!e.isFunction(t.init)||!e.isFunction(t.get)||!e.isFunction(t.set)||!e.isFunction(t.del)||!e.isFunction(t.flush);if(i)throw new Error("The specified driver does not fulfill the API requirements");this.driver=t}else e.each(e.store.drivers,function(){return!e.isFunction(this.available)||!this.available()?!0:(that.driver=this,that.driver.init()===!1?(that.driver=null,!0):!1)});n||(n=e.store.serializers),this.serializers={},e.each(n,function(t,n){if(!e.isFunction(this.init))return!0;that.serializers[t]=this,that.serializers[t].init(that.encoders,that.decoders)})},e.extend(e.store.prototype,{get:function(e){var t=this.driver.get(e);return this.driver.encodes?t:this.unserialize(t)},set:function(e,t){this.driver.set(e,this.driver.encodes?t:this.serialize(t))},del:function(e){this.driver.del(e)},flush:function(){this.driver.flush()},driver:n,encoders:[],decoders:[],serialize:function(t){var n=this;return e.each(this.encoders,function(){var e=n.serializers[this+""];if(!e||!e.encode)return!0;try{t=e.encode(t)}catch(r){}}),t},unserialize:function(t){var n=this;return t?(e.each(this.decoders,function(){var e=n.serializers[this+""];if(!e||!e.decode)return!0;t=e.decode(t)}),t):t}}),e.store.drivers={localStorage:{ident:"$.store.drivers.localStorage",scope:"browser",available:function(){try{return!!window.localStorage}catch(e){return!1}},init:e.noop,get:function(e){return window.localStorage.getItem(e)},set:function(e,t){window.localStorage.setItem(e,t)},del:function(e){window.localStorage.removeItem(e)},flush:function(){window.localStorage.clear()}},userData:{ident:"$.store.drivers.userData",element:null,nodeName:"userdatadriver",scope:"browser",initialized:!1,available:function(){try{return!!document.documentElement&&!!document.documentElement.addBehavior}catch(e){return!1}},init:function(){if(this.initialized)return;try{this.element=document.createElement(this.nodeName),document.documentElement.insertBefore(this.element,document.getElementsByTagName("title")[0]),this.element.addBehavior("#default#userData"),this.initialized=!0}catch(e){return!1}},get:function(e){return this.element.load(this.nodeName),this.element.getAttribute(e)},set:function(e,t){this.element.setAttribute(e,t),this.element.save(this.nodeName)},del:function(e){this.element.removeAttribute(e),this.element.save(this.nodeName)},flush:function(){this.element.expires=(new Date).toUTCString(),this.element.save(this.nodeName)}},windowName:{ident:"$.store.drivers.windowName",scope:"window",cache:{},encodes:!0,available:function(){return!0},init:function(){this.load()},save:function(){window.name=e.store.serializers.json.encode(this.cache)},load:function(){try{this.cache=e.store.serializers.json.decode(window.name+""),typeof this.cache!="object"&&(this.cache={})}catch(t){this.cache={},window.name="{}"}},get:function(e){return this.cache[e]},set:function(e,t){this.cache[e]=t,this.save()},del:function(e){try{delete this.cache[e]}catch(t){this.cache[e]=n}this.save()},flush:function(){window.name="{}"}}},e.store.serializers={json:{ident:"$.store.serializers.json",init:function(e,t){e.push("json"),t.push("json")},encode:JSON.stringify,decode:JSON.parse},xml:{ident:"$.store.serializers.xml",init:function(e,t){e.unshift("xml"),t.push("xml")},isXML:function(e){var t=(e?e.ownerDocument||e:0).documentElement;return t?t.nodeName.toLowerCase()!=="html":!1},encode:function(e){if(!e||e._serialized||!this.isXML(e))return e;var t={_serialized:this.ident,value:e};try{return t.value=(new XMLSerializer).serializeToString(e),t}catch(n){try{return t.value=e.xml,t}catch(r){}}return e},decode:function(e){if(!e||!e._serialized||e._serialized!=this.ident)return e;var t="DOMParser"in window&&(new DOMParser).parseFromString;return!t&&window.ActiveXObject&&(t=function(e){var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}),t?(e.value=t.call("DOMParser"in window&&new DOMParser||window,e.value,"text/xml"),this.isXML(e.value)?e.value:n):n}}};if(e.browser.msie&&e.browser.version=="7.0"){delete e.store.drivers.windowName;var r={ident:"$.store.drivers.voidDriver",scope:"void",cache:{},encodes:!0,available:function(){return!0},init:function(){},save:function(){},get:function(e){},set:function(e,t){},del:function(e){},flush:function(){}};e.store.drivers.voidDriver=r}}),define("aloha/rangy-core",[],function(){});var rangy=function(){function u(n,r){var i=typeof n[r];return i==t||i==e&&!!n[r]||i=="unknown"}function a(t,n){return typeof t[n]==e&&!!t[n]}function f(e,t){return typeof e[t]!=n}function l(e){return function(t,n){var r=n.length;while(r--)if(!e(t,n[r]))return!1;return!0}}function d(e){return e&&c(e,o)&&p(e,s)}function m(e){window.alert("Rangy not supported in your browser. Reason: "+e),v.initialized=!0,v.supported=!1}function g(e){var t="Rangy warning: "+e;v.config.alertOnWarn?window.alert(t):typeof window.console!=n&&typeof window.console.log!=n&&window.console.log(t)}function w(){if(v.initialized)return;var e,t=!1,n=!1;u(document,"createRange")&&(e=document.createRange(),c(e,i)&&p(e,r)&&(t=!0),e.detach());var s=a(document,"body")?document.body:document.getElementsByTagName("body")[0];s&&u(s,"createTextRange")&&(e=s.createTextRange(),d(e)&&(n=!0)),!t&&!n&&m("Neither Range nor TextRange are implemented"),v.initialized=!0,v.features={implementsDomRange:t,implementsTextRange:n};var o=b.concat(y);for(var f=0,l=o.length;f<l;++f)try{o[f](v)}catch(h){a(window,"console")&&u(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",h)}}function S(e){e=e||window,w();for(var t=0,n=E.length;t<n;++t)E[t](e)}function x(e){this.name=e,this.initialized=!1,this.supported=!1}var e="object",t="function",n="undefined",r=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],i=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],s=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],o=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],c=l(u),h=l(a),p=l(f),v={version:"1.2.1",initialized:!1,supported:!0,util:{isHostMethod:u,isHostObject:a,isHostProperty:f,areHostMethods:c,areHostObjects:h,areHostProperties:p,isTextRange:d},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};v.fail=m,v.warn=g,{}.hasOwnProperty?v.util.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}:m("hasOwnProperty not supported");var y=[],b=[];v.init=w,v.addInitListener=function(e){v.initialized?e(v):y.push(e)};var E=[];v.addCreateMissingNativeApiListener=function(e){E.push(e)},v.createMissingNativeApi=S,x.prototype.fail=function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},x.prototype.warn=function(e){v.warn("Module "+this.name+": "+e)},x.prototype.createError=function(e){return new Error("Error in Rangy "+this.name+" module: "+e)},v.createModule=function(e,t){var n=new x(e);v.modules[e]=n,b.push(function(e){t(e,n),n.initialized=!0,n.supported=!0})},v.requireModules=function(e){for(var t=0,n=e.length,r,i;t<n;++t){i=e[t],r=v.modules[i];if(!r||!(r instanceof x))throw new Error("Module '"+i+"' not found");if(!r.supported)throw new Error("Module '"+i+"' not supported")}};var T=!1,N=function(e){T||(T=!0,v.initialized||w())};if(typeof window==n){m("No window found");return}if(typeof document==n){m("No document found");return}return u(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",N,!1),u(window,"addEventListener")?window.addEventListener("load",N,!1):u(window,"attachEvent")?window.attachEvent("onload",N):m("Window does not have required addEventListener or attachEvent method"),v}();rangy.createModule("DomUtil",function(e,t){function u(e){var t;return typeof e.namespaceURI==n||(t=e.namespaceURI)===null||t=="http://www.w3.org/1999/xhtml"}function a(e){var t=e.parentNode;return t.nodeType==1?t:null}function f(e){var t=0;while(e=e.previousSibling)t++;return t}function l(e){var t;return d(e)?e.length:(t=e.childNodes)?t.length:0}function c(e,t){var n=[],r;for(r=e;r;r=r.parentNode)n.push(r);for(r=t;r;r=r.parentNode)if(o(n,r))return r;return null}function h(e,t,n){var r=n?t:t.parentNode;while(r){if(r===e)return!0;r=r.parentNode}return!1}function p(e,t,n){var r,i=n?e:e.parentNode;while(i){r=i.parentNode;if(r===t)return i;i=r}return null}function d(e){var t=e.nodeType;return t==3||t==4||t==8}function v(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function m(e,t){var n=e.cloneNode(!1);return n.deleteData(0,t),e.deleteData(t,e.length-t),v(n,e),n}function g(e){if(e.nodeType==9)return e;if(typeof e.ownerDocument!=n)return e.ownerDocument;if(typeof e.document!=n)return e.document;if(e.parentNode)return g(e.parentNode);throw new Error("getDocument: no document found for node")}function y(e){var t=g(e);if(typeof t.defaultView!=n)return t.defaultView;if(typeof t.parentWindow!=n)return t.parentWindow;throw new Error("Cannot get a window object for node")}function b(e){if(typeof e.contentDocument!=n)return e.contentDocument;if(typeof e.contentWindow!=n)return e.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element")}function w(e){if(typeof e.contentWindow!=n)return e.contentWindow;if(typeof e.contentDocument!=n)return e.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element")}function E(e){return r.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]}function S(e){var t;while(t=e.parentNode)e=t;return e}function x(e){if(!e)return;return e.previousSibling?e.previousSibling.nextSibling:e.nextSibling?e.nextSibling.previousSibling:e.parentNode?e.parentNode.firstChild:e}function T(e,t,n,r){e=x(e),n=x(n);var i,s,o,u,a;if(e==n)return t===r?0:t<r?-1:1;if(i=p(n,e,!0))return t<=f(i)?-1:1;if(i=p(e,n,!0))return f(i)<r?-1:1;s=c(e,n),o=e===s?s:p(e,s,!0),u=n===s?s:p(n,s,!0);if(o===u)throw new Error("comparePoints got to case 4 and childA and childB are the same!");a=s.firstChild;while(a){if(a===o)return-1;if(a===u)return 1;a=a.nextSibling}throw new Error("Should not be here!")}function N(e){var t=g(e).createDocumentFragment(),n;while(n=e.firstChild)t.appendChild(n);return t}function C(e){if(!e)return"[No node]";if(d(e))return'"'+e.data+'"';if(e.nodeType==1){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+e.childNodes.length+"]"}return e.nodeName}function k(e){this.root=e,this._next=e}function L(e){return new k(e)}function A(e,t){this.node=e,this.offset=t}function O(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var n="undefined",r=e.util;r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),r.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var i=document.createElement("div");r.areHostMethods(i,["insertBefore","appendChild","cloneNode"]||!r.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),r.isHostProperty(i,"innerHTML")||t.fail("Element is missing innerHTML property");var s=document.createTextNode("test");r.areHostMethods(s,["splitText","deleteData","insertData","appendData","cloneNode"]||!r.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"])||!r.areHostProperties(s,["data"]))||t.fail("Incomplete Text Node implementation");var o=function(e,t){var n=e.length;while(n--)if(e[n]===t)return!0;return!1};k.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next,t,n;if(this._current){t=e.firstChild;if(t)this._next=t;else{n=null;while(e!==this.root&&!(n=e.nextSibling))e=e.parentNode;this._next=n}}return this._current},detach:function(){this._current=this._next=this.root=null}},A.prototype={equals:function(e){return this.node===e.node&this.offset==e.offset},inspect:function(){return"[DomPosition("+C(this.node)+":"+this.offset+")]"}},O.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},O.prototype.toString=function(){return this.message},e.dom={arrayContains:o,isHtmlNamespace:u,parentElement:a,getNodeIndex:f,getNodeLength:l,getCommonAncestor:c,isAncestorOf:h,getClosestAncestorIn:p,isCharacterDataNode:d,insertAfter:v,splitDataNode:m,getDocument:g,getWindow:y,getIframeWindow:w,getIframeDocument:b,getBody:E,getRootContainer:S,comparePoints:T,inspectNode:C,fragmentFromNodeChildren:N,createIterator:L,DomPosition:A},e.DOMException=O}),rangy.createModule("DomRange",function(e,t){function s(e,t){return e.nodeType!=3&&(n.isAncestorOf(e,t.startContainer,!0)||n.isAncestorOf(e,t.endContainer,!0))}function o(e){return n.getDocument(e.startContainer)}function u(e,t,n){var r=e._listeners[t];if(r)for(var i=0,s=r.length;i<s;++i)r[i].call(e,{target:e,args:n})}function a(e){return new r(e.parentNode,n.getNodeIndex(e))}function f(e){return new r(e.parentNode,n.getNodeIndex(e)+1)}function l(e,t,r){var i=e.nodeType==11?e.firstChild:e;return n.isCharacterDataNode(t)?r==t.length?n.insertAfter(e,t):t.parentNode.insertBefore(e,r==0?t:n.splitDataNode(t,r)):r>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[r]),i}function c(e){var t;for(var n,r=o(e.range).createDocumentFragment(),s;n=e.next();){t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(s=e.getSubtreeIterator(),n.appendChild(c(s)),s.detach(!0));if(n.nodeType==10)throw new i("HIERARCHY_REQUEST_ERR");r.appendChild(n)}return r}function h(e,t,r){var i,s;r=r||{stop:!1};for(var o,u;o=e.next();)if(e.isPartiallySelectedSubtree()){if(t(o)===!1){r.stop=!0;return}u=e.getSubtreeIterator(),h(u,t,r),u.detach(!0);if(r.stop)return}else{i=n.createIterator(o);while(s=i.next())if(t(s)===!1){r.stop=!0;return}}}function p(e){var t;while(e.next())e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),p(t),t.detach(!0)):e.remove()}function d(e){for(var t,n=o(e.range).createDocumentFragment(),r;t=e.next();){e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(d(r)),r.detach(!0)):e.remove();if(t.nodeType==10)throw new i("HIERARCHY_REQUEST_ERR");n.appendChild(t)}return n}function v(e,t,n){var r=!!t&&!!t.length,i,s=!!n;r&&(i=new RegExp("^("+t.join("|")+")$"));var o=[];return h(new g(e,!1),function(e){(!r||i.test(e.nodeType))&&(!s||n(e))&&o.push(e)}),o}function m(e){var t=typeof e.getName=="undefined"?"Range":e.getName();return"["+t+"("+n.inspectNode(e.startContainer)+":"+e.startOffset+", "+n.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function g(e,t){this.range=e,this.clonePartiallySelectedTextNodes=t;if(!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var r=e.commonAncestorContainer;this.sc===this.ec&&n.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===r&&!n.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:n.getClosestAncestorIn(this.sc,r,!0),this._last=this.ec===r&&!n.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:n.getClosestAncestorIn(this.ec,r,!0))}}function y(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function b(e,t,n){this.nodes=v(e,t,n),this._next=this.nodes[0],this._position=0}function N(e){return function(t,r){var i,s=r?t:t.parentNode;while(s){i=s.nodeType;if(n.arrayContains(e,i))return s;s=s.parentNode}return null}}function O(e,t){if(A(e,t))throw new y("INVALID_NODE_TYPE_ERR")}function M(e){if(!e.startContainer)throw new i("INVALID_STATE_ERR")}function _(e,t){if(!n.arrayContains(t,e.nodeType))throw new y("INVALID_NODE_TYPE_ERR")}function D(e,t){if(t<0||t>(n.isCharacterDataNode(e)?e.length:e.childNodes.length))throw new i("INDEX_SIZE_ERR")}function P(e,t){if(k(e,!0)!==k(t,!0))throw new i("WRONG_DOCUMENT_ERR")}function H(e){if(L(e,!0))throw new i("NO_MODIFICATION_ALLOWED_ERR")}function B(e,t){if(!e)throw new i(t)}function j(e){return!n.arrayContains(E,e.nodeType)&&!k(e,!0)}function F(e,t){return t<=(n.isCharacterDataNode(e)?e.length:e.childNodes.length)}function I(e){M(e);if(j(e.startContainer)||j(e.endContainer)||!F(e.startContainer,e.startOffset)||!F(e.endContainer,e.endOffset))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function Z(){}function et(e){e.START_TO_START=X,e.START_TO_END=V,e.END_TO_END=$,e.END_TO_START=J,e.NODE_BEFORE=K,e.NODE_AFTER=Q,e.NODE_BEFORE_AND_AFTER=G,e.NODE_INSIDE=Y}function tt(e){et(e),et(e.prototype)}function nt(e,t){return function(){I(this);var r=this.startContainer,i=this.startOffset,s=this.commonAncestorContainer,o=new g(this,!0),u,a;r!==s&&(u=n.getClosestAncestorIn(r,s,!0),a=f(u),r=a.node,i=a.offset),h(o,H),o.reset();var l=e(o);return o.detach(),t(this,r,i,r,i),l}}function rt(t,r,i){function o(e,t){return function(n){M(this),_(n,w),_(C(n),E);var r=(e?a:f)(n);(t?u:l)(this,r.node,r.offset)}}function u(e,t,i){var s=e.endContainer,o=e.endOffset;if(t!==e.startContainer||i!==this.startOffset){if(C(t)!=C(s)||n.comparePoints(t,i,s,o)==1)s=t,o=i;r(e,t,i,s,o)}}function l(e,t,i){var s=e.startContainer,o=e.startOffset;if(t!==e.endContainer||i!==this.endOffset){if(C(t)!=C(s)||n.comparePoints(t,i,s,o)==-1)s=t,o=i;r(e,s,o,t,i)}}function c(e,t,n){(t!==e.startContainer||n!==this.startOffset||t!==e.endContainer||n!==this.endOffset)&&r(e,t,n,t,n)}t.prototype=new Z,e.util.extend(t.prototype,{setStart:function(e,t){M(this),O(e,!0),D(e,t),u(this,e,t)},setEnd:function(e,t){M(this),O(e,!0),D(e,t),l(this,e,t)},setStartBefore:o(!0,!0),setStartAfter:o(!1,!0),setEndBefore:o(!0,!1),setEndAfter:o(!1,!1),collapse:function(e){I(this),e?r(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):r(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){M(this),O(e,!0),r(this,e,0,e,n.getNodeLength(e))},selectNode:function(e){M(this),O(e,!1),_(e,w);var t=a(e),n=f(e);r(this,t.node,t.offset,n.node,n.offset)},extractContents:nt(d,r),deleteContents:nt(p,r),canSurroundContents:function(){I(this),H(this.startContainer),H(this.endContainer);var e=new g(this,!0),t=e._first&&s(e._first,this)||e._last&&s(e._last,this);return e.detach(),!t},detach:function(){i(this)},splitBoundaries:function(){I(this);var e=this.startContainer,t=this.startOffset,i=this.endContainer,s=this.endOffset,o=e===i;n.isCharacterDataNode(i)&&s>0&&s<i.length&&n.splitDataNode(i,s),n.isCharacterDataNode(e)&&t>0&&t<e.length&&(e=n.splitDataNode(e,t),o?(s-=t,i=e):i==e.parentNode&&s>=n.getNodeIndex(e)&&s++,t=0),r(this,e,t,i,s)},normalizeBoundaries:function(){I(this);var e=this.startContainer,t=this.startOffset,i=this.endContainer,s=this.endOffset,o=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(i=e,s=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},u=function(r){var o=r.previousSibling;if(o&&o.nodeType==r.nodeType){e=r;var u=r.length;t=o.length,r.insertData(0,o.data),o.parentNode.removeChild(o);if(e==i)s+=t,i=e;else if(i==r.parentNode){var a=n.getNodeIndex(r);s==a?(i=r,s=u):s>a&&s--}}},a=!0;if(n.isCharacterDataNode(i))i.length==s&&o(i);else{if(s>0){var f=i.childNodes[s-1];f&&n.isCharacterDataNode(f)&&o(f)}a=!this.collapsed}if(a){if(n.isCharacterDataNode(e))t==0&&u(e);else if(t<e.childNodes.length){var l=e.childNodes[t];l&&n.isCharacterDataNode(l)&&u(l)}}else e=i,t=s;r(this,e,t,i,s)},collapseToPoint:function(e,t){M(this),O(e,!0),D(e,t),c(this,e,t)}}),tt(t)}function it(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:n.getCommonAncestor(e.startContainer,e.endContainer)}function st(e,t,n,r,i){var s=e.startContainer!==t||e.startOffset!==n,o=e.endContainer!==r||e.endOffset!==i;e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=i,it(e),u(e,"boundarychange",{startMoved:s,endMoved:o})}function ot(e){M(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=null,e.collapsed=e.commonAncestorContainer=null,u(e,"detach",null),e._listeners=null}function ut(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},it(this)}e.requireModules(["DomUtil"]);var n=e.dom,r=n.DomPosition,i=e.DOMException;g.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,n.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e=this._current,t,r;!n.isCharacterDataNode(e)||e!==this.sc&&e!==this.ec?e.parentNode&&e.parentNode.removeChild(e):(t=e===this.sc?this.so:0,r=e===this.ec?this.eo:e.length,t!=r&&e.deleteData(t,r-t))},isPartiallySelectedSubtree:function(){var e=this._current;return s(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse();else{e=new ut(o(this.range));var t=this._current,r=t,i=0,s=t,u=n.getNodeLength(t);n.isAncestorOf(t,this.sc,!0)&&(r=this.sc,i=this.so),n.isAncestorOf(t,this.ec,!0)&&(s=this.ec,u=this.eo),st(e,r,i,s,u)}return new g(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},y.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},y.prototype.toString=function(){return this.message},b.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var w=[1,3,4,5,7,8,10],E=[2,9,11],S=[5,6,10,12],x=[1,3,4,5,7,8,10,11],T=[1,3,4,5,7,8],C=n.getRootContainer,k=N([9,11]),L=N(S),A=N([6,10,12]),q=document.createElement("style"),R=!1;try{q.innerHTML="<b>x</b>",R=q.firstChild.nodeType==3}catch(U){}e.features.htmlParsingConforms=R;var z=R?function(e){var t=this.startContainer,r=n.getDocument(t);if(!t)throw new i("INVALID_STATE_ERR");var s=null;return t.nodeType==1?s=t:n.isCharacterDataNode(t)&&(s=n.parentElement(t)),s===null||s.nodeName=="HTML"&&n.isHtmlNamespace(n.getDocument(s).documentElement)&&n.isHtmlNamespace(s)?s=r.createElement("body"):s=s.cloneNode(!1),s.innerHTML=e,n.fragmentFromNodeChildren(s)}:function(e){M(this);var t=o(this),r=t.createElement("body");return r.innerHTML=e,n.fragmentFromNodeChildren(r)},W=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],X=0,V=1,$=2,J=3,K=0,Q=1,G=2,Y=3;Z.prototype={attachListener:function(e,t){this._listeners[e].push(t)},compareBoundaryPoints:function(e,t){I(this),P(this.startContainer,t.startContainer);var r,i,s,o,u=e==J||e==X?"start":"end",a=e==V||e==X?"start":"end";return r=this[u+"Container"],i=this[u+"Offset"],s=t[a+"Container"],o=t[a+"Offset"],n.comparePoints(r,i,s,o)},insertNode:function(e){I(this),_(e,x),H(this.startContainer);if(n.isAncestorOf(e,this.startContainer,!0))throw new i("HIERARCHY_REQUEST_ERR");var t=l(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){I(this);var e,t;if(this.collapsed)return o(this).createDocumentFragment();if(this.startContainer===this.endContainer&&n.isCharacterDataNode(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=o(this).createDocumentFragment(),t.appendChild(e),t;var r=new g(this,!0);return e=c(r),r.detach(),e},canSurroundContents:function(){I(this),H(this.startContainer),H(this.endContainer);var e=new g(this,!0),t=e._first&&s(e._first,this)||e._last&&s(e._last,this);return e.detach(),!t},surroundContents:function(e){_(e,T);if(!this.canSurroundContents())throw new y("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())while(e.lastChild)e.removeChild(e.lastChild);l(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){I(this);var e=new ut(o(this)),t=W.length,n;while(t--)n=W[t],e[n]=this[n];return e},toString:function(){I(this);var e=this.startContainer;if(e===this.endContainer&&n.isCharacterDataNode(e))return e.nodeType==3||e.nodeType==4?e.data.slice(this.startOffset,this.endOffset):"";var t=[],r=new g(this,!0);return h(r,function(e){(e.nodeType==3||e.nodeType==4)&&t.push(e.data)}),r.detach(),t.join("")},compareNode:function(e){I(this);var t=e.parentNode,r=n.getNodeIndex(e);if(!t)throw new i("NOT_FOUND_ERR");var s=this.comparePoint(t,r),o=this.comparePoint(t,r+1);return s<0?o>0?G:K:o>0?Q:Y},comparePoint:function(e,t){return I(this),B(e,"HIERARCHY_REQUEST_ERR"),P(e,this.startContainer),n.comparePoints(e,t,this.startContainer,this.startOffset)<0?-1:n.comparePoints(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:z,toHtml:function(){I(this);var e=o(this).createElement("div");return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){I(this),B(e,"NOT_FOUND_ERR");if(n.getDocument(e)!==o(this))return!1;var r=e.parentNode,i=n.getNodeIndex(e);B(r,"NOT_FOUND_ERR");var s=n.comparePoints(r,i,this.endContainer,this.endOffset),u=n.comparePoints(r,i+1,this.startContainer,this.startOffset);return t?s<=0&&u>=0:s<0&&u>0},isPointInRange:function(e,t){return I(this),B(e,"HIERARCHY_REQUEST_ERR"),P(e,this.startContainer),n.comparePoints(e,t,this.startContainer,this.startOffset)>=0&&n.comparePoints(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e,t){I(this);if(o(e)!=o(this))throw new i("WRONG_DOCUMENT_ERR");var r=
n.comparePoints(this.startContainer,this.startOffset,e.endContainer,e.endOffset),s=n.comparePoints(this.endContainer,this.endOffset,e.startContainer,e.startOffset);return t?r<=0&&s>=0:r<0&&s>0},intersection:function(e){if(this.intersectsRange(e)){var t=n.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),r=n.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset),i=this.cloneRange();return t==-1&&i.setStart(e.startContainer,e.startOffset),r==1&&i.setEnd(e.endContainer,e.endOffset),i}return null},union:function(e){if(this.intersectsRange(e,!0)){var t=this.cloneRange();return n.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1&&t.setStart(e.startContainer,e.startOffset),n.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)==1&&t.setEnd(e.endContainer,e.endOffset),t}throw new y("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==Y},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,n.getNodeLength(e))<=0},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();t.setEnd(r,r.length);var i=this.containsRange(t);return t.detach(),i}return this.containsNodeContents(e)},createNodeIterator:function(e,t){return I(this),new b(this,e,t)},getNodes:function(e,t){return I(this),v(this,e,t)},getDocument:function(){return o(this)},collapseBefore:function(e){M(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){M(this),this.setStartAfter(e),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(e){return ut.rangesEqual(this,e)},inspect:function(){return m(this)}},rt(ut,st,ot),e.rangePrototype=Z.prototype,ut.rangeProperties=W,ut.RangeIterator=g,ut.copyComparisonConstants=tt,ut.createPrototypeRange=rt,ut.inspect=m,ut.getRangeDocument=o,ut.rangesEqual=function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset},e.DomRange=ut,e.RangeException=y}),rangy.createModule("WrappedRange",function(e,t){function o(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var i=n.parentElement();n=e.duplicate(),n.collapse(!1);var s=n.parentElement(),o=i==s?i:r.getCommonAncestor(i,s);return o==t?o:r.getCommonAncestor(t,o)}function u(e){return e.compareEndPoints("StartToEnd",e)==0}function a(e,t,n,s){var o=e.duplicate();o.collapse(n);var u=o.parentElement();r.isAncestorOf(t,u,!0)||(u=t);if(!u.canHaveHTML)return new i(u.parentNode,r.getNodeIndex(u));var a=r.getDocument(u).createElement("span"),f,l=n?"StartToStart":"StartToEnd",c,h,p,d;do u.insertBefore(a,a.previousSibling),o.moveToElementText(a);while((f=o.compareEndPoints(l,e))>0&&a.previousSibling);d=a.nextSibling;if(f==-1&&d&&r.isCharacterDataNode(d)){o.setEndPoint(n?"EndToStart":"EndToEnd",e);var v;if(/[\r\n]/.test(d.data)){var m=o.duplicate(),g=m.text.replace(/\r\n/g,"\r").length;v=m.moveStart("character",g);while((f=m.compareEndPoints("StartToEnd",m))==-1)v++,m.moveStart("character",1)}else v=o.text.length;p=new i(d,v)}else c=(s||!n)&&a.previousSibling,h=(s||n)&&a.nextSibling,h&&r.isCharacterDataNode(h)?p=new i(h,0):c&&r.isCharacterDataNode(c)?p=new i(c,c.length):p=new i(u,r.getNodeIndex(a));return a.parentNode.removeChild(a),p}function f(e,t){var n,i,s=e.offset,o=r.getDocument(e.node),u,a,f=o.body.createTextRange(),l=r.isCharacterDataNode(e.node);return l?(n=e.node,i=n.parentNode):(a=e.node.childNodes,n=s<a.length?a[s]:null,i=e.node),u=o.createElement("span"),u.innerHTML="&#feff;",n?i.insertBefore(u,n):i.appendChild(u),f.moveToElementText(u),f.collapse(!t),i.removeChild(u),l&&f[t?"moveStart":"moveEnd"]("character",s),f}e.requireModules(["DomUtil","DomRange"]);var n,r=e.dom,i=r.DomPosition,s=e.DomRange;if(e.features.implementsDomRange&&(!e.features.implementsTextRange||!e.config.preferTextRange))(function(){function u(e){var t=i.length,n;while(t--)n=i[t],e[n]=e.nativeRange[n]}function a(e,t,n,r,i){var s=e.startContainer!==t||e.startOffset!=n,o=e.endContainer!==r||e.endOffset!=i;if(s||o)e.setEnd(r,i),e.setStart(t,n)}function f(e){e.nativeRange.detach(),e.detached=!0;var t=i.length,n;while(t--)n=i[t],e[n]=null}var t,i=s.rangeProperties,o,l;n=function(e){if(!e)throw new Error("Range must be specified");this.nativeRange=e,u(this)},s.createPrototypeRange(n,a,f),t=n.prototype,t.selectNode=function(e){this.nativeRange.selectNode(e),u(this)},t.deleteContents=function(){this.nativeRange.deleteContents(),u(this)},t.extractContents=function(){var e=this.nativeRange.extractContents();return u(this),e},t.cloneContents=function(){return this.nativeRange.cloneContents()},t.surroundContents=function(e){this.nativeRange.surroundContents(e),u(this)},t.collapse=function(e){this.nativeRange.collapse(e),u(this)},t.cloneRange=function(){return new n(this.nativeRange.cloneRange())},t.refresh=function(){u(this)},t.toString=function(){return this.nativeRange.toString()};var c=document.createTextNode("test");r.getBody(document).appendChild(c);var h=document.createRange();h.setStart(c,0),h.setEnd(c,0);try{h.setStart(c,1),o=!0,t.setStart=function(e,t){this.nativeRange.setStart(e,t),u(this)},t.setEnd=function(e,t){this.nativeRange.setEnd(e,t),u(this)},l=function(e){return function(t){this.nativeRange[e](t),u(this)}}}catch(p){o=!1,t.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}u(this)},t.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}u(this)},l=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(r){this.nativeRange[t](n),this.nativeRange[e](n)}u(this)}}}t.setStartBefore=l("setStartBefore","setEndBefore"),t.setStartAfter=l("setStartAfter","setEndAfter"),t.setEndBefore=l("setEndBefore","setStartBefore"),t.setEndAfter=l("setEndAfter","setStartAfter"),h.selectNodeContents(c),h.startContainer==c&&h.endContainer==c&&h.startOffset==0&&h.endOffset==c.length?t.selectNodeContents=function(e){this.nativeRange.selectNodeContents(e),u(this)}:t.selectNodeContents=function(e){this.setStart(e,0),this.setEnd(e,s.getEndOffset(e))},h.selectNodeContents(c),h.setEnd(c,3);var d=document.createRange();d.selectNodeContents(c),d.setEnd(c,4),d.setStart(c,2),h.compareBoundaryPoints(h.START_TO_END,d)==-1&h.compareBoundaryPoints(h.END_TO_START,d)==1?t.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:t.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)},e.util.isHostMethod(h,"createContextualFragment")&&(t.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),r.getBody(document).removeChild(c),h.detach(),d.detach()})(),e.createNativeRange=function(e){return e=e||document,e.createRange()};else if(e.features.implementsTextRange){n=function(e){this.textRange=e,this.refresh()},n.prototype=new s(document),n.prototype.refresh=function(){var e,t,n=o(this.textRange);u(this.textRange)?t=e=a(this.textRange,n,!0,!0):(e=a(this.textRange,n,!0,!1),t=a(this.textRange,n,!1,!1)),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},s.copyComparisonConstants(n);var l=function(){return this}();typeof l.Range=="undefined"&&(l.Range=n),e.createNativeRange=function(e){return e=e||document,e.body.createTextRange()}}e.features.implementsTextRange&&(n.rangeToTextRange=function(e){if(e.collapsed){var t=f(new i(e.startContainer,e.startOffset),!0);return t}var n=f(new i(e.startContainer,e.startOffset),!0),s=f(new i(e.endContainer,e.endOffset),!1),o=r.getDocument(e.startContainer).body.createTextRange();return o.setEndPoint("StartToStart",n),o.setEndPoint("EndToEnd",s),o}),n.prototype.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createRange=function(t){return t=t||document,new n(e.createNativeRange(t))},e.createRangyRange=function(e){return e=e||document,new s(e)},e.createIframeRange=function(t){return e.createRange(r.getIframeDocument(t))},e.createIframeRangyRange=function(t){return e.createRangyRange(r.getIframeDocument(t))},e.addCreateMissingNativeApiListener(function(t){var n=t.document;typeof n.createRange=="undefined"&&(n.createRange=function(){return e.createRange(this)}),n=t=null})}),rangy.createModule("WrappedSelection",function(e,t){function p(e){return(e||window).getSelection()}function d(e){return(e||window).document.selection}function L(e,t,n){var r=n?"end":"start",i=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function A(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function O(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function M(t){var n;return t instanceof o?(n=t._selectionNativeRange,n||(n=e.createNativeRange(i.getDocument(t.startContainer)),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset),t._selectionNativeRange=n,t.attachListener("detach",function(){this._selectionNativeRange=null}))):t instanceof u?n=t.nativeRange:e.features.implementsDomRange&&t instanceof i.getWindow(t.startContainer).Range&&(n=t),n}function _(e){if(!e.length||e[0].nodeType!=1)return!1;for(var t=1,n=e.length;t<n;++t)if(!i.isAncestorOf(e[0],e[t]))return!1;return!0}function D(e){var t=e.getNodes();if(!_(t))throw new Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function P(e){return!!e&&typeof e.text!="undefined"}function H(e,t){var n=new u(t);e._ranges=[n],L(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function B(t){t._ranges.length=0;if(t.docSelection.type=="None")O(t);else{var n=t.docSelection.createRange();if(P(n))H(t,n);else{t.rangeCount=n.length;var r,s=i.getDocument(n.item(0));for(var o=0;o<t.rangeCount;++o)r=e.createRange(s),r.selectNode(n.item(o)),t._ranges.push(r);t.isCollapsed=t.rangeCount==1&&t._ranges[0].collapsed,L(t,t._ranges[t.rangeCount-1],!1)}}}function j(e,t){var n=e.docSelection.createRange(),r=D(t),s=i.getDocument(n.item(0)),o=i.getBody(s).createControlRange();for(var u=0,a=n.length;u<a;++u)o.add(n.item(u));try{o.add(r)}catch(f){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}o.select(),B(e)}function I(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function R(e,t){var n=i.getDocument(t[0].startContainer),r=i.getBody(n).createControlRange();for(var s=0,o;s<rangeCount;++s){o=D(t[s]);try{r.add(o)}catch(u){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}r.select(),B(e)}function V(e,t){if(e.anchorNode&&i.getDocument(e.anchorNode)!==i.getDocument(t))throw new a("WRONG_DOCUMENT_ERR")}function $(e){var t=[],n=new f(e.anchorNode,e.anchorOffset),r=new f(e.focusNode,e.focusOffset),i=typeof e.getName=="function"?e.getName():"Selection";if(typeof e.rangeCount!="undefined")for(var s=0,u=e.rangeCount;s<u;++s)t[s]=o.inspect(e.getRangeAt(s));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.requireModules(["DomUtil","DomRange","WrappedRange"]),e.config.checkSelectionRanges=!0;var n="boolean",r="_rangySelection",i=e.dom,s=e.util,o=e.DomRange,u=e.WrappedRange,a=e.DOMException,f=i.DomPosition,l,c,h="Control",v=e.util.isHostMethod(window,"getSelection"),m=e.util.isHostObject(document,"selection"),g=m&&(!v||e.config.preferTextRange);g?(l=d,e.isSelectionValid=function(e){var t=(e||window).document,n=t.selection;return n.type!="None"||i.getDocument(n.createRange().parentElement())==t}):v?(l=p,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=l;var y=l(),b=e.createNativeRange(document),w=i.getBody(document),E=s.areHostObjects(y,["anchorNode","focusNode"]&&s.areHostProperties(y,["anchorOffset","focusOffset"]));e.features.selectionHasAnchorAndFocus=E;var S=s.isHostMethod(y,"extend");e.features.selectionHasExtend=S;var x=typeof y.rangeCount=="number";e.features.selectionHasRangeCount=x;var T=!1,N=!0;s.areHostMethods(y,["addRange","getRangeAt","removeAllRanges"])&&typeof y.rangeCount=="number"&&e.features.implementsDomRange&&function(){var e=document.createElement("iframe");w.appendChild(e);var t=i.getIframeDocument(e);t.open(),t.write("<html><head></head><body>12</body></html>"),t.close();var n=i.getIframeWindow(e).getSelection(),r=t.documentElement,s=r.lastChild,o=s.firstChild,u=t.createRange();u.setStart(o,1),u.collapse(!0),n.addRange(u),N=n.rangeCount==1,n.removeAllRanges();var a=u.cloneRange();u.setStart(o,0),a.setEnd(o,2),n.addRange(u),n.addRange(a),T=n.rangeCount==2,u.detach(),a.detach(),w.removeChild(e)}(),e.features.selectionSupportsMultipleRanges=T,e.features.collapsedNonEditableSelectionsSupported=N;var C=!1,k;w&&s.isHostMethod(w,"createControlRange")&&(k=w.createControlRange(),s.areHostProperties(k,["item","add"])&&(C=!0)),e.features.implementsControlRange=C,E?c=function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:c=function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var F;s.isHostMethod(y,"getRangeAt")?F=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:E&&(F=function(t){var n=i.getDocument(t.anchorNode),r=e.createRange(n);return r.setStart(t.anchorNode,t.anchorOffset),r.setEnd(t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&(r.setStart(t.focusNode,t.focusOffset),r.setEnd(t.anchorNode,t.anchorOffset)),r}),e.getSelection=function(e){e=e||window;var t=e[r],n=l(e),i=m?d(e):null;return t?(t.nativeSelection=n,t.docSelection=i,t.refresh(e)):(t=new I(n,i,e),e[r]=t),t},e.getIframeSelection=function(t){return e.getSelection(i.getIframeWindow(t))};var q=I.prototype;if(!g&&E&&s.areHostMethods(y,["removeAllRanges","addRange"])){q.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),O(this)};var U=function(t,n){var r=o.getRangeDocument(n),i=e.createRange(r);i.collapseToPoint(n.endContainer,n.endOffset),t.nativeSelection.addRange(M(i)),t.nativeSelection.extend(n.startContainer,n.startOffset),t.refresh()};x?q.addRange=function(t,n){if(C&&m&&this.docSelection.type==h)j(this,t);else if(n&&S)U(this,t);else{var r;T?r=this.rangeCount:(this.removeAllRanges(),r=0),this.nativeSelection.addRange(M(t)),this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==r+1){if(e.config.checkSelectionRanges){var i=F(this.nativeSelection,this.rangeCount-1);i&&!o.rangesEqual(i,t)&&(t=new u(i))}this._ranges[this.rangeCount-1]=t,L(this,t,X(this.nativeSelection)),this.isCollapsed=c(this)}else this.refresh()}}:q.addRange=function(e,t){t&&S?U(this,e):(this.nativeSelection.addRange(M(e)),this.refresh())},q.setRanges=function(e){if(C&&e.length>1)R(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(s.isHostMethod(y,"empty")&&s.isHostMethod(b,"select")&&C&&g))return t.fail("No means of selecting a Range or TextRange was found"),!1;q.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var e;if(this.anchorNode)e=i.getDocument(this.anchorNode);else if(this.docSelection.type==h){var t=this.docSelection.createRange();t.length&&(e=i.getDocument(t.item(0)).body.createTextRange())}if(e){var n=e.body.createTextRange();n.select(),this.docSelection.empty()}}}catch(r){}O(this)},q.addRange=function(e){this.docSelection.type==h?j(this,e):(u.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,L(this,e,!1))},q.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?R(this,e):t&&this.addRange(e[0])}}q.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new a("INDEX_SIZE_ERR");return this._ranges[e]};var z;if(g)z=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=i.getBody(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==h?B(t):P(n)?H(t,n):O(t)};else if(s.isHostMethod(y,"getRangeAt")&&typeof y.rangeCount=="number")z=function(t){if(C&&m&&t.docSelection.type==h)B(t);else{t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount;if(t.rangeCount){for(var n=0,r=t.rangeCount;n<r;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));L(t,t._ranges[t.rangeCount-1],X(t.nativeSelection)),t.isCollapsed=c(t)}else O(t)}};else{if(!E||typeof y.isCollapsed!=n||typeof b.collapsed!=n||!e.features.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;z=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=F(n,0),e._ranges=[t],e.rangeCount=1,A(e),e.isCollapsed=c(e)):O(e)}}q.refresh=function(e){var t=e?this._ranges.slice(0):null;z(this);if(e){var n=t.length;if(n!=this._ranges.length)return!1;while(n--)if(!o.rangesEqual(t[n],this._ranges[n]))return!1;return!0}};var W=function(e,t){var n=e.getAllRanges(),r=!1;e.removeAllRanges();for(var i=0,s=n.length;i<s;++i)r||t!==n[i]?e.addRange(n[i]):r=!0;e.rangeCount||O(e)};C?q.removeRange=function(e){if(this.docSelection.type==h){var t=this.docSelection.createRange(),n=D(e),r=i.getDocument(t.item(0)),s=i.getBody(r).createControlRange(),o,u=!1;for(var a=0,f=t.length;a<f;++a)o=t.item(a),o!==n||u?s.add(t.item(a)):u=!0;s.select(),B(this)}else W(this,e)}:q.removeRange=function(e){W(this,e)};var X;!g&&E&&e.features.implementsDomRange?(X=function(e){var t=!1;return e.anchorNode&&(t=i.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)==1),t},q.isBackwards=function(){return X(this)}):X=q.isBackwards=function(){return!1},q.toString=function(){var e=[];for(var t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},q.collapse=function(t,n){V(this,t);var r=e.createRange(i.getDocument(t));r.collapseToPoint(t,n),this.removeAllRanges(),this.addRange(r),this.isCollapsed=!0},q.collapseToStart=function(){if(!this.rangeCount)throw new a("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},q.collapseToEnd=function(){if(!this.rangeCount)throw new a("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},q.selectAllChildren=function(t){V(this,t);var n=e.createRange(i.getDocument(t));n.selectNodeContents(t),this.removeAllRanges(),this.addRange(n)},q.deleteFromDocument=function(){if(C&&m&&this.docSelection.type==h){var e=this.docSelection.createRange(),t;while(e.length)t=e.item(0),e.remove(t),t.parentNode.removeChild(t);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();this.removeAllRanges();for(var r=0,i=n.length;r<i;++r)n[r].deleteContents();this.addRange(n[i-1])}},q.getAllRanges=function(){return this._ranges.slice(0)},q.setSingleRange=function(e){this.setRanges([e])},q.containsNode=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n)if(this._ranges[n].containsNode(e,t))return!0;return!1},q.toHtml=function(){var e="";if(this.rangeCount){var t=o.getRangeDocument(this._ranges[0]).createElement("div");for(var n=0,r=this._ranges.length;n<r;++n)t.appendChild(this._ranges[n].cloneContents());e=t.innerHTML}return e},q.getName=function(){return"WrappedSelection"},q.inspect=function(){return $(this)},q.detach=function(){this.win[r]=null,this.win=this.anchorNode=this.focusNode=null},I.inspect=$,e.Selection=I,e.selectionPrototype=q,e.addCreateMissingNativeApiListener(function(t){typeof t.getSelection=="undefined"&&(t.getSelection=function(){return e.getSelection(this)}),t=null})}),define("util/class",[],function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;return this.Class=function(){},Class.extend=function(){function u(){!e&&this._constructor&&this._constructor.apply(this,arguments)}var n=this.prototype;e=!0;var r=new this;e=!1;for(var i=0;i<arguments.length;i++){var s=arguments[i];for(var o in s)r[o]=typeof s[o]=="function"&&typeof n[o]=="function"&&t.test(s[o])?function(e,t){return function(){var r=this._super;this._super=n[e];var i=t.apply(this,arguments);return this._super=r,i}}(o,s[o]):s[o]}return u.prototype=r,u.constructor=u,u.extend=arguments.callee,u},this.Class}),GENTICS=window.GENTICS||{},GENTICS.Utils=GENTICS.Utils||{},define("util/lang",[],function(){}),function(e,t){var n=e.alohaQuery||e.jQuery,r=n,i=e.GENTICS,s=e.Class,o=e.console;i.Utils.applyProperties=function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},i.Utils.uniqeString4=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},i.Utils.guid=function(){var e=i.Utils.uniqeString4;return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}(window),define("aloha/ecma5shims",[],function(){var e={bind:function(e){var t=this.obj||this,n=Function.prototype.bind,r=Array.prototype.slice.call(arguments,1);return n?n.apply(t,arguments):function(){return t.apply(e,arguments.length===0?r:r.concat(Array.prototype.slice.call(arguments)))}},trim:function(){var e=this.obj||this,t=String.prototype.trim;return t?t.call(e):e.replace(/^\s+/,"").replace(/\s+$/,"")},indexOf:function(e,t){var n=this.obj||this,r=Array.prototype.indexOf;if(r)return r.call(n,e,t);t===undefined&&(t=0),t<0&&(t+=n.length),t<0&&(t=0);for(var i=n.length;t<i;t++)if(t in n&&n[t]===e)return t;return-1},forEach:function(e,t){var n=this.obj||this,r=Array.prototype.forEach;if(r)return r.call(n,e,t);for(var i=0,s=n.length;i<s;i++)i in n&&e.call(t,n[i],i,n)},map:function(e,n,r){var i=this.obj||this,s=Array.prototype.map,o=typeof arguments[arguments.length-1]=="boolean"?Array.prototype.pop.call(arguments):!1,u=[];if(s)u=s.call(i,e,n);else{var a=new Array(i.length);for(var f=0,l=i.length;f<l;f++)f in i&&(a[f]=e.call(n,i[f],f,i));u=a}return o?t(u):u},filter:function(e,n,r){var i=this.obj||this,s=Array.prototype.filter,o=typeof arguments[arguments.length-1]=="boolean"?Array.prototype.pop.call(arguments):!1,u=[];if(s)u=s.call(i,e,n);else{var a=[],f;for(var l=0,c=i.length;l<c;l++)l in i&&e.call(n,f=i[l],l,i)&&a.push(f);u=a}return o?t(u):u},every:function(e,t){var n=this.obj||this,r=Array.prototype.every;if(r)return r.call(n,e,t);for(var i=0,s=n.length;i<s;i++)if(i in n&&!e.call(t,n[i],i,n))return!1;return!0},some:function(e,t){var n=this.obj||this,r=Array.prototype.some;if(r)return r.call(n,e,t);for(var i=0,s=n.length;i<s;i++)if(i in n&&e.call(t,n[i],i,n))return!0;return!1},hasAttribute:function(e){var t=this.obj||this,n=t.hasAttribute;return n?t.hasAttribute(e):typeof t.attributes[e]!="undefined"}},t=function(t){var n=function(){};n.prototype=e;var r=new n;return r.obj=t,r};for(var n in e)t[n]=e[n];return typeof Node!="undefined"?t.Node=Node:t.Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,DOCUMENT_POSITION_DISCONNECTED:1,DOCUMENT_POSITION_PRECEDING:2,DOCUMENT_POSITION_FOLLOWING:4,DOCUMENT_POSITION_CONTAINS:8,DOCUMENT_POSITION_CONTAINED_BY:16,DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC:32},t.compareDocumentPosition=function(e,t){function s(e){var t=null;if(e)do t=e;while(e=e.parentNode);return t}function o(e,t){return(e.contains(t)&&16)+(t.contains(e)&&8)+(e.sourceIndex>=0&&t.sourceIndex>=0?(e.sourceIndex<t.sourceIndex&&4)+(e.sourceIndex>t.sourceIndex&&2):1)}function u(e){return"sourceIndex"in e?e:e.parentNode.insertBefore(document.createComment(""),e)}if("compareDocumentPosition"in document.documentElement)return e.compareDocumentPosition(t);if("contains"in document.documentElement){if(e==t)return 0;if(s(e)!=s(t))return 1;if("sourceIndex"in e&&"sourceIndex"in t)return o(e,t);if(e==document)return 20;if(t==document)return 10;var n=u(e),r=u(t),i=o(n,r);return e!=n&&n.parentNode.removeChild(n),t!=r&&r.parentNode.removeChild(r),i}throw"compareDocumentPosition nor contains is not supported by this browser."},t.getComputedStyle=function(e,t){return"getComputedStyle"in window?window.getComputedStyle(e,t):e.currentStyle?e.currentStyle:null},t}),GENTICS=window.GENTICS||{},GENTICS.Utils=GENTICS.Utils||{},define("util/dom",["aloha/jquery","util/class","aloha/ecma5shims"],function(e,t,n){var r=window.GENTICS,i={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,DOCUMENT_POSITION_DISCONNECTED:1,DOCUMENT_POSITION_PRECEDING:2,DOCUMENT_POSITION_FOLLOWING:4,DOCUMENT_POSITION_CONTAINS:8,DOCUMENT_POSITION_CONTAINED_BY:16,DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC:32},s=t.extend({wordRegex:/[\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0525\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0621-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971\u0972\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3D\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC\u0EDD\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8B\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10D0-\u10FA\u10FC\u1100-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u2094\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2D00-\u2D25\u2D30-\u2D65\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31B7\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCB\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA65F\uA662-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B\uA78C\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA2D\uFA30-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,nonWordRegex:/[^\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0525\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0621-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971\u0972\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3D\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC\u0EDD\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8B\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10D0-\u10FA\u10FC\u1100-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u2094\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2D00-\u2D25\u2D30-\u2D65\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31B7\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCB\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA65F\uA662-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B\uA78C\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA2D\uFA30-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/
,mergeableTags:["b","code","del","em","i","ins","strong","sub","sup","#text"],nonWordBoundaryTags:["a","b","code","del","em","i","ins","span","strong","sub","sup","#text"],nonEmptyTags:["br"],tags:{flow:["a","abbr","address","area","article","aside","audio","b","bdi","bdo","blockquote","br","button","canvas","cite","code","command","datalist","del","details","dfn","div","dl","em","embed","fieldset","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","i","iframe","img","input","ins","kbd","keygen","label","map","mark","math","menu","meter","nav","noscript","object","ol","output","p","pre","progress","q","ruby","s","samp","script","section","select","small","span","strong","style","sub","sup","svg","table","textarea","time","u","ul","var","video","wbr","#text"],phrasing:["a","abbr","area","audio","b","bdi","bdo","br","button","canvas","cite","code","command","datalist","del","dfn","em","embed","i","iframe","img","input","ins","kbd","keygen","label","map","mark","math","meter","noscript","object","output","progress","q","ruby","samp","script","select","small","span","strong","sub","sup","svg","textarea","time","u","var","video","wbr","#text"]},children:{a:"phrasing",abbr:"phrasing",address:"flow",area:"empty",article:"flow",aside:"flow",audio:"source",b:"phrasing",base:"empty",bdo:"phrasing",blockquote:"phrasing",body:"flow",br:"empty",button:"phrasing",canvas:"phrasing",caption:"flow",cite:"phrasing",code:"phrasing",col:"empty",colgroup:"col",command:"empty",datalist:["phrasing","option"],dd:"flow",del:"phrasing",div:"flow",details:["summary","flow"],dfn:"flow",dl:["dt","dd"],dt:"phrasing",em:"phrasing",embed:"empty",fieldset:["legend","flow"],figcaption:"flow",figure:["figcaption","flow"],footer:"flow",form:"flow",h1:"phrasing",h2:"phrasing",h3:"phrasing",h4:"phrasing",h5:"phrasing",h6:"phrasing",header:"flow",hgroup:["h1","h2","h3","h4","h5","h6"],hr:"empty",i:"phrasing",iframe:"#text",img:"empty",input:"empty",ins:"phrasing",kbd:"phrasing",keygen:"empty",label:"phrasing",legend:"phrasing",li:"flow",link:"empty",map:"area",mark:"phrasing",menu:["li","flow"],meta:"empty",meter:"phrasing",nav:"flow",noscript:"phrasing",object:"param",ol:"li",optgroup:"option",option:"#text",output:"phrasing",p:"phrasing",param:"empty",pre:"phrasing",progress:"phrasing",q:"phrasing",rp:"phrasing",rt:"phrasing",ruby:["phrasing","rt","rp"],s:"phrasing",samp:"pharsing",script:"#script",section:"flow",select:["option","optgroup"],small:"phrasing",source:"empty",span:"phrasing",strong:"phrasing",style:"phrasing",sub:"phrasing",summary:"phrasing",sup:"phrasing",table:["caption","colgroup","thead","tbody","tfoot","tr"],tbody:"tr",td:"flow",textarea:"#text",tfoot:"tr",th:"phrasing",thead:"tr",time:"phrasing",title:"#text",tr:["th","td"],track:"empty",u:"phrasing",ul:"li","var":"phrasing",video:"source",wbr:"empty"},blockLevelElements:["p","h1","h2","h3","h4","h5","h6","blockquote","div","pre"],listElements:["li","ol","ul"],split:function(t,n,r){var i=e(t.startContainer),s=t.startOffset,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;r&&(i=e(t.endContainer),s=t.endOffset),n.length<1&&(n=e(document.body)),o=!t.isCollapsed()&&!r,a=i.parents().get(),a.unshift(i.get(0)),e.each(a,function(e,t){var r=n.filter(function(){return this==t}).length;if(r)return e>0&&(u=a.slice(0,e)),!1});if(!u)return!0;u=u.reverse();for(h=0,p=u.length;h<p;++h){d=u[h];if(h===p-1)d.nodeType===3?(c=document.createTextNode(d.data.substring(s,d.data.length)),d.data=d.data.substring(0,s)):(v=e(d),m=v.contents(),g=v.clone(!1).empty(),c=g.append(m.slice(s,m.length)).get(0)),o&&t.endContainer===d&&(t.endContainer=c,t.endOffset-=s,t.clearCaches()),l?l.prepend(c):e(d).after(c);else{g=e(d).clone(!1).empty(),f?l.prepend(g):f=g,l=g;for(;;){y=u[h+1].nextSibling;if(!y)break;l.append(y)}if(o&&t.endContainer===d){t.endContainer=g.get(0),b=u[h+1],w=0;for(;;){b=b.previousSibling;if(!b)break;w++}t.endOffset-=w,t.clearCaches()}}}return e(u[0]).after(f),e([u[0],f?f.get(0):c])},allowsNesting:function(t,n){if(!t||!t.nodeName||!n||!n.nodeName)return!1;var r=t.nodeName.toLowerCase(),i=n.nodeName.toLowerCase();return this.children[r]?this.children[r]==i?!0:e.isArray(this.children[r])&&e.inArray(i,this.children[r])>=0?!0:e.isArray(this.tags[this.children[r]])&&e.inArray(i,this.tags[this.children[r]])>=0?!0:!1:!1},addMarkup:function(t,n,r){t.startContainer.nodeType===3&&t.startOffset>0&&t.startOffset<t.startContainer.data.length&&this.split(t,e(t.startContainer).parent(),!1),t.endContainer.nodeType===3&&t.endOffset>0&&t.endOffset<t.endContainer.data.length&&this.split(t,e(t.endContainer).parent(),!0);var i=t.getRangeTree();this.recursiveAddMarkup(i,n,t,r),this.doCleanup({merge:!0,removeempty:!0},t)},recursiveAddMarkup:function(t,n,i,s){var o,u,a;for(o=0,a=t.length;o<a;++o)t[o].type=="full"&&this.allowsNesting(n.get(0),t[o].domobj)?(s||t[o].domobj.nodeName!=n.get(0).nodeName)&&(t[o].domobj.nodeType!==3||e.trim(t[o].domobj.data).length!==0)&&(e(t[o].domobj).wrap(n),!s&&t[o].domobj.nodeType!==3&&(u=new r.Utils.RangeObject,u.startContainer=u.endContainer=t[o].domobj.parentNode,u.startOffset=0,u.endOffset=u.endContainer.childNodes.length,this.removeMarkup(u,n,e(t[o].domobj.parentNode)))):(s||t[o].domobj&&t[o].domobj.nodeName!==n.get(0).nodeName)&&t[o].children&&t[o].children.length>0&&this.recursiveAddMarkup(t[o].children,n)},findHighestElement:function(e,t,n){t=t.toLowerCase();var r,i=e,s=n?function(){return n.filter(function(){return i==this}).length}:function(){return!1};while(!s()&&i)i.nodeName.toLowerCase()===t&&(r=i),i=i.parentNode;return r},removeMarkup:function(t,n,r){var i=n.get(0).nodeName,s=this.findHighestElement(t.startContainer,i,r),o=this.findHighestElement(t.endContainer,i,r),u=!1,a,f,l;s&&t.startOffset>0&&(this.split(t,e(s).parent(),!1),u=!0),o&&(t.endContainer.nodeType===3&&t.endOffset<t.endContainer.data.length&&(this.split(t,e(o).parent(),!0),u=!0),t.endContainer.nodeType===1&&t.endOffset<t.childNodes.length&&(this.split(t,e(o).parent(),!0),u=!0)),u&&t.correctRange(),a=this.findHighestElement(t.getCommonAncestorContainer(),i,r),f=a?a.parentNode:t.getCommonAncestorContainer(),f&&(l=t.getRangeTree(f),this.recursiveRemoveMarkup(l,n),this.doCleanup({merge:!0,removeempty:!0},t,f))},recursiveRemoveMarkup:function(t,n){var r,i,s;for(r=0,i=t.length;r<i;++r)t[r].type=="full"&&t[r].domobj.nodeName==n.get(0).nodeName&&(s=e(t[r].domobj).contents(),s.length>0?s.first().unwrap():e(t[r].domobj).remove()),t[r].children&&this.recursiveRemoveMarkup(t[r].children,n)},doCleanup:function(t,n,i){var s=this,o,u,a,f,l;return typeof t=="undefined"&&(t={}),typeof t.merge=="undefined"&&(t.merge=!1),typeof t.removeempty=="undefined"&&(t.removeempty=!1),typeof i=="undefined"&&n&&(i=n.getCommonAncestorContainer()),o=!1,u=!1,a=e(i),f=n.startOffset,l=n.endOffset,a.contents().each(function(i){var c;try{c=this.nodeType}catch(h){return}switch(c){case 1:if(o&&o.nodeName==this.nodeName)n.startContainer===a&&f>i&&(n.startOffset-=1,u=!0),n.endContainer===a&&l>i&&(n.endOffset-=1,u=!0),e(o).append(e(this).contents()),u|=s.doCleanup(t,n,o),e(this).remove();else{u|=s.doCleanup(t,n,this);var p=!1;t.removeempty&&(r.Utils.Dom.isBlockLevelElement(this)&&this.childNodes.length===0&&(p=!0),e.inArray(this.nodeName.toLowerCase(),s.mergeableTags)>=0&&e(this).text().length===0&&this.childNodes.length===0&&(p=!0)),p?(n.startContainer===this.parentNode&&f>i&&(n.startOffset=n.startOffset-1,u=!0),n.endContainer===this.parentNode&&l>i&&(n.endOffset=n.endOffset-1,u=!0),e(this).remove()):e.inArray(this.nodeName.toLowerCase(),s.mergeableTags)>=0?o=this:o=!1}break;case 3:if(o&&o.nodeType===3&&t.merge)n.startContainer===this?(n.startContainer=o,n.startOffset+=o.nodeValue.length,u=!0):n.startContainer===o.parentNode&&n.startOffset===s.getIndexInParent(o)+1&&(n.startContainer=o,n.startOffset=o.nodeValue.length,u=!0),n.endContainer===this?(n.endContainer=o,n.endOffset+=o.nodeValue.length,u=!0):n.endContainer===o.parentNode&&n.endOffset===s.getIndexInParent(o)+1&&(n.endContainer=o,n.endOffset=o.nodeValue.length,u=!0),o.data+=this.data;else if(this.nodeValue!==""||!t.removeempty)if(this.nodeValue!==""||!t.removeempty){o=this;break}n.startContainer===this.parentNode&&n.startOffset>i&&(n.startOffset=n.startOffset-1,u=!0),n.endContainer===this.parentNode&&n.endOffset>i&&(n.endOffset=n.endOffset-1,u=!0),e(this).remove()}}),u&&n.clearCaches(),u},getIndexInParent:function(e){if(!e)return!1;var t=0,n=e.previousSibling;while(n)t++,n=n.previousSibling;return t},isBlockLevelElement:function(t){return t?t.nodeType===1&&e.inArray(t.nodeName.toLowerCase(),this.blockLevelElements)>=0?!0:!1:!1},isLineBreakElement:function(e){return e?e.nodeType===1&&e.nodeName.toLowerCase()=="br":!1},isListElement:function(t){return t?t.nodeType===1&&e.inArray(t.nodeName.toLowerCase(),this.listElements)>=0:!1},isSplitObject:function(e){if(e.nodeType===1)switch(e.nodeName.toLowerCase()){case"p":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"li":return!0}return!1},searchAdjacentTextNode:function(t,n,r,i){if(!t||t.nodeType!==1||n<0||n>t.childNodes.length)return!1;typeof i=="undefined"&&(i={blocklevel:!0,list:!0,linebreak:!0}),typeof i.blocklevel=="undefined"&&(i.blocklevel=!0),typeof i.list=="undefined"&&(i.list=!0),typeof i.linebreak=="undefined"&&(i.linebreak=!0),typeof r=="undefined"&&(r=!0);var s,o=t;r&&n>0&&(s=t.childNodes[n-1]),!r&&n<t.childNodes.length&&(s=t.childNodes[n]);while(o)if(!s){if(i.blocklevel&&this.isBlockLevelElement(o))return!1;if(i.list&&this.isListElement(o))return!1;s=r?o.previousSibling:o.nextSibling,o=o.parentNode}else{if(s.nodeType===3&&e.trim(s.data).length>0)return s;if(i.blocklevel&&this.isBlockLevelElement(s))return!1;if(i.linebreak&&this.isLineBreakElement(s))return!1;if(i.list&&this.isListElement(s))return!1;s.nodeType===3?s=r?s.previousSibling:s.nextSibling:(o=s,s=r?s.lastChild:s.firstChild)}},insertIntoDOM:function(t,n,r,i,s){var o=n.getContainerParents(r,i),u=this,a,f,l,c,h;return r||(r=e(document.body)),o.length===0?a=r.get(0):e.each(o,function(e,n){if(u.allowsNesting(n,t.get(0)))return a=n,!1}),typeof a=="undefined"&&r.length>0&&(a=r.get(0)),!this.allowsNesting(a,t.get(0))&&!s?!1:typeof a!="undefined"?(c=this.split(n,e(a),i),c===!0?(f=n.startContainer,l=n.startOffset,i&&(f=n.endContainer,l=n.endOffset),l===0?(h=e(f).contents(),h.length>0?h.eq(0).before(t):e(f).append(t),!0):(e(f).contents().eq(l-1).after(t),!0)):c?(c.eq(0).after(t),!0):!1):!1},removeFromDOM:function(t,n,r){if(r){var i=this.getIndexInParent(t),s=e(t).contents().length,o=t.parentNode;n.startContainer==o&&n.startOffset>i?n.startOffset+=s-1:n.startContainer==t&&(n.startContainer=o,n.startOffset=i+n.startOffset),n.endContainer==o&&n.endOffset>i?n.endOffset+=s-1:n.endContainer==t&&(n.endContainer=o,n.endOffset=i+n.endOffset),e(t).contents().unwrap(),this.doCleanup({merge:!0},n,o)}},removeRange:function(t){if(!t)return!1;if(t.isCollapsed())return!1;t.startContainer.nodeType==3&&t.startOffset>0&&t.startOffset<t.startContainer.data.length&&this.split(t,e(t.startContainer).parent(),!1),t.endContainer.nodeType==3&&t.endOffset>0&&t.endOffset<t.endContainer.data.length&&this.split(t,e(t.endContainer).parent(),!0);var n=t.getRangeTree();t.endContainer=t.startContainer,t.endOffset=t.startOffset,this.recursiveRemoveRange(n,t),this.doCleanup({merge:!0},t),t.clearCaches()},recursiveRemoveRange:function(t,n){for(var r=0;r<t.length;++r)t[r].type=="full"?(e(n.startContainer).parents().andSelf().filter(t[r].domobj).length>0&&(n.startContainer=n.endContainer=t[r].domobj.parentNode,n.startOffset=n.endOffset=this.getIndexInParent(t[r].domobj)),e(t[r].domobj).remove()):t[r].type=="partial"&&t[r].children&&this.recursiveRemoveRange(t[r].children,n)},extendToWord:function(e,t){var n=this.searchWordBoundary(e.startContainer,e.startOffset,!0),r=this.searchWordBoundary(e.endContainer,e.endOffset,!1);if(!t){if(e.startContainer==n.container&&e.startOffset==n.offset)return;if(e.endContainer==r.container&&e.endOffset==r.offset)return}e.startContainer=n.container,e.startOffset=n.offset,e.endContainer=r.container,e.endOffset=r.offset,e.correctRange(),e.clearCaches()},isWordBoundaryElement:function(t){return!t||!t.nodeName?!1:e.inArray(t.nodeName.toLowerCase(),this.nonWordBoundaryTags)==-1},searchWordBoundary:function(e,t,n){typeof n=="undefined"&&(n=!0);var r=!1,i,s,o;while(!r)if(e.nodeType===3)if(!n)i=e.data.substring(t).search(this.nonWordRegex),i!=-1?(t+=i,r=!0):(t=this.getIndexInParent(e)+1,e=e.parentNode);else{i=e.data.substring(0,t).search(this.nonWordRegex),s=i;while(s!=-1)i=s,s=e.data.substring(i+1,t).search(this.nonWordRegex),s!=-1&&(s=s+i+1);i!=-1?(t=i+1,r=!0):(t=this.getIndexInParent(e),e=e.parentNode)}else e.nodeType===1&&(n?t>0?this.isWordBoundaryElement(e.childNodes[t-1])?r=!0:(e=e.childNodes[t-1],t=e.nodeType===3?e.data.length:e.childNodes.length):this.isWordBoundaryElement(e)?r=!0:(t=this.getIndexInParent(e),e=e.parentNode):t<e.childNodes.length?this.isWordBoundaryElement(e.childNodes[t])?r=!0:(e=e.childNodes[t],t=0):this.isWordBoundaryElement(e)?r=!0:(t=this.getIndexInParent(e)+1,e=e.parentNode));return e.nodeType!==3&&(o=this.searchAdjacentTextNode(e,t,!n),o&&(e=o,t=n?0:e.data.length)),{container:e,offset:t}},isEmpty:function(t){if(!t)return!0;if(e.inArray(t.nodeName.toLowerCase(),this.nonEmptyTags)!=-1)return!1;if(t.nodeType===3)return t.data.search(/\S/)==-1;for(var n=0,r=t.childNodes.length;n<r;++n)if(!this.isEmpty(t.childNodes[n]))return!1;return!0},setCursorAfter:function(e){var t=new r.Utils.RangeObject,n=this.getIndexInParent(e),i,s;return e.nodeType==3?(i=e,s=i.nodeValue.length):e.nextSibling&&e.nextSibling.nodeType==3?(i=e.nextSibling,s=0):(i=e.parentNode,s=this.getIndexInParent(e)+1),t.startContainer=t.endContainer=i,t.startOffset=t.endOffset=s,t.select(),t},selectDomNode:function(e){var t=new r.Utils.RangeObject;t.startContainer=t.endContainer=e.parentNode,t.startOffset=this.getIndexInParent(e),t.endOffset=t.startOffset+1,t.select()},setCursorInto:function(e){var t=new r.Utils.RangeObject;t.startContainer=t.endContainer=e,t.startOffset=t.endOffset=0,t.select()},isEditingHost:function(e){return e&&e.nodeType==1&&(e.contentEditable=="true"||e.parentNode&&e.parentNode.nodeType==9&&e.parentNode.designMode=="on")},isEditable:function(e){return e&&!this.isEditingHost(e)&&(e.nodeType!=1||e.contentEditable!="false")&&(this.isEditingHost(e.parentNode)||this.isEditable(e.parentNode))},getEditingHostOf:function(e){if(this.isEditingHost(e))return e;if(this.isEditable(e)){var t=e.parentNode;while(!this.isEditingHost(t))t=t.parentNode;return t}return null},inSameEditingHost:function(e,t){return this.getEditingHostOf(e)&&this.getEditingHostOf(e)==this.getEditingHostOf(t)},isBlockNode:function(e){return e&&(e.nodeType==n.Node.ELEMENT_NODE&&n(["inline","inline-block","inline-table","none"]).indexOf(n.getComputedStyle(e).display)==-1||e.nodeType==n.Node.DOCUMENT_NODE||e.nodeType==n.Node.DOCUMENT_FRAGMENT_NODE)},getFirstVisibleChild:function(t,r){if(!t)return null;if(t.nodeType==n.Node.TEXT_NODE&&this.isEmpty(t)||t.nodeType==n.Node.ELEMENT_NODE&&t.offsetHeight==0&&e.inArray(t.nodeName.toLowerCase(),this.nonEmptyTags)===-1)return null;if(t.nodeType==n.Node.TEXT_NODE||t.nodeType==n.Node.ELEMENT_NODE&&t.childNodes.length==0||!e(t).contentEditable())return r?t:null;for(var i=0;i<t.childNodes.length;++i){var s=this.getFirstVisibleChild(t.childNodes[i],!0);if(s!=null)return s}return null},getLastVisibleChild:function(t,r){if(!t)return null;if(t.nodeType==n.Node.TEXT_NODE&&this.isEmpty(t)||t.nodeType==n.Node.ELEMENT_NODE&&t.offsetHeight==0&&e.inArray(t.nodeName.toLowerCase(),this.nonEmptyTags)===-1)return null;if(t.nodeType==n.Node.TEXT_NODE||t.nodeType==n.Node.ELEMENT_NODE&&t.childNodes.length==0||!e(t).contentEditable())return r?t:null;for(var i=t.childNodes.length-1;i>=0;--i){var s=this.getLastVisibleChild(t.childNodes[i],!0);if(s!=null)return s}return null}});return r.Utils.Dom=new s,r.Utils.Dom}),define("aloha/pluginmanager",["aloha/jquery","util/class"],function(e,t){return new(t.extend({plugins:{},init:function(e,t){var n=this,r=Aloha&&Aloha.settings?Aloha.settings.plugins||{}:{},i,s,o;for(o in r)r.hasOwnProperty(o)&&(s=this.plugins[o]||!1,s&&(s.settings=r[o]||{}));if(!t.length)for(o in this.plugins)this.plugins.hasOwnProperty(o)&&t.push(o);for(i=0;i<t.length;++i)o=t[i],s=this.plugins[o]||!1,s&&(s.settings=s.settings||{},typeof s.settings.enabled=="undefined"&&(s.settings.enabled=!0),s.settings.enabled&&s.checkDependencies()&&s.init());e()},register:function(e){if(!e.name)throw new Error("Plugin does not have an name.");if(this.plugins[e.name])throw new Error('Already registered the plugin "'+e.name+'"!');this.plugins[e.name]=e},makeClean:function(e){var t,n;for(n in this.plugins)this.plugins.hasOwnProperty(n)&&(Aloha.Log.isDebugEnabled()&&Aloha.Log.debug(this,"Passing contents of HTML Element with id { "+e.attr("id")+" } for cleaning to plugin { "+n+" }"),this.plugins[n].makeClean(e))},toString:function(){return"pluginmanager"}}))}),define("aloha/core",["aloha/jquery","aloha/pluginmanager"],function(e,t){Aloha.ready(function(){e(".ext-ie6").removeClass("ext-ie6")});var n={};return e.extend(!0,Aloha,{version:"0.10.0",editables:[],activeEditable:null,settings:{},defaults:{},ui:{},OSName:"Unknown",stage:"loadingAloha",loadedPlugins:[],requirePaths:[],init:function(){Aloha.settings=e.extendObjects(!0,{},Aloha.defaults,Aloha.settings),window.rangy&&window.rangy.init(),Aloha.stage="loadPlugins",Aloha.loadPlugins(function(){Aloha.stage="initAloha",Aloha.initAloha(function(){Aloha.stage="initPlugins",Aloha.initPlugins(function(){Aloha.stage="initGui",Aloha.initGui(function(){Aloha.stage="alohaReady",Aloha.trigger("aloha-ready")})})})})},loadPlugins:function(t){var r=this.getPluginsToBeLoaded();if(r.length){var i={},s=[],o=[],u={};e.each(r,function(t,n){var r,a,f,l="";r=n.split("/"),a=r[0],f=r[1],Aloha.settings.basePath&&(l=Aloha.settings.basePath),Aloha.settings.bundles&&Aloha.settings.bundles[a]?l+=Aloha.settings.bundles[a]:l+="../plugins/"+a,s.push(f),i[f]=l+"/"+f+"/lib",u[f]=l+"/"+f,e.each(["nls","css","vendor","res"],function(){i[f+"/"+this]=l+"/"+f+"/"+this}),o.push(f+"/"+f+"-plugin")}),this.loadedPlugins=s,this.requirePaths=i,require({context:"aloha",paths:i,locale:this.settings.locale||this.defaults.locale||"en"},o,t),n=u}else t()},getPluginsToBeLoaded:function(){var t=e("[data-aloha-plugins]").data("aloha-plugins");if(typeof Aloha.settings.plugins!="undefined"&&typeof Aloha.settings.plugins.load!="undefined"){t=Aloha.settings.plugins.load;if(t instanceof Array)return t}return typeof t=="string"&&t!==""?t.replace(/\s+/g,"").split(","):[]},getLoadedPlugins:function(){return this.loadedPlugins},isPluginLoaded:function(t){var n=!1;return e.each(this.loadedPlugins,function(){t.toString()===this.toString()&&(n=!0)}),n},initAloha:function(t){(e.browser.webkit&&parseFloat(e.browser.version)<532.5||e.browser.mozilla&&parseFloat(e.browser.version)<1.9||e.browser.msie&&e.browser.version<7||e.browser.opera&&e.browser.version<11)&&window.console&&window.console.log&&window.console.log("Your browser is not supported."),e("html").mousedown(function(e){Aloha.activeEditable&&!Aloha.isMessageVisible()&&!Aloha.eventHandled&&(Aloha.activeEditable.blur(),Aloha.activeEditable=null)}).mouseup(function(e){Aloha.eventHandled=!1}),Aloha.settings.base=Aloha.getAlohaUrl(),Aloha.Log.init(),Aloha.settings.errorhandling&&(window.onerror=function(e,t,n){return Aloha.Log.error(Aloha,"Error message: "+e+"\nURL: "+t+"\nLine Number: "+n),!0}),navigator.appVersion.indexOf("Win")!=-1&&(Aloha.OSName="Win"),navigator.appVersion.indexOf("Mac")!=-1&&(Aloha.OSName="Mac"),navigator.appVersion.indexOf("X11")!=-1&&(Aloha.OSName="Unix"),navigator.appVersion.indexOf("Linux")!=-1&&(Aloha.OSName="Linux");try{var n;try{n=document.queryCommandSupported("enableObjectResizing")}catch(r){n=!1,Aloha.Log.log("enableObjectResizing is not supported.")}n&&(document.execCommand("enableObjectResizing",!1,!1),Aloha.Log.log("enableObjectResizing disabled."))}catch(r){Aloha.Log.error(r,"Could not disable enableObjectResizing")}t()},initPlugins:function(e){t.init(function(){e()},this.getLoadedPlugins())},initGui:function(e){Aloha.RepositoryManager.init();for(var t=0,n=Aloha.editables.length;t<n;t++)Aloha.editables[t].ready||Aloha.editables[t].init();e()},activateEditable:function(e){for(var t=0,n=Aloha.editables.length;t<n;t++)Aloha.editables[t]!=e&&Aloha.editables[t].isActive&&Aloha.editables[t].blur();Aloha.activeEditable=e},getActiveEditable:function(){return Aloha.activeEditable},deactivateEditable:function(){if(typeof Aloha.activeEditable=="undefined"||Aloha.activeEditable===null)return;Aloha.activeEditable.blur(),Aloha.activeEditable=null},getEditableById:function(t){e("#"+t).get(0).nodeName.toLowerCase()==="textarea"&&(t+="-aloha");for(var n=0,r=Aloha.editables.length;n<r;n++)if(Aloha.editables[n].getId()==t)return Aloha.editables[n];return null},isEditable:function(e){for(var t=0,n=Aloha.editables.length;t<n;t++)if(Aloha.editables[t].originalObj.get(0)===e)return!0;return!1},log:function(e,t,n){typeof Aloha.Log!="undefined"&&Aloha.Log.log(e,t,n)},registerEditable:function(e){Aloha.editables.push(e)},unregisterEditable:function(e){var t=Aloha.editables.indexOf(e);t!=-1&&Aloha.editables.splice(t,1)},toString:function(){return"Aloha"},isModified:function(){for(var e=0;e<Aloha.editables.length;e++)if(Aloha.editables[e].isModified&&Aloha.editables[e].isModified())return!0;return!1},getAlohaUrl:function(t){var n=e("[data-aloha-plugins]"),r=n.length?n[0].src.replace(/\/?aloha.js$/,""):"";return typeof Aloha.settings.baseUrl=="string"&&(r=Aloha.settings.baseUrl),r},getPluginUrl:function(e){var t;return e&&(t=n[e],t&&(t.match("^(/|http[s]?:).*")||(t=Aloha.getAlohaUrl()+"/"+t))),t}}),Aloha}),define("aloha/console",["aloha/core","util/class","aloha/jquery"],function(e,t,n){var r=window.console,i=t.extend({init:function(){if(typeof e.settings.logLevels=="undefined"||!e.settings.logLevels)e.settings.logLevels={error:!0,warn:!0};if(typeof e.settings.logHistory=="undefined"||!e.settings.logHistory)e.settings.logHistory={};e.settings.logHistory.maxEntries||(e.settings.logHistory.maxEntries=100),e.settings.logHistory.highWaterMark||(e.settings.logHistory.highWaterMark=90),e.settings.logHistory.levels||(e.settings.logHistory.levels={error:!0,warn:!0}),this.flushLogHistory(),e.trigger("aloha-logger-ready")},logHistory:[],highWaterMarkReached:!1,log:function(t,n,i){typeof n=="undefined"&&(i=t),typeof n!="string"&&n&&n.toString&&(n=n.toString()),typeof i=="undefined"&&(i=n,n=undefined);if(typeof t=="undefined"||!t)t="log";t=t.toLowerCase();if(typeof e.settings.logLevels=="undefined")return;if(!e.settings.logLevels[t])return;n=n||"Unkown Aloha Component",this.addToLogHistory({level:t,component:n,message:i,date:new Date});switch(t){case"error":window.console&&r.error&&(!n&&!i?r.error("Error occured without message and component"):r.error(n+": "+i));break;case"warn":window.console&&r.warn&&r.warn(n+": "+i);break;case"info":window.console&&r.info&&r.info(n+": "+i);break;case"debug":window.console&&r.log&&r.log(n+" ["+t+"]: "+i);break;default:window.console&&r.log&&r.log(n+" ["+t+"]: "+i)}},error:function(e,t){this.log("error",e,t)},warn:function(e,t){this.log("warn",e,t)},info:function(e,t){this.log("info",e,t)},debug:function(e,t){this.log("debug",e,t)},deprecated:function(t,n){this.log("warn",t,n);if(e.settings.logLevels.deprecated)throw new Error(n)},isLogLevelEnabled:function(t){return e.settings&&e.settings.logLevels&&e.settings.logLevels[t]},isErrorEnabled:function(){return this.isLogLevelEnabled("error")},isWarnEnabled:function(){return this.isLogLevelEnabled("warn")},isInfoEnabled:function(){return this.isLogLevelEnabled("info")},isDebugEnabled:function(){return this.isLogLevelEnabled("debug")},addToLogHistory:function(t){e.settings.logHistory||this.init();if(e.settings.logHistory.maxEntries<=0||!e.settings.logHistory.levels[t.level])return;this.logHistory.push(t),this.highWaterMarkReached||this.logHistory.length>=e.settings.logHistory.maxEntries*e.settings.logHistory.highWaterMark/100&&(e.trigger("aloha-log-full"),this.highWaterMarkReached=!0);while(this.logHistory.length>e.settings.logHistory.maxEntries)this.logHistory.shift()},getLogHistory:function(){return this.logHistory},flushLogHistory:function(){this.logHistory=[],this.highWaterMarkReached=!1}});return i=new i,e.Log=e.Console=i}),GENTICS=window.GENTICS||{},GENTICS.Utils=GENTICS.Utils||{},define("util/range",["aloha/jquery","util/dom","util/class","aloha/console","aloha/rangy-core"],function(e,t,n,r){var i=window.GENTICS,s=window.rangy;return i.Utils.RangeObject=n.extend({_constructor:function(e){typeof e=="object"?(typeof e.startContainer!="undefined"&&(this.startContainer=e.startContainer),typeof e.startOffset!="undefined"&&(this.startOffset=e.startOffset),typeof e.endContainer!="undefined"&&(this.endContainer=e.endContainer),typeof e.endOffset!="undefined"&&(this.endOffset=e.endOffset)):e===!0&&this.initializeFromUserSelection()},startContainer:undefined,startOffset:undefined,endContainer:undefined,endOffset:undefined,deleteContents:function(){t.removeRange(this)},log:function(e){r.deprecated("Utils.RangeObject",'log() is deprecated. use console.log() from module "aloha/console" instead: '+e)},isCollapsed:function(){return!this.endContainer||this.startContainer===this.endContainer&&this.startOffset===this.endOffset},getCommonAncestorContainer:function(){return this.commonAncestorContainer?this.commonAncestorContainer:(this.updateCommonAncestorContainer(),this.commonAncestorContainer)},getContainerParents:function(t,n){var r=n?this.endContainer:this.startContainer,i,s,o;if(!r)return!1;if(typeof t=="undefined"||!t)t=e("body");if(r.nodeType==3)i=e(r).parents();else{i=e(r).parents();for(o=i.length;o>0;--o)i[o]=i[o-1];i[0]=r}return s=i.index(t),s>=0&&(i=i.slice(0,s)),i},getStartContainerParents:function(e){return this.getContainerParents(e,!1)},getEndContainerParents:function(e){return this.getContainerParents(e,!0)},updateCommonAncestorContainer:function(e){if(!e){var t=this.getStartContainerParents(),n=this.getEndContainerParents(),i;if(!(t.length>0&&n.length>0))return r.warn("could not find commonAncestorContainer"),!1;for(i=0;i<t.length;i++)if(n.index(t[i])!=-1){this.commonAncestorContainer=t[i];break}}else this.commonAncestorContainer=e;return r.debug(e?"commonAncestorContainer was set successfully":"commonAncestorContainer was calculated successfully"),!0},getCollapsedIERange:function(e,t){var n=document.body.createTextRange(),r,i,s,o;return o=this.searchElementToLeft(e,t),o.element?(r=document.body.createTextRange(),r.moveToElementText(o.element),n.setEndPoint("StartToEnd",r),o.characters!==0?n.moveStart("character",o.characters):(n.moveStart("character",1),n.moveStart("character",-1))):(i=this.searchElementToRight(e,t),s=e.nodeType==3?e.parentNode:e,r=document.body.createTextRange(),r.moveToElementText(s),n.setEndPoint("StartToStart",r),o.characters!==0&&n.moveStart("character",o.characters)),n.collapse(),n},select:function(){var e,t,n,r,i;r=s.createRange(),r.setStart(this.startContainer,this.startOffset),r.setEnd(this.endContainer,this.endOffset),i=s.getSelection(),i.setSingleRange(r)},searchElementToLeft:function(e,t){var n,r=0;e.nodeType===3?(r=t,n=e.previousSibling):t>0&&(n=e.childNodes[t-1]);while(n&&n.nodeType===3)r+=n.data.length,n=n.previousSibling;return{element:n,characters:r}},searchElementToRight:function(e,t){var n,r=0;e.nodeType===3?(r=e.data.length-t,n=e.nextSibling):t<e.childNodes.length&&(n=e.childNodes[t]);while(n&&n.nodeType===3)r+=n.data.length,n=n.nextSibling;return{element:n,characters:r}},update:function(e){r.debug("now updating rangeObject"),this.initializeFromUserSelection(e),this.updateCommonAncestorContainer()},initializeFromUserSelection:function(e){var t=s.getSelection(),n;if(!t)return!1;if(!t.rangeCount)return!1;n=t.getRangeAt(0);if(!n)return!1;this.startContainer=n.startContainer,this.endContainer=n.endContainer,this.startOffset=n.startOffset,this.endOffset=n.endOffset,this.correctRange();return},correctRange:function(){var e,t,n,r,s;this.clearCaches();if(this.isCollapsed()){if(this.startContainer.nodeType===1){if(this.startOffset>0&&this.startContainer.childNodes[this.startOffset-1].nodeType===3){this.startContainer=this.startContainer.childNodes[this.startOffset-1],this.startOffset=this.startContainer.data.length,this.endContainer=this.startContainer,this.endOffset=this.startOffset;return}if(this.startOffset>0&&this.startContainer.childNodes[this.startOffset-1].nodeType===1){e=i.Utils.Dom.searchAdjacentTextNode(this.startContainer,this.startOffset,!0);if(e){this.startContainer=this.endContainer=e,this.startOffset=this.endOffset=e.data.length;return}e=i.Utils.Dom.searchAdjacentTextNode(this.startContainer,this.startOffset,!1);if(e){this.startContainer=this.endContainer=e,this.startOffset=this.endOffset=0;return}}if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType===3){this.startContainer=this.startContainer.childNodes[this.startOffset],this.startOffset=0,this.endContainer=this.startContainer,this.endOffset=0;return}}this.startContainer.nodeType===3&&this.startOffset===0&&(e=i.Utils.Dom.searchAdjacentTextNode(this.startContainer.parentNode,i.Utils.Dom.getIndexInParent(this.startContainer),!0),e&&(this.startContainer=this.endContainer=e,this.startOffset=this.endOffset=e.data.length))}else{if(this.startContainer.nodeType===1)if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType===3)this.startContainer=this.startContainer.childNodes[this.startOffset],this.startOffset=0;else if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType===1){t=!1,n=this.startContainer.childNodes[this.startOffset];while(t===!1&&n.childNodes&&n.childNodes.length>0)n=n.childNodes[0],n.nodeType===3&&(t=n);t!==!1&&(this.startContainer=t,this.startOffset=0)}this.startContainer.nodeType===3&&this.startOffset===this.startContainer.data.length&&(e=i.Utils.Dom.searchAdjacentTextNode(this.startContainer.parentNode,i.Utils.Dom.getIndexInParent(this.startContainer)+1,!1),e&&(this.startContainer=e,this.startOffset=0));if(this.endContainer.nodeType===3&&this.endOffset===0)if(this.endContainer.previousSibling&&this.endContainer.previousSibling.nodeType===3)this.endContainer=this.endContainer.previousSibling,this.endOffset=this.endContainer.data.length;else if(this.endContainer.previousSibling&&this.endContainer.previousSibling.nodeType===1&&this.endContainer.parentNode){r=this.endContainer.parentNode;for(s=0;s<r.childNodes.length;++s)if(r.childNodes[s]==this.endContainer){this.endOffset=s;break}this.endContainer=r}this.endContainer.nodeType==1&&this.endOffset===0&&this.endContainer.previousSibling&&(this.endContainer.previousSibling.nodeType===3?(this.endContainer=this.endContainer.previousSibling,this.endOffset=this.endContainer.data.length):this.endContainer.previousSibling.nodeType===1&&this.endContainer.previousSibling.childNodes&&this.endContainer.previousSibling.childNodes.length>0&&(this.endContainer=this.endContainer.previousSibling,this.endOffset=this.endContainer.childNodes.length));if(this.endContainer.nodeType==1)if(this.endOffset>0&&this.endContainer.childNodes[this.endOffset-1].nodeType===3)this.endContainer=this.endContainer.childNodes[this.endOffset-1],this.endOffset=this.endContainer.data.length;else if(this.endOffset>0&&this.endContainer.childNodes[this.endOffset-1].nodeType===1){t=!1,n=this.endContainer.childNodes[this.endOffset-1];while(t===!1&&n.childNodes&&n.childNodes.length>0)n=n.childNodes[n.childNodes.length-1],n.nodeType===3&&(t=n);t!==!1&&(this.endContainer=t,this.endOffset=this.endContainer.data.length)}}},clearCaches:function(){this.commonAncestorContainer=undefined},getRangeTree:function(e){return typeof e=="undefined"&&(e=this.getCommonAncestorContainer()),this.inselection=!1,this.recursiveGetRangeTree(e)},recursiveGetRangeTree:function(t){var n=e(t),r=0,s=this,o=[];return n.contents().each(function(e){var n="none",u=!1,a=!1,f=!1,l=!1,c=!1,h=!1,p;s.isCollapsed()&&t===s.startContainer&&s.startOffset===e&&(o[r]=new i.Utils.RangeTree,o[r].type="collapsed",o[r].domobj=undefined,s.inselection=!1,f=!0,r++);if(!s.inselection&&!f)switch(this.nodeType){case 3:this===s.startContainer&&(s.inselection=!0,n=s.startOffset>0?"partial":"full",u=s.startOffset,a=this.length);break;case 1:this===s.startContainer&&s.startOffset===0&&(s.inselection=!0,n="full"),t===s.startContainer&&s.startOffset===e&&(s.inselection=!0,n="full")}if(s.inselection&&!f){n=="none"&&(n="full");switch(this.nodeType){case 3:this===s.endContainer&&(s.inselection=!1
,s.endOffset<this.length&&(n="partial"),u===!1&&(u=0),a=s.endOffset);break;case 1:this===s.endContainer&&s.endOffset===0&&(s.inselection=!1)}t===s.endContainer&&s.endOffset<=e&&(s.inselection=!1,n="none")}o[r]=new i.Utils.RangeTree,o[r].domobj=this,o[r].type=n,n=="partial"&&(o[r].startOffset=u,o[r].endOffset=a),o[r].children=s.recursiveGetRangeTree(this);if(o[r].children.length>0){for(p=0;p<o[r].children.length;++p)switch(o[r].children[p].type){case"none":l=!0;break;case"full":h=!0;break;case"partial":c=!0}c||h&&l?o[r].type="partial":h&&!c&&!l&&(o[r].type="full")}r++}),this.isCollapsed()&&t===this.startContainer&&this.startOffset==t.childNodes.length&&(o[r]=new i.Utils.RangeTree,o[r].type="collapsed",o[r].domobj=undefined),o},findMarkup:function(t,n,r){var i=this.getContainerParents(n,r),s=!1;return e.each(i,function(e,n){if(t.apply(n))return s=n,!1}),s},getText:function(){return this.isCollapsed()?"":this.recursiveGetText(this.getRangeTree())},recursiveGetText:function(t){if(!t)return"";var n=this,r="";return e.each(t,function(){this.type=="full"?r+=e(this.domobj).text():this.type=="partial"&&this.domobj.nodeType===3?r+=e(this.domobj).text().substring(this.startOffset,this.endOffset):this.type=="partial"&&this.domobj.nodeType===1&&this.children&&(r+=n.recursiveGetText(this.children))}),r}}),i.Utils.RangeTree=n.extend({domobj:{},type:null,children:[]}),i.Utils.RangeObject}),define("aloha/floatingmenu",["aloha/core","aloha/jquery","aloha/ext","util/class","aloha/console","vendor/jquery.store"],function(e,t,n,r,i){function f(n){if(!e.activeEditable)return;var r=n.obj,i=e.activeEditable.obj.offset(),s=n.behaviour==="topalign",o=n.behaviour==="append",u=n.pinned&&parseInt(r.css("left"),10)!=i.left+n.horizontalOffset;if(s&&u||o)return;var a=r.height(),f=t(document).scrollTop(),l=i.top-a+n.marginTop-n.topalignOffset;f>l?i.top=s?f+n.marginTop:n.marginTop:f<=l&&(i.top-=a+(s?n.marginTop+n.topalignOffset:0)),n.floatTo(i)}var s=window.GENTICS,o=r.extend({_constructor:function(e){this.label=e,this.groups=[],this.groupMap={},this.visible=!0},getGroup:function(e){var t=this.groupMap[e];return typeof t=="undefined"&&(t=new u,this.groupMap[e]=t,this.groups.push(t)),t},getExtComponent:function(){var e=this;return this.extPanel||(this.extPanel=new n.Panel({tbar:[],title:this.label,style:"margin-top:0px",bodyStyle:"display:none",autoScroll:!0})),t.each(this.groups,function(t,n){n.extButtonGroup||e.extPanel.getTopToolbar().add(n.getExtComponent())}),this.extPanel},doLayout:function(){var n=this;return e.Log.isDebugEnabled()&&e.Log.debug(this,"doLayout called for tab "+this.label),this.visible=!1,t.each(this.groups,function(e,t){n.visible|=t.doLayout()}),e.Log.isDebugEnabled()&&e.Log.debug(this,"tab "+this.label+(this.visible?" is ":" is not ")+"visible now"),this.visible}}),u=r.extend({_constructor:function(){this.buttons=[],this.fields=[]},addButton:function(t){if(t.button instanceof e.ui.AttributeField){if(!(this.fields.length<2))throw new Error("Too much fields in this group");this.fields.push(t)}else typeof t.button!="undefined"&&this.buttons.push(t)},getExtComponent:function(){var e=this,r,i=[],s=0,o=0,u,a,f;if(typeof this.extButtonGroup=="undefined"){this.fields.length>1&&(o=1),t.each(this.buttons,function(e,t){s+=t.button.size=="small"?1:2}),o+=Math.ceil(s/2),u=this.buttons.length,a=0,f=Math.ceil(this.buttons.length/2)-this.buttons.length%2,this.fields.length>0&&(e.buttons.push(this.fields[0]),i.push(this.fields[0].button.getExtConfigProperties()));while(--u>=f)i.push(this.buttons[a++].button.getExtConfigProperties());++u,this.fields.length>1&&(e.buttons.push(this.fields[1]),i.push(this.fields[1].button.getExtConfigProperties()));while(--u>=0)i.push(this.buttons[a++].button.getExtConfigProperties());this.extButtonGroup=new n.ButtonGroup({columns:o,items:i}),t.each(this.buttons,function(t,n){n.button.extButton=e.extButtonGroup.findById(n.button.id);if(n.button.listenerQueue&&n.button.listenerQueue.length>0)for(;;){r=n.button.listenerQueue.shift();if(!r)break;n.button.extButton.addListener(r.eventName,r.handler,r.scope,r.options)}n.button.extButton.setObjectTypeFilter&&(n.button.objectTypeFilter&&(n.button.extButton.noQuery=!1),n.button.objectTypeFilter=="all"&&(n.button.objectTypeFilter=null),n.button.extButton.setObjectTypeFilter(n.button.objectTypeFilter),n.button.displayField&&(n.button.extButton.displayField=n.button.displayField),n.button.tpl&&(n.button.extButton.tpl=n.button.tpl))})}return this.extButtonGroup},doLayout:function(){var e=!1,n=this;return t.each(this.buttons,function(t,r){if(typeof r.button!="undefined"){var i=n.extButtonGroup.findById(r.button.id),s=r.button.isVisible()&&r.scopeVisible;if(!i)return;s&&i.hidden?i.show():!s&&i&&!i.hidden&&i.hide(),e|=s}}),e&&this.extButtonGroup.hidden?this.extButtonGroup.show():!e&&!this.extButtonGroup.hidden&&this.extButtonGroup.hide(),e}}),a={top:null,left:null},l=r.extend({scopes:{"Aloha.empty":{name:"Aloha.empty",extendedScopes:[],buttons:[]},"Aloha.global":{name:"Aloha.global",extendedScopes:["Aloha.empty"],buttons:[]},"Aloha.continuoustext":{name:"Aloha.continuoustext",extendedScopes:["Aloha.global"],buttons:[]}},tabs:[],tabMap:{},initialized:!1,allButtons:[],top:100,left:100,pinned:!1,window:t(window),behaviour:"float",element:"floatingmenu",topalignOffset:0,horizontalOffset:0,marginTop:10,draggable:!0,pin:!1,buttonsAdded:[],fromConfig:!1,init:function(){e.settings.floatingmenu&&(typeof e.settings.floatingmenu.draggable=="boolean"&&(this.draggable=e.settings.floatingmenu.draggable),typeof e.settings.floatingmenu.behaviour=="string"&&(this.behaviour=e.settings.floatingmenu.behaviour),typeof e.settings.floatingmenu.topalignOffset!="undefined"&&(this.topalignOffset=parseInt(e.settings.floatingmenu.topalignOffset,10)),typeof e.settings.floatingmenu.horizontalOffset!="undefined"&&(this.horizontalOffset=parseInt(e.settings.floatingmenu.horizontalOffset,10)),typeof e.settings.floatingmenu.marginTop=="number"&&(this.marginTop=parseInt(e.settings.floatingmenu.marginTop,10)),typeof e.settings.floatingmenu.element=="string"&&(this.element=e.settings.floatingmenu.element),typeof e.settings.floatingmenu.pin=="boolean"&&(this.pin=e.settings.floatingmenu.pin),typeof e.settings.floatingmenu.width!="undefined"&&(this.width=parseInt(e.settings.floatingmenu.width,10))),t.storage=new t.store,this.currentScope="Aloha.global";var n=this;this.window.unload(function(){n.pinned?(t.storage.set("Aloha.FloatingMenu.pinned","true"),t.storage.set("Aloha.FloatingMenu.top",n.top),t.storage.set("Aloha.FloatingMenu.left",n.left),e.Log.isInfoEnabled()&&e.Log.info(this,"stored FloatingMenu pinned position {"+n.left+", "+n.top+"}")):(t.storage.del("Aloha.FloatingMenu.pinned"),t.storage.del("Aloha.FloatingMenu.top"),t.storage.del("Aloha.FloatingMenu.left")),n.userActivatedTab&&t.storage.set("Aloha.FloatingMenu.activeTab",n.userActivatedTab)}).resize(function(){if(n.behaviour==="float")if(n.pinned)n.fixPinnedPosition(),n.refreshShadow(),n.extTabPanel.setPosition(n.left,n.top);else{var t=n.calcFloatTarget(e.Selection.getRangeObject());t&&n.floatTo(t)}}),e.bind("aloha-ready",function(){n.generateComponent(),n.initialized=!0}),typeof e.settings.toolbar=="object"&&(this.fromConfig=!0)},obj:null,shadow:null,panelBody:null,width:400,initTabsAndGroups:function(){var n=this;if(!this.fromConfig)return;t.each(e.settings.toolbar.tabs,function(e,r){var s=n.tabMap[e];typeof s=="undefined"&&(s=new o(e),n.tabs.push(s),n.tabMap[e]=s),t.each(r,function(r,o){var u=s.getGroup(r),a;t.each(o,function(s,o){if(t.inArray(o,n.buttonsAdded)!==-1){i.warn("Skipping button {"+o+"}. A button can't be added "+"to the floating menu twice. Config key: {Aloha.settings.toolbar."+e+"."+r+"}");return}for(a=0;a<n.allButtons.length;a++)if(o===n.allButtons[a].button.name){u.addButton(n.allButtons[a]),n.buttonsAdded.push(n.allButtons[a].button.name);break}})})})},generateComponent:function(){var r=this,i;this.initTabsAndGroups(),n.QuickTips.init(),n.apply(n.QuickTips.getQuickTip(),{minWidth:10});if(!this.extTabPanel){var s=!1;r.draggable&&(s={insertProxy:!1,onDrag:function(e){var t=this.proxy.getEl();this.x=t.getLeft(!0),this.y=t.getTop(!0),this.panel.shadow.hide()},endDrag:function(e){var n=r.pinned?this.y-t(document).scrollTop():this.y;r.left=this.x,r.top=n,a.left=r.left,a.top=r.top,this.panel.setPosition(this.x,n),r.refreshShadow(),this.panel.shadow.show()}}),this.extTabPanel=new n.TabPanel({activeTab:0,width:r.width,plain:!1,draggable:s,floating:{shadow:!1},defaults:{autoScroll:!0},layoutOnTabChange:!0,shadow:!1,cls:"aloha-floatingmenu ext-root",listeners:{tabchange:{fn:function(n,i){i.title!=r.autoActivatedTab?(e.Log.isDebugEnabled()&&e.Log.debug(r,"User selected tab "+i.title),r.userActivatedTab=i.title):e.Log.isDebugEnabled()&&e.Log.debug(r,"Tab "+i.title+" was activated automatically"),r.autoActivatedTab=undefined,t.each(r.allButtons,function(e,t){typeof t.button!="undefined"&&typeof t.button.extButton!="undefined"&&t.button.extButton!==null&&typeof t.button.extButton.setActiveDOMElement=="function"&&typeof t.button.extButton.activeDOMElement!="undefined"&&t.button.extButton.setActiveDOMElement(t.button.extButton.activeDOMElement)}),r.extTabPanel.isVisible()&&(r.extTabPanel.shadow.show(),r.refreshShadow())}}},enableTabScroll:!0})}t.each(this.tabs,function(t,n){try{r.extTabPanel.add(n.getExtComponent())}catch(i){e.Log.error(r,"Error while inserting tab: "+i)}}),this.extTabPanel.shadow||(this.extTabPanel.shadow=t('<div id="aloha-floatingmenu-shadow" class="aloha-shadow">&#160;</div>').hide(),t("body").append(this.extTabPanel.shadow)),i=this.extTabPanel.add({title:"&#160;"}),this.extTabPanel.render(document.body),t(i.tabEl).addClass("aloha-floatingmenu-pin").html("&#160;").mousedown(function(e){r.togglePin(),e.stopPropagation()}),this.panelBody=t("div.aloha-floatingmenu div.x-tab-panel-bwrap"),this.doLayout(),this.obj=t(this.extTabPanel.getEl().dom),t.storage.get("Aloha.FloatingMenu.pinned")=="true"&&(this.top=parseInt(t.storage.get("Aloha.FloatingMenu.top"),10),this.left=parseInt(t.storage.get("Aloha.FloatingMenu.left"),10),this.fixPinnedPosition(),e.Log.isInfoEnabled()&&e.Log.info(this,"restored FloatingMenu pinned position {"+this.left+", "+this.top+"}"),this.refreshShadow()),t.storage.get("Aloha.FloatingMenu.activeTab")&&(this.userActivatedTab=t.storage.get("Aloha.FloatingMenu.activeTab")),this.extTabPanel.setPosition(this.left,this.top),this.obj.mousedown(function(t){t.originalEvent.stopSelectionUpdate=!0,e.eventHandled=!0}),this.obj.mouseup(function(t){t.originalEvent.stopSelectionUpdate=!0,e.eventHandled=!1}),t(window).scroll(function(){f(r)}),r.draggable||t(".aloha-floatingmenu").hover(function(){t(this).css({background:"none"}),t(".aloha-floatingmenu-pin").hide()});if(this.behaviour==="float")e.bind("aloha-selection-changed",function(e,t){if(!r.pinned){var n=r.calcFloatTarget(t);n&&r.floatTo(n)}});else if(this.behaviour==="append"){var o=t("#"+r.element),u=o.offset();if(!u)return e.Log.warn(r,"Invalid element HTML ID for floating menu: "+r.element),!1;this.floatTo(u),this.pin&&this.togglePin(!0),e.bind("aloha-editable-activated",function(e,t){if(r.pinned)return;r.floatTo(u)})}else this.behaviour==="topalign"&&(this.togglePin(!1),e.bind("aloha-editable-activated",function(e,n){if(r.pinned)return;var i=n.editable.obj,s=90,o=i.offset(),u=o.top-s<t(document).scrollTop();u?(o.top=i.height()<s?o.top+i.height():t(document).scrollTop(),o.top+=r.marginTop):o.top-=s+r.topalignOffset,o.left+=r.horizontalOffset;var a=10,f=o.left+r.width+a-t(window).width();f>0&&(o.left-=f),r.floatTo(o)}))},fixPinnedPosition:function(){if(!this.pinned)return;this.top<30?this.top=30:this.top>this.window.height()-this.extTabPanel.getHeight()&&(this.top=this.window.height()-this.extTabPanel.getHeight()),this.left<0?this.left=0:this.left>this.window.width()-this.extTabPanel.getWidth()&&(this.left=this.window.width()-this.extTabPanel.getWidth())},refreshShadow:function(e){if(this.panelBody){var t={top:this.top+24,left:this.left};if(typeof e=="undefined"||!e)t.width=this.panelBody.width()+"px",t.height=this.panelBody.height()+"px";this.extTabPanel.shadow.css(t)}},togglePin:function(e){var n=t(".aloha-floatingmenu-pin");typeof e=="boolean"&&(this.pinned=!e),this.pinned?(n.removeClass("aloha-floatingmenu-pinned"),this.top=this.obj.offset().top,this.obj.removeClass("fixed").css({top:this.top}),this.extTabPanel.shadow.removeClass("fixed"),this.refreshShadow(),this.pinned=!1):(n.addClass("aloha-floatingmenu-pinned"),this.top=this.obj.offset().top-this.window.scrollTop(),this.obj.addClass("fixed").css({top:this.top}),this.extTabPanel.shadow.addClass("fixed"),this.refreshShadow(),this.pinned=!0)},createScope:function(e,t){typeof t=="undefined"?t=["Aloha.empty"]:typeof t=="string"&&(t=[t]),this.scopes[e]||(this.scopes[e]={name:e,extendedScopes:t,buttons:[]})},addButton:function(t,n,r,s){var u=this.scopes[t],a,f,l;n.name||i.warn("Added button with iconClass {"+n.iconClass+'} which has no property "name"');if(typeof u=="undefined")return e.Log.error("Can't add button to given scope since the scope has not yet been initialized.",t),!1;a={button:n,scopeVisible:!1},this.allButtons.push(a),u.buttons.push(a),this.fromConfig||(f=this.tabMap[r],typeof f=="undefined"&&(f=new o(r),this.tabs.push(f),this.tabMap[r]=f),l=f.getGroup(s),l.addButton(a)),this.initialized&&this.generateComponent()},doLayout:function(){e.Log.isDebugEnabled()&&e.Log.debug(this,"doLayout called for FloatingMenu, scope is "+this.currentScope);if(typeof this.extTabPanel=="undefined")return!1;var n=this,r=!1,i=this.extTabPanel.getActiveTab(),s=!1,o=!1,u=!1,a;t.each(this.tabs,function(t,a){a.extPanel==i&&(s=a);var f=a.visible;a.doLayout()?(o=!0,f||(e.Log.isDebugEnabled()&&e.Log.debug(n,"showing tab strip for tab "+a.label),n.extTabPanel.unhideTabStripItem(a.extPanel)),r||(r=a),n.userActivatedTab==a.extPanel.title&&a.extPanel!=i&&(u=a)):f&&(e.Log.isDebugEnabled()&&e.Log.debug(n,"hiding tab strip for tab "+a.label),n.extTabPanel.hideTabStripItem(a.extPanel))}),u?(e.Log.isDebugEnabled()&&e.Log.debug(this,"Setting active tab to "+u.label),this.extTabPanel.setActiveTab(u.extPanel)):typeof s=="object"&&typeof r=="object"&&(s.visible||(e.Log.isDebugEnabled()&&e.Log.debug(this,"Setting active tab to "+r.label),this.autoActivatedTab=r.extPanel.title,this.extTabPanel.setActiveTab(r.extPanel))),o&&this.extTabPanel.hidden?(this.extTabPanel.show(),this.refreshShadow(),this.extTabPanel.shadow.show(),this.extTabPanel.setPosition(this.left,this.top)):!o&&!this.extTabPanel.hidden&&(a=this.extTabPanel.getPosition(!0),this.left=a[0]<0?100:a[0],this.top=a[1]<0?100:a[1],this.extTabPanel.hide(),this.extTabPanel.shadow.hide()),this.extTabPanel.doLayout()},setScope:function(e){var n=this.scopes[e];typeof n!="undefined"&&this.currentScope!=e&&(this.currentScope=e,t.each(this.allButtons,function(e,t){t.scopeVisible=!1}),this.setButtonScopeVisibility(n),this.doLayout())},setButtonScopeVisibility:function(e){var n=this;t.each(e.buttons,function(e,t){t.scopeVisible=!0}),t.each(e.extendedScopes,function(e,t){var r=n.scopes[t];typeof r=="object"&&n.setButtonScopeVisibility(r)})},nextFloatTargetObj:function(e,t){if(!e||e==t)return e;switch(e.nodeName.toLowerCase()){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"p":case"div":case"td":case"pre":case"ul":case"ol":return e;default:return this.nextFloatTargetObj(e.parentNode,t)}},calcFloatTarget:function(n){var r,i,o,u,a,f,l,c;if(!e.activeEditable||typeof n.getCommonAncestorContainer=="undefined")return!1;for(r=0,o=e.editables.length;r<o;r++)if(e.editables[r].obj.get(0)==n.limitObject&&e.editables[r].isDisabled())return!1;return a=this.nextFloatTargetObj(n.getCommonAncestorContainer(),n.limitObject),a?(f=t(a),l=s.Utils.Position.Scroll.top,!f||!f.offset()?!1:(c=f.offset().top-this.obj.height()-50,c<l&&(c+=80+s.Utils.Position.ScrollCorrection.top),c>this.window.height()+this.window.scrollTop()?!1:(u=e.activeEditable.obj.offset().left,i=t(document).width(),i-this.width<u&&(u=i-this.width-s.Utils.Position.ScrollCorrection.left),{left:u,top:c}))):!1},floatTo:function(e){if(this.pinned)return;var t=this,n=this.obj.offset(),r,i;a.left===null?(r=n.left,i=n.top):(r=a.left,i=a.top);if(r!=e.left||i!=e.top)this.obj.offset({left:r,top:i}),this.obj.animate({top:e.top,left:e.left},{queue:!1,step:function(e,n){n.prop==="top"?t.top=n.now:n.prop==="left"&&(t.left=n.now),t.refreshShadow(!1)},complete:function(){a.left=t.left,a.top=t.top}})},hide:function(){this.obj&&this.obj.hide(),this.shadow&&this.shadow.hide()},activateTabOfButton:function(e){var t=null;for(var n=0;n<this.tabs.length&&!t;n++){var r=this.tabs[n];for(var i=0;i<r.groups.length&&!t;i++){var s=r.groups[i];for(var o=0;o<s.buttons.length&&!t;o++){var u=s.buttons[o];if(u.button.name==e){t=r;break}}}}t&&(this.userActivatedTab=t.label,this.doLayout())}}),c=new l;return c.init(),e.bind("aloha-editable-deactivated",function(){c.setScope("Aloha.empty")}),e.bind("aloha-selection-changed",function(){!e.Selection.isSelectionEditable()&&!e.Selection.isFloatingMenuVisible()&&c.setScope("Aloha.empty")}),c}),define("aloha/selection",["aloha/core","aloha/jquery","aloha/floatingmenu","util/class","util/range","aloha/rangy-core"],function(e,t,n,r,i){function u(e){t.browser.msie&&e.startContainer===e.endContainer&&e.startOffset===e.endOffset&&e.startContainer.nodeType==3&&e.startOffset==e.startContainer.data.length&&e.startContainer.nextSibling&&["OL","UL"].indexOf(e.startContainer.nextSibling.nodeName)!==-1&&(e.startContainer.data[e.startContainer.data.length-1]==" "?e.startOffset=e.endOffset=e.startOffset-1:e.startContainer.data=e.startContainer.data+" ")}function a(e){return u(e),e}var s=window.GENTICS,o=r.extend({_constructor:function(){this.rangeObject={},this.preventSelectionChangedFlag=!1,this.tagHierarchy={textNode:[],abbr:["textNode"],b:["textNode","b","i","em","sup","sub","br","span","img","a","del","ins","u","cite","q","code","abbr","strong"],pre:["textNode","b","i","em","sup","sub","br","span","img","a","del","ins","u","cite","q","code","abbr","code"],blockquote:["textNode","b","i","em","sup","sub","br","span","img","a","del","ins","u","cite","q","code","abbr","p","h1","h2","h3","h4","h5","h6"],ins:["textNode","b","i","em","sup","sub","br","span","img","a","u","p","h1","h2","h3","h4","h5","h6"],ul:["li"],ol:["li"],li:["textNode","b","i","em","sup","sub","br","span","img","ul","ol","h1","h2","h3","h4","h5","h6","del","ins","u","a"],tr:["td","th"],table:["tr"],div:["textNode","b","i","em","sup","sub","br","span","img","ul","ol","table","h1","h2","h3","h4","h5","h6","del","ins","u","p","div","pre","blockquote","a"],h1:["textNode","b","i","em","sup","sub","br","span","img","a","del","ins","u"]},this.tagHierarchy={textNode:this.tagHierarchy.textNode,abbr:this.tagHierarchy.abbr,br:this.tagHierarchy.textNode,img:this.tagHierarchy.textNode,b:this.tagHierarchy.b,strong:this.tagHierarchy.b,code:this.tagHierarchy.b,q:this.tagHierarchy.b,blockquote:this.tagHierarchy.blockquote,cite:this.tagHierarchy.b,i:this.tagHierarchy.b,em:this.tagHierarchy.b,sup:this.tagHierarchy.b,sub:this.tagHierarchy.b,span:this.tagHierarchy.b,del:this.tagHierarchy.del,ins:this.tagHierarchy.ins,u:this.tagHierarchy.b,p:this.tagHierarchy.b,pre:this.tagHierarchy.pre,a:this.tagHierarchy.b,ul:this.tagHierarchy.ul,ol:this.tagHierarchy.ol,li:this.tagHierarchy.li,td:this.tagHierarchy.li,div:this.tagHierarchy.div,h1:this.tagHierarchy.h1,h2:this.tagHierarchy.h1,h3:this.tagHierarchy.h1,h4:this.tagHierarchy.h1,h5:this.tagHierarchy.h1,h6:this.tagHierarchy.h1,table:this.tagHierarchy.table},this.replacingElements={h1:["p","h1","h2","h3","h4","h5","h6","pre","blockquote"]},this.replacingElements={h1:this.replacingElements.h1,h2:this.replacingElements.h1,h3:this.replacingElements.h1,h4:this.replacingElements.h1,h5:this.replacingElements.h1,h6:this.replacingElements.h1,pre:this.replacingElements.h1,p:this.replacingElements.h1,blockquote:this.replacingElements.h1},this.allowedToStealElements={h1:["textNode"]},this.allowedToStealElements={h1:this.allowedToStealElements.h1,h2:this.allowedToStealElements.h1,h3:this.allowedToStealElements.h1,h4:this.allowedToStealElements.h1,h5:this.allowedToStealElements.h1,h6:this.allowedToStealElements.h1,p:this.tagHierarchy.b}},SelectionTree:function(){this.domobj={},this.selection=undefined,this.children=[]},onChange:function(t,n){this.updateSelectionTimeout&&(window.clearTimeout(this.updateSelectionTimeout),this.updateSelectionTimeout=undefined);var r=new e.Selection.SelectionRange(!0);this.updateSelectionTimeout=window.setTimeout(function(){e.Selection._updateSelection(n,r)},5)},preventSelectionChanged:function(){this.preventSelectionChangedFlag=!0},isSelectionChangedPrevented:function(){var e=this.preventSelectionChangedFlag;return this.preventSelectionChangedFlag=!1,e},isSelectionEditable:function(){return this.rangeObject.commonAncestorContainer&&t(this.rangeObject.commonAncestorContainer).contentEditable()},isFloatingMenuVisible:function(){var n=t(e.Selection.rangeObject.commonAncestorContainer).attr("data-aloha-floatingmenu-visible");return n!=="undefined"?n==="true"?!0:!1:!1},updateSelection:function(e){return this._updateSelection(e,null)},_updateSelection:function(r,i){if(r&&r.originalEvent&&r.originalEvent.stopSelectionUpdate===!0)return!1;if(typeof i=="undefined")return!1;this.rangeObject=i||new e.Selection.SelectionRange(!0);if(typeof this.rangeObject!="undefined"&&typeof this.rangeObject.startContainer!="undefined"&&this.rangeObject.endContainer!=="undefined")if(this.rangeObject.startContainer.nodeType===3&&!t(this.rangeObject.startContainer.parentNode).contentEditable()||this.rangeObject.endContainer.nodeType===3&&!t(this.rangeObject.endContainer.parentNode).contentEditable())return e.getSelection().removeAllRanges(),!0;return this.rangeObject.update(),this.isSelectionChangedPrevented()?!0:(r!==undefined&&n.setScope("Aloha.continuoustext"),e.trigger("aloha-selection-changed",[this.rangeObject,r]),!0)},getSelectionTree:function(t){return t?t.commonAncestorContainer?(this.inselection=!1,s.Utils.Dom.doCleanup({merge:!0},t)&&(this.rangeObject.update(),this.rangeObject.select()),this.recursiveGetSelectionTree(t,t.commonAncestorContainer)):(e.Log.error(this,"the rangeObject is missing the commonAncestorContainer"),!1):this.rangeObject.getSelectionTree()},recursiveGetSelectionTree:function(n,r){var i=t(r),s=0,o=this,u=[];return i.contents().each(function(t){var i="none",a=!1,f=!1,l=!1,c,h,p=!1,d=!1,v=!1;n.isCollapsed()&&r===n.startContainer&&n.startOffset==t&&(u[s]=new e.Selection.SelectionTree,u[s].selection="collapsed",u[s].domobj=undefined,o.inselection=!1,l=!0,s++);if(!o.inselection&&!l){var m;try{m=this.nodeType}catch(g){return}switch(m){case 3:this===n.startContainer&&(o.inselection=!0,i=n.startOffset>0?"partial":"full",a=n.startOffset,f=this.length);break;case 1:this===n.startContainer&&n.startOffset===0&&(o.inselection=!0,i="full"),r===n.startContainer&&n.startOffset===t&&(o.inselection=!0,i="full")}}if(o.inselection&&!l){i=="none"&&(i="full");switch(this.nodeType){case 3:this===n.endContainer&&(o.inselection=!1,n.endOffset<this.length&&(i="partial"),a===!1&&(a=0),f=n.endOffset);break;case 1:this===n.endContainer&&n.endOffset===0&&(o.inselection=!1)}r===n.endContainer&&n.endOffset<=t&&(o.inselection=!1,i="none")}u[s]=new e.Selection.SelectionTree,u[s].domobj=this,u[s].selection=i,i=="partial"&&(u[s].startOffset=a,u[s].endOffset=f),u[s].children=o.recursiveGetSelectionTree(n,this),h=u[s].children.length;if(h>0){for(c=0;c<h;++c)switch(u[s].children[c].selection){case"none":p=!0;break;case"full":v=!0;break;case"partial":d=!0}d||v&&p?u[s].selection="partial":v&&!d&&!p&&(u[s].selection="full")}s++}),n.isCollapsed()&&r===n.startContainer&&n.startOffset==r.childNodes.length&&(u[s]=new e.Selection.SelectionTree,u[s].selection="collapsed",u[s].domobj=undefined),u},getRangeObject:function(){return this.rangeObject},isRangeObjectWithinMarkup:function(n,r,i,s,o){var u=r?n.endContainer:n.startContainer,a=this,f=t(u).parents(),l=!1,c=-1;return typeof s!="undefined"&&typeof s!="function"&&e.Log.error(this,"parameter tagComparator is not a function"),typeof s=="undefined"&&(s=function(e,t){return a.standardTextLevelSemanticsComparator(e,t)}),f.length>0&&f.each(function(){if(this===o)return e.Log.debug(a,"reached limit dom obj"),!1;if(s(this,i))return l===!1&&(l=[]),e.Log.debug(a,"reached object equal to markup"),c++,l[c]=this,!0}),l},standardSectionsAndGroupingContentComparator:function(t,n){if(t.nodeType===1){if(n[0].tagName&&e.Selection.replacingElements[t.tagName.toLowerCase()]&&e.Selection.replacingElements[t.tagName.toLowerCase()].indexOf(n[0].tagName.toLowerCase())!=-1)return!0}else e.Log.debug(this,"only element nodes (nodeType == 1) can be compared");return!1},standardTagNameComparator:function(t,n){return t.nodeType===1?t.tagName.toLowerCase()!=n[0].tagName.toLowerCase()?!1:!0:(e.Log.debug(this,"only element nodes (nodeType == 1) can be compared"),!1)},standardTextLevelSemanticsComparator:function(t,n){return t.nodeType===1?t.tagName.toLowerCase()!=n[0].tagName.toLowerCase()?!1:this.standardAttributesComparator(t,n)?!0:!1:(e.Log.debug(this,"only element nodes (nodeType == 1) can be compared"),!1)},standardAttributesComparator:function(t,n){var r,i,s,o,u,a,f,l;t=t.cloneNode(!1);if(t.attributes&&t.attributes.length&&t.attributes.length>0)for(r=0,l=t.attributes.length;r<l;r++)i=t.attributes[r],i.nodeName.toLowerCase()=="class"&&i.nodeValue.length>0&&(s=i.nodeValue,o=s.split(" "));if(n[0].attributes&&n[0].attributes.length&&n[0].attributes.length>0)for(r=0,f=n[0].attributes.length;r<f;r++)i=n[0].attributes[r],i.nodeName.toLowerCase()=="class"&&i.nodeValue.length>0&&(s=i.nodeValue,u=s.split(" "));if(o&&!u||u&&!o)return e.Log.debug(this,"tag comparison for <"+t.tagName.toLowerCase()+"> failed because one element has classes and the other has not"),!1;if(o&&u&&o.length!=u.length)return e.Log.debug(this,"tag comparison for <"+t.tagName.toLowerCase()+"> failed because of a different amount of classes"),!1;if(o&&u&&o.length===u.length&&o.length!==0)for(r=0,a=o.length;r<a;r++)if(!n.hasClass(o[r]))return e.Log.debug(this,"tag comparison for <"+t.tagName.toLowerCase()+"> failed because of different classes"),!1;return!0},changeMarkup:function(n,r,i){var s=r[0].tagName.toLowerCase(),o,u,a,f=this.isRangeObjectWithinMarkup(n,!1,r,i,u),l=this.isRangeObjectWithinMarkup(n,!0,r,i,u),c,h,p,d,v;if(this.replacingElements[s])a=n,n=new this.SelectionRange(n),e.activeEditable?o=e.activeEditable.obj.get(0):o=t("body"),n.update(o),r.isReplacingElement=!0;else if(n.isCollapsed())return e.Log.debug(this,"early returning from applying markup because nothing is currently selected"),!1;e.activeEditable?u=e.activeEditable.obj[0]:u=t("body"),!r.isReplacingElement&&n.startOffset===0&&(p=this.getTextNodeSibling(!1,n.commonAncestorContainer.parentNode,n.startContainer))&&(d=this.isRangeObjectWithinMarkup({startContainer:p,startOffset:0},!1,r,i,u)),!r.isReplacingElement&&n.endOffset===n.endContainer.length&&(c=this.getTextNodeSibling(!0,n.commonAncestorContainer.parentNode,n.endContainer))&&(h=this.isRangeObjectWithinMarkup({startContainer:c,startOffset:0},!1,r,i,u));if(!r.isReplacingElement&&f&&!l)e.Log.info(this,"markup 2 non-markup"),this.prepareForRemoval(n.getSelectionTree(),r,i),t(f).addClass("preparedForRemoval"),this.insertCroppedMarkups(f,n,!1,i);else if(!r.isReplacingElement&&f&&l)e.Log.info(this,"markup 2 markup"),this.prepareForRemoval(n.getSelectionTree(),r,i),this.splitRelevantMarkupObject(f,l,n,i);else if(!r.isReplacingElement&&(!f&&l||h||d))e.Log.info(this,"non-markup 2 markup OR with next2markup"),d&&h?(v=new e.Selection.SelectionRange(n),v.startContainer=t(d[d.length-1]).textNodes()[0],v.startOffset=0,v.endContainer=t(h[h.length-1]).textNodes().last()[0],v.endOffset=v.endContainer.length,v.update(),this.applyMarkup(v.getSelectionTree(),n,r,i),e.Log.info(this,"double extending previous markup(previous and after selection), actually wrapping it ...")):d&&!h&&!l?(this.extendExistingMarkupWithSelection(d,n,!1,i),e.Log.info(this,"extending previous markup")):d&&!h&&l?(v=new e.Selection.SelectionRange(n),v.startContainer=t(d[d.length-1]).textNodes()[0],v.startOffset=0,v.endContainer=t(l[l.length-1]).textNodes().last()[0],v.endOffset=v.endContainer.length,v.update(),this.applyMarkup(v.getSelectionTree(),n,r,i),e.Log.info(this,"double extending previous markup(previous and relevant at the end), actually wrapping it ...")):!d&&h?(this.extendExistingMarkupWithSelection(h,n,!0,i),e.Log.info(this,"extending following markup backwards")):this.extendExistingMarkupWithSelection(l,n,!0,i);else if(r.isReplacingElement||!f&&!l&&!d&&!h)e.Log.info(this,"non-markup 2 non-markup"),this.applyMarkup(n.getSelectionTree(),n,r,i,{setRangeObject2NewMarkup:!0});t(".preparedForRemoval").zap(),n.update(),r.isReplacingElement?a.select():n.select()},areMarkupObjectsAsLongAsRangeObject:function(e,n,r){var i,s,o,u,a;if(r.startOffset!==0)return!1;for(i=0,a=e.length;i<a;i++){s=t(e[i]);if(s.textNodes().first()[0]!==r.startContainer)return!1}for(i=0,u=n.length;i<u;i++){s=t(n[i]),o=s.textNodes().last()[0];if(o!==r.endContainer||o.length!=r.endOffset)return!1}return!0},splitRelevantMarkupObject:function(e,n,r,i){t(e).addClass("preparedForRemoval"),t(n).addClass("preparedForRemoval");if(this.areMarkupObjectsAsLongAsRangeObject(e,n,r))return!0;var s=this.intersectRelevantMarkupObjects(e,n);return s?(this.insertCroppedMarkups([s],r,!1,i),this.insertCroppedMarkups([s],r,!0,i)):(this.insertCroppedMarkups(e,r,!1,i),this.insertCroppedMarkups(n,r,!0,i)),!0},intersectRelevantMarkupObjects:function(e,t){var n=!1,r,i,s,o,u,a;if(!e||!t)return n;u=e.length,a=t.length;for(r=0;r<u;r++){i=e[r];for(s=0;s<a;s++)o=t[s],i===o&&(n=i)}return n},extendExistingMarkupWithSelection:function(e,n,r,i){var s,o,u,a,f,l,c,h;r||(s=!0),r&&(o=!0),u=[];for(a=0,f=e.length;a<f;a++)u[a]=new this.SelectionRange,l=e[a],o&&!s&&(u[a].startContainer=n.startContainer,u[a].startOffset=n.startOffset,c=t(l).textNodes(!0),h=c.length-1,u[a].endContainer=c[h],u[a].endOffset=c[h].length,u[a].update(),this.applyMarkup(u[a].getSelectionTree(),n,this.getClonedMarkup4Wrapping(l),i,{setRangeObject2NewMarkup:!0})),!o&&s&&(c=t(l).textNodes(!0),u[a].startContainer=c[0],u[a].startOffset=0,u[a].endContainer=n.endContainer,u[a].endOffset=n.endOffset,u[a].update(),this.applyMarkup(u[a].getSelectionTree(),n,this.getClonedMarkup4Wrapping(l),i,{setRangeObject2NewMarkup:!0}));return!0},getClonedMarkup4Wrapping:function(e){var n=t(e).clone().removeClass("preparedForRemoval").empty();return n.attr("class").length===0&&n.removeAttr("class"),n},insertCroppedMarkups:function(e,n,r,i){var s,o,u,a,f,l,c;r?o=!0:s=!0,a=[];for(f=0;f<e.length;f++){a[f]=new this.SelectionRange,l=e[f];if(s&&!o){c=t(l).textNodes(!0),a[f].startContainer=c[0],a[f].startOffset=0;if(a[f].startContainer===n.startContainer&&a[f].startOffset===n.startOffset)continue;n.startOffset===0?(a[f].endContainer=this.getTextNodeSibling(!1,l,n.startContainer),a[f].endOffset=a[f].endContainer.length):(a[f].endContainer=n.startContainer,a[f].endOffset=n.startOffset),a[f].update(),this.applyMarkup(a[f].getSelectionTree(),n,this.getClonedMarkup4Wrapping(l),i,{setRangeObject2NextSibling:!0})}!s&&o&&(a[f].startContainer=n.endContainer,a[f].startOffset=n.endOffset,u=t(l).textNodes(!0),a[f].endContainer=u[u.length-1],a[f].endOffset=u[u.length-1].length,a[f].update(),this.applyMarkup(a[f].getSelectionTree(),n,this.getClonedMarkup4Wrapping(l),i,{setRangeObject2PreviousSibling:!0}))}return!0},changeMarkupOnSelection:function(e){this.changeMarkup(this.getRangeObject(),e,this.getStandardTagComparator(e)),s.Utils.Dom.doCleanup({merge:!0},this.rangeObject),this.rangeObject.update(),this.rangeObject.select()},applyMarkup:function(t,n,r,i,s){var o,u,a,f;s=s?s:{},this.prepareForRemoval(t,r,i),o=this.optimizeSelectionTree4Markup(t,r,i),f=!0;for(u=0;u<o.length;u++)a=o[u],a.wrappable?this.wrapMarkupAroundSelectionTree(a.elements,n,r,i,s):(e.Log.debug(this,"dive further into non-wrappable object"),this.applyMarkup(a.element.children,n,r,i,s))},getMarkupType:function(n){var r=t(n)[0].nodeName.toLowerCase();n.outerHtml&&e.Log.debug(this,"Node name detected: "+r+" for: "+n.outerHtml());if(r=="#text")return"textNode";if(this.replacingElements[r])return"sectionOrGroupingContent";if(this.tagHierarchy[r])return"textLevelSemantics";e.Log.warn(this,"unknown markup passed to this.getMarkupType(...): "+n.outerHtml())},getStandardTagComparator:function(e){var t=this,n;switch(this.getMarkupType(e)){case"textNode":n=function(e,t){return!1};break;case"sectionOrGroupingContent":n=function(e,n){return t.standardSectionsAndGroupingContentComparator(e,n)};break;case"textLevelSemantics":default:n=function(
e,n){return t.standardTextLevelSemanticsComparator(e,n)}}return n},prepareForRemoval:function(n,r,i){var s=this,o,u;typeof i!="undefined"&&typeof i!="function"&&e.Log.error(this,"parameter tagComparator is not a function"),typeof i=="undefined"&&(i=this.getStandardTagComparator(r));for(o=0;o<n.length;o++)u=n[o],u.domobj&&(u.selection=="full"||u.selection=="partial"&&r.isReplacingElement)&&u.domobj.nodeType===1&&i(u.domobj,r)&&(e.Log.debug(this,"Marking for removal: "+u.domobj.nodeName),t(u.domobj).addClass("preparedForRemoval")),u.selection!="none"&&u.children.length>0&&this.prepareForRemoval(u.children,r,i)},wrapMarkupAroundSelectionTree:function(n,r,i,s,o){var u=[],a=-1,f=!0,l="",c="",h,p,d,v,m,g,y;e.Log.debug(this,"The formatting <"+i[0].tagName+"> will be wrapped around the selection");for(m=0;m<n.length;m++){g=n[m];if(g.domobj&&!this.canTag1WrapTag2(g.domobj.parentNode.tagName.toLowerCase(),i[0].tagName.toLowerCase())){e.Log.info(this,"Skipping the wrapping of <"+i[0].tagName.toLowerCase()+"> because this tag is not allowed inside <"+g.domobj.parentNode.tagName.toLowerCase()+">");continue}if(g.domobj&&g.domobj.nodeType===3&&t.trim(g.domobj.nodeValue).length===0)continue;if(g.domobj&&g.selection=="partial"&&!i.isReplacingElement)if(g.startOffset!==undefined&&g.endOffset===undefined)a++,l+=g.domobj.data.substr(0,g.startOffset),g.domobj.data=g.domobj.data.substr(g.startOffset,g.domobj.data.length-g.startOffset),u[a]=g.domobj;else if(g.endOffset!==undefined&&g.startOffset===undefined)a++,c+=g.domobj.data.substr(g.endOffset,g.domobj.data.length-g.endOffset),g.domobj.data=g.domobj.data.substr(0,g.endOffset),u[a]=g.domobj;else if(g.endOffset!==undefined&&g.startOffset!==undefined){if(g.startOffset==g.endOffset){e.Log.debug(this,"skipping empty selection");continue}a++,l+=g.domobj.data.substr(0,g.startOffset),y=g.domobj.data.substr(g.startOffset,g.endOffset-g.startOffset),c+=g.domobj.data.substr(g.endOffset,g.domobj.data.length-g.endOffset),g.domobj.data=y,u[a]=g.domobj}else e.Log.debug(this,"diving into object"),this.applyMarkup(g.children,r,i,s,o);g.domobj&&(g.selection=="full"||g.selection=="partial"&&i.isReplacingElement)&&(a++,u[a]=g.domobj)}u.length>0&&(u=t(u),t.each(u,function(e,n){t.browser.msie&&n.nodeType==3&&!n.nextSibling&&!n.previousSibling&&n.parentNode&&n.parentNode.nodeName.toLowerCase()=="li"&&(n.data=t.trim(n.data))}),v=u.wrapAll(i).parent(),v.before(l).after(c),o.setRangeObject2NewMarkup&&(d=u.textNodes(),d.index(r.startContainer)!=-1&&(r.startOffset=0),d.index(r.endContainer)!=-1&&(r.endOffset=r.endContainer.length),f=!0),o.setRangeObject2NextSibling&&(h=!0,p=v.textNodes(!0).last()[0],u.index(r.startContainer)!=-1&&(r.startContainer=this.getTextNodeSibling(h,v.parent(),p),r.startOffset=0),u.index(r.endContainer)!=-1&&(r.endContainer=this.getTextNodeSibling(h,v.parent(),p),r.endOffset=r.endOffset-p.length)),o.setRangeObject2PreviousSibling&&(h=!1,p=v.textNodes(!0).first()[0],u.index(r.startContainer)!=-1&&(r.startContainer=this.getTextNodeSibling(h,v.parent(),p),r.startOffset=0),u.index(r.endContainer)!=-1&&(r.endContainer=this.getTextNodeSibling(h,v.parent(),p),r.endOffset=r.endContainer.length)))},getTextNodeSibling:function(e,n,r){var i=t(n).textNodes(!0),s,o;return o=i.index(r),o==-1?!1:(s=o+(e?1:-1),i[s]?i[s]:!1)},optimizeSelectionTree4Markup:function(e,n,r){var i=[],s=0,o=0,u=this,a,f,l,c;typeof r=="undefined"&&(r=function(e,t){return u.standardTextLevelSemanticsComparator(t)});for(a=0;a<e.length;a++)if(e[a].domobj&&e[a].selection!="none")if(n.isReplacingElement&&r(n[0],t(e[a].domobj)))i[s]!==undefined&&s++,i[s]={},i[s].wrappable=!0,i[s].elements=[],i[s].elements[o]=e[a],s++;else if(this.canMarkupBeApplied2ElementAsWhole([e[a]],n)){i[s]===undefined&&(i[s]={},i[s].wrappable=!0,i[s].elements=[]);if(n.isReplacingElement){c=a;for(f=a-1;f>=0;f--){if(!this.canMarkupBeApplied2ElementAsWhole([e[f]],n)||!this.isMarkupAllowedToStealSelectionTreeElement(e[f],n))break;c=f}l=a;for(f=a+1;f<e.length;f++){if(!this.canMarkupBeApplied2ElementAsWhole([e[f]],n)||!this.isMarkupAllowedToStealSelectionTreeElement(e[f],n))break;l=f}o=0;for(f=c;f<=l;f++)i[s].elements[o]=e[f],i[s].elements[o].selection="full",o++;o=0}else i[s].elements[o]=e[a],o++}else i[s]!==undefined&&s++,i[s]={},i[s].wrappable=!1,i[s].element=e[a],o=0,s++;return i},isMarkupAllowedToStealSelectionTreeElement:function(e,t){if(!e.domobj)return!1;var n=e.domobj.nodeName.toLowerCase(),r;return n=n=="#text"?"textNode":n,r=t[0].nodeName.toLowerCase(),this.allowedToStealElements[r]?this.allowedToStealElements[r].indexOf(n)==-1?!1:!0:!1},canMarkupBeApplied2ElementAsWhole:function(e,t){var n,r,i,s;t.jquery&&(n=t[0].tagName),t.tagName&&(n=t.tagName),s=!0;for(r=0;r<e.length;r++){i=e[r];if(i.domobj&&(i.selection!="none"||t.isReplacingElement)){if(!this.canTag1WrapTag2(n,i.domobj.nodeName))return!1;if(i.children.length>0&&!this.canMarkupBeApplied2ElementAsWhole(i.children,t))return!1}}return s},canTag1WrapTag2:function(e,t){e=e=="#text"?"textNode":e.toLowerCase(),t=t=="#text"?"textNode":t.toLowerCase();if(!this.tagHierarchy[e])return!0;if(!this.tagHierarchy[t])return!0;var n=this.tagHierarchy[e],r=n.indexOf(t)!=-1?!0:!1;return r},mayInsertTag:function(t){if(typeof this.rangeObject.unmodifiableMarkupAtStart=="object"){for(var n=0;n<this.rangeObject.unmodifiableMarkupAtStart.length;++n)if(!this.canTag1WrapTag2(this.rangeObject.unmodifiableMarkupAtStart[n].nodeName,t))return!1;return!0}return e.Log.warn(this,"Unable to determine whether tag "+t+" may be inserted"),!0},toString:function(){return"Aloha.Selection"},SelectionRange:s.Utils.RangeObject.extend({_constructor:function(e){this._super(e),e&&(e.commonAncestorContainer&&(this.commonAncestorContainer=e.commonAncestorContainer),e.selectionTree&&(this.selectionTree=e.selectionTree),e.limitObject&&(this.limitObject=e.limitObject),e.markupEffectiveAtStart&&(this.markupEffectiveAtStart=e.markupEffectiveAtStart),e.unmodifiableMarkupAtStart&&(this.unmodifiableMarkupAtStart=e.unmodifiableMarkupAtStart),e.splitObject&&(this.splitObject=e.splitObject))},commonAncestorContainer:undefined,selectionTree:undefined,markupEffectiveAtStart:[],unmodifiableMarkupAtStart:[],limitObject:undefined,splitObject:undefined,select:function(){this._super(),e.Selection.updateSelection()},update:function(e){this.updatelimitObject(),this.updateMarkupEffectiveAtStart(),this.updateCommonAncestorContainer(e),this.selectionTree=undefined},getSelectionTree:function(){return this.selectionTree||(this.selectionTree=e.Selection.getSelectionTree(this)),this.selectionTree},getSelectedSiblings:function(e){var t=this.getSelectionTree();return this.recursionGetSelectedSiblings(e,t)},recursionGetSelectedSiblings:function(e,t){var n=!1,r=!1,i;for(i=0;i<t.length;++i)if(t[i].domobj===e)r=!0,n=[];else if(!r&&t[i].children){n=this.recursionGetSelectedSiblings(e,t[i].children);if(n!==!1)break}else if(r&&t[i].domobj&&t[i].selection!="collapsed"&&t[i].selection!="none")n.push(t[i].domobj);else if(r&&t[i].selection=="none")break;return n},updateMarkupEffectiveAtStart:function(){this.markupEffectiveAtStart=[],this.unmodifiableMarkupAtStart=[];var e=this.getStartContainerParents(),t=!1,n,r,i;for(r=0;r<e.length;r++)i=e[r],!t&&i!==this.limitObject?(this.markupEffectiveAtStart[r]=i,!n&&s.Utils.Dom.isSplitObject(i)&&(n=!0,this.splitObject=i)):(t=!0,this.unmodifiableMarkupAtStart.push(i));n||(this.splitObject=!1);return},updatelimitObject:function(){if(e.editables&&e.editables.length>0){var n=this.getStartContainerParents(),r=e.editables,i,s,o,u;for(i=0;i<n.length;i++){s=n[i];for(o=0;o<r.length;o++){u=r[o].obj[0];if(s===u)return this.limitObject=s,!0}}}return this.limitObject=t("body"),!0},toString:function(e){return e?"Aloha.Selection.SelectionRange {start ["+this.startContainer.nodeValue+"] offset "+this.startOffset+", end ["+this.endContainer.nodeValue+"] offset "+this.endOffset+"}":"Aloha.Selection.SelectionRange"}})}),f=r.extend({_constructor:function(e){this._nativeSelection=e,this.ranges=[],this.preventChange=!1},anchorNode:null,anchorOffset:0,focusNode:null,focusOffset:0,isCollapsed:!1,rangeCount:0,collapse:function(e,t){this._nativeSelection.collapse(e,t)},collapseToStart:function(){throw"NOT_IMPLEMENTED"},extend:function(e,t){},modify:function(e,t,n){},collapseToEnd:function(){throw"NOT_IMPLEMENTED"},selectAllChildren:function(e){throw"NOT_IMPLEMENTED"},deleteFromDocument:function(){throw"NOT_IMPLEMENTED"},getRangeAt:function(e){return a(this._nativeSelection.getRangeAt(e))},addRange:function(t){this._nativeSelection.addRange(t),this._nativeSelection._ranges[0]=a(t),e.Selection.updateSelection()},removeRange:function(e){this._nativeSelection.removeRange()},removeAllRanges:function(){this._nativeSelection.removeAllRanges()},preventedChange:function(e){},isChangedPrevented:function(){},refresh:function(e){},toString:function(){return"Aloha.Selection"},getRangeCount:function(){return this._nativeSelection.rangeCount}});e.getSelection=function(e){var e=e!==document||e!==window?window:e;return new f(window.rangy.getSelection(e))},e.createRange=function(e){return window.rangy.createRange(e)};var l=new o;return e.Selection=l,l}),define("aloha/markup",["aloha/core","util/class","aloha/jquery","aloha/ecma5shims"],function(e,t,n,r){function o(e){return"BR"===e.nodeName}function u(e){return"false"===n(e).attr("contenteditable")}function a(e){return e&&3===e.nodeType}function f(e){return e?a(e)?e.length:e.childNodes.length:0}function l(e){return e?e.nextSibling?a(e.nextSibling)&&!h(e.nextSibling)?l(e.nextSibling):o(e.nextSibling)&&e.nextSibling===e.parentNode.lastChild?l(e.nextSibling):""===e.nextSibling.innerHTML&&!u(e.nextSibling)?l(e.nextSibling):e.nextSibling:e.parentNode?l(e.parentNode):null:null}function c(e){return e?e.previousSibling?a(e.previousSibling)&&!h(e.previousSibling)?c(e.previousSibling):""===e.previousSibling.innerHTML&&!u(e.previousSibling)?c(e.previouSibling):e.previousSibling:e.parentNode?c(e.parentNode):null:null}function h(e){return 0<e.data.replace(/\s+/g,"").length}function p(e,t){return 0===t||t<=e.data.length-e.data.replace(/^\s+/,"").length}function d(e){return e.parent().hasClass("aloha-editable")}function v(e,t){var n=f(e);if(n===t)return!0;var r=a(e);return r&&e.data.replace(/\s+$/,"").length===t?!0:1===n&&!r?o(e.childNodes[0]):!1}function m(e){return n(e).stop(!0).css({opacity:0}).fadeIn(0).delay(100).fadeIn(function(){n(e).css({opacity:1})}),e}function g(t,r){var o=new i.Utils.RangeObject,a=r?c(t):l(t);if(!a||u(a)){var h=n("<div>&nbsp;</div>");r?n(t).before(h):n(t).after(h),o.startContainer=o.endContainer=h[0],o.startOffset=o.endOffset=0,w(o),window.$_alohaPlaceholder=h}else o.startContainer=o.endContainer=a,o.startOffset=o.endOffset=r?f(a):s?1:0,w(o);o.select(),e.trigger("aloha-block-selected",t),e.Selection.preventSelectionChanged()}function y(e,t){return s?r.compareDocumentPosition(e,t)&16:0<n(e).find(t).length}function b(e){var t=e.startContainer,n=e.endContainer,r=window.$_alohaPlaceholder;return r.is(t)||r.is(n)||y(r[0],t)||y(r[0],n)}function w(e){window.$_alohaPlaceholder&&!b(e)&&(0===window.$_alohaPlaceholder.html().replace(/^(&nbsp;)*$/,"").length&&window.$_alohaPlaceholder.remove(),window.$_alohaPlaceholder=null)}var i=window.GENTICS,s=!!(n.browser.msie&&9>parseInt(n.browser.version,10));return e.Markup=t.extend({keyHandlers:{},addKeyHandler:function(e,t){this.keyHandlers[e]||(this.keyHandlers[e]=[]),this.keyHandlers[e].push(t)},insertBreak:function(){var t=e.Selection.rangeObject,r,s,o;t.isCollapsed()||this.removeSelectedMarkup(),o=n("<br/>"),i.Utils.Dom.insertIntoDOM(o,t,e.activeEditable.obj),s=i.Utils.Dom.searchAdjacentTextNode(o.parent().get(0),i.Utils.Dom.getIndexInParent(o.get(0))+1,!1),s&&(nonWSIndex=s.data.search(/\S/),nonWSIndex>0&&(s.data=s.data.substring(nonWSIndex))),t.startContainer=t.endContainer=o.get(0).parentNode,t.startOffset=t.endOffset=i.Utils.Dom.getIndexInParent(o.get(0))+1,t.correctRange(),t.clearCaches(),t.select()},preProcessKeyStrokes:function(t){if(t.type!=="keydown")return!1;var n=e.Selection.rangeObject,r,i;if(this.keyHandlers[t.keyCode]){r=this.keyHandlers[t.keyCode];for(i=0;i<r.length;++i)if(!r[i](t))return!1}return t.keyCode===37||t.keyCode===39?this.processCursor(n,t.keyCode)?(w(e.Selection.rangeObject),!0):!1:t.keyCode===8?(t.preventDefault(),e.execCommand("delete",!1),!1):t.keyCode===46?(e.execCommand("forwarddelete",!1),!1):t.keyCode===13?t.shiftKey?(e.execCommand("insertlinebreak",!1),!1):(e.execCommand("insertparagraph",!1),!1):!0},processCursor:function(e,t){if(!e.isCollapsed())return!0;var r=e.startContainer;if(!r)return!0;var i;if(s){var o=n(r).parents("[contenteditable=false]"),h=o.length>0;if(h){if(!d(o))return!0;i=o[0]}}if(!i){var m=37===t||38===t,y=e.startOffset;if(a(r)){if(m){var b=s&&1===y;if(!b&&!p(r,y))return!0}else if(!v(r,y))return!0}else r=r.childNodes[y===f(r)?y-1:y];i=m?c(r):l(r)}return u(i)?(g(i,m),!1):!0},processShiftEnter:function(e){this.insertHTMLBreak(e.getSelectionTree(),e)},processEnter:function(e){e.splitObject?this.splitRangeObject(e):this.insertHTMLBreak(e.getSelectionTree(),e)},insertHTMLCode:function(t){var r=e.Selection.rangeObject;this.insertHTMLBreak(r.getSelectionTree(),r,n(t))},insertHTMLBreak:function(t,r,s){var o,u,a,f,l,c,h,p,d;s=s?s:n("<br/>");for(o=0,u=t.length;o<u;++o){a=t[o],f=a.domobj?n(a.domobj):undefined;if(a.selection!=="none")if(a.selection=="collapsed")o>0?(l=n(t[o-1].domobj),l.after(s)):(c=n(t[1].domobj),c.before(s)),r.startContainer=r.endContainer=s[0].parentNode,r.startOffset=r.endOffset=i.Utils.Dom.getIndexInParent(s[0])+1,r.correctRange();else if(a.domobj&&a.domobj.nodeType===3){a.domobj.nextSibling&&a.domobj.nextSibling.nodeType==1&&e.Selection.replacingElements[a.domobj.nextSibling.nodeName.toLowerCase()]&&f.after("<br/>");if(this.needEndingBreak()){d=a.domobj;while(d)if(d.nextSibling)d=!1;else{d=d.parentNode;if(i.Utils.Dom.isBlockLevelElement(d)||i.Utils.Dom.isListElement(d))break;d===r.limitObject&&(d=!1)}d&&n(d).append('<br class="aloha-cleanme" />')}f.between(s,a.startOffset),p=0,h=s[0];while(h)h=h.previousSibling,++p;r.startContainer=s[0].parentNode,r.endContainer=s[0].parentNode,r.startOffset=p,r.endOffset=p,r.correctRange()}else a.domobj&&a.domobj.nodeType===1&&(f.parent().find("br.aloha-ephemera").length===0&&(n(r.limitObject).find("br.aloha-ephemera").remove(),n(r.commonAncestorContainer).append(this.getFillUpElement(r.splitObject))),f.after(s),r.startContainer=r.commonAncestorContainer,r.endContainer=r.startContainer,r.startOffset=o+2,r.endOffset=o+2,r.update())}r.select()},needEndingBreak:function(){return!n.browser.msie},getSelectedText:function(){var t=e.Selection.rangeObject;return t.isCollapsed()?!1:this.getFromSelectionTree(t.getSelectionTree(),!0)},getFromSelectionTree:function(e,t){var r="",i,s,o,u;for(i=0,s=e.length;i<s;i++)o=e[i],o.selection=="partial"?o.domobj.nodeType===3?r+=o.domobj.data.substring(o.startOffset,o.endOffset):o.domobj.nodeType===1&&o.children&&(t?r+=this.getFromSelectionTree(o.children,t):(u=n(o.domobj).clone(!1).empty(),u.html(this.getFromSelectionTree(o.children,t)),r+=u.outerHTML())):o.selection=="full"&&(o.domobj.nodeType===3?r+=n(o.domobj).text():o.domobj.nodeType===1&&o.children&&(r+=t?n(o.domobj).text():n(o.domobj).outerHTML()));return r},getSelectedMarkup:function(){var t=e.Selection.rangeObject;return t.isCollapsed()?null:this.getFromSelectionTree(t.getSelectionTree(),!1)},removeSelectedMarkup:function(){var t=e.Selection.rangeObject,n;if(t.isCollapsed())return;n=new e.Selection.SelectionRange,this.removeFromSelectionTree(t.getSelectionTree(),n),n.update(),i.Utils.Dom.doCleanup({merge:!0,removeempty:!0},e.Selection.rangeObject),e.Selection.rangeObject=n,n.correctRange(),n.update(),n.select(),e.Selection.updateSelection()},removeFromSelectionTree:function(e,t){var r,s,o,u,a,f;for(o=0,f=e.length;o<f;o++)u=e[o],u.selection=="partial"?u.domobj.nodeType===3?(s="",u.startOffset>0&&(s+=u.domobj.data.substring(0,u.startOffset)),u.endOffset<u.domobj.data.length&&(s+=u.domobj.data.substring(u.endOffset,u.domobj.data.length)),u.domobj.data=s,t.startContainer||(t.startContainer=t.endContainer=u.domobj,t.startOffset=t.endOffset=u.startOffset)):u.domobj.nodeType===1&&u.children&&(this.removeFromSelectionTree(u.children,t),r?r.nodeName==u.domobj.nodeName&&(n(r).append(n(u.domobj).contents()),n(u.domobj).remove()):r=u.domobj):u.selection=="full"&&(t.startContainer||(a=i.Utils.Dom.searchAdjacentTextNode(u.domobj.parentNode,i.Utils.Dom.getIndexInParent(u.domobj)+1,!1,{blocklevel:!1}),a?(t.startContainer=t.endContainer=a,t.startOffset=t.endOffset=0):(t.startContainer=t.endContainer=u.domobj.parentNode,t.startOffset=t.endOffset=i.Utils.Dom.getIndexInParent(u.domobj)+1)),n(u.domobj).remove())},splitRangeObject:function(t,r){var s=n(t.splitObject),o,u,a;t.update(t.splitObject),o=t.getSelectionTree(),a=this.getSplitFollowUpContainer(t),this.splitRangeObjectHelper(o,t,a),a.hasClass("preparedForRemoval")&&a.removeClass("preparedForRemoval"),u=this.getInsertAfterObject(t,a),n(a).insertAfter(u),t.splitObject.nodeName.toLowerCase()==="li"&&!e.Selection.standardTextLevelSemanticsComparator(t.splitObject,a)&&n(t.splitObject).remove(),t.startContainer=null;var f=a.contents();f.length>0&&f.get(0).nodeType==1&&f.get(0).nodeName.toLowerCase()==="br"&&(t.startContainer=a.get(0)),t.startContainer||(t.startContainer=a.textNodes(!0,!0).first().get(0)),t.startContainer||(t.startContainer=a.textNodes(!1).first().parent().get(0)),t.startContainer?(t.endContainer=t.startContainer,t.startOffset=0,t.endOffset=0):(t.startContainer=t.endContainer=a.parent().get(0),t.startOffset=t.endOffset=i.Utils.Dom.getIndexInParent(a.get(0))),t.update(),t.select()},getInsertAfterObject:function(t,r){var i,s,o;for(s=0;s<t.markupEffectiveAtStart.length;s++){o=t.markupEffectiveAtStart[s],o===t.splitObject&&(i=!0);if(!i)continue;if(e.Selection.canTag1WrapTag2(n(o).parent()[0].nodeName,r[0].nodeName))return o}return!1},getFillUpElement:function(e){return n.browser.msie?!1:n('<br class="aloha-cleanme"/>')},removeElementContentWhitespaceObj:function(e){var t=0,n=[],r,i,s;for(r=0;r<e.length;++r)i=e[r],i.isElementContentWhitespace&&(n[n.length]=r);for(r=0;r<n.length;++r)s=n[r],e.splice(s-t,1),++t},splitRangeObjectHelper:function(t,r,s,o){s||e.Log.warn(this,"no followUpContainer, no inBetweenMarkup, nothing to do...");var u=this.getFillUpElement(r.splitObject),a=n(r.splitObject),f=!1,l,c,h,p,d,v,m;if(t.length>0){d=s.contents(),d.length!==t.length&&this.removeElementContentWhitespaceObj(d);for(c=0,m=t.length;c<m;++c){l=t[c];if(l.selection==="none"&&f===!1||l.domobj&&l.domobj.nodeType===3&&l===t[t.length-1]&&l.startOffset===l.domobj.data.length){s.textNodes().length>1||l.domobj.nodeType===1&&l.children.length===0?d.eq(c).remove():i.Utils.Dom.isSplitObject(s[0])?u?s.html(u):s.empty():(s.empty(),s.addClass("preparedForRemoval"));continue}l.selection!=="none"?(l.domobj&&l.domobj.nodeType===3&&l.startOffset!==undefined&&(h=l.domobj.data,l.startOffset>0?l.domobj.data=h.substr(0,l.startOffset):t.length>1?n(l.domobj).remove():(v=n(l.domobj).parent(),i.Utils.Dom.isSplitObject(v[0])?u?v.html(u):v.empty():v.remove()),h.length-l.startOffset>0?d[c].data=h.substr(l.startOffset,h.length):d.length>1?d.eq(c).remove():i.Utils.Dom.isBlockLevelElement(s[0])?u?s.html(u):s.empty():(s.empty(),s.addClass("preparedForRemoval"))),f=!0,l.children.length>0&&this.splitRangeObjectHelper(l.children,r,d.eq(c),o)):l.selection==="none"&&f===!0&&(p=n(l.domobj).remove())}}else e.Log.error(this,"can not split splitObject due to an empty selection tree");a.find("br.aloha-ephemera:gt(0)").remove(),s.find("br.aloha-ephemera:gt(0)").remove(),a.find(".preparedForRemoval").remove(),s.find(".preparedForRemoval").remove(),a.contents().length===0&&i.Utils.Dom.isSplitObject(a[0])&&u&&a.html(u),s.contents().length===0&&i.Utils.Dom.isSplitObject(s[0])&&u&&s.html(u)},getSplitFollowUpContainer:function(e){var t=e.splitObject.nodeName.toLowerCase(),r,i,s;switch(t){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":s=n(e.splitObject).textNodes(":not(.aloha-cleanme)").last()[0];if(s&&e.startContainer===s&&e.startOffset===s.length)return r=n("<p></p>"),i=n(e.splitObject).clone().contents(),r.append(i),r;break;case"li":if(e.startContainer.nodeName.toLowerCase()==="br"&&n(e.startContainer).hasClass("aloha-ephemera"))return r=n("<p></p>"),i=n(e.splitObject).clone().contents(),r.append(i),r;if(!e.splitObject.nextSibling&&n.trim(n(e.splitObject).text()).length===0)return r=n("<p></p>"),r}return n(e.splitObject).clone()},transformDomObject:function(e,t,r){var i=n(e),s=n("<"+t+"></"+t+">"),o;if(i[0].attributes)for(o=0;o<i[0].attributes.length;++o)s.attr(i[0].attributes[o].nodeName,i[0].attributes[o].nodeValue);return i[0].style&&i[0].style.cssText&&(s[0].style.cssText=i[0].style.cssText),i.contents().appendTo(s),i.replaceWith(s),r&&(r.startContainer==e&&(r.startContainer=s.get(0)),r.endContainer==e&&(r.endContainer=s.get(0))),s},toString:function(){return"Aloha.Markup"}}),e.Markup=new e.Markup,e.Markup}),define("aloha/observable",["aloha/jquery"],function(e,t){var n=e;return{_eventHandlers:null,bind:function(e,t,n){this._eventHandlers=this._eventHandlers||{},this._eventHandlers[e]||(this._eventHandlers[e]=[]),this._eventHandlers[e].push({handler:t,scope:n?n:window})},unbind:function(e,t){this._eventHandlers=this._eventHandlers||{};if(!this._eventHandlers[e])return;t?this._eventHandlers[e]=n.grep(this._eventHandlers[e],function(e){return e.handler===t?!1:!0}):this._eventHandlers[e]=[]},trigger:function(e){this._eventHandlers=this._eventHandlers||{};if(!this._eventHandlers[e])return;var t=[];n.each(arguments,function(e,n){e>0&&t.push(n)}),n.each(this._eventHandlers[e],function(e,n){n.handler.apply(n.scope,t)})},unbindAll:function(){this._eventHandlers=null}}}),define("aloha/registry",["aloha/jquery","aloha/observable"],function(e,t){return Class.extend(t,{_entries:null,_constructor:function(){this._entries={}},register:function(e,t){this._entries[e]=t,this.trigger("register",t,e)},unregister:function(e){var t=this._entries[e];delete this._entries[e],this.trigger("unregister",t,e)},get:function(e){return this._entries[e]},has:function(e){return this._entries[e]?!0:!1},getEntries:function(){return e.extend({},this._entries)}})}),define("aloha/contenthandlermanager",["aloha/jquery","aloha/registry"],function(e,t){return new(t.extend({createHandler:function(e){if(typeof e.handleContent!="function")throw"ContentHandler has no function handleContent().";var t=Class.extend({handleContent:function(e){}},e);return new t},handleContent:function(t,n){var r,i=this.getEntries();if(typeof n.contenthandler=="undefined"){n.contenthandler=[];for(r in i)i.hasOwnProperty(r)&&n.contenthandler.push(r)}for(r in i)if(i.hasOwnProperty(r)){if(e.inArray(r,n.contenthandler)<0)continue;typeof i[r].handleContent=="function"?t=i[r].handleContent(t,n):console.error("A valid content handler needs the method handleContent.")}return t}}))}),define("aloha/editable",["aloha/core","util/class","aloha/jquery","aloha/pluginmanager","aloha/floatingmenu","aloha/selection","aloha/markup","aloha/contenthandlermanager","aloha/console"],function(e,t,n,r,i,s,o,u,a){var f=window.unescape,l=window.GENTICS,c=!1;e.defaults.contentHandler={},e.defaults.contentHandler.initEditable=["sanitize"],e.defaults.contentHandler.getContents=["sanitize"],typeof e.settings.contentHandler=="undefined"&&(e.settings.contentHandler={});var h=function(e){return n(e).html()},p=h;e.Editable=t.extend({_constructor:function(t){t.attr("id")||t.attr("id",l.Utils.guid()),this.obj=t,this.originalObj=t,this.ready=!1,this.sccDelimiters=[":",";",".","!","?",",",f("%u0009"),f("%u0020"),f("%u0008"),f("%u007F"),"Enter"],this.sccIdle=5e3,this.sccDelay=500,this.sccTimerIdle=!1,this.sccTimerDelay=!1,this.keyCodeMap={93:"Apps",18:"Alt",20:"CapsLock",17:"Control",40:"Down",35:"End",13:"Enter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",36:"Home",45:"Insert",37:"Left",224:"Meta",34:"PageDown",33:"PageUp",19:"Pause",44:"PrintScreen",39:"Right",145:"Scroll",16:"Shift",38:"Up",91:"Win",92:"Win"},this.placeholderClass="aloha-placeholder",e.registerEditable(this),this.init()},init:function(){var t=this;this.settings=e.settings,e.settings&&e.settings.smartContentChange&&(e.settings.smartContentChange.delimiters&&(this.sccDelimiters=e.settings.smartContentChange.delimiters),e.settings.smartContentChange.idle&&(this.sccIdle=e.settings.smartContentChange.idle),e.settings.smartContentChange.delay&&(this.sccDelay=e.settings.smartContentChange.delay));if(!this.check(this.obj)){this.destroy();return}typeof e.settings.contentHandler.initEditable=="undefined"&&(e.settings.contentHandler.initEditable=e.defaults.contentHandler.initEditable);var r=t.obj.html();r=u.handleContent(r,{contenthandler:e.settings.contentHandler.initEditable}),t.obj.html(r),e.bind("aloha-ready",function(){t.obj.addClass("aloha-editable").contentEditable(!0),t.obj.mousedown(function(n){if(!e.eventHandled)return e.eventHandled=!0,t.activate(n)}),t.obj.mouseup(function(t){e.eventHandled=!1}),t.obj.focus(function(e){return t.activate(e)}),t.obj.keydown(function(e){var n=o.preProcessKeyStrokes(e);return t.keyCode=e.which,n||t.smartContentChange(e),n}),t.obj.keypress(function(t){e.activeEditable.smartContentChange(t)}),t.obj.keyup(function(t){if(t.keyCode===27)return e.deactivateEditable(),!1}),t.obj.contentEditableSelectionChange(function(e){return s.onChange(t.obj,e),t.obj}),t.setUnmodified(),t.snapshotContent=t.getContents(),n.browser.mozilla&&t.initEmptyEditable(),t.initPlaceholder(),t.ready=!0,e.trigger("aloha-editable-created",[t])})},isActive:!1,originalContent:null,range:undefined,check:function(){var e=this,t=this.obj,r=t.get(0),i=r.nodeName.toLowerCase(),s=["a","abbr","address","article","aside","b","bdo","blockquote","cite","code","command","del","details","dfn","div","dl","em","footer","h1","h2","h3","h4","h5","h6","header","i","ins","menu","nav","p","pre","q","ruby","section","small","span","strong","sub","sup","var"],o,u;for(o=0;o<s.length;++o)if(i===s[o])return!0;switch(i){case"label":case"button":break;case"textarea":return u=n('<div id="'+this.getId()+'-aloha" class="aloha-textarea" />').insertAfter(t),u.height(t.height()).width(t.width()).html(t.val()),t.hide(),t.parents("form:first").submit(function(){t.val(e.getContents())}),this.obj=u,!0;default:}return!1},initPlaceholder:function(){e.settings.placeholder&&this.isEmpty()&&this.addPlaceholder()},isEmpty:function(){var e=n.trim(this.getContents()),t=e==="<br>"?!0:!1;return e.length===0||t},initEmptyEditable:function(){var e=this.obj;this.empty(this.getContents())&&n(e).prepend('<br class="aloha-cleanme" />')},addPlaceholder:function(){var t=n("<div>"),r=n("<span>"),i,s=this.obj;l.Utils.Dom.allowsNesting(s[0],t[0])?i=t:i=r,n(s).append(i.addClass(this.placeholderClass)),n.each(e.settings.placeholder,function(e,t){s.is(e)&&i.html(t)}),n("br",s).remove()},removePlaceholder:function(e,t){var r=this.placeholderClass,i;if(t===!0){i=s.getRangeObject();if(!i.select)return;i.startContainer=i.endContainer=e.get(0),i.startOffset=i.endOffset=0,i.select(),window.setTimeout(function(){n("."+r,e).remove()},20)}else n("."+r,e).remove()},destroy:function(){this===e.getActiveEditable()&&(this.blur(),i.hide());switch(this.originalObj.get(0).nodeName.toLowerCase()){case"label":case"button":break;case"textarea":this.originalObj.val(this.getContents()),this.obj.remove(),this.originalObj.show();break;default:}this.ready=!1,this.removePlaceholder(this.obj),this.obj.removeClass("aloha-editable").contentEditable(!1).unbind("mousedown click dblclick focus keydown keypress keyup"),e.trigger("aloha-editable-destroyed",[this]),e.unregisterEditable(this)},setUnmodified:function(){this.originalContent=this.getContents()},isModified:function(){return this.originalContent!==this.getContents()},toString:function(){return"Aloha.Editable"},isDisabled:function(){return!this.obj.contentEditable()||this.obj.contentEditable()==="false"},disable:function(){return this.isDisabled()||this.obj.contentEditable(!1)},enable:function(){return this.isDisabled()&&this.obj.contentEditable(!0)},activate:function(t){var n=e.getActiveEditable();if(c){c=!1;return}if(t&&t.type==="focus"&&n!==null&&n.obj.parent().get(0)===t.currentTarget)return;if(this.isActive||this.isDisabled())return;this.obj.addClass("aloha-editable-active"),e.activateEditable(this),c=!0,this.removePlaceholder(this.obj,!0),c=!1,this.isActive=!0,e.trigger("aloha-editable-activated",{oldActive:n,editable:this})},blur:function(){this.obj.blur(),this.isActive=!1,this.initPlaceholder(),this.obj.removeClass("aloha-editable-active"),e.trigger("aloha-editable-deactivated",{editable:this}),e.activeEditable.smartContentChange({type:"blur"},null)},empty:function(e){return null===e||n.trim(e)===""||e==="<br/>"},getContents:function(e){var t=this.obj.clone(!1);return t.find(".aloha-cleanme").remove(),this.removePlaceholder(t),r.makeClean(t),e?t.contents():p(t[0])},setContents:function(t,n){var r=null;return e.getActiveEditable()===this&&(e.deactivateEditable(),r=this),this.obj.html(t),null!==r&&r.activate(),this.smartContentChange({type:"set-contents"}),n?this.obj.contents():p(this.obj[0])},getId:function(){return this.obj.attr("id")},smartContentChange:function(t){var r=this,i=null,s,o;if(t&&(t.metaKey||t.crtlKey||t.altKey))return!1;t&&t.originalEvent&&(s=new RegExp("U\\+(\\w{4})"),o=s.exec(t.originalEvent.keyIdentifier),t.originalEvent.keyIdentifier&&!1?(o!==null&&(i=f("%u"+o[1])),i===null&&(i=t.originalEvent.keyIdentifier)):i=this.keyCodeMap[this.keyCode]||String.fromCharCode(t.which)||"unknown"),n.inArray(i,this.sccDelimiters)>=0?(clearTimeout(this.sccTimerIdle),clearTimeout(this.sccTimerDelay),this.sccTimerDelay=setTimeout(function(){e.trigger("aloha-smart-content-changed",{editable:r,keyIdentifier:t.originalEvent.keyIdentifier,keyCode:t.keyCode,"char":i,triggerType:"keypress",snapshotContent:r.getSnapshotContent()}),a.debug("Aloha.Editable","smartContentChanged: event type keypress triggered")},this.sccDelay)):t&&t.type==="paste"?e.trigger("aloha-smart-content-changed",{editable:r,keyIdentifier:null,keyCode:null,"char":null,triggerType:"paste",snapshotContent:r.getSnapshotContent()}):t&&t.type==="blur"?e.trigger("aloha-smart-content-changed",{editable:r,keyIdentifier:null,keyCode:null,"char":null,triggerType:"blur",snapshotContent:r.getSnapshotContent()}):i!==null&&(clearTimeout(this.sccTimerDelay),clearTimeout(this.sccTimerIdle),this.sccTimerIdle=setTimeout(function(){e.trigger("aloha-smart-content-changed",{editable:r,keyIdentifier:null,keyCode:null,"char":null,triggerType:"idle",snapshotContent:r.getSnapshotContent()})},this.sccIdle))},getSnapshotContent:function(){var e=this.snapshotContent;return this.snapshotContent=this.getContents(),e}}),e.Editable.setContentSerializer=function(e){p=e}}),define("aloha/message",["aloha/core","util/class","aloha/jquery"],function(e,t,n){var r=window.GENTICS;e.Message=t.extend({_constructor:function(e){this.title=e.title,this.text=e.text,this.type=e.type,this.callback=e.callback},toString:function(){return this.type+": "+this.message}}),e.Message.Type={CONFIRM:"confirm",ALERT:"alert",WAIT:"wait"},e.MessageLine=t.extend({messages:[],add:function(e){var t="",r=this.messages.length,i;this.messages[r]=e;while(r>4)this.messages.shift(),--r;for(i=0;i<r;i++)t+=this.messages[i].toString()+"<br/>";n("#gtx_aloha_messageline").html(t)}}),e.MessageLine=new e.MessageLine}),define("aloha/plugin",["aloha/core","aloha/jquery","util/class","aloha/pluginmanager","aloha/console"],function(e,t,n,r,i){var s=n.extend({name:null,defaults:{},settings:{},dependencies:[],_constructor:function(e){typeof e!="string"?i.error("Cannot initialise unnamed plugin, skipping"):this.name=e},checkDependencies:function(){var n=!0,r=this;return t.each(this.dependencies,function(){e.isPluginLoaded(this)||(n=!1,i.error("plugin."+r.name,'Required plugin "'+this+'" not found.'))}),n},init:function(){},getEditableConfig:function(e){var n=null,r=!1,i=this;return this.settings.editables&&t.each(this.settings.editables,function(s,o){if(e.is(s)){r=!0;if(o instanceof Array)n=[],n=t.merge(n,o);else if(typeof o=="object"){n={};for(var u in o)o.hasOwnProperty(u)&&(o[u]instanceof Array||(typeof o[u]=="object"?(n[u]={},n[u]=t.extend(!0,n[u],i.config[u],o[u])):n[u]=o[u]))}else n=o}}),r||(typeof this.settings.config=="undefined"||!this.settings.config?n=this.config:n=this.settings.config),n},makeClean:function(e){},getUID:function(e){return i.deprecated("plugin","getUID() is deprecated. Use plugin.name instead."),this.name},i18n:function(t,n){return i.deprecated("plugin","i18n() is deprecated. Use plugin.t() instead."),e.i18n(this,t,n)},toString:function(
){return this.name},log:function(e,t){i.deprecated("plugin","log() is deprecated. Use Aloha.console instead."),i.log(e,this,t)}});return s.create=function(n,i){var o=new(s.extend(i))(n);return o.settings=t.extendObjects(!0,o.defaults,e.settings[n]),r.register(o),o},s}),define("aloha/engine",["aloha/ecma5shims","aloha/jquery"],function(e,t){function o(e){if(!e)return 0;if(!e.style)return 0;if(typeof e.style.length!="undefined")return e.style.length;var t=0;for(var n in e.style)e.style[n]&&e.style[n]!==0&&e.style[n]!=="false"&&t++;return t}function u(e){if(!e)return null;var t=[],n,r=e.length;for(n=r>>>0;n--;)t[n]=e[n];return t}function a(e){return e.hasChildNodes()?e.firstChild:l(e)}function f(t){if(t.previousSibling){t=t.previousSibling;while(t.hasChildNodes())t=t.lastChild;return t}return t.parentNode&&t.parentNode.nodeType==e.Node.ELEMENT_NODE?t.parentNode:null}function l(e){while(e&&!e.nextSibling)e=e.parentNode;return e?e.nextSibling:null}function c(t,n){return t&&n&&Boolean(e.compareDocumentPosition(t,n)&e.Node.DOCUMENT_POSITION_CONTAINED_BY)}function h(e,t){return(e||t)&&(e==t||c(e,t))}function p(t,n){return n&&t&&Boolean(e.compareDocumentPosition(n,t)&e.Node.DOCUMENT_POSITION_CONTAINED_BY)}function d(t,n){return Boolean(e.compareDocumentPosition(t,n)&e.Node.DOCUMENT_POSITION_FOLLOWING)}function v(t,n){return Boolean(e.compareDocumentPosition(t,n)&e.Node.DOCUMENT_POSITION_PRECEDING)}function m(e){var t=[];while(e.parentNode)t.unshift(e.parentNode),e=e.parentNode;return t}function g(e){var t=[],n=l(e);while((e=a(e))&&e!=n)t.push(e);return t}function y(e){var t={fontFamily:"font-family",fontSize:"font-size",fontStyle:"font-style",fontWeight:"font-weight",textDecoration:"text-decoration"};return typeof t[e]!="undefined"?t[e]:e}function b(e){return{"xx-small":1,small:2,medium:3,large:4,"x-large":5,"xx-large":6,"xxx-large":7}[e]}function w(e){return{1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[e]}function E(e){return e===null||!e||e===n}function S(e){return e.dir=="ltr"?"ltr":e.dir=="rtl"?"rtl":q(e.parentNode)?S(e.parentNode):"ltr"}function x(e){var t=0;while(e.previousSibling)t++,e=e.previousSibling;return t}function T(t){switch(t.nodeType){case e.Node.PROCESSING_INSTRUCTION_NODE:case e.Node.DOCUMENT_TYPE_NODE:return 0;case e.Node.TEXT_NODE:case e.Node.COMMENT_NODE:return t.length;default:return t.childNodes.length}}function N(t,n,r,i){if(t==r){if(n==i)return"equal";if(n<i)return"before";if(n>i)return"after"}if(e.compareDocumentPosition(r,t)&e.Node.DOCUMENT_POSITION_FOLLOWING){var s=N(r,i,t,n);if(s=="before")return"after";if(s=="after")return"before"}if(e.compareDocumentPosition(r,t)&e.Node.DOCUMENT_POSITION_CONTAINS){var o=r;while(o.parentNode!=t)o=o.parentNode;if(x(o)<n)return"after"}return"before"}function C(e){var t=e;while(t.parentNode!=null)t=t.parentNode;return t}function k(e,t){var n=N(e,0,t.startContainer,t.startOffset),r=N(e,T(e),t.endContainer,t.endOffset);return C(e)==C(t.startContainer)&&n=="after"&&r=="before"}function L(e,t){typeof t=="undefined"&&(t=function(){return!0});var n=e.startContainer;n.hasChildNodes()&&e.startOffset<n.childNodes.length?n=n.childNodes[e.startOffset]:e.startOffset==T(n)?n=l(n):n=a(n);var r=e.endContainer;r.hasChildNodes()&&e.endOffset<r.childNodes.length?r=r.childNodes[e.endOffset]:r=l(r);var i=[];while(d(n,r)){if(k(n,e)&&t(n)){i.push(n),n=l(n);continue}n=a(n)}return i}function A(e,t){typeof t=="undefined"&&(t=function(){return!0});var n=e.startContainer;n.hasChildNodes()&&e.startOffset<n.childNodes.length?n=n.childNodes[e.startOffset]:e.startOffset==T(n)?n=l(n):n=a(n);var r=e.endContainer;r.hasChildNodes()&&e.endOffset<r.childNodes.length?r=r.childNodes[e.endOffset]:r=l(r);var i=[];while(d(n,r))k(n,e)&&t(n)&&i.push(n),n=a(n);return i}function O(t){if(t.toLowerCase()=="currentcolor")return null;var n=document.createElement("span");document.body.appendChild(n),n.style.color="black";var r=document.createElement("span");n.appendChild(r),r.style.color=t,t=e.getComputedStyle(r).color;if(t=="rgb(0, 0, 0)"){n.color="white",t=e.getComputedStyle(r).color;if(t!="rgb(0, 0, 0)")return null}return document.body.removeChild(n),/^rgba\([0-9]+, [0-9]+, [0-9]+, 1\)$/.test(t)?t.replace("rgba","rgb").replace(", 1)",")"):t=="transparent"?"rgba(0, 0, 0, 0)":t}function M(t){t=t.toLowerCase();if(e(["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"]).indexOf(t)!=-1)return t;t=O(t);var n=/^rgb\(([0-9]+), ([0-9]+), ([0-9]+)\)$/.exec(t);return n?"#"+parseInt(n[1]).toString(16).replace(/^.$/,"0$&")+parseInt(n[2]).toString(16).replace(/^.$/,"0$&")+parseInt(n[3]).toString(16).replace(/^.$/,"0$&"):null}function D(e,t,n,r){_==0&&typeof n!="undefined"?i=n:_==0&&(i=null,i=n);if(e in s){if(t=="enabled"||t in s[e]){_++;try{var o=r()}catch(u){throw _--,u}return _--,o}throw"INVALID_ACCESS_ERR"}throw"NOT_SUPPORTED_ERR"}function P(e,t,n,r){e=e.toLowerCase();if(arguments.length==1||arguments.length>=4&&typeof t=="undefined")t=!1;if(arguments.length<=2||arguments.length>=4&&typeof n=="undefined")n="";return D(e,"action",r,function(e,t,n){return function(){return H(e)?(s[e].action(n,r),it(r),!0):!1}}(e,t,n))}function H(t,n){return t=t.toLowerCase(),D(t,"action",n,function(t){return function(){return e(["copy","cut","paste","selectall","stylewithcss","usecss"]).indexOf(t)!=-1||n!==null}}(t))}function B(e,t){return e=e.toLowerCase(),D(e,"indeterm",t,function(e){return function(){return H(e,t)?s[e].indeterm(t):!1}}(e))}function j(e,t){return e=e.toLowerCase(),D(e,"state",t,function(e){return function(){return H(e,t)?typeof ot(e,t)!="undefined"?ot(e,t):s[e].state(t):!1}}(e))}function F(e){return e=e.toLowerCase(),e in s}function I(e,t){return e=e.toLowerCase(),D(e,"value",t,function(){return H(e,t)?e=="fontsize"&&ft("fontsize",t)!==undefined?Ft(ft("fontsize",t)):typeof ft(e,t)!="undefined"?ft(e,t):s[e].value():""})}function q(t,n){return typeof n=="string"&&(n=[n]),typeof n=="object"&&(n=e(n).map(function(e){return e.toUpperCase()})),t&&t.nodeType==e.Node.ELEMENT_NODE&&E(t.namespaceURI)&&(typeof n=="undefined"||e(n).indexOf(t.tagName)!=-1)}function U(e){return q(e,R)}function z(t){return t&&(t.nodeType==e.Node.ELEMENT_NODE&&e(["inline","inline-block","inline-table","none"]).indexOf(e.getComputedStyle(t).display)==-1||t.nodeType==e.Node.DOCUMENT_NODE||t.nodeType==e.Node.DOCUMENT_FRAGMENT_NODE)}function W(e){return e&&!z(e)}function X(t){return t&&t.nodeType==e.Node.ELEMENT_NODE&&(t.contentEditable=="true"||t.parentNode&&t.parentNode.nodeType==e.Node.DOCUMENT_NODE&&t.parentNode.designMode=="on")}function V(n){return n&&!X(n)&&(n.nodeType!=e.Node.ELEMENT_NODE||n.contentEditable!="false"||t(n).hasClass("aloha-table-wrapper"))&&(X(n.parentNode)||V(n.parentNode))}function $(e){for(var t=0;t<e.childNodes.length;t++)if(V(e.childNodes[t])||$(e.childNodes[t]))return!0;return!1}function J(e){if(X(e))return e;if(V(e)){var t=e.parentNode;while(!X(t))t=t.parentNode;return t}return null}function K(e,t){return J(e)&&J(e)==J(t)}function Q(t){if(!q(t,"br"))return!1;var n=t.parentNode;while(e.getComputedStyle(n).display=="inline")n=n.parentNode;var r=e(n).hasAttribute("style")?n.getAttribute("style"):null;n.style.height="auto",n.style.maxHeight="none",n.style.minHeight="0";var i=document.createTextNode("​"),s=n.offsetHeight;if(s==0)throw"isCollapsedLineBreak: original height is zero, bug?";t.parentNode.insertBefore(i,t.nextSibling);var o=n.offsetHeight;return i.parentNode.removeChild(i),r===null?(n.setAttribute("style",""),n.removeAttribute("style")):n.setAttribute("style",r),s<o-5}function G(t){if(!q(t,"br"))return!1;if(q(t.parentNode,"li")&&t.parentNode.childNodes.length==1)return!1;var n=t.parentNode;while(e.getComputedStyle(n).display=="inline")n=n.parentNode;var r=e(n).hasAttribute("style")?n.getAttribute("style"):null;n.style.height="auto",n.style.maxHeight="none",n.style.minHeight="0";var i=e(t).hasAttribute("style")?t.getAttribute("style"):null,s=n.offsetHeight;if(s==0)throw"isExtraneousLineBreak: original height is zero, bug?";t.setAttribute("style","display:none");var o=n.offsetHeight;return r===null?(n.setAttribute("style",""),n.removeAttribute("style")):n.setAttribute("style",r),i===null?t.removeAttribute("style"):t.setAttribute("style",i),s==o}function Y(t){return t&&t.nodeType==e.Node.TEXT_NODE&&(t.data==""||/^[\t\n\r ]+$/.test(t.data)&&t.parentNode&&t.parentNode.nodeType==e.Node.ELEMENT_NODE&&e(["normal","nowrap"]).indexOf(e.getComputedStyle(t.parentNode).whiteSpace)!=-1||/^[\t\r ]+$/.test(t.data)&&t.parentNode&&t.parentNode.nodeType==e.Node.ELEMENT_NODE&&e.getComputedStyle(t.parentNode).whiteSpace=="pre-line"||/^[\t\n\r ]+$/.test(t.data)&&t.parentNode&&t.parentNode.nodeType==e.Node.DOCUMENT_FRAGMENT_NODE)}function Z(t,n){if(!V(t)&&!X(t))return;if(!t||t.nodeType!==e.Node.TEXT_NODE)return;if(e(["pre","pre-wrap"]).indexOf(e.getComputedStyle(t.parentNode).whiteSpace)!=-1)return;if(!/[\t\n\r ]{2,}/.test(t.data))return;var r="",i=n.startContainer==t,s=n.endContainer==t,o=!1;for(var u=0;u<t.data.length;++u)/[\t\n\r ]/.test(t.data[u])?o?(i&&r.length<n.startOffset&&n.startOffset--,s&&r.length<n.endOffset&&n.endOffset--):(r+=" ",o=!0):(r+=t.data[u],o=!1);t.data=r}function et(t){if(!Y(t))return!1;if(t.data=="")return!0;var n=t.parentNode;if(!n)return!0;if(e(m(t)).some(function(t){return t.nodeType==e.Node.ELEMENT_NODE&&e.getComputedStyle(t).display=="none"}))return!0;while(!z(n)&&n.parentNode)n=n.parentNode;var r=t;while(r!=n){r=f(r);if(z(r)||q(r,"br"))return!0;if(r.nodeType==e.Node.TEXT_NODE&&!Y(r)||q(r,"img"))break}r=t;var i=l(n);while(r!=i){r=a(r);if(z(r)||q(r,"br"))return!0;if(r&&r.nodeType==e.Node.TEXT_NODE&&!Y(r)||q(r,"img"))break}return!1}function tt(t){if(!t)return!1;if(e(m(t).concat(t)).filter(function(t){return t.nodeType==e.Node.ELEMENT_NODE},!0).some(function(t){return e.getComputedStyle(t).display=="none"}))return!1;if(z(t)||t.nodeType==e.Node.TEXT_NODE&&!et(t)||q(t,"img")||q(t,"br")&&!G(t))return!0;for(var n=0;n<t.childNodes.length;n++)if(tt(t.childNodes[n]))return!0;return!1}function nt(e){return e&&!tt(e)}function rt(t){if(Q(t)&&!G(t))return!0;if(!W(t)||t.nodeType!=e.Node.ELEMENT_NODE)return!1;var n=!1;for(var r=0;r<t.childNodes.length;r++){if(!nt(t.childNodes[r])&&!rt(t.childNodes[r]))return!1;rt(t.childNodes[r])&&(n=!0)}return n}function it(e){var t=new window.GENTICS.Utils.RangeObject;t.startContainer=e.startContainer,t.startOffset=e.startOffset,t.endContainer=e.endContainer,t.endOffset=e.endOffset,t.select()}function st(){var t;if(i)t=i;else{if(!Aloha.getSelection().rangeCount)return null;t=Aloha.getSelection().getRangeAt(0)}if(e([e.Node.TEXT_NODE,e.Node.ELEMENT_NODE]).indexOf(t.startContainer.nodeType)==-1||e([e.Node.TEXT_NODE,e.Node.ELEMENT_NODE]).indexOf(t.endContainer.nodeType)==-1||!t.startContainer.ownerDocument||!t.endContainer.ownerDocument||!p(t.startContainer,t.startContainer.ownerDocument)||!p(t.endContainer,t.endContainer.ownerDocument))throw"Invalid active range; test bug?";return t}function ht(t,n,r,i){r==-1&&(r=n.childNodes.length);var s=t.parentNode,o=x(t),u=[i];for(var a=0;a<Aloha.getSelection().rangeCount;a++)u.push(Aloha.getSelection().getRangeAt(a));var f=[];e(u).forEach(function(e){f.push([e.startContainer,e.startOffset]),f.push([e.endContainer,e.endOffset])}),e(f).forEach(function(e){e[0]==n&&e[1]>r&&e[1]++,e[0]==s&&(e[1]==o||e[1]==o+1)&&(e[0]=n,e[1]+=r-o),e[0]==s&&e[1]>o+1&&e[1]--}),n.childNodes.length==r?n.appendChild(t):n.insertBefore(t,n.childNodes[r]);if(f[0][1]>f[0][0].childNodes.length&&f[1][1]>f[1][0].childNodes.length)i.setStart(t,0),i.setEnd(t,0);else{i.setStart(f[0][0],f[0][1]),i.setEnd(f[1][0],f[1][1]),Aloha.getSelection().removeAllRanges();for(var a=1;a<u.length;a++){var l=Aloha.createRange();l.setStart(f[2*a][0],f[2*a][1]),l.setEnd(f[2*a+1][0],f[2*a+1][1]),Aloha.getSelection().addRange(l)}l&&(i=l)}}function pt(e,t,n){if(q(e,t.toUpperCase()))return e;if(!e.parentNode)return e;var r=e.ownerDocument.createElement(t);e.parentNode.insertBefore(r,e);for(var i=0;i<e.attributes.length;i++)typeof r.setAttributeNS=="function"?r.setAttributeNS(e.attributes[i].namespaceURI,e.attributes[i].name,e.attributes[i].value):r.setAttribute(e.attributes[i].name,e.attributes[i].value);while(e.childNodes.length)ht(e.firstChild,r,r.childNodes.length,n);return e.parentNode.removeChild(e),n.startContainer===e&&n.setStart(r,n.startOffset),n.endContainer===e&&n.setEnd(r,n.endOffset),r}function dt(e){var t=e.previousSibling;if(!t)return;while(t.hasChildNodes())t=t.lastChild;while(nt(t)&&!G(t)&&t!=e.parentNode)t=f(t);V(t)&&G(t)&&t.parentNode.removeChild(t)}function vt(e){var t=e;while(t.hasChildNodes())t=t.lastChild;while(nt(t)&&!G(t)&&t!=e)t=f(t);V(t)&&G(t)&&t.parentNode.removeChild(t)}function mt(e){dt(e),vt(e)}function gt(e,t,n,r){typeof t=="undefined"&&(t=function(){return!1}),typeof n=="undefined"&&(n=function(){return null});if(!e.length||!V(e[0]))return null;W(e[e.length-1])&&!q(e[e.length-1],"br")&&q(e[e.length-1].nextSibling,"br")&&e.push(e[e.length-1].nextSibling);var s;V(e[0].previousSibling)&&t(e[0].previousSibling)?s=e[0].previousSibling:V(e[e.length-1].nextSibling)&&t(e[e.length-1].nextSibling)?s=e[e.length-1].nextSibling:s=n();if(!s)return null;if(!s.parentNode){e[0].parentNode.insertBefore(s,e[0]);var o=r.startContainer,u=r.startOffset,a=r.endContainer,f=r.endOffset;o==s.parentNode&&u>=x(s)&&r.setStart(o,u+1),a==s.parentNode&&f>=x(s)&&r.setEnd(a,f+1),i&&i!==r&&(o=i.startContainer,u=i.startOffset,a=i.endContainer,f=i.endOffset,o==s.parentNode&&u>=x(s)&&i.setStart(o,u+1),a==s.parentNode&&f>=x(s)&&i.setEnd(a,f+1))}var l=e[0].parentNode;if(d(s,e[0])){!W(s)&&W(s.lastChild)&&W(e[0])&&!q(s.lastChild,"BR")&&s.appendChild(s.ownerDocument.createElement("br"));for(var c=0;c<e.length;c++)ht(e[c],s,-1,r)}else{!W(s)&&W(s.firstChild)&&W(e[e.length-1])&&!q(e[e.length-1],"BR")&&s.insertBefore(s.ownerDocument.createElement("br"),s.firstChild);for(var c=e.length-1;c>=0;c--)ht(e[c],s,0,r)}V(l)&&!l.hasChildNodes()&&l.parentNode.removeChild(l);if(V(s.nextSibling)&&t(s.nextSibling)){!W(s)&&W(s.lastChild)&&W(s.nextSibling.firstChild)&&!q(s.lastChild,"BR")&&s.appendChild(s.ownerDocument.createElement("br"));while(s.nextSibling.hasChildNodes())ht(s.nextSibling.firstChild,s,-1,r);s.parentNode.removeChild(s.nextSibling)}return mt(s),s}function bt(e){return q(e,yt)}function wt(t,n){if((e(["colgroup","table","tbody","tfoot","thead","tr"]).indexOf(n)!=-1||q(n,["colgroup","table","tbody","tfoot","thead","tr"]))&&typeof t=="object"&&t.nodeType==e.Node.TEXT_NODE&&!/^[ \t\n\f\r]*$/.test(t.data))return!1;if(e(["script","style","plaintext","xmp"]).indexOf(n)==-1&&!q(n,["script","style","plaintext","xmp"])||typeof t=="object"&&t.nodeType==e.Node.TEXT_NODE){if(typeof t!="object"||t.nodeType!=e.Node.DOCUMENT_NODE&&t.nodeType!=e.Node.DOCUMENT_FRAGMENT_NODE&&t.nodeType!=e.Node.DOCUMENT_TYPE_NODE){q(t)&&(t=t.tagName.toLowerCase());if(typeof t!="string")return!0;if(q(n)){var r=n;while(r){if(t=="a"&&q(r,"a"))return!1;if(e(R).indexOf(t)!=-1&&bt(r))return!1;if(/^h[1-6]$/.test(t)&&q(r)&&/^H[1-6]$/.test(r.tagName))return!1;r=r.parentNode}n=n.tagName.toLowerCase()}if(typeof n!="object"||n.nodeType!=e.Node.ELEMENT_NODE&&n.nodeType!=e.Node.DOCUMENT_FRAGMENT_NODE){if(typeof n!="string")return!1;switch(n){case"colgroup":return t=="col";case"table":return e(["caption","col","colgroup","tbody","td","tfoot","th","thead","tr"]).indexOf(t)!=-1;case"tbody":case"thead":case"tfoot":return e(["td","th","tr"]).indexOf(t)!=-1;case"tr":return e(["td","th"]).indexOf(t)!=-1;case"dl":return e(["dt","dd"]).indexOf(t)!=-1;case"dir":case"ol":case"ul":return e(["dir","li","ol","ul"]).indexOf(t)!=-1;case"hgroup":return/^h[1-6]$/.test(t)}if(e(["body","caption","col","colgroup","frame","frameset","head","html","tbody","td","tfoot","th","thead","tr"]).indexOf(t)!=-1)return!1;if(e(["dd","dt"]).indexOf(t)!=-1&&n!="dl")return!1;if(t=="li"&&n!="ol"&&n!="ul")return!1;var i=[[["a"],["a"]],[["dd","dt"],["dd","dt"]],[["h1","h2","h3","h4","h5","h6"],["h1","h2","h3","h4","h5","h6"]],[["li"],["li"]],[["nobr"],["nobr"]],[yt,R],[["td","th"],["caption","col","colgroup","tbody","td","tfoot","th","thead","tr"]]];for(var s=0;s<i.length;s++)if(e(i[s][0]).indexOf(n)!=-1&&e(i[s][1]).indexOf(t)!=-1)return!1;return!0}return!0}return!1}return!1}function Et(t,n){return n.collapsed?!1:k(t,n)?!0:t==n.startContainer&&t.nodeType==e.Node.TEXT_NODE&&T(t)!=n.startOffset?!0:t==n.endContainer&&t.nodeType==e.Node.TEXT_NODE&&n.endOffset!=0?!0:t.hasChildNodes()&&e(t.childNodes).every(function(e){return Et(e,n)})&&(!p(n.startContainer,t)||n.startContainer.nodeType!=e.Node.TEXT_NODE||n.startOffset==0)&&(!p(n.endContainer,t)||n.endContainer.nodeType!=e.Node.TEXT_NODE||n.endOffset==T(n.endContainer))?!0:!1}function St(e,t){typeof t=="undefined"&&(t=function(){return!0});var n=e.startContainer;while(Et(n.parentNode,e))n=n.parentNode;var r=l(e.endContainer),i=[];while(d(n,r)){if(Et(n,e)&&t(n)){i.push(n),n=l(n);continue}n=a(n)}return i}function xt(e,t){typeof t=="undefined"&&(t=function(){return!0});var n=e.startContainer;while(Et(n.parentNode,e))n=n.parentNode;var r=l(e.endContainer),i=[];while(d(n,r))Et(n,e)&&t(n)&&i.push(n),n=a(n);return i}function Tt(t){if(!q(t))return!1;if(e(["B","EM","I","S","SPAN","STRIKE","STRONG","SUB","SUP","U"]).indexOf(t.tagName)!=-1){if(t.attributes.length==0)return!0;if(t.attributes.length==1&&e(t).hasAttribute("style"))return!0}if(t.tagName=="FONT"||t.tagName=="A"){var n=t.attributes.length;e(t).hasAttribute("style")&&n--,t.tagName=="FONT"&&(e(t).hasAttribute("color")&&n--,e(t).hasAttribute("face")&&n--,e(t).hasAttribute("size")&&n--),t.tagName=="A"&&e(t).hasAttribute("href")&&n--;if(n==0)return!0}return!1}function Nt(t){return q(t)?e(["A","B","EM","FONT","I","S","SPAN","STRIKE","STRONG","SUB","SUP","U"]).indexOf(t.tagName)==-1?!1:t.attributes.length==0?!0:t.attributes.length>1?!1:e(t).hasAttribute("style")&&o(t)==0?!0:t.tagName=="A"&&e(t).hasAttribute("href")?!0:t.tagName=="FONT"&&(e(t).hasAttribute("color")||e(t).hasAttribute("face")||e(t).hasAttribute("size"))?!0:t.tagName!="B"&&t.tagName!="STRONG"||!e(t).hasAttribute("style")||o(t)!=1||t.style.fontWeight==""?t.tagName!="I"&&t.tagName!="EM"||!e(t).hasAttribute("style")||o(t)!=1||t.style.fontStyle==""?t.tagName!="A"&&t.tagName!="FONT"&&t.tagName!="SPAN"||!e(t).hasAttribute("style")||o(t)!=1||t.style.textDecoration!=""?e(["A","FONT","S","SPAN","STRIKE","U"]).indexOf(t.tagName)==-1||!e(t).hasAttribute("style")||o(t)!=1||t.style.textDecoration!="line-through"&&t.style.textDecoration!="underline"&&t.style.textDecoration!="overline"&&t.style.textDecoration!="none"?!1:!0:!0:!0:!0:!1}function Ct(e,t,n){return t===null&&n===null?!0:typeof t!="string"||typeof n!="string"||t!=n||"equivalentValues"in s[e]?typeof t=="string"&&typeof n=="string"&&"equivalentValues"in s[e]&&s[e].equivalentValues(t,n)?!0:!1:!0}function kt(t,n,r){if(Ct(t,n,r))return!0;if(t!="fontsize"||typeof n!="string"||typeof r!="string")return!1;var i=kt;if(i.sizeMap===undefined){i.sizeMap={};var s=document.createElement("font");document.body.appendChild(s),e(["xx-small","small","medium","large","x-large","xx-large","xxx-large"]).forEach(function(t){s.size=b(t),i.sizeMap[t]=e.getComputedStyle(s).fontSize}),document.body.removeChild(s)}return n===i.sizeMap[r]||r===i.sizeMap[n]}function Lt(t,n){if(t.nodeType==e.Node.ELEMENT_NODE||!!t.parentNode&&t.parentNode.nodeType==e.Node.ELEMENT_NODE){if(t.nodeType!=e.Node.ELEMENT_NODE)return Lt(t.parentNode,n);if(n=="createlink"||n=="unlink"){while(t&&(!q(t)||t.tagName!="A"||!e(t).hasAttribute("href")))t=t.parentNode;return t?t.getAttribute("href"):null}if(n=="backcolor"||n=="hilitecolor"){while((e.getComputedStyle(t).backgroundColor=="rgba(0, 0, 0, 0)"||e.getComputedStyle(t).backgroundColor===""||e.getComputedStyle(t).backgroundColor=="transparent")&&t.parentNode&&t.parentNode.nodeType==e.Node.ELEMENT_NODE)t=t.parentNode;return e.getComputedStyle(t).backgroundColor=="rgba(0, 0, 0, 0)"||e.getComputedStyle(t).backgroundColor===""||e.getComputedStyle(t).backgroundColor=="transparent"?"rgb(255, 255, 255)":e.getComputedStyle(t).backgroundColor}if(n=="subscript"||n=="superscript"){var r=!1,i=!1;while(W(t)){var o=e.getComputedStyle(t).verticalAlign;q(t,"sub")?r=!0:q(t,"sup")&&(i=!0),t=t.parentNode}return r&&i?"mixed":r?"subscript":i?"superscript":null}if(n=="strikethrough"){do{if(e.getComputedStyle(t).textDecoration.indexOf("line-through")!=-1)return"line-through";t=t.parentNode}while(t&&t.nodeType==e.Node.ELEMENT_NODE);return null}if(n=="underline"){do{if(e.getComputedStyle(t).textDecoration.indexOf("underline")!=-1)return"underline";t=t.parentNode}while(t&&t.nodeType==e.Node.ELEMENT_NODE);return null}if("relevantCssProperty"in s[n])return e.getComputedStyle(t)[s[n].relevantCssProperty].toString();throw"Bug: no relevantCssProperty for "+n+" in getEffectiveCommandValue"}return null}function At(t,n){if(n!="backcolor"&&n!="hilitecolor"||e.getComputedStyle(t).display=="inline"){if(n=="createlink"||n=="unlink")return q(t)&&t.tagName=="A"&&e(t).hasAttribute("href")?t.getAttribute("href"):null;if(n=="subscript"||n=="superscript")return q(t,"sup")?"superscript":q(t,"sub")?"subscript":null;if(n=="strikethrough"&&t.style.textDecoration!="")return t.style.textDecoration.indexOf("line-through")!=-1?"line-through":null;if(n=="strikethrough"&&q(t,["S","STRIKE"]))return"line-through";if(n=="underline"&&t.style.textDecoration!="")return t.style.textDecoration.indexOf("underline")!=-1?"underline":null;if(n=="underline"&&q(t,"U"))return"underline";var r=s[n].relevantCssProperty;if(r===null)return null;if(t.style[r]!="")return t.style[r];if(E(t.namespaceURI)&&t.tagName=="FONT"){if(r=="color"&&e(t).hasAttribute("color"))return t.color;if(r=="fontFamily"&&e(t).hasAttribute("face"))return t.face;if(r=="fontSize"&&e(t).hasAttribute("size")){var i=parseInt(t.size);return i<1&&(i=1),i>7&&(i=7),{1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[i]}}return r!="fontWeight"||t.tagName!="B"&&t.tagName!="STRONG"?r!="fontStyle"||t.tagName!="I"&&t.tagName!="EM"?null:"italic":"bold"}return null}function Ot(e,t,n,r){var i=e;while(Tt(i)&&i.childNodes.length==1&&Tt(i.firstChild)&&(!Nt(i)||!Ct(t,At(i,t),n)))i=i.firstChild;if(i==e||!Nt(i)||!Ct(t,At(i,t),n)||!kt(t,Lt(i,t),n))return;while(i.hasChildNodes())ht(i.firstChild,i.parentNode,x(i),r);e.parentNode.insertBefore(i,e.nextSibling),ht(e,i,-1,r)}function Mt(t){var n=[];return e(t).forEach(function(t){e(["subscript","bold","fontname","fontsize","forecolor","hilitecolor","italic","strikethrough","underline"]).forEach(function(r){var i=t;i.nodeType!=e.Node.ELEMENT_NODE&&(i=i.parentNode);while(i&&i.nodeType==e.Node.ELEMENT_NODE&&At(i,r)===null)i=i.parentNode;i&&i.nodeType==e.Node.ELEMENT_NODE?n.push([t,r,At(i,r)]):n.push([t,r,null])})}),n}function _t(t,n){e(t).forEach(function(t){var r=t[0],i=t[1],s=t[2],o=r;if(!o||o.nodeType!=e.Node.ELEMENT_NODE)o=o.parentNode;while(o&&o.nodeType==e.Node.ELEMENT_NODE&&At(o,i)===null)o=o.parentNode;s===null&&o&&o.nodeType==e.Node.ELEMENT_NODE?Pt(r,i,null,n):(o&&o.nodeType==e.Node.ELEMENT_NODE&&!Ct(i,At(o,i),s)||(!o||o.nodeType!=e.Node.ELEMENT_NODE)&&s!==null)&&Ht(r,i,s,n)})}function Dt(e,t,n){if(!V(e))return[];if(At(e,t)===null)return[];if(Nt(e)){var r=Array.prototype.slice.call(u(e.childNodes));for(var i=0;i<r.length;i++)ht(r[i],e.parentNode,x(e),n);return e.parentNode.removeChild(e),r}return t=="strikethrough"&&e.style.textDecoration.indexOf("line-through")!=-1&&(e.style.textDecoration=="line-through"?e.style.textDecoration="":e.style.textDecoration=e.style.textDecoration.replace("line-through",""),e.getAttribute("style")==""&&e.removeAttribute("style")),t=="underline"&&e.style.textDecoration.indexOf("underline")!=-1&&(e.style.textDecoration=="underline"?e.style.textDecoration="":e.style.textDecoration=e.style.textDecoration.replace("underline",""),e.getAttribute("style")==""&&e.removeAttribute("style")),s[t].relevantCssProperty!==null&&(e.style[s[t].relevantCssProperty]="",e.getAttribute("style")==""&&e.removeAttribute("style")),E(e.namespaceURI)&&e.tagName=="FONT"&&(t=="forecolor"&&e.removeAttribute("color"),t=="fontname"&&e.removeAttribute("face"),t=="fontsize"&&e.removeAttribute("size")),q(e,"A")&&(t=="createlink"||t=="unlink")&&e.removeAttribute("href"),At(e,t)===null?[]:[pt(e,"span",n)]}function Pt(t,n,r,i){if(!t.parentNode||t.parentNode.nodeType!=e.Node.ELEMENT_NODE)return;if(kt(n,Lt(t,n),r))return;var s=t.parentNode,o=[];while(V(s)&&s.nodeType==e.Node.ELEMENT_NODE&&!kt(n,Lt(s,n),r))o.push(s),s=s.parentNode;if(!o.length)return;var a=At(o[o.length-1],n);if(a===null&&a!=r)return;if(r!==null&&!kt(n,Lt(o[o.length-1].parentNode,n),r))return;while(o.length){var s=o.pop();At(s,n)!==null&&(a=At(s,n));var f=Array.prototype.slice.call(u(s.childNodes));At(s,n)!==null&&Dt(s,n,i);for(var l=0;l<f.length;l++){var c=f[l];if(c==t)continue;if(c.nodeType==e.Node.ELEMENT_NODE&&At(c,n)!==null&&!Ct(n,a,At(c,n)))continue;if(c==o[o.length-1])continue;Ht(c,n,a,i)}}}function Ht(n,i,o,u){if(!n.parentNode)return;if(o===null)return;wt(n,"span")&&(Ot(n.previousSibling,i,o,u),Ot(n.nextSibling,i,o,u),gt([n],function(e){return Nt(e)&&Ct(i,At(e,i),o)&&kt(i,Lt(e,i),o)},function(){return null},u));if(kt(i,Lt(n,i),o))return;if(!wt(n,"span")){var a=[];for(var f=0;f<n.childNodes.length;f++){if(n.childNodes[f].nodeType==e.Node.ELEMENT_NODE){var l=At(n.childNodes[f],i);if(l!==null&&!Ct(i,o,l))continue}a.push(n.childNodes[f])}for(var f=0;f<a.length;f++)Ht(a[f],i,o,u);return}if(kt(i,Lt(n,i),o))return;var c=null;r||(i=="bold"&&(o=="bold"||o=="700")&&(c=n.ownerDocument.createElement("b")),i=="italic"&&o=="italic"&&(c=n.ownerDocument.createElement("i")),i=="strikethrough"&&o=="line-through"&&(c=n.ownerDocument.createElement("s")),i=="underline"&&o=="underline"&&(c=n.ownerDocument.createElement("u")),i=="forecolor"&&M(o)&&(c=n.ownerDocument.createElement("span"),t(c).css("color",M(o))),i=="fontname"&&(c=n.ownerDocument.createElement("font"),c.face=o));if(i=="createlink"||i=="unlink"){c=n.ownerDocument.createElement("a"),c.setAttribute("href",o);var h=n.parentNode;while(h)q(h,"A")&&(h=pt(h,"span",u)),h=h.parentNode}i=="fontsize"&&e(["xx-small","small","medium","large","x-large","xx-large","xxx-large"]).indexOf(o)!=-1&&(!r||o=="xxx-large")&&(c=n.ownerDocument.createElement("font"),c.size=b(o)),(i=="subscript"||i=="superscript")&&o=="subscript"&&(c=n.ownerDocument.createElement("sub")),(i=="subscript"||i=="superscript")&&o=="superscript"&&(c=n.ownerDocument.createElement("sup")),c||(c=n.ownerDocument.createElement("span")),n.parentNode.insertBefore(c,n);var p=s[i].relevantCssProperty;p!==null&&!kt(i,Lt(c,i),o)&&(c.style[p]=o),i=="strikethrough"&&o=="line-through"&&Lt(c,"strikethrough")!="line-through"&&(c.style.textDecoration="line-through"),i=="underline"&&o=="underline"&&Lt(c,"underline")!="underline"&&(c.style.textDecoration="underline"),ht(n,c,c.childNodes.length,u);if(n.nodeType==e.Node.ELEMENT_NODE&&!Ct(i,Lt(n,i),o)){ht(n,c.parentNode,x(c),u),c.parentNode.removeChild(c);var a=[];for(var f=0;f<n.childNodes.length;f++){if(n.childNodes[f].nodeType==e.Node.ELEMENT_NODE){var l=At(n.childNodes[f],i);if(l!==null&&!Ct(i,o,l))continue}a.push(n.childNodes[f])}for(var f=0;f<a.length;f++)Ht(a[f],i,o,u)}}function Bt(t,n,r){r=r||st();if(!e(xt(r)).filter(function(t){return t.nodeType==e.Node.TEXT_NODE},!0).some(V)){"inlineCommandActivatedValues"in s[t]&&ut(t,e(s[t].inlineCommandActivatedValues).indexOf(n)!=-1,r),t=="subscript"&&at("superscript",r),t=="superscript"&&at("subscript",r),n===null?ct(t,r):"value"in s[t]&&lt(t,n,r);return}if(V(r.startContainer)&&r.startContainer.nodeType==e.Node.TEXT_NODE&&r.startOffset!=0&&r.startOffset!=T(r.startContainer)){var i=r.startContainer.splitText(r.startOffset),o=Aloha.createRange();if(r.startContainer==r.endContainer){var u=r.endOffset-r.startOffset;o.setEnd(i,u),r.setEnd(i,u)}o.setStart(i,0),Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(o),r.setStart(i,0)}if(V(r.endContainer)&&r.endContainer.nodeType==e.Node.TEXT_NODE&&r.endOffset!=0&&r.endOffset!=T(r.endContainer)){var a=r,f=[a.startContainer,a.startOffset],l=[a.endContainer,a.endOffset];a.endContainer.splitText(a.endOffset),a.setStart(f[0],f[1]),a.setEnd(l[0],l[1]),Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(a)}e(xt(st(),function(t){return V(t)&&t.nodeType==e.Node.ELEMENT_NODE})).forEach(function(e){Dt(e,t,r)}),e(xt(r,V)).forEach(function(e){Pt(e,t,n,r),Ht(e,t,n,r)})}function jt(t){t=e(t).trim();if(/^[-+]?[0-9]+(\.[0-9]+)?([eE][-+]?[0-9]+)?$/.test(t)){var n;t[0]=="+"?(t=t.slice(1),n="relative-plus"):t[0]=="-"?(t=t.slice(1),n="relative-minus"):n="absolute";var r=parseInt(t);n=="relative-plus"&&(r+=3),n=="relative-minus"&&(r=3-r),r<1&&(r=1),r>7&&(r=7),t={1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[r]}return t}function Ft(t){t=jt(t);if(e(["xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large"]).indexOf(t)==-1&&!/^[0-9]+(\.[0-9]+)?(cm|mm|in|pt|pc|px)$/.test(t))return null;var n=document.createElement("font");document.body.appendChild(n),t=="xxx-large"?n.size=7:n.style.fontSize=t;var r=parseInt(e.getComputedStyle(n).fontSize);document.body.removeChild(n);var i=1;while(i<7){var n=document.createElement("font");n.size=i,document.body.appendChild(n);var s=parseInt(e.getComputedStyle(n).fontSize);n.size=1+i;var o=parseInt(e.getComputedStyle(n).fontSize);document.body.removeChild(n);var u=(o+s)/2;if(r<u)return String(i);i++}return"7"}function It(e){if(!q(e))return!1;if(e.tagName=="BLOCKQUOTE")return!0;if(e.tagName!="DIV")return!1;if(typeof e.style.length!="undefined"){for(var t=0;t<e.style.length;t++)if(/^(-[a-z]+-)?margin/.test(e.style[t]))return!0}else for(var n in e.style)if(/^(-[a-z]+-)?margin/.test(n)&&e.style[n]&&e.style[n]!==0)return!0;return!1}function qt(t){if(!It(t))return!1;if(t.tagName!="BLOCKQUOTE"&&t.tagName!="DIV")return!1;for(var n=0;n<t.attributes.length;n++)if(!E(t.attributes[n].namespaceURI)||e(["style","class","dir"]).indexOf(t.attributes[n].name)==-1)return!1;if(typeof t.style.length!="undefined"){for(var n=0;n<t.style.length;n++)if(!/^(-[a-z]+-)?(margin|border|padding)/.test(t.style[n]))return!1}else for(var r in t.style)if(!/^(-[a-z]+-)?(margin|border|padding)/.test(r)&&t.style[r]&&t.style[r]!==0&&t.style[r]!=="false")return!1;return!0}function Rt(e){return q(e,["address","div","h1","h2","h3","h4","h5","h6","listing","p","pre","xmp"])}function Ut(e){return Rt(e)||q(e,["li","dt","dd"])}function Wt(n,r){if(!V(n))return;if(e(m(n)).every(function(e){return!K(n,e)||!wt(n,e)})&&!q(n,zt)){if(q(n,["dd","dt"])){gt([n],function(e){return q(e,"dl")&&!e.attributes.length},function(){return document.createElement("dl")},r);return}if(!U(n))return;n=pt(n,zt,r),Wt(n,r);var i=g(n);for(var s=0;s<i.length;s++)Wt(i[s],r);return}var o=Mt([n]);while(!wt(n,n.parentNode)){for(var s=n.parentNode.childNodes.length-1;s>=0;--s)n.parentNode.childNodes[s].nodeType==3&&n.parentNode.childNodes[s].data.length==0&&(n.parentNode.removeChild(n.parentNode.childNodes[s]),r.startContainer==n.parentNode&&r.startOffset>s&&r.startOffset--,r.endContainer==
n.parentNode&&r.endOffset>s&&r.endOffset--);if(n.parentNode.childNodes.length==1){var u=!1,a=!1;r.startContainer===n.parentNode&&(u=!0),r.endContainer===n.parentNode&&(a=!0),t(n).unwrap(),u&&(r.startContainer=n.parentNode,r.startOffset=r.startOffset+x(n)),a&&(r.endContainer=n.parentNode,r.endOffset=r.endOffset+x(n))}else on([n],r)}_t(o,r)}function Xt(t,n){if(!q(t,"LI")||!V(t)||!V(t.parentNode))return;var r=null;while(e(t.childNodes).some(function(e){return q(e,["OL","UL"])})){var i=t.lastChild;q(i,["OL","UL"])||!r&&i.nodeType==e.Node.TEXT_NODE&&/^[ \t\n\f\r]*$/.test(i.data)?(r=null,ht(i,t.parentNode,1+x(t),n)):(r||(r=t.ownerDocument.createElement("li"),t.parentNode.insertBefore(r,t.nextSibling)),ht(i,r,0,n))}}function Vt(e,n){if(!q(e,["OL","UL"])||!V(e))return;var r=t(e);r.children("ol,ul").each(function(e,t){q(t.previousSibling,"LI")&&ht(t,t.previousSibling,t.previousSibling.childNodes.length,n)})}function $t(){var t=Yt(st()),n=L(t,function(e){return V(e)&&!It(e)&&(q(e,["ol","ul"])||q(e.parentNode,["ol","ul"])||wt(e,"li"))});if(!n.length)return"none";if(e(n).every(function(e){return q(e,"ol")||q(e.parentNode,"ol")||q(e.parentNode,"li")&&q(e.parentNode.parentNode,"ol")})&&!e(n).some(function(e){return q(e,"ul")||"querySelector"in e&&e.querySelector("ul")}))return"ol";if(e(n).every(function(e){return q(e,"ul")||q(e.parentNode,"ul")||q(e.parentNode,"li")&&q(e.parentNode.parentNode,"ul")})&&!e(n).some(function(e){return q(e,"ol")||"querySelector"in e&&e.querySelector("ol")}))return"ul";var r=e(n).some(function(e){return q(e,"ol")||q(e.parentNode,"ol")||"querySelector"in e&&e.querySelector("ol")||q(e.parentNode,"li")&&q(e.parentNode.parentNode,"ol")}),i=e(n).some(function(e){return q(e,"ul")||q(e.parentNode,"ul")||"querySelector"in e&&e.querySelector("ul")||q(e.parentNode,"li")&&q(e.parentNode.parentNode,"ul")});return r&&i?"mixed":r?"mixed ol":i?"mixed ul":"none"}function Jt(t){while(t&&t.nodeType!=e.Node.ELEMENT_NODE||t.nodeType==e.Node.ELEMENT_NODE&&e(["inline","none"]).indexOf(e.getComputedStyle(t).display)!=-1)t=t.parentNode;if(!t||t.nodeType!=e.Node.ELEMENT_NODE)return"left";var n=e.getComputedStyle(t).textAlign.replace(/^-(moz|webkit)-/,"").replace(/^auto$/,"start");return n=="start"?S(t)=="ltr"?"left":"right":n=="end"?S(t)=="ltr"?"right":"left":e(["center","justify","left","right"]).indexOf(n)!=-1?n:"left"}function Kt(e,t){return!e.parentNode&&t==0||0<=t-1&&t-1<e.childNodes.length&&tt(e.childNodes[t-1])&&(z(e.childNodes[t-1])||q(e.childNodes[t-1],"br"))}function Qt(e,t){return!e.parentNode&&t==T(e)||t<e.childNodes.length&&tt(e.childNodes[t])&&z(e.childNodes[t])}function Gt(e,t){return Kt(e,t)||Qt(e,t)}function Yt(t){var n=t.startContainer,r=t.startOffset,i=t.endContainer,s=t.endOffset,o=e(m(n).concat(n)).filter(function(e){return q(e,"li")}).slice(-1);o.length&&(r=x(o[0]),n=o[0].parentNode);if(!Kt(n,r))do r==0?(r=x(n),n=n.parentNode):r--;while(!Gt(n,r));while(r==0&&n.parentNode)r=x(n),n=n.parentNode;var o=e(m(i).concat(i)).filter(function(e){return q(e,"li")}).slice(-1);o.length&&(s=1+x(o[0]),i=o[0].parentNode);if(!Qt(i,s))do s==T(i)?(s=1+x(i),i=i.parentNode):s++;while(!Gt(i,s));while(s==T(i)&&i.parentNode)s=1+x(i),i=i.parentNode;var u=Aloha.createRange();return u.setStart(n,r),u.setEnd(i,s),u}function Zt(e){var t=0;while(!Gt(e,t)){if(0<=t-1&&t-1<e.childNodes.length&&tt(e.childNodes[t-1]))return!1;t==0||!e.hasChildNodes()?(t=x(e),e=e.parentNode):(e=e.childNodes[t-1],t=T(e))}return!0}function en(e){var t=T(e);while(!Gt(e,t)){if(t<e.childNodes.length&&tt(e.childNodes[t]))return!1;t==T(e)||!e.hasChildNodes()?(t=1+x(e),e=e.parentNode):(e=e.childNodes[t],t=0)}return!0}function tn(t){var n=[];return ft("createlink",t)!==undefined&&n.push(["createlink",ft("createlink",t)]),e(["bold","italic","strikethrough","subscript","superscript","underline"]).forEach(function(e){ot(e,t)!==undefined&&n.push([e,ot(e,t)])}),e(["fontname","fontsize","forecolor","hilitecolor"]).forEach(function(e){ft(e,t)!==undefined&&n.push([e,ft(e,t)])}),n}function nn(t){var n=[],r=e(xt(t)).filter(function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})[0];return r?(n.push(["createlink",s.createlink.value(t)]),e(["bold","italic","strikethrough","subscript","superscript","underline"]).forEach(function(t){e(s[t].inlineCommandActivatedValues).indexOf(Lt(r,t))!=-1?n.push([t,!0]):n.push([t,!1])}),e(["fontname","fontsize","forecolor","hilitecolor"]).forEach(function(e){n.push([e,s[e].value(t)])}),n.push("fontsize",Lt(r,"fontsize")),n):n}function rn(t,n){var r=e(xt(n)).filter(function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})[0];if(r)for(var i=0;i<t.length;i++){var s=t[i][0],o=t[i][1];if(typeof o=="boolean"&&j(s)!=o)P(s);else if(typeof o=="string"&&s!="fontsize"&&!Ct(s,I(s),o))P(s,!1,o);else{if(typeof o!="string"||s!="fontsize"||!(ft("fontsize",n)!==undefined&&ft("fontsize",n)!==o||ft("fontsize",n)===undefined&&!kt(s,Lt(r,"fontsize"),o)))continue;P("fontsize",!1,o)}r=e(xt(n)).filter(function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})[0]||r}else for(var i=0;i<t.length;i++){var s=t[i][0],o=t[i][1];typeof o=="boolean"&&ut(s,o,n),typeof o=="string"&&lt(s,o,n)}}function sn(){var t,n={};arguments.length<3?t=arguments[0]:(t=Aloha.createRange(),t.setStart(arguments[0],arguments[1]),t.setEnd(arguments[2],arguments[3])),arguments.length==2&&(n=arguments[1]),arguments.length==5&&(n=arguments[4]);var r="blockMerging"in n?!!n.blockMerging:!0,i="stripWrappers"in n?!!n.stripWrappers:!0;if(!t)return;var s=t.startContainer,o=t.startOffset,a=t.endContainer,f=t.endOffset;while(s.hasChildNodes()){if(o==T(s)&&K(s,s.parentNode)&&W(s)){o=1+x(s),s=s.parentNode;continue}if(o==T(s))break;var l=s.childNodes[o];if(z(l)||l.nodeType==e.Node.ELEMENT_NODE&&!l.hasChildNodes()||l.nodeType!=e.Node.ELEMENT_NODE&&l.nodeType!=e.Node.TEXT_NODE)break;s=l,o=0}while(a.hasChildNodes()){if(f==0&&K(a,a.parentNode)&&W(a)){f=x(a),a=a.parentNode;continue}if(f==0)break;var l=a.childNodes[f-1];if(z(l)||l.nodeType==e.Node.ELEMENT_NODE&&!l.hasChildNodes()||l.nodeType!=e.Node.ELEMENT_NODE&&l.nodeType!=e.Node.TEXT_NODE)break;a=l,f=T(l)}if(N(a,f,s,o)!=="after"){t.setEnd(t.startContainer,t.startOffset);return}s.nodeType==e.Node.TEXT_NODE&&o==0&&s!=a,a.nodeType==e.Node.TEXT_NODE&&f==T(a)&&s!=a&&(f=1+x(a),a=a.parentNode),t.setStart(s,o),t.setEnd(a,f);var h=t.startContainer;while(K(h,h.parentNode)&&W(h))h=h.parentNode;if(!z(h)&&!X(h)||!wt("span",h)||q(h,["td","th"]))h=null;var d=t.endContainer;while(K(d,d.parentNode)&&W(d))d=d.parentNode;if(!z(d)&&!X(d)||!wt("span",d)||q(d,["td","th"]))d=null;var v=nn(t);if(s==a&&V(s)&&s.nodeType==e.Node.TEXT_NODE){var m=s.parentNode;s.deleteData(o,f-o),fn(s,o),t.setEnd(t.startContainer,t.startOffset),rn(v,t),(V(m)||X(m))&&!W(m)&&m.offsetHeight===0&&m.appendChild(dn());return}V(s)&&s.nodeType==e.Node.TEXT_NODE&&s.deleteData(o,T(s)-o);var g=L(t,function(e){return V(e)&&!q(e,["thead","tbody","tfoot","tr","th","td"])});for(var y=0;y<g.length;y++){var b=g[y],m=b.parentNode;m.removeChild(b);if(i||!c(m,s)&&m!=s)while(V(m)&&W(m)&&T(m)==0){var w=m.parentNode;w.removeChild(m),m=w}(V(m)||X(m))&&!W(m)&&!m.hasChildNodes()&&m.offsetHeight===0&&m.appendChild(dn())}V(a)&&a.nodeType==e.Node.TEXT_NODE&&a.deleteData(0,f),fn(t.startContainer,t.startOffset),fn(t.endContainer,t.endOffset);if(!r||!h||!d||!K(h,d)||h==d){t.setEnd(t.startContainer,t.startOffset),rn(v,t);return}h.children.length==1&&rt(h.firstChild)&&h.removeChild(h.firstChild),d.children.length==1&&rt(d.firstChild)&&d.removeChild(d.firstChild);if(c(h,d)){var l=d;while(l.parentNode!=h)l=l.parentNode;t.setStart(h,x(l)),t.setEnd(h,x(l));if(!d.hasChildNodes()){while(V(d)&&d.parentNode.childNodes.length==1&&d.parentNode!=h){var m=d;m.removeChild(d),d=m}V(d)&&!W(d)&&W(d.previousSibling)&&W(d.nextSibling)&&d.parentNode.insertBefore(document.createElement("br"),d.nextSibling),V(d)&&d.parentNode.removeChild(d),rn(v,t);return}if(!W(d.firstChild)){rn(v,t);return}var E=[];E.push(d.firstChild);while(!q(E[E.length-1],"br")&&W(E[E.length-1].nextSibling))E.push(E[E.length-1].nextSibling);var S=Mt(E);while(E[0].parentNode!=h)on(E,t);V(E[0].previousSibling)&&q(E[0].previousSibling,"br")&&E[0].parentNode.removeChild(E[0].previousSibling)}else if(p(h,d)){t.setStart(h,T(h)),t.setEnd(h,T(h));var l=h;while(l.parentNode!=d)l=l.parentNode;W(l.nextSibling)&&q(h.lastChild,"br")&&h.removeChild(h.lastChild);var C=[];l.nextSibling&&!q(l.nextSibling,"br")&&!z(l.nextSibling)&&C.push(l.nextSibling),C.length&&C[C.length-1].nextSibling&&!q(C[C.length-1].nextSibling,"br")&&!z(C[C.length-1].nextSibling)&&C.push(C[C.length-1].nextSibling);var S=Mt(C);e(C).forEach(function(e){ht(e,h,-1,t)}),q(l.nextSibling,"br")&&l.parentNode.removeChild(l.nextSibling)}else{t.setStart(h,T(h)),t.setEnd(h,T(h)),W(d.firstChild)&&q(h.lastChild,"br")&&h.removeChild(h.lastChild);var S=Mt([].slice.call(u(d.childNodes)));while(d.hasChildNodes())ht(d.firstChild,h,-1,t);while(!d.hasChildNodes()){var m=d.parentNode;m.removeChild(d),d=m}}_t(S,t),!h.hasChildNodes()&&h.offsetHeight==0&&h.appendChild(dn()),rn(v,t)}function on(t,n){var r=t[0].parentNode;if(!V(r)||!r.parentNode)return;e(t).indexOf(r.firstChild)!=-1&&dt(r);var i=e(t).indexOf(r.firstChild)!=-1&&Zt(r),s=e(t).indexOf(r.lastChild)!=-1&&en(r);if(e(t).indexOf(r.firstChild)==-1&&e(t).indexOf(r.lastChild)!=-1){for(var o=t.length-1;o>=0;o--)ht(t[o],r.parentNode,1+x(r),n);s&&!en(t[t.length-1])&&t[t.length-1].parentNode.insertBefore(document.createElement("br"),t[t.length-1].nextSibling),vt(r);return}if(e(t).indexOf(r.firstChild)==-1){var u=r.cloneNode(!1);r.removeAttribute("id"),r.parentNode.insertBefore(u,r);while(t[0].previousSibling)ht(r.firstChild,u,u.childNodes.length,n)}for(var o=0;o<t.length;o++)ht(t[o],r.parentNode,x(r),n);i&&!Zt(t[0])&&t[0].parentNode.insertBefore(document.createElement("br"),t[0]),W(t[t.length-1])&&!q(t[t.length-1],"br")&&q(r.firstChild,"br")&&!W(r)&&r.removeChild(r.firstChild),r.hasChildNodes()?dt(r):(r.parentNode===n.startContainer&&r.parentNode===n.endContainer&&n.startContainer===n.endContainer&&n.startOffset===n.endOffset&&r.parentNode.childNodes.length===n.startOffset&&(n.startOffset=r.parentNode.childNodes.length-1,n.endOffset=n.startOffset),r.parentNode.removeChild(r),s&&!en(t[t.length-1])&&t[t.length-1].parentNode.insertBefore(document.createElement("br"),t[t.length-1].nextSibling)),!t[t.length-1].nextSibling&&t[t.length-1].parentNode&&vt(t[t.length-1].parentNode)}function un(e,t){e.hasChildNodes()?on([].slice.call(u(e.childNodes)),t):e.parentNode.removeChild(e)}function an(e,t,n){if(e==0)return"";if(e==1&&!t&&!n)return" ";if(e==1)return" ";var r="",i;t?i="  ":i="  ";while(e>3)r+=i,e-=2;return e==3?r+=!t&&!n?"   ":t&&!n?"   ":!t&&n?"   ":t&&n?"   ":"impossible":r+=!t&&!n?"  ":t&&!n?"  ":!t&&n?"  ":t&&n?"  ":"impossible",r}function fn(t,n){if(!V(t)&&!X(t))return;var r=t,i=n;for(;;)if(0<=i-1&&K(r,r.childNodes[i-1]))r=r.childNodes[i-1],i=T(r);else if(i==0&&!Zt(r)&&K(r,r.parentNode))i=x(r),r=r.parentNode;else{if(r.nodeType!=e.Node.TEXT_NODE||e(["pre","pre-wrap"]).indexOf(e.getComputedStyle(r.parentNode).whiteSpace)!=-1||i==0||!/[ \xa0]/.test(r.data[i-1]))break;i--}var s=r,o=i,u=0,a=!1;for(;;)if(o<s.childNodes.length&&K(s,s.childNodes[o]))s=s.childNodes[o],o=0;else if(o==T(s)&&!en(s)&&K(s,s.parentNode))o=1+x(s),s=s.parentNode;else{if(s.nodeType!=e.Node.TEXT_NODE||e(["pre","pre-wrap"]).indexOf(e.getComputedStyle(s.parentNode).whiteSpace)!=-1||o==T(s)||!/[ \xa0]/.test(s.data[o]))break;if(a&&" "==s.data[o]){s.deleteData(o,1);continue}a=" "==s.data[o],o++,u++}var f=an(u,i==0&&Zt(r),o==T(s)&&en(s));while(N(r,i,s,o)=="before")if(i<r.childNodes.length)r=r.childNodes[i],i=0;else if(r.nodeType!=e.Node.TEXT_NODE||i==T(r))i=1+x(r),r=r.parentNode;else{var l=f[0];f=f.slice(1),l!=r.data[i]&&(r.insertData(i,l),r.deleteData(i+1,1)),i++}}function ln(e,t){if(!e.length)return;var n=e[0];if(q(n.parentNode,["OL","UL"])){var r=n.parentNode.tagName;gt(e,function(e){return q(e,r)},function(){return n.ownerDocument.createElement(r)},t);return}var i=gt(e,function(e){return qt(e)},function(){return n.ownerDocument.createElement("blockquote")},t);Wt(i,t)}function cn(t,n){if(!V(t))return;if(qt(t)){un(t,n);return}if(It(t)){t.removeAttribute("class"),t.removeAttribute("dir"),t.style.margin="",t.style.padding="",t.style.border="",t.getAttribute("style")==""&&t.removeAttribute("style"),pt(t,"div",n);return}var r=t.parentNode,i=[];while(V(r)&&r.nodeType==e.Node.ELEMENT_NODE&&!qt(r)&&!q(r,["ol","ul"]))i.push(r),r=r.parentNode;if(!V(r)||!qt(r)){r=t.parentNode,i=[];while(V(r)&&r.nodeType==e.Node.ELEMENT_NODE&&!It(r)&&!q(r,["ol","ul"]))i.push(r),r=r.parentNode}if(q(t,["OL","UL"])&&(!V(r)||!It(r))){t.removeAttribute("reversed"),t.removeAttribute("start"),t.removeAttribute("type");var s=[].slice.call(u(t.childNodes));if(t.attributes.length&&!q(t.parentNode,["OL","UL"]))pt(t,"div",n);else{var o=Mt([].slice.call(u(t.childNodes)));un(t,n),_t(o,n)}for(var a=0;a<s.length;a++)Wt(s[a],n);return}if(!V(r)||!It(r))return;i.push(r);var f=r;while(i.length){r=i.pop();var l=t.parentNode==r?t:i[i.length-1];W(l)&&!q(l,"BR")&&q(l.nextSibling,"BR")&&l.parentNode.removeChild(l.nextSibling);var c=[].slice.call(u(r.childNodes),0,x(l)),h=[].slice.call(u(r.childNodes),1+x(l));ln(c,n),ln(h,n)}cn(f,n)}function hn(t,n){var r=$t()==t?"disable":"enable";t=t.toUpperCase();var i=t=="OL"?"UL":"OL",s=[];(function(){for(var e=n.endContainer;e!=n.commonAncestorContainer;e=e.parentNode)q(e,"li")&&s.unshift(e);for(var e=n.startContainer;e;e=e.parentNode)q(e,"li")&&s.unshift(e)})(),e(s).forEach(function(e){Xt(e,n)});var o=Yt(n);r=="enable"&&e(A(o,function(e){return V(e)&&q(e,i)})).forEach(function(e){if(V(e.previousSibling)&&q(e.previousSibling,t)||V(e.nextSibling)&&q(e.nextSibling,t)){var r=[].slice.call(u(e.childNodes)),i=Mt(r);on(r,n),gt(r,function(e){return q(e,t)},function(){return null},n),_t(i,n)}else pt(e,t,n)});var a=L(o,function(e){return V(e)&&!It(e)&&(q(e,["OL","UL"])||q(e.parentNode,["OL","UL"])||wt(e,"li"))});r=="enable"&&(a=e(a).filter(function(e){return!q(e,["ol","ul"])||q(e.parentNode,["ol","ul"])}));if(r=="disable")while(a.length){var f=[];f.push(a.shift());if(q(f[0],t)){cn(f[0],n);continue}while(a.length&&a[0]==f[f.length-1].nextSibling&&!q(a[0],t))f.push(a.shift());var l=Mt(f);on(f,n);for(var c=0;c<f.length;c++)Wt(f[c],n);_t(l,n)}else while(a.length){var f=[];while(!f.length||a.length&&a[0]==f[f.length-1].nextSibling)if(q(a[0],["p","div"]))f.push(pt(a[0],"li",n)),a.shift();else if(q(a[0],["li","ol","ul"]))f.push(a.shift());else{var h=[];while(!h.length||a.length&&a[0]==h[h.length-1].nextSibling&&W(a[0])&&W(h[h.length-1])&&!q(h[h.length-1],"br"))h.push(a.shift());f.push(gt(h,undefined,function(){return document.createElement("li")},n))}if(q(f[0].parentNode,t)||e(f).every(function(e){return q(e,["ol","ul"])}))continue;if(q(f[0].parentNode,i)){var l=Mt(f);on(f,n),gt(f,function(e){return q(e,t)},function(){return document.createElement(t)},n),_t(l,n);continue}Wt(gt(f,function(e){return q(e,t)},function(){if(!V(f[0].parentNode)||!qt(f[0].parentNode)||!V(f[0].parentNode.previousSibling)||!q(f[0].parentNode.previousSibling,t))return document.createElement(t);var e=f[0].parentNode.previousSibling;return Xt(e.lastChild,n),(!V(e.lastChild)||!q(e.lastChild,t))&&e.appendChild(document.createElement(t)),e.lastChild},n),n)}}function pn(t,n){var r=Yt(n),s=A(r,function(t){return t.nodeType==e.Node.ELEMENT_NODE&&V(t)&&(e(t).hasAttribute("align")||t.style.textAlign!=""||q(t,"center"))});for(var u=0;u<s.length;u++){var a=s[u];a.removeAttribute("align"),a.style.textAlign="",a.getAttribute("style")==""&&a.removeAttribute("style"),q(a,["div","span","center"])&&!a.attributes.length&&un(a,n),q(a,"center")&&a.attributes.length&&pt(a,"div",n)}r=Yt(i);var f=[];f=L(r,function(e){return V(e)&&wt(e,"div")&&Jt(e)!=t});while(f.length){var l=[];l.push(f.shift());while(f.length&&f[0]==l[l.length-1].nextSibling)l.push(f.shift());gt(l,function(n){return q(n,"div")&&e(n.attributes).every(function(e){return e.name=="align"&&e.value.toLowerCase()==t||e.name=="style"&&o(n)==1&&n.style.textAlign==t})},function(){var e=document.createElement("div");return e.setAttribute("style","text-align: "+t),e},n)}}function dn(){var e=document.createElement("br");return e.setAttribute("class","aloha-end-br"),e}var n="http://www.w3.org/1999/xhtml",r=!1,i=null,s={},_=0,R=["address","article","aside","blockquote","caption","center","col","colgroup","dd","details","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","listing","menu","nav","ol","p","plaintext","pre","section","summary","table","tbody","td","tfoot","th","thead","tr","ul","xmp"],ot,ut,at,ft,lt,ct;(function(){function r(r){if(!n||n.startContainer!=r.startContainer||n.endContainer!=r.endContainer||n.startOffset!=r.startOffset||n.endOffset!=r.endOffset)e={},t={},n=r.cloneRange()}var e={},t={},n=null;ot=function(t,n){return r(n),e[t]},ut=function(t,n,i){r(i),e[t]=n},at=function(t,n){r(n),delete e[t]},ft=function(e,n){return r(n),t[e]},lt=function(e,n,i){r(i),t[e]=n,e=="backcolor"?t.hilitecolor=n:e=="hilitecolor"&&(t.backcolor=n)},ct=function(e,n){r(n),delete t[e],e=="backcolor"?delete t.hilitecolor:e=="hilitecolor"&&delete t.backcolor}})();var yt=["a","abbr","b","bdi","bdo","cite","code","dfn","em","h1","h2","h3","h4","h5","h6","i","kbd","mark","p","pre","q","rp","rt","ruby","s","samp","small","span","strong","sub","sup","u","var","acronym","listing","strike","xmp","big","blink","font","marquee","nobr","tt"];s.backcolor={action:function(e){/^([0-9a-fA-F]{3}){1,2}$/.test(e)&&(e="#"+e);if(!/^(rgba?|hsla?)\(.*\)$/.test(e)&&!M(e)&&e.toLowerCase()!="transparent")return;Bt("backcolor",e)},standardInlineValueCommand:!0,relevantCssProperty:"backgroundColor",equivalentValues:function(e,t){return O(e)===O(t)}},s.bold={action:function(e,t){j("bold",t)?Bt("bold","normal",t):Bt("bold","bold",t)},inlineCommandActivatedValues:["bold","600","700","800","900"],relevantCssProperty:"fontWeight",equivalentValues:function(e,t){return e==t||e=="bold"&&t=="700"||e=="700"&&t=="bold"||e=="normal"&&t=="400"||e=="400"&&t=="normal"}},s.createlink={action:function(t){if(t==="")return;e(xt(st())).forEach(function(n){e(m(n)).forEach(function(n){V(n)&&q(n,"a")&&e(n).hasAttribute("href")&&n.setAttribute("href",t)})}),Bt("createlink",t)},standardInlineValueCommand:!0},s.fontname={action:function(e){Bt("fontname",e)},standardInlineValueCommand:!0,relevantCssProperty:"fontFamily"},s.fontsize={action:function(t){if(t==="")return;t=jt(t);if(e(["xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large"]).indexOf(t)==-1&&!/^[0-9]+(\.[0-9]+)?(cm|mm|in|pt|pc)$/.test(t))return;Bt("fontsize",t)},indeterm:function(){return e(xt(st(),function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})).map(function(e){return Lt(e,"fontsize")},!0).filter(function(t,n,r){return e(r.slice(0,n)).indexOf(t)==-1}).length>=2},value:function(t){var n=xt(t,function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})[0];n===undefined&&(n=t.startContainer);var r=Lt(n,"fontsize");return Ft(r)},relevantCssProperty:"fontSize"},s.forecolor={action:function(e){/^([0-9a-fA-F]{3}){1,2}$/.test(e)&&(e="#"+e);if(!/^(rgba?|hsla?)\(.*\)$/.test(e)&&!M(e)&&e.toLowerCase()!="transparent")return;Bt("forecolor",e)},standardInlineValueCommand:!0,relevantCssProperty:"color",equivalentValues:function(e,t){return O(e)===O(t)}},s.hilitecolor={action:function(e){/^([0-9a-fA-F]{3}){1,2}$/.test(e)&&(e="#"+e);if(!/^(rgba?|hsla?)\(.*\)$/.test(e)&&!M(e)&&e.toLowerCase()!="transparent")return;Bt("hilitecolor",e)},indeterm:function(){return e(xt(st(),function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})).map(function(e){return Lt(e,"hilitecolor")},!0).filter(function(t,n,r){return e(r.slice(0,n)).indexOf(t)==-1}).length>=2},standardInlineValueCommand:!0,relevantCssProperty:"backgroundColor",equivalentValues:function(e,t){return O(e)===O(t)}},s.italic={action:function(e,t){j("italic",t)?Bt("italic","normal",t):Bt("italic","italic",t)},inlineCommandActivatedValues:["italic","oblique"],relevantCssProperty:"fontStyle"},s.removeformat={action:function(){function t(e){return V(e)&&q(e,["abbr","acronym","b","bdi","bdo","big","blink","cite","code","dfn","em","font","i","ins","kbd","mark","nobr","q","s","samp","small","span","strike","strong","sub","sup","tt","u","var"])}var n=xt(st(),t);e(n).forEach(function(e){while(e.hasChildNodes())ht(e.firstChild,e.parentNode,x(e),range);e.parentNode.removeChild(e)});if(V(st().startContainer)&&st().startContainer.nodeType==e.Node.TEXT_NODE&&st().startOffset!=0&&st().startOffset!=T(st().startContainer))if(st().startContainer==st().endContainer){var r=st().endOffset-st().startOffset,i=st().startContainer.splitText(st().startOffset);st().setStart(i,0),st().setEnd(i,r)}else st().setStart(st().startContainer.splitText(st().startOffset),0);if(V(st().endContainer)&&st().endContainer.nodeType==e.Node.TEXT_NODE&&st().endOffset!=0&&st().endOffset!=T(st().endContainer)){var s=[st().startContainer,st().startOffset],r=[st().endContainer,st().endOffset];st().setEnd(document.documentElement,0),r[0].splitText(r[1]),st().setStart(s[0],s[1]),st().setEnd(r[0],r[1])}e(xt(st(),V)).forEach(function(e){while(t(e.parentNode)&&K(e.parentNode,e))on([e],range)}),e(["subscript","bold","fontname","fontsize","forecolor","hilitecolor","italic","strikethrough","underline"]).forEach(function(e){Bt(e,null)})}},s.strikethrough={action:function(){j("strikethrough")?Bt("strikethrough",null):Bt("strikethrough","line-through")},inlineCommandActivatedValues:["line-through"]},s.subscript={action:function(){var e=j("subscript");Bt("subscript",null),e||Bt("subscript","subscript")},indeterm:function(){var t=xt(st(),function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE});return e(t).some(function(e){return Lt(e,"subscript")=="subscript"})&&e(t).some(function(e){return Lt(e,"subscript")!="subscript"})||e(t).some(function(e){return Lt(e,"subscript")=="mixed"})},inlineCommandActivatedValues:["subscript"]},s.superscript={action:function(){var e=j("superscript");Bt("superscript",null),e||Bt("superscript","superscript")},indeterm:function(){var t=xt(st(),function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE});return e(t).some(function(e){return Lt(e,"superscript")=="superscript"})&&e(t).some(function(e){return Lt(e,"superscript")!="superscript"})||e(t).some(function(e){return Lt(e,"superscript")=="mixed"})},inlineCommandActivatedValues:["superscript"]},s.underline={action:function(){j("underline")?Bt("underline",null):Bt("underline","underline")},inlineCommandActivatedValues:["underline"]},s.unlink={action:function(){var t=st(),n=[];for(var r=t.startContainer;r;r=r.parentNode)q(r,"A")&&e(r).hasAttribute("href")&&n.unshift(r);for(var r=t.startContainer;r!=l(t.endContainer);r=a(r))q(r,"A")&&e(r).hasAttribute("href")&&(k(r,t)||c(r,t.endContainer)||r==t.endContainer)&&n.push(r);for(var i=0;i<n.length;i++)Dt(n[i],"unlink",t)},standardInlineValueCommand:!0};var zt="p";s["delete"]={action:function(t,n){if(!n.collapsed){sn(n);return}fn(n.startContainer,n.startOffset);var r=n.startContainer,i=n.startOffset,s=!1,o=!1;for(;;){i>0&&(s=q(r.childNodes[i-1],"br")||!1,o=q(r.childNodes[i-1],"hr")||!1);if(i==0&&V(r.previousSibling)&&nt(r.previousSibling))r.parentNode.removeChild(r.previousSibling);else if(0<=i-1&&i-1<r.childNodes.length&&V(r.childNodes[i-1])&&(nt(r.childNodes[i-1])||s||o)){r.removeChild(r.childNodes[i-1]),i--;if(s||o){n.setStart(r,i),n.setEnd(r,i);return}}else if(i==0&&W(r)||nt(r))i=x(r),r=r.parentNode;else{if(0<=i-1&&i-1<r.childNodes.length&&V(r.childNodes[i-1])&&q(r.childNodes[i-1],"a")){un(r.childNodes[i-1],n);return}if(!(0<=i-1&&i-1<r.childNodes.length&&!z(r.childNodes[i-1])&&!q(r.childNodes[i-1],["br","img"])))break;r=r.childNodes[i-1],i=T(r)}}Z(r,n),i=n.startOffset;if(r.nodeType==e.Node.TEXT_NODE&&i!=0){n.setStart(r,i),n.setEnd(r,i),n.startOffset-=1,sn(n);return}if(W(r))return;if(0<=i-1&&i-1<r.childNodes.length&&q(r.childNodes[i-1],["br","hr","img"])){n.setStart(r,i),n.setEnd(r,i),sn(n);return}if(q(r,["li","dt","dd"])&&r==r.parentNode.firstChild&&i==0){var u=[];for(var a=r.parentNode;a;a=a.parentNode)q(a,"li")&&u.unshift(a);for(var f=0;f<u.length;f++)Xt(u[f],n);var l=Mt([r]);on([r],n),_t(l,n),q(r,["dd","dt"])&&e(m(r)).every(function(e){return!K(r,e)||!wt(r,e)})&&(r=pt(r,zt,n)),Wt(r,n);for(var f=0;f<u.length;f++)Vt(u[f].parentNode,n);return}var c=r,p=i;for(;;)if(p==0)p=x(c),c=c.parentNode;else{if(!(0<=p-1&&p-1<c.childNodes.length&&V(c.childNodes[p-1])&&nt(c.childNodes[p-1])))break;c.removeChild(c.childNodes[p-1]),p--}if(i==0&&e(m(r).concat(r)).filter(function(e){return V(e)&&K(e,r)&&It(e)}).length){var d=Aloha.createRange();d.setStart(r,0),d.setEnd(r,0),d=Yt(d);var v=L(d,function(e){return V(e)&&!$(e)});for(var f=0;f<v.length;f++)cn(v[f],n);return}if(q(c.childNodes[p],"table"))return;if(0<=p-1&&p-1<c.childNodes.length&&q(c.childNodes[p-1],"table")){n.setStart(c,p-1),n.setEnd(c,p);return}if(i==0&&(q(c.childNodes[p-1],"hr")||q(c.childNodes[p-1],"br")&&(q(c.childNodes[p-1].previousSibling,"br")||!W(c.childNodes[p-1].previousSibling)))){n.setStart(r,i),n.setEnd(r,i),sn(c,p-1,c,p);return}if(q(c.childNodes[p],["li","dt","dd"])&&W(c.childNodes[p].firstChild)&&p!=0){var g=c.childNodes[p-1];W(g.lastChild)&&!q(g.lastChild,"br")&&g.appendChild(document.createElement("br")),W(g.lastChild)&&g.appendChild(document.createElement("br"))}if(q(c.childNodes[p],["li","dt","dd"])&&q(c.childNodes[p-1],["li","dt","dd"]))c=c.childNodes[p-1],p=T(c),r=c.nextSibling,i=0;else while(0<=p-1&&p-1<c.childNodes.length)V(c.childNodes[p-1])&&nt(c.childNodes[p-1])?(c.removeChild(c.childNodes[p-1]),p--):(c=c.childNodes[p-1],p=T(c));var y=Aloha.createRange();y.setStart(c,p),y.setEnd(r,i),sn(y),h(document.body,n.startContainer)||(y.startContainer.hasChildNodes()||y.startContainer.nodeType==e.Node.TEXT_NODE?(n.setStart(y.startContainer,y.startOffset),n.setEnd(y.startContainer,y.startOffset)):(n.setStart(y.startContainer.parentNode,x(y.startContainer)),n.setEnd(y.startContainer.parentNode,x(y.startContainer))))}};var vn=["address","dd","div","dt","h1","h2","h3","h4","h5","h6","p","pre"];return s.formatblock={action:function(t){/^<.*>$/.test(t)&&(t=t.slice(1,-1)),t=t.toLowerCase();if(e(vn).indexOf(t)==-1)return;var n=Yt(st()),r=L(n,function(t){return V(t)&&(Rt(t)||wt(t,"p")||q(t,["dd","dt"]))&&!e(g(t)).some(U)}),i=Mt(r);for(var s=0;s<r.length;s++){var o=r[s];while(e(m(o)).some(function(t){return V(t)&&K(t,o)&&q(t,vn)&&!e(g(t)).some(U)}))on([o],range)}_t(i,range);while(r.length){var a;if(Ut(r[0])){a=[].slice.call(u(r[0].childNodes));var i=Mt(a);un(r[0],range),_t(i,range),r.shift()}else{a=[],a.push(r.shift());while(r.length&&r[0]==a[a.length-1].nextSibling&&!Ut(r[0])&&!q(a[a.length-1],"BR"))a.push(r.shift())}Wt(gt(a,e(["div","p"]).indexOf(t)==-1?function(e){return q(e,t)&&!e.attributes.length}:function(){return!1},function(){return document.createElement(t)},range),range)}},indeterm:function(){var t=Yt(st()),n=A(t,function(e){return tt(e)&&V(e)&&!e.hasChildNodes()});if(!n.length)return!1;var r=null;for(var i=0;i<n.length;i++){var s=n[i];while(V(s.parentNode)&&K(s,s.parentNode)&&!q(s,vn))s=s.parentNode;var o="";V(s)&&q(s,vn)&&!e(g(s)).some(U)&&(o=s.tagName);if(r===null)r=o;else if(r!=o)return!0}return!1},value:function(){var t=Yt(st()),n=A(t,function(e){return tt(e)&&V(e)&&!e.hasChildNodes()});if(!n.length)return"";var r=n[0];while(V(r.parentNode)&&K(r,r.parentNode)&&!q(r,vn))r=r.parentNode;return V(r)&&q(r,vn)&&!e(g(r)).some(U)?r.tagName.toLowerCase():""}},s.forwarddelete={action:function(t,n){if(!n.collapsed){sn(n);return}fn(n.startContainer,n.startOffset);var r=n.startContainer,i=n.startOffset,s=!1,o=!1;for(;;){i<r.childNodes.length&&(s=q(r.childNodes[i],"br")||!1,o=q(r.childNodes[i],"hr")||!1);if(i==T(r)&&V(r.nextSibling)&&nt(r.nextSibling))r.parentNode.removeChild(r.nextSibling);else if(i<r.childNodes.length&&V(r.childNodes[i])&&(nt(r.childNodes[i])||s||o)){r.removeChild(r.childNodes[i]);if(s||o){n.setStart(r,i),n.setEnd(r,i);return}}else if(i<r.childNodes.length&&rt(r.childNodes[i]))i++;else if(i==T(r)&&W(r)||nt(r))i=1+x(r),r=r.parentNode;else{if(!(i<r.childNodes.length&&!z(r.childNodes[i])&&!q(r.childNodes[i],["br","img"])))break;r=r.childNodes[i],i=0}}Z(r,n),i=n.startOffset;if(r.nodeType==e.Node.TEXT_NODE&&i!=T(r)){n.setStart(r,i),n.setEnd(r,i);var u=i+1;while(u!=r.length&&/^[\u0300-\u036f\u0591-\u05bd\u05c1\u05c2]$/.test(r.data[u]))u++;sn(r,i,r,u);return}if(W(r))return;if(i<r.childNodes.length&&q(r.childNodes[i],["br","hr","img"])){n.setStart(r,i),n.setEnd(r,i),sn(r,i,r,i+1);return}var a=r,u=i;for(;;)if(u==T(a))u=1+x(a),a=a.parentNode;else{if(!(u<a.childNodes.length&&V(a.childNodes[u])&&nt(a.childNodes[u])))break;a.removeChild(a.childNodes[u])}if(q(a.childNodes[u-1],"table"))return;if(q(a.childNodes[u],"table")){n.setStart(a,u),n.setEnd(a,u+1);return}if(i==T(r)&&q(a.childNodes[u],["br","hr"])){n.setStart(r,i),n.setEnd(r,i),sn(a,u,a,u+1);return}while(u<a.childNodes.length)V(a.childNodes[u])&&nt(a.childNodes[u])?a.removeChild(a.childNodes[u]):(a=a.childNodes[u],u=0);sn(r,i,a,u)}},s.indent={action:function(){var e=[];for(var t=st().endContainer;t!=st().commonAncestorContainer;t=t.parentNode)q(t,"LI")&&e.unshift(t);for(var t=st().startContainer;t!=st().commonAncestorContainer;t=t.parentNode)q(t,"LI")&&e.unshift(t);for(var t=st().commonAncestorContainer;t;t=t.parentNode)q(t,"LI")&&e.unshift(t);for(var n=0;n<e.length;n++)Xt(e[n,range]);var r=Yt(st()),i=[];i=L(r,function(e){return V(e)&&(wt(e,"div")||wt(e,"ol"))}),i.length&&q(i[0],"LI")&&q(i[0].parentNode,["OL","UL"])&&q(i[0].previousSibling,"LI")&&Xt(i[0].previousSibling,range);while(i.length){var s=[];s.push(i.shift());while(i.length&&i[0]==s[s.length-1].nextSibling)s.push(i.shift());ln(s,range)}}},s.inserthorizontalrule={action:function(t,n){while(n.startOffset==0&&n.startContainer.parentNode)n.setStart(n.startContainer.parentNode,x(n.startContainer));while(n.endOffset==T(n.endContainer)&&n.endContainer.parentNode)n.setEnd(n.endContainer.parentNode,1+x(n.endContainer));sn(n,{blockMerging:!1});if(!V(st().startContainer)&&!X(st().startContainer))return;st().startContainer.nodeType==e.Node.TEXT_NODE&&st().startOffset==0&&(st().setStart(st().startContainer.parentNode,x(st().startContainer)),st().collapse(!0)),st().startContainer.nodeType==e.Node.TEXT_NODE&&st().startOffset==T(st().startContainer)&&(st().setStart(st().startContainer.parentNode,1+x(st().startContainer)),st().collapse(!0));var r=document.createElement("hr");n.insertNode(r),Wt(r,n),n.setStart(r.parentNode,1+x(r)),n.setEnd(r.parentNode,1+x(r)),Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(n)}},s.inserthtml={action:function(t,n){sn(n);if(!V(n.startContainer)&&!X(n.startContainer))return;var r=n.createContextualFragment(t),i=r.lastChild;if(!i)return;var s=g(r);z(n.startContainer)&&e(n.startContainer.childNodes).filter(function(e,t){return V(e)&&rt(e)&&x(e)>=t.startOffset},!0).forEach(function(e){e.parentNode.removeChild(e)}),n.insertNode(r),z(n.startContainer)&&!e(n.startContainer.childNodes).some(tt)&&n.startContainer.appendChild(dn()),n.setStart(i.parentNode,1+x(i)),n.setEnd(i.parentNode,1+x(i));for(var o=0;o<s.length;o++)Wt(s[o],n);it(n)}},s.insertimage={action:function(e){if(e==="")return;var t=st();sn(t,{stripWrappers:!1});if(!V(st().startContainer)&&!X(st().startContainer))return;z(t.startContainer)&&t.startContainer.childNodes.length==1&&q(t.startContainer.firstChild,"br")&&t.startOffset==0&&t.startContainer.removeChild(t.startContainer.firstChild);var n=document.createElement("img");n.setAttribute("src",e),t.insertNode(n),t.setStart(n.parentNode,1+x(n)),t.setEnd(n.parentNode,1+x(n)),Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(t),n.removeAttribute("width"),n.removeAttribute("height")}},s.insertlinebreak={action:function(t,n){sn(n,{stripWrappers:!1});if(!V(n.startContainer)&&!X(n.startContainer))return;if(n.startContainer.nodeType==e.Node.ELEMENT_NODE&&!wt("br",n.startContainer))return;if(n.startContainer.nodeType!=e.Node.ELEMENT_NODE&&!wt("br",n.startContainer.parentNode))return;if(n.startContainer.nodeType==e.Node.TEXT_NODE&&n.startOffset==0){var r=n.startContainer.parentNode,i=x(n.startContainer);Aloha.getSelection().collapse(r,i),n.setStart(r,i),n.setEnd(r,i)}if(n.startContainer.nodeType==e.Node.TEXT_NODE&&n.startOffset==T(n.startContainer)){var r=n.startContainer.parentNode,i=1+x(n.startContainer);Aloha.getSelection().collapse(r,i),n.setStart(r,i),n.setEnd(r,i)}var s=document.createElement("br");n.insertNode(s),Aloha.getSelection().collapse(s.parentNode,1+x(s)),n.setStart(s.parentNode,1+x(s)),n.setEnd(s.parentNode,1+x(s)),Q(s)&&(n.insertNode(dn()),Aloha.getSelection().collapse(s.parentNode,1+x(s)),n.setStart(s.parentNode,1+x(s)),n.setEnd(s.parentNode,1+x(s)))}},s.insertorderedlist={action
:function(){hn("ol")},indeterm:function(){return/^mixed( ol)?$/.test($t())},state:function(){return $t()=="ol"}},s.insertparagraph={action:function(t,n){sn(n);if(!V(n.startContainer)&&!X(n.startContainer))return;var r=n.startContainer,i=n.startOffset;r.nodeType==e.Node.TEXT_NODE&&i!=0&&i!=T(r)&&r.splitText(i),r.nodeType==e.Node.TEXT_NODE&&i==T(r)&&(i=1+x(r),r=r.parentNode);if(r.nodeType==e.Node.TEXT_NODE||r.nodeType==e.Node.COMMENT_NODE)i=x(r),r=r.parentNode;Aloha.getSelection().collapse(r,i),n.setStart(r,i),n.setEnd(r,i);var s=r;while(!Ut(s)&&V(s.parentNode)&&K(r,s.parentNode))s=s.parentNode;if(!V(s)||!K(s,r)||!Ut(s)){var o=zt,u=Yt(n),f=L(u,function(e){return wt(e,"p")}).slice(0,1);if(!f.length){if(!wt(o,n.startContainer))return;s=document.createElement(o),n.insertNode(s),s.appendChild(dn()),Aloha.getSelection().collapse(s,0),n.setStart(s,0),n.setEnd(s,0);return}while(f[f.length-1].nextSibling&&wt(f[f.length-1].nextSibling,"p"))f.push(f[f.length-1].nextSibling);s=gt(f,function(){return!1},function(){return document.createElement(o)},n)}if(s.tagName=="ADDRESS"||s.tagName=="LISTING"||s.tagName=="PRE"){var l=document.createElement("br"),c=s.offsetHeight;n.insertNode(l);var h=s.offsetHeight;Aloha.getSelection().collapse(r,i+1),n.setStart(r,i+1),n.setEnd(r,i+1),c==h&&!p(a(l),s)&&(n.insertNode(dn()),Aloha.getSelection().collapse(r,i+1),n.setEnd(r,i+1));return}if(e(["LI","DT","DD"]).indexOf(s.tagName)!=-1&&(!s.hasChildNodes()||s.childNodes.length==1&&q(s.firstChild,"br"))){on([s],n);if(!s.hasChildNodes()){var c=s.offsetHeight,d=dn();s.appendChild(d),s.offsetHeight!==c&&s.removeChild(d)}q(s,["dd","dt"])&&e(m(s)).every(function(e){return!K(s,e)||!wt(s,e)})&&(s=pt(s,zt,n)),Wt(s,n);if(q(s,"li")&&q(s.nextSibling,"li")&&q(s.nextSibling.firstChild,["ol","ul"])){var v=s.nextSibling,y=s.nextSibling.childNodes.length;for(var b=0;b<y;b++)s.appendChild(v.childNodes[b]);v.parentNode.removeChild(v)}return}var w=Aloha.createRange();w.setStart(n.startContainer,n.startOffset),w.setEnd(s,T(s));while(w.startOffset==0&&w.startContainer!=s)w.setStart(w.startContainer.parentNode,x(w.startContainer));while(w.startOffset==T(w.startContainer)&&w.startContainer!=s)w.setStart(w.startContainer.parentNode,1+x(w.startContainer));var E=L(w),S=!E.length||E.length==1&&q(E[0],"br"),N;/^H[1-6]$/.test(s.tagName)&&S?N=zt:s.tagName=="DT"&&S?N="dd":s.tagName=="DD"&&S?N="dt":N=s.tagName.toLowerCase();var C=document.createElement(N);for(var b=0;b<s.attributes.length;b++)typeof C.setAttributeNS=="function"?C.setAttributeNS(s.attributes[b].namespaceURI,s.attributes[b].name,s.attributes[b].value):s.attributes[b].value.length>0&&s.attributes[b].value!="null"&&s.attributes[b].value>0&&C.setAttribute(s.attributes[b].name,s.attributes[b].value);C.removeAttribute("id"),s.parentNode.insertBefore(C,s.nextSibling);var k=A(w),O=w.extractContents(),M=g(O);for(var b=0;b<M.length;b++)M[b].nodeType==e.Node.ELEMENT_NODE&&e(k).indexOf(M[b])==-1&&M[b].removeAttribute("id");var _=[],D=O.firstChild;if(D)do Y(D)||_.push(D);while(D=D.nextSibling);if(q(C,"li")&&_.length&&q(_[0],["ul","ol"])){var c=C.offsetHeight,d=dn();C.appendChild(d);var h=C.offsetHeight;c!==h&&C.removeChild(d)}C.appendChild(O),s.offsetHeight==0&&!e(s.childNodes).some(tt)&&s.appendChild(dn()),C.offsetHeight==0&&!e(C.childNodes).some(tt)&&C.appendChild(dn()),Aloha.getSelection().collapse(C,0),n.setStart(C,0),n.setEnd(C,0)}},s.inserttext={action:function(t,n){sn(n,{stripWrappers:!1});if(!V(n.startContainer)&&!X(n.startContainer))return;if(t.length>1){for(var r=0;r<t.length;r++)s.inserttext.action(t[r],n);return}if(t=="")return;if(t=="\n"){s.insertparagraph.action("",n);return}var i=n.startContainer,o=n.startOffset;0<=o-1&&o-1<i.childNodes.length&&i.childNodes[o-1].nodeType==e.Node.TEXT_NODE&&(i=i.childNodes[o-1],o=T(i)),0<=o&&o<i.childNodes.length&&i.childNodes[o].nodeType==e.Node.TEXT_NODE&&(i=i.childNodes[o],o=0);var u=i.nodeType==e.Node.ELEMENT_NODE?i:i.parentNode;t==" "&&u.nodeType==e.Node.ELEMENT_NODE&&e(["pre","pre-wrap"]).indexOf(e.getComputedStyle(u).whiteSpace)==-1&&(t=" ");var a=tn(n);if(i.nodeType==e.Node.TEXT_NODE)i.insertData(o,t),Aloha.getSelection().collapse(i,o),n.setStart(i,o),Aloha.getSelection().extend(i,o+1),n.setEnd(i,o+1);else{i.childNodes.length==1&&Q(i.firstChild)&&i.removeChild(i.firstChild);var f=document.createTextNode(t);n.insertNode(f),Aloha.getSelection().collapse(f,0),n.setStart(f,0),Aloha.getSelection().extend(f,1),n.setEnd(f,1)}rn(a),fn(n.startContainer,n.startOffset),fn(n.endContainer,n.endOffset),Aloha.getSelection().collapseToEnd(),n.collapse(!1)}},s.insertunorderedlist={action:function(){hn("ul")},indeterm:function(){return/^mixed( ul)?$/.test($t())},state:function(){return $t()=="ul"}},s.justifycenter={action:function(e,t){pn("center",t)},indeterm:function(){var t=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e(t).some(function(e){return Jt(e)=="center"})&&e(t).some(function(e){return Jt(e)!="center"})},state:function(){var t=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return t.length&&e(t).every(function(e){return Jt(e)=="center"})},value:function(){var e=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e.length?Jt(e[0]):"left"}},s.justifyfull={action:function(e,t){pn("justify",t)},indeterm:function(){var t=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e(t).some(function(e){return Jt(e)=="justify"})&&e(t).some(function(e){return Jt(e)!="justify"})},state:function(){var t=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return t.length&&e(t).every(function(e){return Jt(e)=="justify"})},value:function(){var e=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e.length?Jt(e[0]):"left"}},s.justifyleft={action:function(e,t){pn("left",t)},indeterm:function(){var t=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e(t).some(function(e){return Jt(e)=="left"})&&e(t).some(function(e){return Jt(e)!="left"})},state:function(){var t=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return t.length&&e(t).every(function(e){return Jt(e)=="left"})},value:function(){var e=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e.length?Jt(e[0]):"left"}},s.justifyright={action:function(e,t){pn("right",t)},indeterm:function(){var t=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e(t).some(function(e){return Jt(e)=="right"})&&e(t).some(function(e){return Jt(e)!="right"})},state:function(){var t=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return t.length&&e(t).every(function(e){return Jt(e)=="right"})},value:function(){var e=A(Yt(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e.length?Jt(e[0]):"left"}},s.outdent={action:function(){var t=[];(function(){for(var e=st().endContainer;e!=st().commonAncestorContainer;e=e.parentNode)q(e,"li")&&t.unshift(e);for(var e=st().startContainer;e;e=e.parentNode)q(e,"li")&&t.unshift(e)})(),e(t).forEach(function(e){Xt(e,range)});var n=Yt(st()),r=L(n,function(t){return V(t)&&(!e(g(t)).some(V)||q(t,["ol","ul"])||q(t,"li")&&q(t.parentNode,["ol","ul"]))});while(r.length){while(r.length&&(q(r[0],["OL","UL"])||!q(r[0].parentNode,["OL","UL"])))cn(r.shift(),range);if(!r.length)break;var i=[];i.push(r.shift());while(r.length&&r[0]==i[i.length-1].nextSibling&&!q(r[0],["OL","UL"]))i.push(r.shift());var s=Mt(i);on(i,range),e(i).forEach(Wt),_t(s,range)}}},s.selectall={action:function(){var e=document.body;e||(e=document.documentElement),e?Aloha.getSelection().selectAllChildren(e):Aloha.getSelection().removeAllRanges()}},s.stylewithcss={action:function(e){r=String(e).toLowerCase()!="false"},state:function(){return r}},s.usecss={action:function(e){r=String(e).toLowerCase()=="false"}},function(){var t=[];for(var n in s)t.push(n);e(t).forEach(function(t){"relevantCssProperty"in s[t]||(s[t].relevantCssProperty=null),"inlineCommandActivatedValues"in s[t]&&!("indeterm"in s[t])&&(s[t].indeterm=function(n){var r=e(xt(n,function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})).map(function(e){return Lt(e,t)}),i=e(r).filter(function(n){return e(s[t].inlineCommandActivatedValues).indexOf(n)!=-1});return i.length>=1&&r.length-i.length>=1}),"inlineCommandActivatedValues"in s[t]&&(s[t].state=function(n){var r=xt(n,function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE});return r.length==0?e(s[t].inlineCommandActivatedValues).indexOf(Lt(n.startContainer,t))!=-1:e(r).every(function(n){return e(s[t].inlineCommandActivatedValues).indexOf(Lt(n,t))!=-1})}),"standardInlineValueCommand"in s[t]&&(s[t].indeterm=function(){var n=e(xt(st())).filter(function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE},!0).map(function(e){return Lt(e,t)});for(var r=1;r<n.length;r++)if(n[r]!=n[r-1])return!0;return!1},s[t].value=function(n){var r=xt(n,function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})[0];return typeof r=="undefined"&&(r=n.startContainer),Lt(r,t)})})}(),{commands:s,execCommand:P,queryCommandIndeterm:B,queryCommandState:j,queryCommandValue:I,queryCommandEnabled:H,queryCommandSupported:F}}),define("aloha/command",["aloha/core","aloha/registry","aloha/engine","util/dom","aloha/contenthandlermanager"],function(e,t,n,r,i){var s={execCommand:function(t,s,o,u){if(!u){if(!e.getSelection().getRangeCount())return;u=e.getSelection().getRangeAt(0)}t=="insertHTML"&&(o=i.handleContent(o,{contenthandler:e.settings.contentHandler.insertHtml})),n.execCommand(t,s,o,u);if(e.getSelection().getRangeCount()){u=e.getSelection().getRangeAt(0);var a=u.commonAncestorContainer.parentNode,f=new window.GENTICS.Utils.RangeObject;f.startContainer=u.startContainer,f.startOffset=u.startOffset,f.endContainer=u.endContainer,f.endOffset=u.endOffset,r.doCleanup({merge:!0,removeempty:!1},f,a),f.select()}e.trigger("aloha-command-executed",t)},queryCommandEnabled:function(t,r){if(!r){if(!e.getSelection().getRangeCount())return;r=e.getSelection().getRangeAt(0)}return n.queryCommandEnabled(t,r)},queryCommandIndeterm:function(t,r){if(!r){if(!e.getSelection().getRangeCount())return;r=e.getSelection().getRangeAt(0)}return n.queryCommandIndeterm(t,r)},queryCommandState:function(t,r){if(!r){if(!e.getSelection().getRangeCount())return;r=e.getSelection().getRangeAt(0)}return n.queryCommandState(t,r)},queryCommandSupported:function(e){return n.queryCommandSupported(e)},queryCommandValue:function(t,r){if(!r){if(!e.getSelection().getRangeCount())return;r=e.getSelection().getRangeAt(0)}return n.queryCommandValue(t,r)},querySupportedCommands:function(){var e=[],t;for(t in n.commands)e.push(t);return e}};return s=new(t.extend(s)),e.execCommand=s.execCommand,e.queryCommandEnabled=s.queryCommandEnabled,e.queryCommandIndeterm=s.queryCommandIndeterm,e.queryCommandState=s.queryCommandState,e.queryCommandSupported=s.queryCommandSupported,e.queryCommandValue=s.queryCommandValue,e.querySupportedCommands=s.querySupportedCommands,s}),define("aloha/jquery.patch",["aloha/jquery"],function(e){e.data=function(e){return function(t,n,r,i){if(!e.acceptData(t))return;var s=e.expando,o=typeof n=="string",u,a=t.nodeType,f=a?e.cache:t,l=a?t[e.expando]:t[e.expando]&&e.expando;if((!l||i&&l&&(!f[l]||!f[l][s]))&&o&&r===undefined)return;l||(a?t[e.expando]=l=++e.uuid:l=e.expando),f[l]||(f[l]={},a||(f[l].toJSON=e.noop));if(typeof n=="object"||typeof n=="function")i?f[l][s]=e.extend(f[l][s],n):f[l]=e.extend(f[l],n);return u=f[l],i&&(u[s]||(u[s]={}),u=u[s]),r!==undefined&&(u[e.camelCase(n)]=r),n==="events"&&!u[n]?u[s]&&u[s].events:o?u[e.camelCase(n)]:u}}(e)}),define("aloha/jquery.aloha",["aloha/core","aloha/selection","aloha/jquery","aloha/console"],function(e,t,n,r){var i=window.XMLSerializer;n.fn.between=function(e,t){var n,r;this[0].nodeType!==3?(n=this.children().size(),t>n&&(t=n),t<=0?this.prepend(e):this.children().eq(t-1).after(e)):t<=0?this.before(e):t>=this[0].length?this.after(e):(r=this[0].data,this[0].data=r.substring(0,t),this.after(r.substring(t,r.length)),this.after(e))},n.fn.contentEditable=function(e){var t=n(this),i="contenteditable";return n.browser.msie&&parseInt(n.browser.version,10)==7&&(i="contentEditable"),typeof e=="undefined"?typeof t[0]=="undefined"?(r.error("The jquery object did not contain any valid elements."),undefined):typeof t[0].isContentEditable=="undefined"?(r.warn("Could not determine whether the is editable or not. I assume it is."),!0):t[0].isContentEditable:(e===""?t.removeAttr(i):(e&&e!=="false"?e="true":e="false",t.attr(i,e)),t)},n.fn.aloha=function(){var t=n(this);return e.bind("aloha-ready",function(){t.each(function(){e.isEditable(this)||new e.Editable(n(this))})}),t},n.fn.mahalo=function(){return this.each(function(){e.isEditable(this)&&e.getEditableById(n(this).attr("id")).destroy()})},n.fn.contentEditableSelectionChange=function(e){var r=this;return this.keyup(function(n){var r=t.getRangeObject();e(n)}),this.dblclick(function(t){e(t)}),this.mousedown(function(e){r.selectionStarted=!0}),n(document).mouseup(function(n){t.eventOriginalTarget=r,r.selectionStarted&&e(n),t.eventOriginalTarget=!1,r.selectionStarted=!1}),this},n.fn.outerHtml=n.fn.outerHtml||function(){var e=n(this),t=e.get(0);if(typeof t.outerHTML!="undefined")return t.outerHTML;try{return(new i).serializeToString(t)}catch(r){try{return t.xml}catch(r){}}},n.fn.zap=function(){return this.each(function(){n(this.childNodes).insertBefore(this)}).remove()},n.fn.textNodes=function(e,t){var r=[],i=function(s){if(s.nodeType===3&&n.trim(s.data)&&!t||s.nodeType===3&&t||s.nodeName=="BR"&&!e)r.push(s);else for(var o=0,u=s.childNodes.length;o<u;++o)i(s.childNodes[o])};return i(this[0]),n(r)},n.extendObjects=n.fn.extendObjects=function(){var e,t,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;typeof u=="boolean"&&(l=u,u=arguments[1]||{},a=2),typeof u!="object"&&!n.isFunction(u)&&(u={}),f===a&&(u=this,--a);for(;a<f;a++)if((e=arguments[a])!=null)for(t in e){r=u[t],i=e[t];if(u===i)continue;l&&i&&(n.isPlainObject(i)||(s=n.isArray(i)))?(s?(s=!1,o=r&&n.isArray(r)?r:[]):o=r&&n.isPlainObject(r)?r:{},n.isArray(i)?u[t]=i:u[t]=n.extendObjects(l,o,i)):i!==undefined&&(u[t]=i)}return u},n.isBoolean=function(e){return e===!0||e===!1},n.isNumeric=function(e){return!isNaN(e-0)}}),define("aloha/sidebar",["aloha/core","aloha/jquery","aloha/selection"],function(e,t,n,r){function f(e,t){return e.replace(/\{([a-z0-9\-\_]+)\}/ig,function(e,n,r,i){var s=t[n]||e;return typeof s=="function"?s():s})}function l(e){return typeof e=="string"?f(e,a):e}function c(){var e=[],n=o;return t.each(arguments,function(){e.push("."+(this==""?n:n+"-"+this))}),t.trim(e.join(" "))}function h(){var e=[],n=o;return t.each(arguments,function(){e.push(this==""?n:n+"-"+this)}),t.trim(e.join(" "))}var i=t,s=void 0,o="aloha-sidebar",u=+(new Date),a={bar:h("bar"),handle:h("handle"),inner:h("inner"),panels:h("panels"),"config-btn":h("config-btn"),"handle-icon":h("handle-icon"),"panel-content":h("panel-content"),"panel-content-inner":h("panel-content-inner"),"panel-content-inner-text":h("panel-content-inner-text"),"panel-title":h("panel-title"),"panel-title-arrow":h("panel-title-arrow"),"panel-title-text":h("panel-title-text")};t.easing.easeOutExpo||t.extend(t.easing,{easeOutExpo:function(e,t,n,r,i){return t==i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n},easeOutElastic:function(e,t,n,r,i){var s=Math,o=1.70158,u=0,a=r;if(!t)return n;if((t/=i)==1)return n+r;u||(u=i*.3);if(a<s.abs(r)){a=r;var o=u/4}else var o=u/(2*s.PI)*s.asin(r/a);return a*s.pow(2,-10*t)*s.sin((t*i-o)*2*s.PI/u)+r+n}});var p=function(r){var i=this;this.id=h(++u),this.panels={},this.container=t(l('<div class="{bar}"><div class="{handle}"><span class="{handle-icon}"></span></div><div class="{inner}"><ul class="{panels}"></ul></div></div>')),this.width=300,this.opened=!1,this.isOpen=!1,this.settings={rotateIcons:!t.browser.msie,overlayPage:!0},t(function(){(typeof e.settings.sidebar=="undefined"||!e.settings.sidebar.disabled)&&i.init(r)})};t.extend(p.prototype,{init:function(e){var n=this,r;typeof e=="object"&&(r=e.panels,delete e.panels),t.extend(this,e),typeof r=="object"&&t.each(r,function(){n.addPanel(this,!0)});var i=this.container;this.position=="right"&&i.addClass(h("right")),i.hide().appendTo(t("body")).click(function(){n.barClicked.apply(n,arguments)}).find(c("panels")).width(this.width),i.width(this.width),this.width=i.width(),t(window).resize(function(){n.updateHeight()}),this.updateHeight(),this.roundCorners(),this.initToggler(),this.container.css(this.position=="right"?"marginRight":"marginLeft",-this.width),this.opened&&this.open(0),this.toggleHandleIcon(this.isOpen),this.subscribeToEvents(),t(window).resize(function(){n.correctHeight()}),this.correctHeight()},show:function(){return this.container.css("display","block"),this},hide:function(){return this.container.css("display","none"),this},checkActivePanels:function(e){var n=[];if(typeof e!="undefined"&&typeof e.markupEffectiveAtStart!="undefined"){var r=e.markupEffectiveAtStart.length;for(var i=0;i<r;++i)n.push(t(e.markupEffectiveAtStart[i]))}var s=this;t.each(this.panels,function(){s.showActivePanel(this,n)}),this.correctHeight()},subscribeToEvents:function(){var t=this,n=this.container;e.bind("aloha-selection-changed",function(e,n){t.checkActivePanels(n)}),n.mousedown(function(t){t.originalEvent.stopSelectionUpdate=!0,e.eventHandled=!0}),n.mouseup(function(t){t.originalEvent.stopSelectionUpdate=!0,e.eventHandled=!1}),e.bind("aloha-editable-deactivated",function(e,n){t.checkActivePanels()})},correctHeight:function(){var e=this.container.find(c("inner")).height()-30,n=[];t.each(this.panels,function(){this.isActive&&n.push(this)});if(n.length==0)return;var r=e-(n[0].title.outerHeight()+10)*n.length,i,s,o,u,a,f=0,l=Math;while(n.length>0&&r>0){r+=f,f=0,a=[];for(var h=n.length-1;h>=0;--h)i=n[h],o=i.content.find(c("panel-content-inner")),s=l.min(o.height("auto").height(),l.floor(r/(h+1))),o.height(s),r-=s,u=o.find(c("panel-content-inner-text")),u.height()>s?(a.push(i),f+=s,o.css({"overflow-x":"hidden","overflow-y":"scroll"})):o.css("overflow-y","hidden"),i.expanded&&i.expand();n=a}},showActivePanel:function(e,n){n.push(null);var r=n.length,i=0,s=e.content.parent("li"),o=e.activeOn,u=t();for(var a=0;a<r;++a)o(n[a])&&(++i,n[a]&&t.merge(u,n[a]));i?e.activate(u):e.deactivate(),this.roundCorners()},initToggler:function(){var n=this,r=this.container,i=r.find(c("handle-icon")),s=h("toggled"),o,u=this.position=="right";this.opened&&this.rotateHandleArrow(u?0:180,0),t(function(){typeof e.settings.sidebar!="undefined"&&e.settings.sidebar.handle&&e.settings.sidebar.handle.top&&(t(r.find(c("handle"))).get(0).style.top=e.settings.sidebar.handle.top)}),r.find(c("handle")).click(function(){o&&clearInterval(o),i.stop().css("marginLeft",4),n.isOpen?(t(this).removeClass(s),n.close(),n.isOpen=!1):(t(this).addClass(s),n.open(),n.isOpen=!0)}).hover(function(){var e=n.isOpen?-1:1;o&&clearInterval(o),i.stop(),t(this).stop().animate(u?{marginLeft:"-="+e*5}:{marginRight:"-="+e*5},200),o=setInterval(function(){e*=-1,i.animate(u?{left:"-="+e*4}:{right:"-="+e*4},300)},300)},function(){o&&clearInterval(o),i.stop().css(u?"left":"right",5),t(this).stop().animate(u?{marginLeft:0}:{marginRight:0},600,"easeOutElastic")})},roundCorners:function(){var e=this.container,t=e.find(c("panels>li:not(","deactivated)")),n=h("panel-top"),r=h("panel-bottom");e.find(c("panel-top,","panel-bottom")).removeClass(n).removeClass(r),t.first().find(c("panel-title")).addClass(n),t.last().find(c("panel-content")).addClass(r)},updateHeight:function(){var e=t(window).height();this.container.height(e).find(c("inner")).height(e)},barClicked:function(e){this.handleBarclick(t(e.target))},handleBarclick:function(e){e.hasClass(h("panel-title"))?this.togglePanel(e):e.hasClass(h("panel-content"))||e.hasClass(h("handle"))||e.hasClass(h("bar"))||this.handleBarclick(e.parent())},getPanelById:function(e){return this.panels[e]},getPanelByElement:function(e){var t=e[0].tagName=="LI"?e:e.parent("li");return this.getPanelById(t[0].id)},togglePanel:function(e){this.getPanelByElement(e).toggle()},rotateHandleIcon:function(e,t){var n=this.container.find(c("handle-icon"));n.animate({angle:e},{duration:typeof t=="number"||typeof t=="string"?t:500,easing:"easeOutExpo",step:function(e,t){n.css({"-o-transform":"rotate("+e+"deg)","-webkit-transform":"rotate("+e+"deg)","-moz-transform":"rotate("+e+"deg)","-ms-transform":"rotate("+e+"deg)"})}})},toggleHandleIcon:function(e){var t=this.position=="right"^e;if(this.settings.rotateIcons)this.rotateHandleIcon(t?180:0,0);else{var n=this.container.find(c("handle-icon"));t?n.addClass(h("handle-icon-left")):n.removeClass(h("handle-icon-left"))}},open:function(e,n){if(this.isOpen)return this;var r=this.position=="right",i=r?{marginRight:0}:{marginLeft:0};return this.toggleHandleIcon(!0),this.container.animate(i,typeof e=="number"||typeof e=="string"?e:500,"easeOutExpo"),this.settings.overlayPage||t("body").animate(r?{marginRight:"+="+this.width}:{marginLeft:"+="+this.width},500,"easeOutExpo"),this.isOpen=!0,t("body").trigger(h("opened"),this),this},close:function(e,n){if(!this.isOpen)return this;var r=this.position=="right",i=r?{marginRight:-this.width}:{marginLeft:-this.width};return this.toggleHandleIcon(!1),this.container.animate(i,typeof e=="number"||typeof e=="string"?e:500,"easeOutExpo"),this.settings.overlayPage||t("body").animate(r?{marginRight:"-="+this.width}:{marginLeft:"-="+this.width},500,"easeOutExpo"),this.isOpen=!1,this},activatePanel:function(e,t){return typeof e=="string"&&(e=this.getPanelById(e)),e&&e.activate(t),this.roundCorners(),this},expandPanel:function(e,t){return typeof e=="string"&&(e=this.getPanelById(e)),e&&e.expand(t),this},collapsePanel:function(e,t){return typeof e=="string"&&(e=this.getPanelById(e)),e&&e.collapse(t),this},addPanel:function(e,t){return e instanceof d||(e.width||(e.width=this.width),e.sidebar=this,e=new d(e)),this.panels[e.id]=e,this.container.find(c("panels")).append(e.element),t!==!0&&this.roundCorners(),this.checkActivePanels(n.getRangeObject()),e}});var d=function(n){this.id=null,this.folds={},this.button=null,this.title=t(l('						 			<div class="{panel-title}">							 				<span class="{panel-title-arrow}"></span>		 				<span class="{panel-title-text}">Untitled</span> 			</div>												 		')),this.content=t(l('								<div class="{panel-content}">									<div class="{panel-content-inner}">								<div class="{panel-content-inner-text}">					</div>													</div>													</div>													')),this.element=null,this.expanded=!1,this.effectiveElement=null,this.isActive=!0,this.init(n)};t.extend(d.prototype,{init:function(e){this.setTitle(e.title).setContent(e.content),delete e.title,delete e.content,t.extend(this,e),this.id||(this.id=h(++u));var n=this.element=t('<li id="'+this.id+'">').append(this.title,this.content);this.expanded&&this.content.height("auto"),this.toggleTitleIcon(this.expanded),this.coerceActiveOn(),this.title.attr("unselectable","on").css("-moz-user-select","none").each(function(){this.onselectstart=function(){return!1}}),typeof this.onInit=="function"&&this.onInit.apply(this)},toggleTitleIcon:function(e){if(this.sidebar.settings.rotateIcons)this.rotateTitleIcon(e?90:0);else{var t=this.title.find(c("panel-title-arrow"));e?t.addClass(h("panel-title-arrow-down")):t.removeClass(h("panel-title-arrow-down"))}},coerceActiveOn:function(){if(typeof this.activeOn!="function"){var e=this.activeOn;this.activeOn=function(){var t=typeof e,n;return t=="boolean"?n=function(){return e}:t=="undefined"?n=function(){return!0}:t=="string"?n=function(t){return t?t.is(e):!1}:n=function(){return!1},n}()}},activate:function(e){this.isActive=!0,this.content.parent("li").show().removeClass(h("deactivated")),this.effectiveElement=e,typeof this.onActivate=="function"&&this.onActivate.call(this,e)},deactivate:function(){this.isActive=!1,this.content.parent("li").hide().addClass(h("deactivated")),this.effectiveElement=null},toggle:function(){this.expanded?this.collapse():this.expand()},expand:function(e){var t=this,n=this.content,r=n.height(),i=n.height("auto").height();return n.height(r).stop().animate({height:i},500,"easeOutExpo",function(){typeof e=="function"&&e.call(t)}),this.element.removeClass("collapsed"),this.toggleTitleIcon(!0),this.expanded=!0,this},collapse:function(e,t){var n=this;return this.element.addClass("collapsed"),this.content.stop().animate({height:5},250,"easeOutExpo",function(){typeof t=="function"&&t.call(n)}),this.toggleTitleIcon(!1),this.expanded=!1,this},setTitle:function(e){return this.title.find(c("panel-title-text")).html(e),this},setContent:function(e){if(!e||e=="")e="&nbsp;";return this.content.find(c("panel-content-inner-text")).html(e),this},rotateTitleIcon:function(e,t){var n=this.title.find(c("panel-title-arrow"));n.animate({angle:e},{duration:typeof t=="number"?t:500,easing:"easeOutExpo",step:function(e,t){n.css({"-o-transform":"rotate("+e+"deg)","-webkit-transform":"rotate("+e+"deg)","-moz-transform":"rotate("+e+"deg)","-ms-transform":"rotate("+e+"deg)"})}})},renderEffectiveParents:function(e,n){var r=e.first(),i=[],s=[],o=this.activeOn,u,a;while(r.length>0&&!r.is(".aloha-editable")){if(o(r)){s.push("<span>"+r[0].tagName.toLowerCase()+"</span>"),u=s.length,a=[];while(u--)a.push(s[u]);i.push(f('<div class="aloha-sidebar-panel-parent"><div class="aloha-sidebar-panel-parent-path">{path}</div><div class="aloha-sidebar-panel-parent-content aloha-sidebar-opened">{content}</div></div>',{path:a.join(""),content:typeof n=="function"?n(r):"----"}))}r=r.parent()}this.setContent(i.join("")),t(".aloha-sidebar-panel-parent-path").click(function(){var e=t(this).parent().find(".aloha-sidebar-panel-parent-content");e.hasClass("aloha-sidebar-opened")?e.hide().removeClass("aloha-sidebar-opened"):e.show().addClass("aloha-sidebar-opened")}),this.content.height("auto").find(".aloha-sidebar-panel-content-inner").height("auto")}});var v=new p({position:"left",width:250}),m=new p({position:"right",width:250});return e.Sidebar={left:v,right:m},e.Sidebar}),GENTICS=window.GENTICS||{},GENTICS.Utils=GENTICS.Utils||{},define("util/position",["aloha/jquery"],function(e){var t=e,n=window.GENTICS,r=window.Class,i=window.console;n.Utils.Position={},n.Utils.Position.w=e(window),n.Utils.Position.Scroll={top:0,left:0,isScrolling:!1},n.Utils.Position.ScrollCorrection={top:100,left:50},n.Utils.Position.Mouse={x:0,y:0,oldX:0,oldY:0,isMoving:!1,triggeredMouseStop:!0},n.Utils.Position.mouseStopCallbacks=[],n.Utils.Position.mouseMoveCallbacks=[],n.Utils.Position.update=function(){var e=this.w.scrollTop(),t=this.w.scrollLeft(),n;if(this.Scroll.isScrolling)this.Scroll.top==e&&this.Scroll.left==t&&(this.Scroll.isScrolling=!1);else if(this.Scroll.top!=e||this.Scroll.left!=t)this.Scroll.isScrolling=!0;this.Scroll.top=e,this.Scroll.left=t;if(this.Mouse.x==this.Mouse.oldX&&this.Mouse.y==this.Mouse.oldY){this.Mouse.isMoving=!1;if(!this.Mouse.triggeredMouseStop){this.Mouse.triggeredMouseStop=!0;for(n=0;n<this.mouseStopCallbacks.length;n++)this.mouseStopCallbacks[n].call()}}else{this.Mouse.isMoving=!0,this.Mouse.triggeredMouseStop=!1;for(n=0;n<this.mouseMoveCallbacks.length;n++)this.mouseMoveCallbacks[n].call()}this.Mouse.oldX=this.Mouse.x,this.Mouse.oldY=this.Mouse.y},n.Utils.Position.addMouseStopCallback=function(e){return this.mouseStopCallbacks.push(e),this.mouseStopCallbacks.length-1},n.Utils.Position.addMouseMoveCallback=function(e){return this.mouseMoveCallbacks.push(e),this.mouseMoveCallbacks.length-1},e(function(){setInterval(function(){n.Utils.Position.update()},500)}),e("html").mousemove(function(e){n.Utils.Position.Mouse.x=e.pageX,n.Utils.Position.Mouse.y=e.pageY})}),define("aloha/repositorymanager",["aloha/core","util/class","aloha/jquery","aloha/console"],function(e,t,n,r){return e.RepositoryManager=t.extend({repositories:[],settings:{},init:function(){var t=this.repositories,r=0,i=t.length,s;e.settings&&e.settings.repositories&&(this.settings=e.settings.repositories),this.settings.timeout=this.settings.timeout||5e3;for(;r<i;++r)s=t[r],s.settings||(s.settings={}),this.settings[s.repositoryId]&&n.extend(s.settings,this.settings[s.repositoryId]),s.init()},register:function(e){this.getRepository(e.repositoryId)?r.warn(this,"A repository with name { "+e.repositoryId+" } already registerd. Ignoring this."):this.repositories.push(e)},getRepository:function(e){var t=this.repositories,n=0,r=t.length;for(;n<r;++n)if(t[n].repositoryId===e)return t[n];return null},query:function(e,t){var r=this,i,s=[],o={numItems:0,hasMoreItems:!1},u=[],a=0,f,l,c,h=function(e,i){if(a===0)return;var u=e?e.length:0;if(u){if(!e[0].repositoryId){var l=this.repositoryId,c;for(c=0;c<u;++c)e[c].repositoryId=l}n.merge(s,e)}i&&o?(n.isNumeric(i.numItems)&&n.isNumeric(o.numItems)?o.numItems+=i.numItems:o.numItems=undefined,n.isBoolean(i.hasMoreItems)&&n.isBoolean(o.hasMoreItems)?o.hasMoreItems=o.hasMoreItems||i.hasMoreItems:o.hasMoreItems=undefined):o=undefined,--a===0&&r.queryCallback(t,s,o,f)},p=parseInt(e.timeout,10)||this.settings.timeout;f=setTimeout(function(){a=0,r.queryCallback(t,s,o,f)},p),e.repositoryId?u.push(this.getRepository(e.repositoryId)):u=this.repositories,c=u.length;var d=[];for(l=0;l<c;++l)i=u[l],typeof i.query=="function"&&(++a,d.push(i));c=d.length;for(l=0;l<c;++l)i=d[l],i.query(e,function(){h.apply(i,arguments)});a===0&&this.queryCallback(t,s,o,f)},queryCallback:function(e,t,n,r){r&&(clearTimeout(r),r=undefined);var i={items:t,results:t.length};n&&(i.numItems=n.numItems,i.hasMoreItems=n.hasMoreItems),e.call(this,i)},getChildren:function(t,r){var i=this,s,o=[],u=[],a=0,f,l,c,h=function(e){if(a===0)return;n.merge(o,e),--a===0&&i.getChildrenCallback(r,o,f)};if(t.inFolderId==="aloha"){var p=t.repositoryFilter,d=p&&p.length;c=this.repositories.length;for(l=0;l<c;++l)s=this.repositories[l],(!d||n.inArray(s.repositoryId,p)>-1)&&u.push(new e.RepositoryFolder({id:s.repositoryId,name:s.repositoryName,repositoryId:s.repositoryId,type:"repository",hasMoreItems:!0}));i.getChildrenCallback(r,u,null);return}u=this.repositories;var v=parseInt(t.timeout,10)||this.settings.timeout;f=setTimeout(function(){a=0,i.getChildrenCallback(r,o,f)},v),c=u.length;for(l=0;l<c;++l)s=u[l],typeof s.getChildren=="function"&&(++a,s.getChildren(t,function(){h.apply(s,arguments)}));a===0&&this.getChildrenCallback(r,o,f)},getChildrenCallback:function(e,t,n){n&&(clearTimeout(n),n=undefined),e.call(this,t)},makeClean:function(e){var t=this,n={},i=0,s=t.repositories.length;e.find("[data-gentics-aloha-repository="+this.prefix+"]").each(function(){for(;i<s;++i)n.makeClean(e);r.debug(t,"Passing contents of HTML Element with id { "+this.attr("id")+" } for cleaning to repository { "+n.repositoryId+" }"),n.makeClean(this)})},markObject:function(e,t){if(!e)return;if(t){var i=this.getRepository(t.repositoryId);i?(n(e).attr({"data-gentics-aloha-repository":t.repositoryId,"data-gentics-aloha-object-id":t.id}),i.markObject(e,t)):r.error(this,"Trying to apply a repository { "+t.name+" } to an object, but item has no repositoryId.")}else n(e).removeAttr("data-gentics-aloha-repository").removeAttr("data-gentics-aloha-object-id")},getObject:function(e,t){var r=this,i=n(e),s=this.getRepository(i.attr("data-gentics-aloha-repository")),o=i.attr("data-gentics-aloha-object-id");s&&o&&(this.itemCache=this.itemCache||[],this.itemCache[s.repositoryId]=this.itemCache[s.repositoryId]||[],this.itemCache[s.repositoryId][o]?t.call(this,[this.itemCache[s.repositoryId][o]]):s.getObjectById(o,function(e){r.itemCache[s.repositoryId][o]=e[0],t.call(this,e)}))},toString:function(){return"repositorymanager"}}),e.RepositoryManager=new e.RepositoryManager,e.RepositoryManager}),function(){function t(e,t,n,r,i,s){t[e]&&(n.push(e),(t[e]===!0||t[e]===1)&&r.push(i+e+"/"+s))}function n(e,t,n,r,i){var s=r+t+"/"+i;require._fileExists(e.nameToUrl(s,null))&&n.push(s)}var e=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",{version:"0.24.0",load:function(r,i,s,o){o=o||{};var u,a=e.exec(r),f=a[1],l=a[4],c=a[5],h=l.split("-"),p=[],d={},v,m,g="";a[5]?(f=a[1],u=f+c):(u=r,c=a[4],l=o.locale||(o.locale=typeof navigator=="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),h=l.split("-"));if(o.isBuild){p.push(u),n(i,"root",p,f,c);for(v=0;m=h[v];v++)g+=(g?"-":"")+m,n(i,g,p,f,c);i(p),s()}else i([u],function(e){var n=[];t("root",e,n,p,f,c);for(v=0;m=h[v];v++)g+=(g?"-":"")+m,t(g,e,n,p,f,c);i(p,function(){var t,r;for(t=n.length-1;t>-1&&(m=n[t]);t--){r=e[m];if(r===!0||r===1)r=i(f+m+"/"+c);require.mixin(d,r)}d.t=function(e){return this[e]?this[e]:e},s(d)})})}})}(),define("aloha/nls/i18n",{root:{"plugin.abbr.floatingmenu.tab.abbr":"Abbreviation","floatingmenu.tab.format":"Format","floatingmenu.tab.insert":"Insert",yes:"Yes",no:"No",cancel:"Cancel","repository.no_item_found":"No item found."
,"repository.loading":"Loading","repository.no_items_found_yet":"No items found yet..."},de:!0}),define("aloha/ext-alohaproxy",["aloha/jquery","aloha/ext","aloha/repositorymanager","aloha/console","i18n!aloha/nls/i18n"],function(e,t,n,r){t.data.AlohaProxy=function(){var e={};e[t.data.Api.actions.read]=!0,t.data.AlohaProxy.superclass.constructor.call(this,{api:e}),this.params={queryString:null,objectTypeFilter:null,filter:null,inFolderId:null,orderBy:null,maxItems:null,skipCount:null,renditionFilter:null,repositoryId:null}};var i=Aloha.require("i18n!aloha/nls/i18n");t.extend(t.data.AlohaProxy,t.data.DataProxy,{doRequest:function(t,i,s,o,u,a,f){e.extend(this.params,s);try{n.query(this.params,function(e){u.call(a,o.readRecords(e),f,!0)})}catch(l){return r.error("Ext.data.AlohaProxy","An error occured while querying repositories."),this.fireEvent("loadexception",this,null,f,l),this.fireEvent("exception",this,"response",t,f,null,l),!1}},setObjectTypeFilter:function(e){this.params.objectTypeFilter=e},getObjectTypeFilter:function(){return this.params.objectTypeFilter},setParams:function(t){e.extend(this.params,t)}})}),define("aloha/ext-alohareader",["aloha/ext"],function(e){e.data.AlohaObjectReader=function(t,n){t={},e.applyIf(t,{idProperty:"id",root:"items",totalProperty:"results",fields:["id","url","name","type","weight","path","repositoryId"]}),e.data.JsonReader.superclass.constructor.call(this,t,t.fields)},e.extend(e.data.AlohaObjectReader,e.data.JsonReader,{})}),define("aloha/ext-alohatreeloader",["aloha/ext","aloha/repositorymanager"],function(e,t){e.tree.AlohaTreeLoader=function(t){e.apply(this,t),e.tree.AlohaTreeLoader.superclass.constructor.call(this)},e.extend(e.tree.AlohaTreeLoader,e.tree.TreeLoader,{paramOrder:["node","id"],nodeParameter:"id",directFn:function(e,n,r){var i={inFolderId:e.id,objectTypeFilter:this.objectTypeFilter,repositoryId:e.repositoryId};t.getChildren(i,function(t){var n={};n={status:!0,scope:this,argument:{callback:r,node:e}},typeof r=="function"&&r(t,n)})},createNode:function(t){return t.name&&(t.text=t.name),t.hasMoreItems&&(t.leaf=!t.hasMoreItems),t.objectType&&(t.cls=t.objectType),e.tree.TreeLoader.prototype.createNode.call(this,t)},objectTypeFilter:null,setObjectTypeFilter:function(e){this.objectTypeFilter=e},getObjectTypeFilter:function(){return this.objectTypeFilter}})}),define("aloha/ui",["aloha/core","util/class","aloha/jquery","aloha/floatingmenu","aloha/ext","aloha/console","i18n!aloha/nls/i18n"],function(e,t,n,r,i,s,o){var u=window.GENTICS;return e.ui=e.ui||{},i.MessageBox.buttonText.yes=o.t("yes"),i.MessageBox.buttonText.no=o.t("no"),i.MessageBox.buttonText.cancel=o.t("cancel"),i.ux.GENTICSMenu=i.extend(i.menu.Menu,{onRender:function(){i.ux.GENTICSMenu.superclass.onRender.apply(this,arguments),n(this.el.dom).mousedown(function(e){e.stopPropagation()})}}),e.ui.Button=t.extend({_constructor:function(e){this.init(e)},init:function(e){this.label=!1,this.name=!1,this.iconClass=!1,this.icon=!1,this.onclick=!1,this.menu=null,this.toggle=!1,this.pressed=!1,this.visible=!0,this.enabled=!0,this.tooltip=!1,this.extButton=null,this.listenerQueue=[],u.Utils.applyProperties(this,e),this.name===!1&&(this.name=this.iconClass),this.id=this.generateId()},generateId:function(){return e.ui.Button.idCounter=e.ui.Button.idCounter+1,"aloha-button"+e.ui.Button.idCounter},setPressed:function(e){this.toggle&&(this.pressed=e,typeof this.extButton=="object"&&this.extButton!=null&&this.extButton.pressed!=e&&this.extButton.toggle(this.pressed))},isPressed:function(){return this.toggle?this.pressed:!1},show:function(){this.visible=!0},hide:function(){this.visible=!1},isVisible:function(){return this.visible},enable:function(){this.enabled=!0,typeof this.extButton=="object"&&this.extButton.enable()},disable:function(){this.enabled=!1,typeof this.extButton=="object"&&this.extButton.disable()},isEnabled:function(){return this.enabled},getExtMenu:function(){var e,t,n;if(this.menu&&typeof this.menu=="object"){e=new i.ux.GENTICSMenu;for(t=0;t<this.menu.length;++t)n=this.menu[t],e.addItem(new i.menu.Item(n.getExtMenuConfigProperties()))}return e},getExtMenuConfigProperties:function(){var e=this,t=this.getExtMenu();return{text:this.label,icon:this.icon,iconCls:this.iconClass,handler:function(){typeof e.onclick=="function"&&e.onclick()},menu:t}},getExtConfigProperties:function(){var e=this,t=this.getExtMenu(),n={text:this.label,enableToggle:this.toggle,pressed:this.pressed,icon:this.icon,iconCls:this.iconClass,scale:this.scale||this.size,width:this.width||undefined,rowspan:this.rowspan||(this.size=="large"||this.size=="medium"?2:1),menu:t,handler:function(t,n){typeof e.onclick=="function"&&e.onclick.apply(e,[t,n]),e.toggle&&(e.pressed=!e.pressed)},xtype:t&&typeof this.onclick=="function"?"splitbutton":"button",tooltipType:"qtip",tooltip:this.tooltip,id:this.id,arrowAlign:this.arrowAlign||(this.size=="large"||this.size=="small"?"right":"bottom")};return n}}),e.ui.Button.idCounter=0,i.ux.MultiSplitButton=i.extend(i.Component,{initComponent:function(){var e=this;this.on("beforehide",function(){e.closePanel()})},autoEl:{cls:"aloha-multisplit-wrapper"},ulObj:null,panelButton:null,wrapper:null,panelOpened:!1,_getItems:function(){var t=this,r=[],i,s;return e.settings.components&&e.settings.components[this.name]&&typeof e.settings.components[this.name]=="object"?(n.each(e.settings.components[this.name],function(e,n){for(i=0,s=t.items.length;i<s;i++)if(t.items[i].name===n){r.push(t.items[i]);break}}),r):this.items},onRender:function(){i.ux.MultiSplitButton.superclass.onRender.apply(this,arguments),this.wrapper=n(this.el.dom);var e=this,t,s,o,u='<ul class="aloha-multisplit">';o=this._getItems();for(t=0;t<o.length;t++){s=o[t],typeof s.visible=="undefined"&&(s.visible=!0);if(s.wide)continue;u+='<li><button xmlns:ext="http://www.extjs.com/" class="'+s.iconClass+'" ext:qtip="'+s.tooltip+'" gtxmultisplititem="'+t+'">&#160;</button>'+"</li>"}for(t=0;t<o.length;t++){s=o[t];if(!s.wide)continue;u+='<li><button xmlns:ext="http://www.extjs.com/" class="aloha-multisplit-wide '+s.iconClass+'" ext:qtip="'+s.tooltip+'" gtxmultisplititem="'+t+'">'+s.text+"</button>"+"</li>"}u+="</ul>",r.extTabPanel.on("move",function(){e.closePanel()}),r.extTabPanel.on("tabchange",function(){e.closePanel()}),this.ulObj=n(this.el.createChild(u).dom).click(function(t){e.onClick(t)}),this.panelButton=n(this.el.createChild('<button class="aloha-multisplit-toggle aloha-multisplit-toggle-open">&#160;</button>').dom).click(function(){e.togglePanel()})},onClick:function(e){if(!e.target.attributes.gtxmultisplititem)return;var t=n(e.target);this.closePanel(),t.hasClass("aloha-multisplit-wide")||this.setActiveDOMElement(t),this.items[e.target.attributes.gtxmultisplititem.value].click()},setActiveItem:function(e){var t;this.closePanel(),t=n("#"+this.id+" .aloha-button-"+e),t.length===1?(this.setActiveDOMElement(t),this.activeItem=e):(this.setActiveDOMElement(null),this.activeItem=null)},setActiveDOMElement:function(e){var t=this,r;while(typeof t!="undefined"){if(t.hidden){this.activeDOMElement=e;return}t=t.ownerCt}n(this.ulObj).find(".aloha-multisplit-activeitem").removeClass("aloha-multisplit-activeitem"),e&&e.parent().addClass("aloha-multisplit-activeitem");if(!e||e.parent().is(":hidden"))return;e&&this.ulObj&&(this.ulObj.css("margin-top",0),r=e.position().top,this.ulObj.css({"margin-top":-r+6,height:46+r-6})),this.activeDOMElement=undefined},togglePanel:function(){this.panelOpened?this.closePanel():this.openPanel()},openPanel:function(){if(this.panelOpened)return;var e=this.wrapper.offset();this.ulObj.appendTo(n("body")).addClass("aloha-multisplit-expanded").mousedown(function(e){e.stopPropagation()}).css({top:e.top-1,left:e.left-1}).animate({height:this.ulObj.prop?this.ulObj.prop("scrollHeight"):this.ulObj.attr("scrollHeight")}),this.panelButton.removeClass("aloha-multisplit-toggle-open").addClass("aloha-multisplit-toggle-close"),this.panelOpened=!0},closePanel:function(){if(!this.panelOpened)return;this.ulObj.removeClass("aloha-multisplit-expanded").appendTo(this.wrapper),this.panelButton.addClass("aloha-multisplit-toggle-open").removeClass("aloha-multisplit-toggle-close"),this.panelOpened=!1},hideItem:function(e){for(var t=0;t<this.items.length;t++)if(this.items[t].name==e){this.items[t].visible=!1,n("#"+this.id+" [gtxmultisplititem="+t+"]").parent().hide();return}},showItem:function(e){for(var t=0;t<this.items.length;t++)if(this.items[t].name==e){this.items[t].visible=!0,n("#"+this.id+" [gtxmultisplititem="+t+"]").parent().show();return}}}),i.reg("alohamultisplitbutton",i.ux.MultiSplitButton),e.ui.MultiSplitButton=t.extend({_constructor:function(e){this.items=[],u.Utils.applyProperties(this,e),this.id=this.generateId()},generateId:function(){return e.ui.MultiSplitButton.idCounter=e.ui.MultiSplitButton.idCounter+1,"aloha-multisplitbutton"+e.ui.MultiSplitButton.idCounter},getExtConfigProperties:function(){return{xtype:"alohamultisplitbutton",items:this.items,name:this.name,id:this.id}},setActiveItem:function(e){this.extButton&&typeof e!="undefined"&&this.extButton.setActiveItem(e)},isVisible:function(){for(var e=0;e<this.items.length;e++)if(this.items[e].visible)return!0;return!1},showItem:function(e){if(typeof this.extButton=="undefined")return;this.extButton.showItem(e)},hideItem:function(e){if(typeof this.extButton=="undefined")return;this.extButton.hideItem(e)}}),e.i18n=function(e,t,n){return s.deprecated("Aloha",'i18n() is deprecated. Use module "i18n!aloha/nls/i18n" instead.'),t},e.showMessage=function(t){r.obj&&r.obj.css("z-index",8900);switch(t.type){case e.Message.Type.ALERT:i.MessageBox.alert(t.title,t.text,t.callback);break;case e.Message.Type.CONFIRM:i.MessageBox.confirm(t.title,t.text,t.callback);break;case e.Message.Type.WAIT:i.MessageBox.wait(t.text,t.title);break;default:e.log("warn",this,"Unknown message type for message {"+t.toString()+"}")}},e.hideMessage=function(){i.MessageBox.hide()},e.isMessageVisible=function(){return i.MessageBox.isVisible()},e.ui.MultiSplitButton.idCounter=0,e.ui}),define("aloha/ui-attributefield",["aloha/core","aloha/jquery","aloha/ext","i18n!aloha/nls/i18n","aloha/ui","aloha/repositorymanager","aloha/selection","aloha/ext-alohaproxy","aloha/ext-alohareader"],function(e,t,n,r,i,s,o){var u=void 0,a=function(e){return e?e='<tpl for="."><div class="x-combo-list-item"><tpl if="this.hasRepositoryTemplate(values)">{[ this.renderRepositoryTemplate(values) ]}</tpl><tpl if="!this.hasRepositoryTemplate(values)">'+e+"</tpl>"+"</div></tpl>":e='<tpl for="."><div class="x-combo-list-item"><tpl if="this.hasRepositoryTemplate(values)">{[ this.renderRepositoryTemplate(values) ]}</tpl><tpl if="!this.hasRepositoryTemplate(values)"><span><b>{name}</b></span></tpl></div></tpl>',new n.XTemplate(e,{hasRepositoryTemplate:function(e){var t=s.getRepository(e.repositoryId);return t&&t.hasTemplate()},renderRepositoryTemplate:function(e){var t=s.getRepository(e.repositoryId);if(t&&t.hasTemplate()){if(!t._ExtTPL||t.template!==t._ExtTPLcache)t._ExtTPL=new n.XTemplate(t.template),t._ExtTPLcache=t.template;return t._ExtTPL.apply(e)}}})},f;n.ux.AlohaAttributeField=n.extend(n.form.ComboBox,{typeAhead:!1,mode:"remote",triggerAction:"all",width:300,hideTrigger:!0,minChars:3,valueField:"id",displayField:"name",listEmptyText:r.t("repository.no_item_found"),loadingText:r.t("repository.loading")+"...",enableKeyEvents:!0,store:new n.data.Store({proxy:new n.data.AlohaProxy,reader:new n.data.AlohaObjectReader}),clickAttached:!1,tpl:a(),onSelect:function(e){this.setItem(e.data),typeof this.alohaButton.onSelect=="function"&&this.alohaButton.onSelect.call(this.alohaButton,e.data),this.collapse()},finishEditing:function(){var e=t(this.getTargetObject()),n;e&&((n=e.attr("data-original-background-color"))?t(e).css("background-color",n):t(e).css("background-color",""),t(e).removeAttr("data-original-background-color"));if(f===e.attr(this.targetAttribute))return;this.resourceItem||s.markObject(this.targetObject),this.getValue()===""&&(this.wrap&&t(this.wrap.dom.children[0]).css("color","#AAA"),this.setValue(this.placeholder))},listeners:{beforequery:function(e){if(this.noQuery){e.cancel=!0;return}this.store!==null&&this.store.proxy!==null&&this.store.proxy.setParams({objectTypeFilter:this.getObjectTypeFilter(),queryString:e.query})},afterrender:function(e,n){t(this.wrap.dom.children[0]).css("color","#AAA"),this.setValue(this.placeholder)},keydown:function(e,t){if(t.keyCode==13||t.keyCode==27)this.isExpanded()?this.ALOHAwasExpanded=!0:this.ALOHAwasExpanded=!1,t.preventDefault()},keyup:function(e,t){(t.keyCode==13||t.keyCode==27)&&!this.ALOHAwasExpanded&&setTimeout(function(){o.getRangeObject().select()},0),this.resourceItem&&this.resourceValue!==this.wrap.dom.children[0].value&&(this.resourceItem=null,this.resourceValue=null);if(!this.resourceItem){var n=this.wrap.dom.children[0].value;this.setAttribute(this.targetAttribute,n)}},focus:function(e,n){var r=t(this.getTargetObject()),i=r.css("background-color");this.getValue()===this.placeholder&&(this.setValue(""),t(this.wrap.dom.children[0]).css("color","black")),r&&r.context&&r.context.style&&r.context.style["background-color"]&&r.attr("data-original-background-color",r.context.style["background-color"]),r.css("background-color","#80B5F2")},blur:function(e,t){this.finishEditing()},hide:function(e,t){this.finishEditing()},expand:function(t){this.noQuery&&this.collapse();if(!this.clickAttached){var n=this;this.mon(this.innerList,"mousedown",function(t){e.eventHandled=!0},this),this.mon(this.innerList,"mouseup",function(t){e.eventHandled=!1},this),this.clickAttached=!0}}},setItem:function(e,t){this.resourceItem=e;if(e){t=t?t:this.displayField;var n=e[t];this.setValue(n),this.resourceValue=n,this.setAttribute(this.targetAttribute,e[this.valueField]),s.markObject(this.targetObject,e)}else this.resourceValue=null},getItem:function(){return this.resourceItem},setAttribute:function(e,n,r,i){var s=!0,o;this.targetObject&&(typeof i!="undefined"&&(o=new RegExp(r),i.match(o)||(s=!1)),s?t(this.targetObject).attr(e,n):t(this.targetObject).removeAttr(e))},setTargetObject:function(e,n){var r=this;this.targetObject=e,this.targetAttribute=n,this.setItem(null),e&&n&&(f=t(e).attr(n)),this.targetObject&&this.targetAttribute?this.setValue(t(this.targetObject).attr(this.targetAttribute)):this.setValue("");var r=this;s.getObject(e,function(e){e&&e.length>0&&r.setItem(e[0])})},getTargetObject:function(){return this.targetObject},setObjectTypeFilter:function(e){this.objectTypeFilter=e},getObjectTypeFilter:function(){return this.objectTypeFilter},noQuery:!0}),n.reg("alohaattributefield",n.ux.AlohaAttributeField),i.AttributeField=i.Button.extend({_constructor:function(e){this.onSelect=null,this.listenerQueue=[],this.objectTypeFilter=null,this.tpl=null,this.displayField=null,this.valueField=null,this.init(e)},getExtConfigProperties:function(){var e={alohaButton:this,xtype:"alohaattributefield",rowspan:this.rowspan||u,width:this.width||u,placeholder:this.placeholder||u,id:this.id,cls:this.cls||u};return this.valueField&&(e.valueField=this.valueField),this.displayField&&(e.displayField=this.displayField),this.minChars&&(e.minChars=this.minChars),e},setTargetObject:function(e,t){this.extButton&&this.extButton.setTargetObject(e,t)},getTargetObject:function(){return this.extButton?this.extButton.getTargetObject():null},focus:function(){this.extButton&&(this.extButton.focus(),this.extButton.getValue().length>0&&this.extButton.selectText(0,this.extButton.getValue().length))},addListener:function(e,t,n){var r;this.extButton?this.extButton.addListener(e,t,null):(r={eventName:e,handler:t,scope:n,options:null},this.listenerQueue.push(r))},setAttribute:function(e,t,n,r){this.extButton&&this.extButton.setAttribute(e,t,n,r)},setObjectTypeFilter:function(e){this.extButton?(this.noQuery=!1,this.extButton.setObjectType(e)):(e||(e="all"),this.objectTypeFilter=e)},setItem:function(e,t){this.extButton&&this.extButton.setItem(e,t)},getItem:function(){return this.extButton?this.extButton.getItem():null},getValue:function(){return this.extButton?this.extButton.getValue():null},setValue:function(e){this.extButton&&this.extButton.setValue(e)},getQueryValue:function(){return this.extButton?this.extButton.getValue():null},setDisplayField:function(e){var t;return this.extButton?t=this.extButton.displayField=e:t=this.displayField=e,t},setTemplate:function(e){var t;return this.extButton?t=this.extButton.tpl=a(e):t=this.tpl=a(e),t}})}),define("aloha/ui-browser",["aloha/ext","aloha/ui"],function(e,t){var n=window.Class;t.Browser=n.extend({_constructor:function(){this.onSelect=null;var t=this;this.grid=new e.grid.GridPanel({region:"center",autoScroll:!0,store:new e.data.Store({proxy:new e.data.AlohaProxy,reader:new e.data.AlohaObjectReader}),columns:[{id:"name",header:"Name",width:100,sortable:!0,dataIndex:"name"},{header:"URL",renderer:function(e){return e},width:300,sortable:!0,dataIndex:"url"}],stripeRows:!0,autoExpandColumn:"name",height:350,width:600,title:"Objectlist",stateful:!0,stateId:"grid",selModel:new e.grid.RowSelectionModel({singleSelect:!0}),listeners:{dblclick:function(e){t.onItemSelect()}}}),this.grid.getSelectionModel().on({selectionchange:function(e,n,r){var i=t.grid.getSelectionModel().getSelected();i?this.win.buttons[1].enable():this.win.buttons[1].disable()},scope:this}),this.tree=new e.tree.TreePanel({region:"center",useArrows:!0,autoScroll:!0,animate:!0,enableDD:!0,containerScroll:!0,border:!1,loader:new e.tree.AlohaTreeLoader,root:{nodeType:"async",text:"Aloha Repositories",draggable:!1,id:"aloha"},rootVisible:!1,listeners:{beforeload:function(e){this.loader.baseParams={node:e.attributes}}}}),this.tree.getSelectionModel().on({selectionchange:function(e,n){if(n){var r=n.attributes;t.grid.store.load({params:{inFolderId:r.id,objectTypeFilter:t.objectTypeFilter,repositoryId:r.repositoryId}})}},scope:this}),this.nav=new e.Panel({title:"Navigation",region:"west",width:300,layout:"fit",collapsible:!0,items:[this.tree]}),this.win=new e.Window({title:"Resource Selector",layout:"border",width:800,height:300,closeAction:"hide",onEsc:function(){this.hide()},defaultButton:this.nav,plain:!0,initHidden:!0,items:[this.nav,this.grid],buttons:[{text:"Close",handler:function(){t.win.hide()}},{text:"Select",disabled:!0,handler:function(){t.onItemSelect()}}],toFront:function(t){return this.manager=this.manager||e.WindowMgr,this.manager.bringToFront(this),this.setZIndex(9999999999),this}}),this.onItemSelect=function(){var e=this.grid.getSelectionModel(),t=e?e.getSelected():null,n=t?t.data:null;this.win.hide(),typeof this.onSelect=="function"&&this.onSelect.call(this,n)}},setObjectTypeFilter:function(e){this.objectTypeFilter=e},getObjectTypeFilter:function(){return this.objectTypeFilter},show:function(){this.win.show(),this.win.toFront(!0),this.win.focus()}})}),define("aloha/repository",["aloha/core","util/class","aloha/repositorymanager"],function(e,t,n){var r=t.extend({_constructor:function(e,t){this.repositoryId=e,this.settings={},this.repositoryName=t?t:e,n.register(this)},init:function(){},query:null,getChildren:null,makeClean:function(e){},markObject:function(e,t){},setTemplate:function(e){e?this.template=e:this.template=null},hasTemplate:function(){return this.template?!0:!1},getTemplate:function(){return this.template},getObjectById:function(e,t){return!0}});return e.AbstractRepository=r,r}),define("aloha/repositoryobjects",["aloha/core","util/class"],function(e,t){var n=window.GENTICS;e.RepositoryObject=function(){},e.RepositoryDocument=t.extend({_constructor:function(e){var t=e;this.type="document";if(!t.id||!t.name||!t.repositoryId)return;n.Utils.applyProperties(this,e),this.baseType="document"}}),e.RepositoryFolder=t.extend({_constructor:function(e){var t=e;this.type="folder";if(!t.id||!t.name||!t.repositoryId)return;n.Utils.applyProperties(this,e),this.baseType="folder"}})}),function(){"use strict";function r(){var e="./",t,n=document.getElementsByTagName("script"),r,i=n.length,s=/\/aloha.js$/,o=/[^\/]*\.js$/;for(r=0;r<i&&(t=n[r]);++r){if(s.test(t.src)){e=t.src.replace(s,"");break}e==="./"&&t.getAttribute("data-aloha-plugins")&&o.test(t.src)&&(e=t.src.replace(o,""))}return e}var e=window.jQuery.noConflict(!0),t,n;window.Aloha=window.Aloha||{},Aloha.defaults={},Aloha.settings=Aloha.settings||{},Aloha.jQuery=Aloha.settings.jQuery||Aloha.jQuery||e||null,Aloha._require=require,Aloha.define=define,Aloha.settings.baseUrl=Aloha.settings.baseUrl||r(),Aloha.settings.requireConfig={context:"aloha",baseUrl:Aloha.settings.baseUrl,locale:Aloha.settings.locale},n=require.config(Aloha.settings.requireConfig),Aloha.require=function(e){return arguments.length==1&&typeof e=="function"?n(["aloha"],e):n.apply(this,arguments)},t=Aloha.jQuery.Deferred(),Aloha.bind=function(e,n){return e=="aloha-ready"?Aloha.stage!="alohaReady"?t.done(n):n():Aloha.jQuery(Aloha,"body").bind(e,n),this},Aloha.trigger=function(e,n){return e=="aloha-ready"&&Aloha.jQuery(t.resolve),Aloha.jQuery(Aloha,"body").trigger(e,n),this},Aloha.ready=function(e){return this.bind("aloha-ready",e),this},function(e){require.onError=function(t){var n=[],r=Aloha.jQuery.trim(t.requireModules).split(" ");for(var i=0;i<r.length;i++)switch(t.requireType){case"timeout":/^aloha\/.+/.test(r[i])?n.push(r[i]):window.console&&typeof window.console.error=="function"&&window.console.error("Aloha-Editor Error: The following module failed to load: "+r[i]);break;default:e.apply({},arguments)}throw"Aloha-Editor Exception: The following core file"+(n.length?"s have":" has")+" timed-out while loading: "+n.join(", ")}}(require.onError)}(),define("aloha",[],function(){return Aloha}),require(Aloha.settings.requireConfig,["aloha/jquery","aloha/ext","util/json2"],function(){require(Aloha.settings.requireConfig,["vendor/jquery.json-2.2.min","vendor/jquery.store","aloha/rangy-core","util/class","util/lang","util/range","util/dom","aloha/core","aloha/editable","aloha/console","aloha/markup","aloha/message","aloha/plugin","aloha/selection","aloha/command","aloha/jquery.patch","aloha/jquery.aloha","aloha/sidebar","util/position","aloha/ext-alohaproxy","aloha/ext-alohareader","aloha/ext-alohatreeloader","aloha/ui","aloha/ui-attributefield","aloha/ui-browser","aloha/floatingmenu","aloha/repositorymanager","aloha/repository","aloha/repositoryobjects","aloha/contenthandlermanager"],function(){Aloha.jQuery(Aloha.init)})});