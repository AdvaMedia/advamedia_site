/*!
* This file is part of Aloha Editor Project http://aloha-editor.org
* Copyright (c) 2010-2011 Gentics Software GmbH, aloha@gentics.com
* Contributors http://aloha-editor.org/contribution.php 
* Licensed unter the terms of http://www.aloha-editor.org/license.html
*
* Aloha Editor is free software: you can redistribute it and/or modify
* it under the terms of the GNU Affero General Public License as published by
* the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.*
*
* Aloha Editor is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
* GNU Affero General Public License for more details.
*
* You should have received a copy of the GNU Affero General Public License
* along with this program. If not, see <http://www.gnu.org/licenses/>.
*/
// define jquery and ext modules. They need to be available in global namespace
define("aloha/jquery",[],function(){return Aloha.jQuery.support.getSetAttribute||function(a){Aloha.jQuery.removeAttr=function(a,b){a.removeAttribute(b)}}(Aloha),Aloha.jQuery}),define("aloha/ext",[],function(){return Ext.QuickTips.init(),Ext}),define("util/json2",[],function(){});var JSON;JSON||(JSON={}),function(){function f(a){return a<10?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(a)),typeof rep=="function"&&(i=rep.call(b,a,i));switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";gap+=indent,h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1)h[c]=str(c,i)||"null";return e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g,e}if(rep&&typeof rep=="object"){f=rep.length;for(c=0;c<f;c+=1)typeof rep[c]=="string"&&(d=rep[c],e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e))}else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));return e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g,e}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(a,b,c){var d;gap="",indent="";if(typeof c=="number")for(d=0;d<c;d+=1)indent+=" ";else typeof c=="string"&&(indent=c);rep=b;if(!b||typeof b=="function"||typeof b=="object"&&typeof b.length=="number")return str("",{"":a});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object")for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("vendor/jquery.json-2.2.min",["aloha/jquery"],function($){$.toJSON=function(a){if(typeof JSON=="object"&&JSON.stringify)return JSON.stringify(a);var b=typeof a;if(a===null)return"null";if(b=="undefined")return undefined;if(b=="number"||b=="boolean")return a+"";if(b=="string")return $.quoteString(a);if(b=="object"){if(typeof a.toJSON=="function")return $.toJSON(a.toJSON());if(a.constructor===Date){var c=a.getUTCMonth()+1;c<10&&(c="0"+c);var d=a.getUTCDate();d<10&&(d="0"+d);var e=a.getUTCFullYear(),f=a.getUTCHours();f<10&&(f="0"+f);var g=a.getUTCMinutes();g<10&&(g="0"+g);var h=a.getUTCSeconds();h<10&&(h="0"+h);var i=a.getUTCMilliseconds();return i<100&&(i="0"+i),i<10&&(i="0"+i),'"'+e+"-"+c+"-"+d+"T"+f+":"+g+":"+h+"."+i+'Z"'}if(a.constructor===Array){var j=[];for(var k=0;k<a.length;k++)j.push($.toJSON(a[k])||"null");return"["+j.join(",")+"]"}var l=[];for(var m in a){var n,b=typeof m;if(b=="number")n='"'+m+'"';else{if(b!="string")continue;n=$.quoteString(m)}if(typeof a[m]=="function")continue;var o=$.toJSON(a[m]);l.push(n+":"+o)}return"{"+l.join(", ")+"}"}},$.evalJSON=function(src){return typeof JSON=="object"&&JSON.parse?JSON.parse(src):eval("("+src+")")},$.secureEvalJSON=function(src){if(typeof JSON=="object"&&JSON.parse)return JSON.parse(src);var filtered=src;filtered=filtered.replace(/\\["\\\/bfnrtu]/g,"@"),filtered=filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]"),filtered=filtered.replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered))return eval("("+src+")");throw new SyntaxError("Error parsing JSON, source is not valid.")},$.quoteString=function(a){return a.match(_escapeable)?'"'+a.replace(_escapeable,function(a){var b=_meta[a];return typeof b=="string"?b:(b=a.charCodeAt(),"\\u00"+Math.floor(b/16).toString(16)+(b%16).toString(16))})+'"':'"'+a+'"'};var _escapeable=/["\\\x00-\x1f\x7f-\x9f]/g,_meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"}}),define("vendor/jquery.store",["aloha/jquery","util/json2"],function(a,b,c){a.store=function(b,c){var d=window.JSON;that=this;if(typeof b=="string"){if(!a.store.drivers[b])throw new Error("Unknown driver "+b);this.driver=a.store.drivers[b]}else if(typeof b=="object"){var e=!a.isFunction(b.init)||!a.isFunction(b.get)||!a.isFunction(b.set)||!a.isFunction(b.del)||!a.isFunction(b.flush);if(e)throw new Error("The specified driver does not fulfill the API requirements");this.driver=b}else a.each(a.store.drivers,function(){return!a.isFunction(this.available)||!this.available()?!0:(that.driver=this,that.driver.init()===!1?(that.driver=null,!0):!1)});c||(c=a.store.serializers),this.serializers={},a.each(c,function(b,c){if(!a.isFunction(this.init))return!0;that.serializers[b]=this,that.serializers[b].init(that.encoders,that.decoders)})},a.extend(a.store.prototype,{get:function(a){var b=this.driver.get(a);return this.driver.encodes?b:this.unserialize(b)},set:function(a,b){this.driver.set(a,this.driver.encodes?b:this.serialize(b))},del:function(a){this.driver.del(a)},flush:function(){this.driver.flush()},driver:c,encoders:[],decoders:[],serialize:function(b){var c=this;return a.each(this.encoders,function(){var a=c.serializers[this+""];if(!a||!a.encode)return!0;try{b=a.encode(b)}catch(d){}}),b},unserialize:function(b){var c=this;return b?(a.each(this.decoders,function(){var a=c.serializers[this+""];if(!a||!a.decode)return!0;b=a.decode(b)}),b):b}}),a.store.drivers={localStorage:{ident:"$.store.drivers.localStorage",scope:"browser",available:function(){try{return!!window.localStorage}catch(a){return!1}},init:a.noop,get:function(a){return window.localStorage.getItem(a)},set:function(a,b){window.localStorage.setItem(a,b)},del:function(a){window.localStorage.removeItem(a)},flush:function(){window.localStorage.clear()}},userData:{ident:"$.store.drivers.userData",element:null,nodeName:"userdatadriver",scope:"browser",initialized:!1,available:function(){try{return!!document.documentElement&&!!document.documentElement.addBehavior}catch(a){return!1}},init:function(){if(this.initialized)return;try{this.element=document.createElement(this.nodeName),document.documentElement.insertBefore(this.element,document.getElementsByTagName("title")[0]),this.element.addBehavior("#default#userData"),this.initialized=!0}catch(a){return!1}},get:function(a){return this.element.load(this.nodeName),this.element.getAttribute(a)},set:function(a,b){this.element.setAttribute(a,b),this.element.save(this.nodeName)},del:function(a){this.element.removeAttribute(a),this.element.save(this.nodeName)},flush:function(){this.element.expires=(new Date).toUTCString(),this.element.save(this.nodeName)}},windowName:{ident:"$.store.drivers.windowName",scope:"window",cache:{},encodes:!0,available:function(){return!0},init:function(){this.load()},save:function(){window.name=a.store.serializers.json.encode(this.cache)},load:function(){try{this.cache=a.store.serializers.json.decode(window.name+""),typeof this.cache!="object"&&(this.cache={})}catch(b){this.cache={},window.name="{}"}},get:function(a){return this.cache[a]},set:function(a,b){this.cache[a]=b,this.save()},del:function(a){try{delete this.cache[a]}catch(b){this.cache[a]=c}this.save()},flush:function(){window.name="{}"}}},a.store.serializers={json:{ident:"$.store.serializers.json",init:function(a,b){a.push("json"),b.push("json")},encode:JSON.stringify,decode:JSON.parse},xml:{ident:"$.store.serializers.xml",init:function(a,b){a.unshift("xml"),b.push("xml")},isXML:function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName.toLowerCase()!=="html":!1},encode:function(a){if(!a||a._serialized||!this.isXML(a))return a;var b={_serialized:this.ident,value:a};try{return b.value=(new XMLSerializer).serializeToString(a),b}catch(c){try{return b.value=a.xml,b}catch(d){}}return a},decode:function(a){if(!a||!a._serialized||a._serialized!=this.ident)return a;var b="DOMParser"in window&&(new DOMParser).parseFromString;return!b&&window.ActiveXObject&&(b=function(a){var b=new ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b}),b?(a.value=b.call("DOMParser"in window&&new DOMParser||window,a.value,"text/xml"),this.isXML(a.value)?a.value:c):c}}};if(a.browser.msie&&a.browser.version=="7.0"){delete a.store.drivers.windowName;var d={ident:"$.store.drivers.voidDriver",scope:"void",cache:{},encodes:!0,available:function(){return!0},init:function(){},save:function(){},get:function(a){},set:function(a,b){},del:function(a){},flush:function(){}};a.store.drivers.voidDriver=d}}),define("aloha/rangy-core",[],function(){});var rangy=function(){function h(c,d){var e=typeof c[d];return e==b||e==a&&!!c[d]||e=="unknown"}function i(b,c){return typeof b[c]==a&&!!b[c]}function j(a,b){return typeof a[b]!=c}function k(a){return function(b,c){var d=c.length;while(d--)if(!a(b,c[d]))return!1;return!0}}function o(a){return a&&l(a,g)&&n(a,f)}function q(a){window.alert("Rangy not supported in your browser. Reason: "+a),p.initialized=!0,p.supported=!1}function r(a){var b="Rangy warning: "+a;p.config.alertOnWarn?window.alert(b):typeof window.console!=c&&typeof window.console.log!=c&&window.console.log(b)}function u(){if(p.initialized)return;var a,b=!1,c=!1;h(document,"createRange")&&(a=document.createRange(),l(a,e)&&n(a,d)&&(b=!0),a.detach());var f=i(document,"body")?document.body:document.getElementsByTagName("body")[0];f&&h(f,"createTextRange")&&(a=f.createTextRange(),o(a)&&(c=!0)),!b&&!c&&q("Neither Range nor TextRange are implemented"),p.initialized=!0,p.features={implementsDomRange:b,implementsTextRange:c};var g=t.concat(s);for(var j=0,k=g.length;j<k;++j)try{g[j](p)}catch(m){i(window,"console")&&h(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",m)}}function w(a){a=a||window,u();for(var b=0,c=v.length;b<c;++b)v[b](a)}function x(a){this.name=a,this.initialized=!1,this.supported=!1}var a="object",b="function",c="undefined",d=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],e=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],f=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],g=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],l=k(h),m=k(i),n=k(j),p={version:"1.2.1",initialized:!1,supported:!0,util:{isHostMethod:h,isHostObject:i,isHostProperty:j,areHostMethods:l,areHostObjects:m,areHostProperties:n,isTextRange:o},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};p.fail=q,p.warn=r,{}.hasOwnProperty?p.util.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}:q("hasOwnProperty not supported");var s=[],t=[];p.init=u,p.addInitListener=function(a){p.initialized?a(p):s.push(a)};var v=[];p.addCreateMissingNativeApiListener=function(a){v.push(a)},p.createMissingNativeApi=w,x.prototype.fail=function(a){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+a)},x.prototype.warn=function(a){p.warn("Module "+this.name+": "+a)},x.prototype.createError=function(a){return new Error("Error in Rangy "+this.name+" module: "+a)},p.createModule=function(a,b){var c=new x(a);p.modules[a]=c,t.push(function(a){b(a,c),c.initialized=!0,c.supported=!0})},p.requireModules=function(a){for(var b=0,c=a.length,d,e;b<c;++b){e=a[b],d=p.modules[e];if(!d||!(d instanceof x))throw new Error("Module '"+e+"' not found");if(!d.supported)throw new Error("Module '"+e+"' not supported")}};var y=!1,z=function(a){y||(y=!0,p.initialized||u())};if(typeof window==c){q("No window found");return}if(typeof document==c){q("No document found");return}return h(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",z,!1),h(window,"addEventListener")?window.addEventListener("load",z,!1):h(window,"attachEvent")?window.attachEvent("onload",z):q("Window does not have required addEventListener or attachEvent method"),p}();rangy.createModule("DomUtil",function(a,b){function h(a){var b;return typeof a.namespaceURI==c||(b=a.namespaceURI)===null||b=="http://www.w3.org/1999/xhtml"}function i(a){var b=a.parentNode;return b.nodeType==1?b:null}function j(a){var b=0;while(a=a.previousSibling)b++;return b}function k(a){var b;return o(a)?a.length:(b=a.childNodes)?b.length:0}function l(a,b){var c=[],d;for(d=a;d;d=d.parentNode)c.push(d);for(d=b;d;d=d.parentNode)if(g(c,d))return d;return null}function m(a,b,c){var d=c?b:b.parentNode;while(d){if(d===a)return!0;d=d.parentNode}return!1}function n(a,b,c){var d,e=c?a:a.parentNode;while(e){d=e.parentNode;if(d===b)return e;e=d}return null}function o(a){var b=a.nodeType;return b==3||b==4||b==8}function p(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a}function q(a,b){var c=a.cloneNode(!1);return c.deleteData(0,b),a.deleteData(b,a.length-b),p(c,a),c}function r(a){if(a.nodeType==9)return a;if(typeof a.ownerDocument!=c)return a.ownerDocument;if(typeof a.document!=c)return a.document;if(a.parentNode)return r(a.parentNode);throw new Error("getDocument: no document found for node")}function s(a){var b=r(a);if(typeof b.defaultView!=c)return b.defaultView;if(typeof b.parentWindow!=c)return b.parentWindow;throw new Error("Cannot get a window object for node")}function t(a){if(typeof a.contentDocument!=c)return a.contentDocument;if(typeof a.contentWindow!=c)return a.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element")}function u(a){if(typeof a.contentWindow!=c)return a.contentWindow;if(typeof a.contentDocument!=c)return a.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element")}function v(a){return d.isHostObject(a,"body")?a.body:a.getElementsByTagName("body")[0]}function w(a){var b;while(b=a.parentNode)a=b;return a}function x(a){if(!a)return;return a.previousSibling?a.previousSibling.nextSibling:a.nextSibling?a.nextSibling.previousSibling:a.parentNode?a.parentNode.firstChild:a}function y(a,b,c,d){a=x(a),c=x(c);var e,f,g,h,i;if(a==c)return b===d?0:b<d?-1:1;if(e=n(c,a,!0))return b<=j(e)?-1:1;if(e=n(a,c,!0))return j(e)<d?-1:1;f=l(a,c),g=a===f?f:n(a,f,!0),h=c===f?f:n(c,f,!0);if(g===h)throw new Error("comparePoints got to case 4 and childA and childB are the same!");i=f.firstChild;while(i){if(i===g)return-1;if(i===h)return 1;i=i.nextSibling}throw new Error("Should not be here!")}function z(a){var b=r(a).createDocumentFragment(),c;while(c=a.firstChild)b.appendChild(c);return b}function A(a){if(!a)return"[No node]";if(o(a))return'"'+a.data+'"';if(a.nodeType==1){var b=a.id?' id="'+a.id+'"':"";return"<"+a.nodeName+b+">["+a.childNodes.length+"]"}return a.nodeName}function B(a){this.root=a,this._next=a}function C(a){return new B(a)}function D(a,b){this.node=a,this.offset=b}function E(a){this.code=this[a],this.codeName=a,this.message="DOMException: "+this.codeName}var c="undefined",d=a.util;d.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method"),d.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var e=document.createElement("div");d.areHostMethods(e,["insertBefore","appendChild","cloneNode"]||!d.areHostObjects(e,["previousSibling","nextSibling","childNodes","parentNode"]))||b.fail("Incomplete Element implementation"),d.isHostProperty(e,"innerHTML")||b.fail("Element is missing innerHTML property");var f=document.createTextNode("test");d.areHostMethods(f,["splitText","deleteData","insertData","appendData","cloneNode"]||!d.areHostObjects(e,["previousSibling","nextSibling","childNodes","parentNode"])||!d.areHostProperties(f,["data"]))||b.fail("Incomplete Text Node implementation");var g=function(a,b){var c=a.length;while(c--)if(a[c]===b)return!0;return!1};B.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next,b,c;if(this._current){b=a.firstChild;if(b)this._next=b;else{c=null;while(a!==this.root&&!(c=a.nextSibling))a=a.parentNode;this._next=c}}return this._current},detach:function(){this._current=this._next=this.root=null}},D.prototype={equals:function(a){return this.node===a.node&this.offset==a.offset},inspect:function(){return"[DomPosition("+A(this.node)+":"+this.offset+")]"}},E.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},E.prototype.toString=function(){return this.message},a.dom={arrayContains:g,isHtmlNamespace:h,parentElement:i,getNodeIndex:j,getNodeLength:k,getCommonAncestor:l,isAncestorOf:m,getClosestAncestorIn:n,isCharacterDataNode:o,insertAfter:p,splitDataNode:q,getDocument:r,getWindow:s,getIframeWindow:u,getIframeDocument:t,getBody:v,getRootContainer:w,comparePoints:y,inspectNode:A,fragmentFromNodeChildren:z,createIterator:C,DomPosition:D},a.DOMException=E}),rangy.createModule("DomRange",function(a,b){function f(a,b){return a.nodeType!=3&&(c.isAncestorOf(a,b.startContainer,!0)||c.isAncestorOf(a,b.endContainer,!0))}function g(a){return c.getDocument(a.startContainer)}function h(a,b,c){var d=a._listeners[b];if(d)for(var e=0,f=d.length;e<f;++e)d[e].call(a,{target:a,args:c})}function i(a){return new d(a.parentNode,c.getNodeIndex(a))}function j(a){return new d(a.parentNode,c.getNodeIndex(a)+1)}function k(a,b,d){var e=a.nodeType==11?a.firstChild:a;return c.isCharacterDataNode(b)?d==b.length?c.insertAfter(a,b):b.parentNode.insertBefore(a,d==0?b:c.splitDataNode(b,d)):d>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[d]),e}function l(a){var b;for(var c,d=g(a.range).createDocumentFragment(),f;c=a.next();){b=a.isPartiallySelectedSubtree(),c=c.cloneNode(!b),b&&(f=a.getSubtreeIterator(),c.appendChild(l(f)),f.detach(!0));if(c.nodeType==10)throw new e("HIERARCHY_REQUEST_ERR");d.appendChild(c)}return d}function m(a,b,d){var e,f;d=d||{stop:!1};for(var g,h;g=a.next();)if(a.isPartiallySelectedSubtree()){if(b(g)===!1){d.stop=!0;return}h=a.getSubtreeIterator(),m(h,b,d),h.detach(!0);if(d.stop)return}else{e=c.createIterator(g);while(f=e.next())if(b(f)===!1){d.stop=!0;return}}}function n(a){var b;while(a.next())a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),n(b),b.detach(!0)):a.remove()}function o(a){for(var b,c=g(a.range).createDocumentFragment(),d;b=a.next();){a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),d=a.getSubtreeIterator(),b.appendChild(o(d)),d.detach(!0)):a.remove();if(b.nodeType==10)throw new e("HIERARCHY_REQUEST_ERR");c.appendChild(b)}return c}function p(a,b,c){var d=!!b&&!!b.length,e,f=!!c;d&&(e=new RegExp("^("+b.join("|")+")$"));var g=[];return m(new r(a,!1),function(a){(!d||e.test(a.nodeType))&&(!f||c(a))&&g.push(a)}),g}function q(a){var b=typeof a.getName=="undefined"?"Range":a.getName();return"["+b+"("+c.inspectNode(a.startContainer)+":"+a.startOffset+", "+c.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function r(a,b){this.range=a,this.clonePartiallySelectedTextNodes=b;if(!a.collapsed){this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset;var d=a.commonAncestorContainer;this.sc===this.ec&&c.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===d&&!c.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:c.getClosestAncestorIn(this.sc,d,!0),this._last=this.ec===d&&!c.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:c.getClosestAncestorIn(this.ec,d,!0))}}function s(a){this.code=this[a],this.codeName=a,this.message="RangeException: "+this.codeName}function t(a,b,c){this.nodes=p(a,b,c),this._next=this.nodes[0],this._position=0}function z(a){return function(b,d){var e,f=d?b:b.parentNode;while(f){e=f.nodeType;if(c.arrayContains(a,e))return f;f=f.parentNode}return null}}function E(a,b){if(D(a,b))throw new s("INVALID_NODE_TYPE_ERR")}function F(a){if(!a.startContainer)throw new e("INVALID_STATE_ERR")}function G(a,b){if(!c.arrayContains(b,a.nodeType))throw new s("INVALID_NODE_TYPE_ERR")}function H(a,b){if(b<0||b>(c.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new e("INDEX_SIZE_ERR")}function I(a,b){if(B(a,!0)!==B(b,!0))throw new e("WRONG_DOCUMENT_ERR")}function J(a){if(C(a,!0))throw new e("NO_MODIFICATION_ALLOWED_ERR")}function K(a,b){if(!a)throw new e(b)}function L(a){return!c.arrayContains(v,a.nodeType)&&!B(a,!0)}function M(a,b){return b<=(c.isCharacterDataNode(a)?a.length:a.childNodes.length)}function N(a){F(a);if(L(a.startContainer)||L(a.endContainer)||!M(a.startContainer,a.startOffset)||!M(a.endContainer,a.endOffset))throw new Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")")}function _(){}function ab(a){a.START_TO_START=T,a.START_TO_END=U,a.END_TO_END=V,a.END_TO_START=W,a.NODE_BEFORE=X,a.NODE_AFTER=Y,a.NODE_BEFORE_AND_AFTER=Z,a.NODE_INSIDE=$}function bb(a){ab(a),ab(a.prototype)}function cb(a,b){return function(){N(this);var d=this.startContainer,e=this.startOffset,f=this.commonAncestorContainer,g=new r(this,!0),h,i;d!==f&&(h=c.getClosestAncestorIn(d,f,!0),i=j(h),d=i.node,e=i.offset),m(g,J),g.reset();var k=a(g);return g.detach(),b(this,d,e,d,e),k}}function db(b,d,e){function g(a,b){return function(c){F(this),G(c,u),G(A(c),v);var d=(a?i:j)(c);(b?h:k)(this,d.node,d.offset)}}function h(a,b,e){var f=a.endContainer,g=a.endOffset;if(b!==a.startContainer||e!==this.startOffset){if(A(b)!=A(f)||c.comparePoints(b,e,f,g)==1)f=b,g=e;d(a,b,e,f,g)}}function k(a,b,e){var f=a.startContainer,g=a.startOffset;if(b!==a.endContainer||e!==this.endOffset){if(A(b)!=A(f)||c.comparePoints(b,e,f,g)==-1)f=b,g=e;d(a,f,g,b,e)}}function l(a,b,c){(b!==a.startContainer||c!==this.startOffset||b!==a.endContainer||c!==this.endOffset)&&d(a,b,c,b,c)}b.prototype=new _,a.util.extend(b.prototype,{setStart:function(a,b){F(this),E(a,!0),H(a,b),h(this,a,b)},setEnd:function(a,b){F(this),E(a,!0),H(a,b),k(this,a,b)},setStartBefore:g(!0,!0),setStartAfter:g(!1,!0),setEndBefore:g(!0,!1),setEndAfter:g(!1,!1),collapse:function(a){N(this),a?d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){F(this),E(a,!0),d(this,a,0,a,c.getNodeLength(a))},selectNode:function(a){F(this),E(a,!1),G(a,u);var b=i(a),c=j(a);d(this,b.node,b.offset,c.node,c.offset)},extractContents:cb(o,d),deleteContents:cb(n,d),canSurroundContents:function(){N(this),J(this.startContainer),J(this.endContainer);var a=new r(this,!0),b=a._first&&f(a._first,this)||a._last&&f(a._last,this);return a.detach(),!b},detach:function(){e(this)},splitBoundaries:function(){N(this);var a=this.startContainer,b=this.startOffset,e=this.endContainer,f=this.endOffset,g=a===e;c.isCharacterDataNode(e)&&f>0&&f<e.length&&c.splitDataNode(e,f),c.isCharacterDataNode(a)&&b>0&&b<a.length&&(a=c.splitDataNode(a,b),g?(f-=b,e=a):e==a.parentNode&&f>=c.getNodeIndex(a)&&f++,b=0),d(this,a,b,e,f)},normalizeBoundaries:function(){N(this);var a=this.startContainer,b=this.startOffset,e=this.endContainer,f=this.endOffset,g=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(e=a,f=a.length,a.appendData(b.data),b.parentNode.removeChild(b))},h=function(d){var g=d.previousSibling;if(g&&g.nodeType==d.nodeType){a=d;var h=d.length;b=g.length,d.insertData(0,g.data),g.parentNode.removeChild(g);if(a==e)f+=b,e=a;else if(e==d.parentNode){var i=c.getNodeIndex(d);f==i?(e=d,f=h):f>i&&f--}}},i=!0;if(c.isCharacterDataNode(e))e.length==f&&g(e);else{if(f>0){var j=e.childNodes[f-1];j&&c.isCharacterDataNode(j)&&g(j)}i=!this.collapsed}if(i){if(c.isCharacterDataNode(a))b==0&&h(a);else if(b<a.childNodes.length){var k=a.childNodes[b];k&&c.isCharacterDataNode(k)&&h(k)}}else a=e,b=f;d(this,a,b,e,f)},collapseToPoint:function(a,b){F(this),E(a,!0),H(a,b),l(this,a,b)}}),bb(b)}function eb(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:c.getCommonAncestor(a.startContainer,a.endContainer)}function fb(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!==c,g=a.endContainer!==d||a.endOffset!==e;a.startContainer=b,a.startOffset=c,a.endContainer=d,a.endOffset=e,eb(a),h(a,"boundarychange",{startMoved:f,endMoved:g})}function gb(a){F(a),a.startContainer=a.startOffset=a.endContainer=a.endOffset=null,a.collapsed=a.commonAncestorContainer=null,h(a,"detach",null),a._listeners=null}function hb(a){this.startContainer=a,this.startOffset=0,this.endContainer=a,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},eb(this)}a.requireModules(["DomUtil"]);var c=a.dom,d=c.DomPosition,e=a.DOMException;r.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,c.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var a=this._current,b,d;!c.isCharacterDataNode(a)||a!==this.sc&&a!==this.ec?a.parentNode&&a.parentNode.removeChild(a):(b=a===this.sc?this.so:0,d=a===this.ec?this.eo:a.length,b!=d&&a.deleteData(b,d-b))},isPartiallySelectedSubtree:function(){var a=this._current;return f(a,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse();else{a=new hb(g(this.range));var b=this._current,d=b,e=0,f=b,h=c.getNodeLength(b);c.isAncestorOf(b,this.sc,!0)&&(d=this.sc,e=this.so),c.isAncestorOf(b,this.ec,!0)&&(f=this.ec,h=this.eo),fb(a,d,e,f,h)}return new r(a,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},s.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},s.prototype.toString=function(){return this.message},t.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var u=[1,3,4,5,7,8,10],v=[2,9,11],w=[5,6,10,12],x=[1,3,4,5,7,8,10,11],y=[1,3,4,5,7,8],A=c.getRootContainer,B=z([9,11]),C=z(w),D=z([6,10,12]),O=document.createElement("style"),P=!1;try{O.innerHTML="<b>x</b>",P=O.firstChild.nodeType==3}catch(Q){}a.features.htmlParsingConforms=P;var R=P?function(a){var b=this.startContainer,d=c.getDocument(b);if(!b)throw new e("INVALID_STATE_ERR");var f=null;return b.nodeType==1?f=b:c.isCharacterDataNode(b)&&(f=c.parentElement(b)),f===null||f.nodeName=="HTML"&&c.isHtmlNamespace(c.getDocument(f).documentElement)&&c.isHtmlNamespace(f)?f=d.createElement("body"):f=f.cloneNode(!1),f.innerHTML=a,c.fragmentFromNodeChildren(f)}:function(a){F(this);var b=g(this),d=b.createElement("body");return d.innerHTML=a,c.fragmentFromNodeChildren(d)},S=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],T=0,U=1,V=2,W=3,X=0,Y=1,Z=2,$=3;_.prototype={attachListener:function(a,b){this._listeners[a].push(b)},compareBoundaryPoints:function(a,b){N(this),I(this.startContainer,b.startContainer);var d,e,f,g,h=a==W||a==T?"start":"end",i=a==U||a==T?"start":"end";return d=this[h+"Container"],e=this[h+"Offset"],f=b[i+"Container"],g=b[i+"Offset"],c.comparePoints(d,e,f,g)},insertNode:function(a){N(this),G(a,x),J(this.startContainer);if(c.isAncestorOf(a,this.startContainer,!0))throw new e("HIERARCHY_REQUEST_ERR");var b=k(a,this.startContainer,this.startOffset);this.setStartBefore(b)},cloneContents:function(){N(this);var a,b;if(this.collapsed)return g(this).createDocumentFragment();if(this.startContainer===this.endContainer&&c.isCharacterDataNode(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=g(this).createDocumentFragment(),b.appendChild(a),b;var d=new r(this,!0);return a=l(d),d.detach(),a},canSurroundContents:function(){N(this),J(this.startContainer),J(this.endContainer);var a=new r(this,!0),b=a._first&&f(a._first,this)||a._last&&f(a._last,this);return a.detach(),!b},surroundContents:function(a){G(a,y);if(!this.canSurroundContents())throw new s("BAD_BOUNDARYPOINTS_ERR");var b=this.extractContents();if(a.hasChildNodes())while(a.lastChild)a.removeChild(a.lastChild);k(a,this.startContainer,this.startOffset),a.appendChild(b),this.selectNode(a)},cloneRange:function(){N(this);var a=new hb(g(this)),b=S.length,c;while(b--)c=S[b],a[c]=this[c];return a},toString:function(){N(this);var a=this.startContainer;if(a===this.endContainer&&c.isCharacterDataNode(a))return a.nodeType==3||a.nodeType==4?a.data.slice(this.startOffset,this.endOffset):"";var b=[],d=new r(this,!0);return m(d,function(a){(a.nodeType==3||a.nodeType==4)&&b.push(a.data)}),d.detach(),b.join("")},compareNode:function(a){N(this);var b=a.parentNode,d=c.getNodeIndex(a);if(!b)throw new e("NOT_FOUND_ERR");var f=this.comparePoint(b,d),g=this.comparePoint(b,d+1);return f<0?g>0?Z:X:g>0?Y:$},comparePoint:function(a,b){return N(this),K(a,"HIERARCHY_REQUEST_ERR"),I(a,this.startContainer),c.comparePoints(a,b,this.startContainer,this.startOffset)<0?-1:c.comparePoints(a,b,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:R,toHtml:function(){N(this);var a=g(this).createElement("div");return a.appendChild(this.cloneContents()),a.innerHTML},intersectsNode:function(a,b){N(this),K(a,"NOT_FOUND_ERR");if(c.getDocument(a)!==g(this))return!1;var d=a.parentNode,e=c.getNodeIndex(a);K(d,"NOT_FOUND_ERR");var f=c.comparePoints(d,e,this.endContainer,this.endOffset),h=c.comparePoints(d,e+1,this.startContainer,this.startOffset);return b?f<=0&&h>=0:f<0&&h>0},isPointInRange:function(a,b){return N(this),K(a,"HIERARCHY_REQUEST_ERR"),I(a,this.startContainer),c.comparePoints(a,b,this.startContainer,this.startOffset)>=0&&c.comparePoints(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a,b){N(this);if(g(a)!=g(this))throw new e("WRONG_DOCUMENT_ERR");var d=
c.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),f=c.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);return b?d<=0&&f>=0:d<0&&f>0},intersection:function(a){if(this.intersectsRange(a)){var b=c.comparePoints(this.startContainer,this.startOffset,a.startContainer,a.startOffset),d=c.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),e=this.cloneRange();return b==-1&&e.setStart(a.startContainer,a.startOffset),d==1&&e.setEnd(a.endContainer,a.endOffset),e}return null},union:function(a){if(this.intersectsRange(a,!0)){var b=this.cloneRange();return c.comparePoints(a.startContainer,a.startOffset,this.startContainer,this.startOffset)==-1&&b.setStart(a.startContainer,a.startOffset),c.comparePoints(a.endContainer,a.endOffset,this.endContainer,this.endOffset)==1&&b.setEnd(a.endContainer,a.endOffset),b}throw new s("Ranges do not intersect")},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==$},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,c.getNodeLength(a))<=0},containsRange:function(a){return this.intersection(a).equals(a)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);if(c.length>0){b.setStart(c[0],0);var d=c.pop();b.setEnd(d,d.length);var e=this.containsRange(b);return b.detach(),e}return this.containsNodeContents(a)},createNodeIterator:function(a,b){return N(this),new t(this,a,b)},getNodes:function(a,b){return N(this),p(this,a,b)},getDocument:function(){return g(this)},collapseBefore:function(a){F(this),this.setEndBefore(a),this.collapse(!1)},collapseAfter:function(a){F(this),this.setStartAfter(a),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return hb.rangesEqual(this,a)},inspect:function(){return q(this)}},db(hb,fb,gb),a.rangePrototype=_.prototype,hb.rangeProperties=S,hb.RangeIterator=r,hb.copyComparisonConstants=bb,hb.createPrototypeRange=db,hb.inspect=q,hb.getRangeDocument=g,hb.rangesEqual=function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset},a.DomRange=hb,a.RangeException=s}),rangy.createModule("WrappedRange",function(a,b){function g(a){var b=a.parentElement(),c=a.duplicate();c.collapse(!0);var e=c.parentElement();c=a.duplicate(),c.collapse(!1);var f=c.parentElement(),g=e==f?e:d.getCommonAncestor(e,f);return g==b?g:d.getCommonAncestor(b,g)}function h(a){return a.compareEndPoints("StartToEnd",a)==0}function i(a,b,c,f){var g=a.duplicate();g.collapse(c);var h=g.parentElement();d.isAncestorOf(b,h,!0)||(h=b);if(!h.canHaveHTML)return new e(h.parentNode,d.getNodeIndex(h));var i=d.getDocument(h).createElement("span"),j,k=c?"StartToStart":"StartToEnd",l,m,n,o;do h.insertBefore(i,i.previousSibling),g.moveToElementText(i);while((j=g.compareEndPoints(k,a))>0&&i.previousSibling);o=i.nextSibling;if(j==-1&&o&&d.isCharacterDataNode(o)){g.setEndPoint(c?"EndToStart":"EndToEnd",a);var p;if(/[\r\n]/.test(o.data)){var q=g.duplicate(),r=q.text.replace(/\r\n/g,"\r").length;p=q.moveStart("character",r);while((j=q.compareEndPoints("StartToEnd",q))==-1)p++,q.moveStart("character",1)}else p=g.text.length;n=new e(o,p)}else l=(f||!c)&&i.previousSibling,m=(f||c)&&i.nextSibling,m&&d.isCharacterDataNode(m)?n=new e(m,0):l&&d.isCharacterDataNode(l)?n=new e(l,l.length):n=new e(h,d.getNodeIndex(i));return i.parentNode.removeChild(i),n}function j(a,b){var c,e,f=a.offset,g=d.getDocument(a.node),h,i,j=g.body.createTextRange(),k=d.isCharacterDataNode(a.node);return k?(c=a.node,e=c.parentNode):(i=a.node.childNodes,c=f<i.length?i[f]:null,e=a.node),h=g.createElement("span"),h.innerHTML="&#feff;",c?e.insertBefore(h,c):e.appendChild(h),j.moveToElementText(h),j.collapse(!b),e.removeChild(h),k&&j[b?"moveStart":"moveEnd"]("character",f),j}a.requireModules(["DomUtil","DomRange"]);var c,d=a.dom,e=d.DomPosition,f=a.DomRange;if(a.features.implementsDomRange&&(!a.features.implementsTextRange||!a.config.preferTextRange))(function(){function h(a){var b=e.length,c;while(b--)c=e[b],a[c]=a.nativeRange[c]}function i(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!=c,g=a.endContainer!==d||a.endOffset!=e;if(f||g)a.setEnd(d,e),a.setStart(b,c)}function j(a){a.nativeRange.detach(),a.detached=!0;var b=e.length,c;while(b--)c=e[b],a[c]=null}var b,e=f.rangeProperties,g,k;c=function(a){if(!a)throw new Error("Range must be specified");this.nativeRange=a,h(this)},f.createPrototypeRange(c,i,j),b=c.prototype,b.selectNode=function(a){this.nativeRange.selectNode(a),h(this)},b.deleteContents=function(){this.nativeRange.deleteContents(),h(this)},b.extractContents=function(){var a=this.nativeRange.extractContents();return h(this),a},b.cloneContents=function(){return this.nativeRange.cloneContents()},b.surroundContents=function(a){this.nativeRange.surroundContents(a),h(this)},b.collapse=function(a){this.nativeRange.collapse(a),h(this)},b.cloneRange=function(){return new c(this.nativeRange.cloneRange())},b.refresh=function(){h(this)},b.toString=function(){return this.nativeRange.toString()};var l=document.createTextNode("test");d.getBody(document).appendChild(l);var m=document.createRange();m.setStart(l,0),m.setEnd(l,0);try{m.setStart(l,1),g=!0,b.setStart=function(a,b){this.nativeRange.setStart(a,b),h(this)},b.setEnd=function(a,b){this.nativeRange.setEnd(a,b),h(this)},k=function(a){return function(b){this.nativeRange[a](b),h(this)}}}catch(n){g=!1,b.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(c){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}h(this)},b.setEnd=function(a,b){try{this.nativeRange.setEnd(a,b)}catch(c){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}h(this)},k=function(a,b){return function(c){try{this.nativeRange[a](c)}catch(d){this.nativeRange[b](c),this.nativeRange[a](c)}h(this)}}}b.setStartBefore=k("setStartBefore","setEndBefore"),b.setStartAfter=k("setStartAfter","setEndAfter"),b.setEndBefore=k("setEndBefore","setStartBefore"),b.setEndAfter=k("setEndAfter","setStartAfter"),m.selectNodeContents(l),m.startContainer==l&&m.endContainer==l&&m.startOffset==0&&m.endOffset==l.length?b.selectNodeContents=function(a){this.nativeRange.selectNodeContents(a),h(this)}:b.selectNodeContents=function(a){this.setStart(a,0),this.setEnd(a,f.getEndOffset(a))},m.selectNodeContents(l),m.setEnd(l,3);var o=document.createRange();o.selectNodeContents(l),o.setEnd(l,4),o.setStart(l,2),m.compareBoundaryPoints(m.START_TO_END,o)==-1&m.compareBoundaryPoints(m.END_TO_START,o)==1?b.compareBoundaryPoints=function(a,b){return b=b.nativeRange||b,a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END),this.nativeRange.compareBoundaryPoints(a,b)}:b.compareBoundaryPoints=function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)},a.util.isHostMethod(m,"createContextualFragment")&&(b.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)}),d.getBody(document).removeChild(l),m.detach(),o.detach()})(),a.createNativeRange=function(a){return a=a||document,a.createRange()};else if(a.features.implementsTextRange){c=function(a){this.textRange=a,this.refresh()},c.prototype=new f(document),c.prototype.refresh=function(){var a,b,c=g(this.textRange);h(this.textRange)?b=a=i(this.textRange,c,!0,!0):(a=i(this.textRange,c,!0,!1),b=i(this.textRange,c,!1,!1)),this.setStart(a.node,a.offset),this.setEnd(b.node,b.offset)},f.copyComparisonConstants(c);var k=function(){return this}();typeof k.Range=="undefined"&&(k.Range=c),a.createNativeRange=function(a){return a=a||document,a.body.createTextRange()}}a.features.implementsTextRange&&(c.rangeToTextRange=function(a){if(a.collapsed){var b=j(new e(a.startContainer,a.startOffset),!0);return b}var c=j(new e(a.startContainer,a.startOffset),!0),f=j(new e(a.endContainer,a.endOffset),!1),g=d.getDocument(a.startContainer).body.createTextRange();return g.setEndPoint("StartToStart",c),g.setEndPoint("EndToEnd",f),g}),c.prototype.getName=function(){return"WrappedRange"},a.WrappedRange=c,a.createRange=function(b){return b=b||document,new c(a.createNativeRange(b))},a.createRangyRange=function(a){return a=a||document,new f(a)},a.createIframeRange=function(b){return a.createRange(d.getIframeDocument(b))},a.createIframeRangyRange=function(b){return a.createRangyRange(d.getIframeDocument(b))},a.addCreateMissingNativeApiListener(function(b){var c=b.document;typeof c.createRange=="undefined"&&(c.createRange=function(){return a.createRange(this)}),c=b=null})}),rangy.createModule("WrappedSelection",function(a,b){function n(a){return(a||window).getSelection()}function o(a){return(a||window).document.selection}function C(a,b,c){var d=c?"end":"start",e=c?"start":"end";a.anchorNode=b[d+"Container"],a.anchorOffset=b[d+"Offset"],a.focusNode=b[e+"Container"],a.focusOffset=b[e+"Offset"]}function D(a){var b=a.nativeSelection;a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset}function E(a){a.anchorNode=a.focusNode=null,a.anchorOffset=a.focusOffset=0,a.rangeCount=0,a.isCollapsed=!0,a._ranges.length=0}function F(b){var c;return b instanceof g?(c=b._selectionNativeRange,c||(c=a.createNativeRange(e.getDocument(b.startContainer)),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset),b._selectionNativeRange=c,b.attachListener("detach",function(){this._selectionNativeRange=null}))):b instanceof h?c=b.nativeRange:a.features.implementsDomRange&&b instanceof e.getWindow(b.startContainer).Range&&(c=b),c}function G(a){if(!a.length||a[0].nodeType!=1)return!1;for(var b=1,c=a.length;b<c;++b)if(!e.isAncestorOf(a[0],a[b]))return!1;return!0}function H(a){var b=a.getNodes();if(!G(b))throw new Error("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return b[0]}function I(a){return!!a&&typeof a.text!="undefined"}function J(a,b){var c=new h(b);a._ranges=[c],C(a,c,!1),a.rangeCount=1,a.isCollapsed=c.collapsed}function K(b){b._ranges.length=0;if(b.docSelection.type=="None")E(b);else{var c=b.docSelection.createRange();if(I(c))J(b,c);else{b.rangeCount=c.length;var d,f=e.getDocument(c.item(0));for(var g=0;g<b.rangeCount;++g)d=a.createRange(f),d.selectNode(c.item(g)),b._ranges.push(d);b.isCollapsed=b.rangeCount==1&&b._ranges[0].collapsed,C(b,b._ranges[b.rangeCount-1],!1)}}}function L(a,b){var c=a.docSelection.createRange(),d=H(b),f=e.getDocument(c.item(0)),g=e.getBody(f).createControlRange();for(var h=0,i=c.length;h<i;++h)g.add(c.item(h));try{g.add(d)}catch(j){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}g.select(),K(a)}function N(a,b,c){this.nativeSelection=a,this.docSelection=b,this._ranges=[],this.win=c,this.refresh()}function P(a,b){var c=e.getDocument(b[0].startContainer),d=e.getBody(c).createControlRange();for(var f=0,g;f<rangeCount;++f){g=H(b[f]);try{d.add(g)}catch(h){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}d.select(),K(a)}function U(a,b){if(a.anchorNode&&e.getDocument(a.anchorNode)!==e.getDocument(b))throw new i("WRONG_DOCUMENT_ERR")}function V(a){var b=[],c=new j(a.anchorNode,a.anchorOffset),d=new j(a.focusNode,a.focusOffset),e=typeof a.getName=="function"?a.getName():"Selection";if(typeof a.rangeCount!="undefined")for(var f=0,h=a.rangeCount;f<h;++f)b[f]=g.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.requireModules(["DomUtil","DomRange","WrappedRange"]),a.config.checkSelectionRanges=!0;var c="boolean",d="_rangySelection",e=a.dom,f=a.util,g=a.DomRange,h=a.WrappedRange,i=a.DOMException,j=e.DomPosition,k,l,m="Control",p=a.util.isHostMethod(window,"getSelection"),q=a.util.isHostObject(document,"selection"),r=q&&(!p||a.config.preferTextRange);r?(k=o,a.isSelectionValid=function(a){var b=(a||window).document,c=b.selection;return c.type!="None"||e.getDocument(c.createRange().parentElement())==b}):p?(k=n,a.isSelectionValid=function(){return!0}):b.fail("Neither document.selection or window.getSelection() detected."),a.getNativeSelection=k;var s=k(),t=a.createNativeRange(document),u=e.getBody(document),v=f.areHostObjects(s,["anchorNode","focusNode"]&&f.areHostProperties(s,["anchorOffset","focusOffset"]));a.features.selectionHasAnchorAndFocus=v;var w=f.isHostMethod(s,"extend");a.features.selectionHasExtend=w;var x=typeof s.rangeCount=="number";a.features.selectionHasRangeCount=x;var y=!1,z=!0;f.areHostMethods(s,["addRange","getRangeAt","removeAllRanges"])&&typeof s.rangeCount=="number"&&a.features.implementsDomRange&&function(){var a=document.createElement("iframe");u.appendChild(a);var b=e.getIframeDocument(a);b.open(),b.write("<html><head></head><body>12</body></html>"),b.close();var c=e.getIframeWindow(a).getSelection(),d=b.documentElement,f=d.lastChild,g=f.firstChild,h=b.createRange();h.setStart(g,1),h.collapse(!0),c.addRange(h),z=c.rangeCount==1,c.removeAllRanges();var i=h.cloneRange();h.setStart(g,0),i.setEnd(g,2),c.addRange(h),c.addRange(i),y=c.rangeCount==2,h.detach(),i.detach(),u.removeChild(a)}(),a.features.selectionSupportsMultipleRanges=y,a.features.collapsedNonEditableSelectionsSupported=z;var A=!1,B;u&&f.isHostMethod(u,"createControlRange")&&(B=u.createControlRange(),f.areHostProperties(B,["item","add"])&&(A=!0)),a.features.implementsControlRange=A,v?l=function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:l=function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var M;f.isHostMethod(s,"getRangeAt")?M=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:v&&(M=function(b){var c=e.getDocument(b.anchorNode),d=a.createRange(c);return d.setStart(b.anchorNode,b.anchorOffset),d.setEnd(b.focusNode,b.focusOffset),d.collapsed!==this.isCollapsed&&(d.setStart(b.focusNode,b.focusOffset),d.setEnd(b.anchorNode,b.anchorOffset)),d}),a.getSelection=function(a){a=a||window;var b=a[d],c=k(a),e=q?o(a):null;return b?(b.nativeSelection=c,b.docSelection=e,b.refresh(a)):(b=new N(c,e,a),a[d]=b),b},a.getIframeSelection=function(b){return a.getSelection(e.getIframeWindow(b))};var O=N.prototype;if(!r&&v&&f.areHostMethods(s,["removeAllRanges","addRange"])){O.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),E(this)};var Q=function(b,c){var d=g.getRangeDocument(c),e=a.createRange(d);e.collapseToPoint(c.endContainer,c.endOffset),b.nativeSelection.addRange(F(e)),b.nativeSelection.extend(c.startContainer,c.startOffset),b.refresh()};x?O.addRange=function(b,c){if(A&&q&&this.docSelection.type==m)L(this,b);else if(c&&w)Q(this,b);else{var d;y?d=this.rangeCount:(this.removeAllRanges(),d=0),this.nativeSelection.addRange(F(b)),this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==d+1){if(a.config.checkSelectionRanges){var e=M(this.nativeSelection,this.rangeCount-1);e&&!g.rangesEqual(e,b)&&(b=new h(e))}this._ranges[this.rangeCount-1]=b,C(this,b,T(this.nativeSelection)),this.isCollapsed=l(this)}else this.refresh()}}:O.addRange=function(a,b){b&&w?Q(this,a):(this.nativeSelection.addRange(F(a)),this.refresh())},O.setRanges=function(a){if(A&&a.length>1)P(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}}}else{if(!(f.isHostMethod(s,"empty")&&f.isHostMethod(t,"select")&&A&&r))return b.fail("No means of selecting a Range or TextRange was found"),!1;O.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var a;if(this.anchorNode)a=e.getDocument(this.anchorNode);else if(this.docSelection.type==m){var b=this.docSelection.createRange();b.length&&(a=e.getDocument(b.item(0)).body.createTextRange())}if(a){var c=a.body.createTextRange();c.select(),this.docSelection.empty()}}}catch(d){}E(this)},O.addRange=function(a){this.docSelection.type==m?L(this,a):(h.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,C(this,a,!1))},O.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?P(this,a):b&&this.addRange(a[0])}}O.getRangeAt=function(a){if(a<0||a>=this.rangeCount)throw new i("INDEX_SIZE_ERR");return this._ranges[a]};var R;if(r)R=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=e.getBody(b.win.document).createTextRange(),c.collapse(!0)),b.docSelection.type==m?K(b):I(c)?J(b,c):E(b)};else if(f.isHostMethod(s,"getRangeAt")&&typeof s.rangeCount=="number")R=function(b){if(A&&q&&b.docSelection.type==m)K(b);else{b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount;if(b.rangeCount){for(var c=0,d=b.rangeCount;c<d;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));C(b,b._ranges[b.rangeCount-1],T(b.nativeSelection)),b.isCollapsed=l(b)}else E(b)}};else{if(!v||typeof s.isCollapsed!=c||typeof t.collapsed!=c||!a.features.implementsDomRange)return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;R=function(a){var b,c=a.nativeSelection;c.anchorNode?(b=M(c,0),a._ranges=[b],a.rangeCount=1,D(a),a.isCollapsed=l(a)):E(a)}}O.refresh=function(a){var b=a?this._ranges.slice(0):null;R(this);if(a){var c=b.length;if(c!=this._ranges.length)return!1;while(c--)if(!g.rangesEqual(b[c],this._ranges[c]))return!1;return!0}};var S=function(a,b){var c=a.getAllRanges(),d=!1;a.removeAllRanges();for(var e=0,f=c.length;e<f;++e)d||b!==c[e]?a.addRange(c[e]):d=!0;a.rangeCount||E(a)};A?O.removeRange=function(a){if(this.docSelection.type==m){var b=this.docSelection.createRange(),c=H(a),d=e.getDocument(b.item(0)),f=e.getBody(d).createControlRange(),g,h=!1;for(var i=0,j=b.length;i<j;++i)g=b.item(i),g!==c||h?f.add(b.item(i)):h=!0;f.select(),K(this)}else S(this,a)}:O.removeRange=function(a){S(this,a)};var T;!r&&v&&a.features.implementsDomRange?(T=function(a){var b=!1;return a.anchorNode&&(b=e.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)==1),b},O.isBackwards=function(){return T(this)}):T=O.isBackwards=function(){return!1},O.toString=function(){var a=[];for(var b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")},O.collapse=function(b,c){U(this,b);var d=a.createRange(e.getDocument(b));d.collapseToPoint(b,c),this.removeAllRanges(),this.addRange(d),this.isCollapsed=!0},O.collapseToStart=function(){if(!this.rangeCount)throw new i("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)},O.collapseToEnd=function(){if(!this.rangeCount)throw new i("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)},O.selectAllChildren=function(b){U(this,b);var c=a.createRange(e.getDocument(b));c.selectNodeContents(b),this.removeAllRanges(),this.addRange(c)},O.deleteFromDocument=function(){if(A&&q&&this.docSelection.type==m){var a=this.docSelection.createRange(),b;while(a.length)b=a.item(0),a.remove(b),b.parentNode.removeChild(b);this.refresh()}else if(this.rangeCount){var c=this.getAllRanges();this.removeAllRanges();for(var d=0,e=c.length;d<e;++d)c[d].deleteContents();this.addRange(c[e-1])}},O.getAllRanges=function(){return this._ranges.slice(0)},O.setSingleRange=function(a){this.setRanges([a])},O.containsNode=function(a,b){for(var c=0,d=this._ranges.length;c<d;++c)if(this._ranges[c].containsNode(a,b))return!0;return!1},O.toHtml=function(){var a="";if(this.rangeCount){var b=g.getRangeDocument(this._ranges[0]).createElement("div");for(var c=0,d=this._ranges.length;c<d;++c)b.appendChild(this._ranges[c].cloneContents());a=b.innerHTML}return a},O.getName=function(){return"WrappedSelection"},O.inspect=function(){return V(this)},O.detach=function(){this.win[d]=null,this.win=this.anchorNode=this.focusNode=null},N.inspect=V,a.Selection=N,a.selectionPrototype=O,a.addCreateMissingNativeApiListener(function(b){typeof b.getSelection=="undefined"&&(b.getSelection=function(){return a.getSelection(this)}),b=null})}),define("util/class",[],function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;return this.Class=function(){},Class.extend=function(){function h(){!a&&this._constructor&&this._constructor.apply(this,arguments)}var c=this.prototype;a=!0;var d=new this;a=!1;for(var e=0;e<arguments.length;e++){var f=arguments[e];for(var g in f)d[g]=typeof f[g]=="function"&&typeof c[g]=="function"&&b.test(f[g])?function(a,b){return function(){var d=this._super;this._super=c[a];var e=b.apply(this,arguments);return this._super=d,e}}(g,f[g]):f[g]}return h.prototype=d,h.constructor=h,h.extend=arguments.callee,h},this.Class}),GENTICS=window.GENTICS||{},GENTICS.Utils=GENTICS.Utils||{},define("util/lang",[],function(){}),function(a,b){var c=a.alohaQuery||a.jQuery,d=c,e=a.GENTICS,f=a.Class,g=a.console;e.Utils.applyProperties=function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},e.Utils.uniqeString4=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},e.Utils.guid=function(){var a=e.Utils.uniqeString4;return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}(window),define("aloha/ecma5shims",[],function(){var a={bind:function(a){var b=this.obj||this,c=Function.prototype.bind,d=Array.prototype.slice.call(arguments,1);return c?c.apply(b,arguments):function(){return b.apply(a,arguments.length===0?d:d.concat(Array.prototype.slice.call(arguments)))}},trim:function(){var a=this.obj||this,b=String.prototype.trim;return b?b.call(a):a.replace(/^\s+/,"").replace(/\s+$/,"")},indexOf:function(a,b){var c=this.obj||this,d=Array.prototype.indexOf;if(d)return d.call(c,a,b);b===undefined&&(b=0),b<0&&(b+=c.length),b<0&&(b=0);for(var e=c.length;b<e;b++)if(b in c&&c[b]===a)return b;return-1},forEach:function(a,b){var c=this.obj||this,d=Array.prototype.forEach;if(d)return d.call(c,a,b);for(var e=0,f=c.length;e<f;e++)e in c&&a.call(b,c[e],e,c)},map:function(a,c,d){var e=this.obj||this,f=Array.prototype.map,g=typeof arguments[arguments.length-1]=="boolean"?Array.prototype.pop.call(arguments):!1,h=[];if(f)h=f.call(e,a,c);else{var i=new Array(e.length);for(var j=0,k=e.length;j<k;j++)j in e&&(i[j]=a.call(c,e[j],j,e));h=i}return g?b(h):h},filter:function(a,c,d){var e=this.obj||this,f=Array.prototype.filter,g=typeof arguments[arguments.length-1]=="boolean"?Array.prototype.pop.call(arguments):!1,h=[];if(f)h=f.call(e,a,c);else{var i=[],j;for(var k=0,l=e.length;k<l;k++)k in e&&a.call(c,j=e[k],k,e)&&i.push(j);h=i}return g?b(h):h},every:function(a,b){var c=this.obj||this,d=Array.prototype.every;if(d)return d.call(c,a,b);for(var e=0,f=c.length;e<f;e++)if(e in c&&!a.call(b,c[e],e,c))return!1;return!0},some:function(a,b){var c=this.obj||this,d=Array.prototype.some;if(d)return d.call(c,a,b);for(var e=0,f=c.length;e<f;e++)if(e in c&&a.call(b,c[e],e,c))return!0;return!1},hasAttribute:function(a){var b=this.obj||this,c=b.hasAttribute;return c?b.hasAttribute(a):typeof b.attributes[a]!="undefined"}},b=function(b){var c=function(){};c.prototype=a;var d=new c;return d.obj=b,d};for(var c in a)b[c]=a[c];return typeof Node!="undefined"?b.Node=Node:b.Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,DOCUMENT_POSITION_DISCONNECTED:1,DOCUMENT_POSITION_PRECEDING:2,DOCUMENT_POSITION_FOLLOWING:4,DOCUMENT_POSITION_CONTAINS:8,DOCUMENT_POSITION_CONTAINED_BY:16,DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC:32},b.compareDocumentPosition=function(a,b){function f(a){var b=null;if(a)do b=a;while(a=a.parentNode);return b}function g(a,b){return(a.contains(b)&&16)+(b.contains(a)&&8)+(a.sourceIndex>=0&&b.sourceIndex>=0?(a.sourceIndex<b.sourceIndex&&4)+(a.sourceIndex>b.sourceIndex&&2):1)}function h(a){return"sourceIndex"in a?a:a.parentNode.insertBefore(document.createComment(""),a)}if("compareDocumentPosition"in document.documentElement)return a.compareDocumentPosition(b);if("contains"in document.documentElement){if(a==b)return 0;if(f(a)!=f(b))return 1;if("sourceIndex"in a&&"sourceIndex"in b)return g(a,b);if(a==document)return 20;if(b==document)return 10;var c=h(a),d=h(b),e=g(c,d);return a!=c&&c.parentNode.removeChild(c),b!=d&&d.parentNode.removeChild(d),e}throw"compareDocumentPosition nor contains is not supported by this browser."},b.getComputedStyle=function(a,b){return"getComputedStyle"in window?window.getComputedStyle(a,b):a.currentStyle?a.currentStyle:null},b}),GENTICS=window.GENTICS||{},GENTICS.Utils=GENTICS.Utils||{},define("util/dom",["aloha/jquery","util/class","aloha/ecma5shims"],function(a,b,c){var d=window.GENTICS,e={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,DOCUMENT_POSITION_DISCONNECTED:1,DOCUMENT_POSITION_PRECEDING:2,DOCUMENT_POSITION_FOLLOWING:4,DOCUMENT_POSITION_CONTAINS:8,DOCUMENT_POSITION_CONTAINED_BY:16,DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC:32},f=b.extend({wordRegex:/[\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0525\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0621-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971\u0972\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3D\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC\u0EDD\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8B\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10D0-\u10FA\u10FC\u1100-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u2094\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2D00-\u2D25\u2D30-\u2D65\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31B7\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCB\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA65F\uA662-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B\uA78C\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA2D\uFA30-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,nonWordRegex:/[^\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0525\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0621-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971\u0972\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3D\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC\u0EDD\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8B\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10D0-\u10FA\u10FC\u1100-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u2094\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2D00-\u2D25\u2D30-\u2D65\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31B7\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCB\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA65F\uA662-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B\uA78C\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA2D\uFA30-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/
,mergeableTags:["b","code","del","em","i","ins","strong","sub","sup","#text"],nonWordBoundaryTags:["a","b","code","del","em","i","ins","span","strong","sub","sup","#text"],nonEmptyTags:["br"],tags:{flow:["a","abbr","address","area","article","aside","audio","b","bdi","bdo","blockquote","br","button","canvas","cite","code","command","datalist","del","details","dfn","div","dl","em","embed","fieldset","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","i","iframe","img","input","ins","kbd","keygen","label","map","mark","math","menu","meter","nav","noscript","object","ol","output","p","pre","progress","q","ruby","s","samp","script","section","select","small","span","strong","style","sub","sup","svg","table","textarea","time","u","ul","var","video","wbr","#text"],phrasing:["a","abbr","area","audio","b","bdi","bdo","br","button","canvas","cite","code","command","datalist","del","dfn","em","embed","i","iframe","img","input","ins","kbd","keygen","label","map","mark","math","meter","noscript","object","output","progress","q","ruby","samp","script","select","small","span","strong","sub","sup","svg","textarea","time","u","var","video","wbr","#text"]},children:{a:"phrasing",abbr:"phrasing",address:"flow",area:"empty",article:"flow",aside:"flow",audio:"source",b:"phrasing",base:"empty",bdo:"phrasing",blockquote:"phrasing",body:"flow",br:"empty",button:"phrasing",canvas:"phrasing",caption:"flow",cite:"phrasing",code:"phrasing",col:"empty",colgroup:"col",command:"empty",datalist:["phrasing","option"],dd:"flow",del:"phrasing",div:"flow",details:["summary","flow"],dfn:"flow",dl:["dt","dd"],dt:"phrasing",em:"phrasing",embed:"empty",fieldset:["legend","flow"],figcaption:"flow",figure:["figcaption","flow"],footer:"flow",form:"flow",h1:"phrasing",h2:"phrasing",h3:"phrasing",h4:"phrasing",h5:"phrasing",h6:"phrasing",header:"flow",hgroup:["h1","h2","h3","h4","h5","h6"],hr:"empty",i:"phrasing",iframe:"#text",img:"empty",input:"empty",ins:"phrasing",kbd:"phrasing",keygen:"empty",label:"phrasing",legend:"phrasing",li:"flow",link:"empty",map:"area",mark:"phrasing",menu:["li","flow"],meta:"empty",meter:"phrasing",nav:"flow",noscript:"phrasing",object:"param",ol:"li",optgroup:"option",option:"#text",output:"phrasing",p:"phrasing",param:"empty",pre:"phrasing",progress:"phrasing",q:"phrasing",rp:"phrasing",rt:"phrasing",ruby:["phrasing","rt","rp"],s:"phrasing",samp:"pharsing",script:"#script",section:"flow",select:["option","optgroup"],small:"phrasing",source:"empty",span:"phrasing",strong:"phrasing",style:"phrasing",sub:"phrasing",summary:"phrasing",sup:"phrasing",table:["caption","colgroup","thead","tbody","tfoot","tr"],tbody:"tr",td:"flow",textarea:"#text",tfoot:"tr",th:"phrasing",thead:"tr",time:"phrasing",title:"#text",tr:["th","td"],track:"empty",u:"phrasing",ul:"li","var":"phrasing",video:"source",wbr:"empty"},blockLevelElements:["p","h1","h2","h3","h4","h5","h6","blockquote","div","pre"],listElements:["li","ol","ul"],split:function(b,c,d){var e=a(b.startContainer),f=b.startOffset,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;d&&(e=a(b.endContainer),f=b.endOffset),c.length<1&&(c=a(document.body)),g=!b.isCollapsed()&&!d,i=e.parents().get(),i.unshift(e.get(0)),a.each(i,function(a,b){var d=c.filter(function(){return this==b}).length;if(d)return a>0&&(h=i.slice(0,a)),!1});if(!h)return!0;h=h.reverse();for(m=0,n=h.length;m<n;++m){o=h[m];if(m===n-1)o.nodeType===3?(l=document.createTextNode(o.data.substring(f,o.data.length)),o.data=o.data.substring(0,f)):(p=a(o),q=p.contents(),r=p.clone(!1).empty(),l=r.append(q.slice(f,q.length)).get(0)),g&&b.endContainer===o&&(b.endContainer=l,b.endOffset-=f,b.clearCaches()),k?k.prepend(l):a(o).after(l);else{r=a(o).clone(!1).empty(),j?k.prepend(r):j=r,k=r;for(;;){s=h[m+1].nextSibling;if(!s)break;k.append(s)}if(g&&b.endContainer===o){b.endContainer=r.get(0),t=h[m+1],u=0;for(;;){t=t.previousSibling;if(!t)break;u++}b.endOffset-=u,b.clearCaches()}}}return a(h[0]).after(j),a([h[0],j?j.get(0):l])},allowsNesting:function(b,c){if(!b||!b.nodeName||!c||!c.nodeName)return!1;var d=b.nodeName.toLowerCase(),e=c.nodeName.toLowerCase();return this.children[d]?this.children[d]==e?!0:a.isArray(this.children[d])&&a.inArray(e,this.children[d])>=0?!0:a.isArray(this.tags[this.children[d]])&&a.inArray(e,this.tags[this.children[d]])>=0?!0:!1:!1},addMarkup:function(b,c,d){b.startContainer.nodeType===3&&b.startOffset>0&&b.startOffset<b.startContainer.data.length&&this.split(b,a(b.startContainer).parent(),!1),b.endContainer.nodeType===3&&b.endOffset>0&&b.endOffset<b.endContainer.data.length&&this.split(b,a(b.endContainer).parent(),!0);var e=b.getRangeTree();this.recursiveAddMarkup(e,c,b,d),this.doCleanup({merge:!0,removeempty:!0},b)},recursiveAddMarkup:function(b,c,e,f){var g,h,i;for(g=0,i=b.length;g<i;++g)b[g].type=="full"&&this.allowsNesting(c.get(0),b[g].domobj)?(f||b[g].domobj.nodeName!=c.get(0).nodeName)&&(b[g].domobj.nodeType!==3||a.trim(b[g].domobj.data).length!==0)&&(a(b[g].domobj).wrap(c),!f&&b[g].domobj.nodeType!==3&&(h=new d.Utils.RangeObject,h.startContainer=h.endContainer=b[g].domobj.parentNode,h.startOffset=0,h.endOffset=h.endContainer.childNodes.length,this.removeMarkup(h,c,a(b[g].domobj.parentNode)))):(f||b[g].domobj&&b[g].domobj.nodeName!==c.get(0).nodeName)&&b[g].children&&b[g].children.length>0&&this.recursiveAddMarkup(b[g].children,c)},findHighestElement:function(a,b,c){b=b.toLowerCase();var d,e=a,f=c?function(){return c.filter(function(){return e==this}).length}:function(){return!1};while(!f()&&e)e.nodeName.toLowerCase()===b&&(d=e),e=e.parentNode;return d},removeMarkup:function(b,c,d){var e=c.get(0).nodeName,f=this.findHighestElement(b.startContainer,e,d),g=this.findHighestElement(b.endContainer,e,d),h=!1,i,j,k;f&&b.startOffset>0&&(this.split(b,a(f).parent(),!1),h=!0),g&&(b.endContainer.nodeType===3&&b.endOffset<b.endContainer.data.length&&(this.split(b,a(g).parent(),!0),h=!0),b.endContainer.nodeType===1&&b.endOffset<b.childNodes.length&&(this.split(b,a(g).parent(),!0),h=!0)),h&&b.correctRange(),i=this.findHighestElement(b.getCommonAncestorContainer(),e,d),j=i?i.parentNode:b.getCommonAncestorContainer(),j&&(k=b.getRangeTree(j),this.recursiveRemoveMarkup(k,c),this.doCleanup({merge:!0,removeempty:!0},b,j))},recursiveRemoveMarkup:function(b,c){var d,e,f;for(d=0,e=b.length;d<e;++d)b[d].type=="full"&&b[d].domobj.nodeName==c.get(0).nodeName&&(f=a(b[d].domobj).contents(),f.length>0?f.first().unwrap():a(b[d].domobj).remove()),b[d].children&&this.recursiveRemoveMarkup(b[d].children,c)},doCleanup:function(b,c,e){var f=this,g,h,i,j,k;return typeof b=="undefined"&&(b={}),typeof b.merge=="undefined"&&(b.merge=!1),typeof b.removeempty=="undefined"&&(b.removeempty=!1),typeof e=="undefined"&&c&&(e=c.getCommonAncestorContainer()),g=!1,h=!1,i=a(e),j=c.startOffset,k=c.endOffset,i.contents().each(function(e){var l;try{l=this.nodeType}catch(m){return}switch(l){case 1:if(g&&g.nodeName==this.nodeName)c.startContainer===i&&j>e&&(c.startOffset-=1,h=!0),c.endContainer===i&&k>e&&(c.endOffset-=1,h=!0),a(g).append(a(this).contents()),h|=f.doCleanup(b,c,g),a(this).remove();else{h|=f.doCleanup(b,c,this);var n=!1;b.removeempty&&(d.Utils.Dom.isBlockLevelElement(this)&&this.childNodes.length===0&&(n=!0),a.inArray(this.nodeName.toLowerCase(),f.mergeableTags)>=0&&a(this).text().length===0&&this.childNodes.length===0&&(n=!0)),n?(c.startContainer===this.parentNode&&j>e&&(c.startOffset=c.startOffset-1,h=!0),c.endContainer===this.parentNode&&k>e&&(c.endOffset=c.endOffset-1,h=!0),a(this).remove()):a.inArray(this.nodeName.toLowerCase(),f.mergeableTags)>=0?g=this:g=!1}break;case 3:if(g&&g.nodeType===3&&b.merge)c.startContainer===this?(c.startContainer=g,c.startOffset+=g.nodeValue.length,h=!0):c.startContainer===g.parentNode&&c.startOffset===f.getIndexInParent(g)+1&&(c.startContainer=g,c.startOffset=g.nodeValue.length,h=!0),c.endContainer===this?(c.endContainer=g,c.endOffset+=g.nodeValue.length,h=!0):c.endContainer===g.parentNode&&c.endOffset===f.getIndexInParent(g)+1&&(c.endContainer=g,c.endOffset=g.nodeValue.length,h=!0),g.data+=this.data;else if(this.nodeValue!==""||!b.removeempty)if(this.nodeValue!==""||!b.removeempty){g=this;break}c.startContainer===this.parentNode&&c.startOffset>e&&(c.startOffset=c.startOffset-1,h=!0),c.endContainer===this.parentNode&&c.endOffset>e&&(c.endOffset=c.endOffset-1,h=!0),a(this).remove()}}),h&&c.clearCaches(),h},getIndexInParent:function(a){if(!a)return!1;var b=0,c=a.previousSibling;while(c)b++,c=c.previousSibling;return b},isBlockLevelElement:function(b){return b?b.nodeType===1&&a.inArray(b.nodeName.toLowerCase(),this.blockLevelElements)>=0?!0:!1:!1},isLineBreakElement:function(a){return a?a.nodeType===1&&a.nodeName.toLowerCase()=="br":!1},isListElement:function(b){return b?b.nodeType===1&&a.inArray(b.nodeName.toLowerCase(),this.listElements)>=0:!1},isSplitObject:function(a){if(a.nodeType===1)switch(a.nodeName.toLowerCase()){case"p":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"li":return!0}return!1},searchAdjacentTextNode:function(b,c,d,e){if(!b||b.nodeType!==1||c<0||c>b.childNodes.length)return!1;typeof e=="undefined"&&(e={blocklevel:!0,list:!0,linebreak:!0}),typeof e.blocklevel=="undefined"&&(e.blocklevel=!0),typeof e.list=="undefined"&&(e.list=!0),typeof e.linebreak=="undefined"&&(e.linebreak=!0),typeof d=="undefined"&&(d=!0);var f,g=b;d&&c>0&&(f=b.childNodes[c-1]),!d&&c<b.childNodes.length&&(f=b.childNodes[c]);while(g)if(!f){if(e.blocklevel&&this.isBlockLevelElement(g))return!1;if(e.list&&this.isListElement(g))return!1;f=d?g.previousSibling:g.nextSibling,g=g.parentNode}else{if(f.nodeType===3&&a.trim(f.data).length>0)return f;if(e.blocklevel&&this.isBlockLevelElement(f))return!1;if(e.linebreak&&this.isLineBreakElement(f))return!1;if(e.list&&this.isListElement(f))return!1;f.nodeType===3?f=d?f.previousSibling:f.nextSibling:(g=f,f=d?f.lastChild:f.firstChild)}},insertIntoDOM:function(b,c,d,e,f){var g=c.getContainerParents(d,e),h=this,i,j,k,l,m;return d||(d=a(document.body)),g.length===0?i=d.get(0):a.each(g,function(a,c){if(h.allowsNesting(c,b.get(0)))return i=c,!1}),typeof i=="undefined"&&d.length>0&&(i=d.get(0)),!this.allowsNesting(i,b.get(0))&&!f?!1:typeof i!="undefined"?(l=this.split(c,a(i),e),l===!0?(j=c.startContainer,k=c.startOffset,e&&(j=c.endContainer,k=c.endOffset),k===0?(m=a(j).contents(),m.length>0?m.eq(0).before(b):a(j).append(b),!0):(a(j).contents().eq(k-1).after(b),!0)):l?(l.eq(0).after(b),!0):!1):!1},removeFromDOM:function(b,c,d){if(d){var e=this.getIndexInParent(b),f=a(b).contents().length,g=b.parentNode;c.startContainer==g&&c.startOffset>e?c.startOffset+=f-1:c.startContainer==b&&(c.startContainer=g,c.startOffset=e+c.startOffset),c.endContainer==g&&c.endOffset>e?c.endOffset+=f-1:c.endContainer==b&&(c.endContainer=g,c.endOffset=e+c.endOffset),a(b).contents().unwrap(),this.doCleanup({merge:!0},c,g)}},removeRange:function(b){if(!b)return!1;if(b.isCollapsed())return!1;b.startContainer.nodeType==3&&b.startOffset>0&&b.startOffset<b.startContainer.data.length&&this.split(b,a(b.startContainer).parent(),!1),b.endContainer.nodeType==3&&b.endOffset>0&&b.endOffset<b.endContainer.data.length&&this.split(b,a(b.endContainer).parent(),!0);var c=b.getRangeTree();b.endContainer=b.startContainer,b.endOffset=b.startOffset,this.recursiveRemoveRange(c,b),this.doCleanup({merge:!0},b),b.clearCaches()},recursiveRemoveRange:function(b,c){for(var d=0;d<b.length;++d)b[d].type=="full"?(a(c.startContainer).parents().andSelf().filter(b[d].domobj).length>0&&(c.startContainer=c.endContainer=b[d].domobj.parentNode,c.startOffset=c.endOffset=this.getIndexInParent(b[d].domobj)),a(b[d].domobj).remove()):b[d].type=="partial"&&b[d].children&&this.recursiveRemoveRange(b[d].children,c)},extendToWord:function(a,b){var c=this.searchWordBoundary(a.startContainer,a.startOffset,!0),d=this.searchWordBoundary(a.endContainer,a.endOffset,!1);if(!b){if(a.startContainer==c.container&&a.startOffset==c.offset)return;if(a.endContainer==d.container&&a.endOffset==d.offset)return}a.startContainer=c.container,a.startOffset=c.offset,a.endContainer=d.container,a.endOffset=d.offset,a.correctRange(),a.clearCaches()},isWordBoundaryElement:function(b){return!b||!b.nodeName?!1:a.inArray(b.nodeName.toLowerCase(),this.nonWordBoundaryTags)==-1},searchWordBoundary:function(a,b,c){typeof c=="undefined"&&(c=!0);var d=!1,e,f,g;while(!d)if(a.nodeType===3)if(!c)e=a.data.substring(b).search(this.nonWordRegex),e!=-1?(b+=e,d=!0):(b=this.getIndexInParent(a)+1,a=a.parentNode);else{e=a.data.substring(0,b).search(this.nonWordRegex),f=e;while(f!=-1)e=f,f=a.data.substring(e+1,b).search(this.nonWordRegex),f!=-1&&(f=f+e+1);e!=-1?(b=e+1,d=!0):(b=this.getIndexInParent(a),a=a.parentNode)}else a.nodeType===1&&(c?b>0?this.isWordBoundaryElement(a.childNodes[b-1])?d=!0:(a=a.childNodes[b-1],b=a.nodeType===3?a.data.length:a.childNodes.length):this.isWordBoundaryElement(a)?d=!0:(b=this.getIndexInParent(a),a=a.parentNode):b<a.childNodes.length?this.isWordBoundaryElement(a.childNodes[b])?d=!0:(a=a.childNodes[b],b=0):this.isWordBoundaryElement(a)?d=!0:(b=this.getIndexInParent(a)+1,a=a.parentNode));return a.nodeType!==3&&(g=this.searchAdjacentTextNode(a,b,!c),g&&(a=g,b=c?0:a.data.length)),{container:a,offset:b}},isEmpty:function(b){if(!b)return!0;if(a.inArray(b.nodeName.toLowerCase(),this.nonEmptyTags)!=-1)return!1;if(b.nodeType===3)return b.data.search(/\S/)==-1;for(var c=0,d=b.childNodes.length;c<d;++c)if(!this.isEmpty(b.childNodes[c]))return!1;return!0},setCursorAfter:function(a){var b=new d.Utils.RangeObject,c=this.getIndexInParent(a),e,f;return a.nodeType==3?(e=a,f=e.nodeValue.length):a.nextSibling&&a.nextSibling.nodeType==3?(e=a.nextSibling,f=0):(e=a.parentNode,f=this.getIndexInParent(a)+1),b.startContainer=b.endContainer=e,b.startOffset=b.endOffset=f,b.select(),b},selectDomNode:function(a){var b=new d.Utils.RangeObject;b.startContainer=b.endContainer=a.parentNode,b.startOffset=this.getIndexInParent(a),b.endOffset=b.startOffset+1,b.select()},setCursorInto:function(a){var b=new d.Utils.RangeObject;b.startContainer=b.endContainer=a,b.startOffset=b.endOffset=0,b.select()},isEditingHost:function(a){return a&&a.nodeType==1&&(a.contentEditable=="true"||a.parentNode&&a.parentNode.nodeType==9&&a.parentNode.designMode=="on")},isEditable:function(a){return a&&!this.isEditingHost(a)&&(a.nodeType!=1||a.contentEditable!="false")&&(this.isEditingHost(a.parentNode)||this.isEditable(a.parentNode))},getEditingHostOf:function(a){if(this.isEditingHost(a))return a;if(this.isEditable(a)){var b=a.parentNode;while(!this.isEditingHost(b))b=b.parentNode;return b}return null},inSameEditingHost:function(a,b){return this.getEditingHostOf(a)&&this.getEditingHostOf(a)==this.getEditingHostOf(b)},isBlockNode:function(a){return a&&(a.nodeType==c.Node.ELEMENT_NODE&&c(["inline","inline-block","inline-table","none"]).indexOf(c.getComputedStyle(a).display)==-1||a.nodeType==c.Node.DOCUMENT_NODE||a.nodeType==c.Node.DOCUMENT_FRAGMENT_NODE)},getFirstVisibleChild:function(b,d){if(!b)return null;if(b.nodeType==c.Node.TEXT_NODE&&this.isEmpty(b)||b.nodeType==c.Node.ELEMENT_NODE&&b.offsetHeight==0&&a.inArray(b.nodeName.toLowerCase(),this.nonEmptyTags)===-1)return null;if(b.nodeType==c.Node.TEXT_NODE||b.nodeType==c.Node.ELEMENT_NODE&&b.childNodes.length==0||!a(b).contentEditable())return d?b:null;for(var e=0;e<b.childNodes.length;++e){var f=this.getFirstVisibleChild(b.childNodes[e],!0);if(f!=null)return f}return null},getLastVisibleChild:function(b,d){if(!b)return null;if(b.nodeType==c.Node.TEXT_NODE&&this.isEmpty(b)||b.nodeType==c.Node.ELEMENT_NODE&&b.offsetHeight==0&&a.inArray(b.nodeName.toLowerCase(),this.nonEmptyTags)===-1)return null;if(b.nodeType==c.Node.TEXT_NODE||b.nodeType==c.Node.ELEMENT_NODE&&b.childNodes.length==0||!a(b).contentEditable())return d?b:null;for(var e=b.childNodes.length-1;e>=0;--e){var f=this.getLastVisibleChild(b.childNodes[e],!0);if(f!=null)return f}return null}});return d.Utils.Dom=new f,d.Utils.Dom}),define("aloha/pluginmanager",["aloha/jquery","util/class"],function(a,b){return new(b.extend({plugins:{},init:function(a,b){var c=this,d=Aloha&&Aloha.settings?Aloha.settings.plugins||{}:{},e,f,g;for(g in d)d.hasOwnProperty(g)&&(f=this.plugins[g]||!1,f&&(f.settings=d[g]||{}));if(!b.length)for(g in this.plugins)this.plugins.hasOwnProperty(g)&&b.push(g);for(e=0;e<b.length;++e)g=b[e],f=this.plugins[g]||!1,f&&(f.settings=f.settings||{},typeof f.settings.enabled=="undefined"&&(f.settings.enabled=!0),f.settings.enabled&&f.checkDependencies()&&f.init());a()},register:function(a){if(!a.name)throw new Error("Plugin does not have an name.");if(this.plugins[a.name])throw new Error('Already registered the plugin "'+a.name+'"!');this.plugins[a.name]=a},makeClean:function(a){var b,c;for(c in this.plugins)this.plugins.hasOwnProperty(c)&&(Aloha.Log.isDebugEnabled()&&Aloha.Log.debug(this,"Passing contents of HTML Element with id { "+a.attr("id")+" } for cleaning to plugin { "+c+" }"),this.plugins[c].makeClean(a))},toString:function(){return"pluginmanager"}}))}),define("aloha/core",["aloha/jquery","aloha/pluginmanager"],function(a,b){Aloha.ready(function(){a(".ext-ie6").removeClass("ext-ie6")});var c={};return a.extend(!0,Aloha,{version:"0.10.0",editables:[],activeEditable:null,settings:{},defaults:{},ui:{},OSName:"Unknown",stage:"loadingAloha",loadedPlugins:[],requirePaths:[],init:function(){Aloha.settings=a.extendObjects(!0,{},Aloha.defaults,Aloha.settings),window.rangy&&window.rangy.init(),Aloha.stage="loadPlugins",Aloha.loadPlugins(function(){Aloha.stage="initAloha",Aloha.initAloha(function(){Aloha.stage="initPlugins",Aloha.initPlugins(function(){Aloha.stage="initGui",Aloha.initGui(function(){Aloha.stage="alohaReady",Aloha.trigger("aloha-ready")})})})})},loadPlugins:function(b){var d=this.getPluginsToBeLoaded();if(d.length){var e={},f=[],g=[],h={};a.each(d,function(b,c){var d,i,j,k="";d=c.split("/"),i=d[0],j=d[1],Aloha.settings.basePath&&(k=Aloha.settings.basePath),Aloha.settings.bundles&&Aloha.settings.bundles[i]?k+=Aloha.settings.bundles[i]:k+="../plugins/"+i,f.push(j),e[j]=k+"/"+j+"/lib",h[j]=k+"/"+j,a.each(["nls","css","vendor","res"],function(){e[j+"/"+this]=k+"/"+j+"/"+this}),g.push(j+"/"+j+"-plugin")}),this.loadedPlugins=f,this.requirePaths=e,require({context:"aloha",paths:e,locale:this.settings.locale||this.defaults.locale||"en"},g,b),c=h}else b()},getPluginsToBeLoaded:function(){var b=a("[data-aloha-plugins]").data("aloha-plugins");if(typeof Aloha.settings.plugins!="undefined"&&typeof Aloha.settings.plugins.load!="undefined"){b=Aloha.settings.plugins.load;if(b instanceof Array)return b}return typeof b=="string"&&b!==""?b.replace(/\s+/g,"").split(","):[]},getLoadedPlugins:function(){return this.loadedPlugins},isPluginLoaded:function(b){var c=!1;return a.each(this.loadedPlugins,function(){b.toString()===this.toString()&&(c=!0)}),c},initAloha:function(b){(a.browser.webkit&&parseFloat(a.browser.version)<532.5||a.browser.mozilla&&parseFloat(a.browser.version)<1.9||a.browser.msie&&a.browser.version<7||a.browser.opera&&a.browser.version<11)&&window.console&&window.console.log&&window.console.log("Your browser is not supported."),a("html").mousedown(function(a){Aloha.activeEditable&&!Aloha.isMessageVisible()&&!Aloha.eventHandled&&(Aloha.activeEditable.blur(),Aloha.activeEditable=null)}).mouseup(function(a){Aloha.eventHandled=!1}),Aloha.settings.base=Aloha.getAlohaUrl(),Aloha.Log.init(),Aloha.settings.errorhandling&&(window.onerror=function(a,b,c){return Aloha.Log.error(Aloha,"Error message: "+a+"\nURL: "+b+"\nLine Number: "+c),!0}),navigator.appVersion.indexOf("Win")!=-1&&(Aloha.OSName="Win"),navigator.appVersion.indexOf("Mac")!=-1&&(Aloha.OSName="Mac"),navigator.appVersion.indexOf("X11")!=-1&&(Aloha.OSName="Unix"),navigator.appVersion.indexOf("Linux")!=-1&&(Aloha.OSName="Linux");try{var c;try{c=document.queryCommandSupported("enableObjectResizing")}catch(d){c=!1,Aloha.Log.log("enableObjectResizing is not supported.")}c&&(document.execCommand("enableObjectResizing",!1,!1),Aloha.Log.log("enableObjectResizing disabled."))}catch(d){Aloha.Log.error(d,"Could not disable enableObjectResizing")}b()},initPlugins:function(a){b.init(function(){a()},this.getLoadedPlugins())},initGui:function(a){Aloha.RepositoryManager.init();for(var b=0,c=Aloha.editables.length;b<c;b++)Aloha.editables[b].ready||Aloha.editables[b].init();a()},activateEditable:function(a){for(var b=0,c=Aloha.editables.length;b<c;b++)Aloha.editables[b]!=a&&Aloha.editables[b].isActive&&Aloha.editables[b].blur();Aloha.activeEditable=a},getActiveEditable:function(){return Aloha.activeEditable},deactivateEditable:function(){if(typeof Aloha.activeEditable=="undefined"||Aloha.activeEditable===null)return;Aloha.activeEditable.blur(),Aloha.activeEditable=null},getEditableById:function(b){a("#"+b).get(0).nodeName.toLowerCase()==="textarea"&&(b+="-aloha");for(var c=0,d=Aloha.editables.length;c<d;c++)if(Aloha.editables[c].getId()==b)return Aloha.editables[c];return null},isEditable:function(a){for(var b=0,c=Aloha.editables.length;b<c;b++)if(Aloha.editables[b].originalObj.get(0)===a)return!0;return!1},log:function(a,b,c){typeof Aloha.Log!="undefined"&&Aloha.Log.log(a,b,c)},registerEditable:function(a){Aloha.editables.push(a)},unregisterEditable:function(a){var b=Aloha.editables.indexOf(a);b!=-1&&Aloha.editables.splice(b,1)},toString:function(){return"Aloha"},isModified:function(){for(var a=0;a<Aloha.editables.length;a++)if(Aloha.editables[a].isModified&&Aloha.editables[a].isModified())return!0;return!1},getAlohaUrl:function(b){var c=a("[data-aloha-plugins]"),d=c.length?c[0].src.replace(/\/?aloha.js$/,""):"";return typeof Aloha.settings.baseUrl=="string"&&(d=Aloha.settings.baseUrl),d},getPluginUrl:function(a){var b;return a&&(b=c[a],b&&(b.match("^(/|http[s]?:).*")||(b=Aloha.getAlohaUrl()+"/"+b))),b}}),Aloha}),define("aloha/console",["aloha/core","util/class","aloha/jquery"],function(a,b,c){var d=window.console,e=b.extend({init:function(){if(typeof a.settings.logLevels=="undefined"||!a.settings.logLevels)a.settings.logLevels={error:!0,warn:!0};if(typeof a.settings.logHistory=="undefined"||!a.settings.logHistory)a.settings.logHistory={};a.settings.logHistory.maxEntries||(a.settings.logHistory.maxEntries=100),a.settings.logHistory.highWaterMark||(a.settings.logHistory.highWaterMark=90),a.settings.logHistory.levels||(a.settings.logHistory.levels={error:!0,warn:!0}),this.flushLogHistory(),a.trigger("aloha-logger-ready")},logHistory:[],highWaterMarkReached:!1,log:function(b,c,e){typeof c=="undefined"&&(e=b),typeof c!="string"&&c&&c.toString&&(c=c.toString()),typeof e=="undefined"&&(e=c,c=undefined);if(typeof b=="undefined"||!b)b="log";b=b.toLowerCase();if(typeof a.settings.logLevels=="undefined")return;if(!a.settings.logLevels[b])return;c=c||"Unkown Aloha Component",this.addToLogHistory({level:b,component:c,message:e,date:new Date});switch(b){case"error":window.console&&d.error&&(!c&&!e?d.error("Error occured without message and component"):d.error(c+": "+e));break;case"warn":window.console&&d.warn&&d.warn(c+": "+e);break;case"info":window.console&&d.info&&d.info(c+": "+e);break;case"debug":window.console&&d.log&&d.log(c+" ["+b+"]: "+e);break;default:window.console&&d.log&&d.log(c+" ["+b+"]: "+e)}},error:function(a,b){this.log("error",a,b)},warn:function(a,b){this.log("warn",a,b)},info:function(a,b){this.log("info",a,b)},debug:function(a,b){this.log("debug",a,b)},deprecated:function(b,c){this.log("warn",b,c);if(a.settings.logLevels.deprecated)throw new Error(c)},isLogLevelEnabled:function(b){return a.settings&&a.settings.logLevels&&a.settings.logLevels[b]},isErrorEnabled:function(){return this.isLogLevelEnabled("error")},isWarnEnabled:function(){return this.isLogLevelEnabled("warn")},isInfoEnabled:function(){return this.isLogLevelEnabled("info")},isDebugEnabled:function(){return this.isLogLevelEnabled("debug")},addToLogHistory:function(b){a.settings.logHistory||this.init();if(a.settings.logHistory.maxEntries<=0||!a.settings.logHistory.levels[b.level])return;this.logHistory.push(b),this.highWaterMarkReached||this.logHistory.length>=a.settings.logHistory.maxEntries*a.settings.logHistory.highWaterMark/100&&(a.trigger("aloha-log-full"),this.highWaterMarkReached=!0);while(this.logHistory.length>a.settings.logHistory.maxEntries)this.logHistory.shift()},getLogHistory:function(){return this.logHistory},flushLogHistory:function(){this.logHistory=[],this.highWaterMarkReached=!1}});return e=new e,a.Log=a.Console=e}),GENTICS=window.GENTICS||{},GENTICS.Utils=GENTICS.Utils||{},define("util/range",["aloha/jquery","util/dom","util/class","aloha/console","aloha/rangy-core"],function(a,b,c,d){var e=window.GENTICS,f=window.rangy;return e.Utils.RangeObject=c.extend({_constructor:function(a){typeof a=="object"?(typeof a.startContainer!="undefined"&&(this.startContainer=a.startContainer),typeof a.startOffset!="undefined"&&(this.startOffset=a.startOffset),typeof a.endContainer!="undefined"&&(this.endContainer=a.endContainer),typeof a.endOffset!="undefined"&&(this.endOffset=a.endOffset)):a===!0&&this.initializeFromUserSelection()},startContainer:undefined,startOffset:undefined,endContainer:undefined,endOffset:undefined,deleteContents:function(){b.removeRange(this)},log:function(a){d.deprecated("Utils.RangeObject",'log() is deprecated. use console.log() from module "aloha/console" instead: '+a)},isCollapsed:function(){return!this.endContainer||this.startContainer===this.endContainer&&this.startOffset===this.endOffset},getCommonAncestorContainer:function(){return this.commonAncestorContainer?this.commonAncestorContainer:(this.updateCommonAncestorContainer(),this.commonAncestorContainer)},getContainerParents:function(b,c){var d=c?this.endContainer:this.startContainer,e,f,g;if(!d)return!1;if(typeof b=="undefined"||!b)b=a("body");if(d.nodeType==3)e=a(d).parents();else{e=a(d).parents();for(g=e.length;g>0;--g)e[g]=e[g-1];e[0]=d}return f=e.index(b),f>=0&&(e=e.slice(0,f)),e},getStartContainerParents:function(a){return this.getContainerParents(a,!1)},getEndContainerParents:function(a){return this.getContainerParents(a,!0)},updateCommonAncestorContainer:function(a){if(!a){var b=this.getStartContainerParents(),c=this.getEndContainerParents(),e;if(!(b.length>0&&c.length>0))return d.warn("could not find commonAncestorContainer"),!1;for(e=0;e<b.length;e++)if(c.index(b[e])!=-1){this.commonAncestorContainer=b[e];break}}else this.commonAncestorContainer=a;return d.debug(a?"commonAncestorContainer was set successfully":"commonAncestorContainer was calculated successfully"),!0},getCollapsedIERange:function(a,b){var c=document.body.createTextRange(),d,e,f,g;return g=this.searchElementToLeft(a,b),g.element?(d=document.body.createTextRange(),d.moveToElementText(g.element),c.setEndPoint("StartToEnd",d),g.characters!==0?c.moveStart("character",g.characters):(c.moveStart("character",1),c.moveStart("character",-1))):(e=this.searchElementToRight(a,b),f=a.nodeType==3?a.parentNode:a,d=document.body.createTextRange(),d.moveToElementText(f),c.setEndPoint("StartToStart",d),g.characters!==0&&c.moveStart("character",g.characters)),c.collapse(),c},select:function(){var a,b,c,d,e;d=f.createRange(),d.setStart(this.startContainer,this.startOffset),d.setEnd(this.endContainer,this.endOffset),e=f.getSelection(),e.setSingleRange(d)},searchElementToLeft:function(a,b){var c,d=0;a.nodeType===3?(d=b,c=a.previousSibling):b>0&&(c=a.childNodes[b-1]);while(c&&c.nodeType===3)d+=c.data.length,c=c.previousSibling;return{element:c,characters:d}},searchElementToRight:function(a,b){var c,d=0;a.nodeType===3?(d=a.data.length-b,c=a.nextSibling):b<a.childNodes.length&&(c=a.childNodes[b]);while(c&&c.nodeType===3)d+=c.data.length,c=c.nextSibling;return{element:c,characters:d}},update:function(a){d.debug("now updating rangeObject"),this.initializeFromUserSelection(a),this.updateCommonAncestorContainer()},initializeFromUserSelection:function(a){var b=f.getSelection(),c;if(!b)return!1;if(!b.rangeCount)return!1;c=b.getRangeAt(0);if(!c)return!1;this.startContainer=c.startContainer,this.endContainer=c.endContainer,this.startOffset=c.startOffset,this.endOffset=c.endOffset,this.correctRange();return},correctRange:function(){var a,b,c,d,f;this.clearCaches();if(this.isCollapsed()){if(this.startContainer.nodeType===1){if(this.startOffset>0&&this.startContainer.childNodes[this.startOffset-1].nodeType===3){this.startContainer=this.startContainer.childNodes[this.startOffset-1],this.startOffset=this.startContainer.data.length,this.endContainer=this.startContainer,this.endOffset=this.startOffset;return}if(this.startOffset>0&&this.startContainer.childNodes[this.startOffset-1].nodeType===1){a=e.Utils.Dom.searchAdjacentTextNode(this.startContainer,this.startOffset,!0);if(a){this.startContainer=this.endContainer=a,this.startOffset=this.endOffset=a.data.length;return}a=e.Utils.Dom.searchAdjacentTextNode(this.startContainer,this.startOffset,!1);if(a){this.startContainer=this.endContainer=a,this.startOffset=this.endOffset=0;return}}if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType===3){this.startContainer=this.startContainer.childNodes[this.startOffset],this.startOffset=0,this.endContainer=this.startContainer,this.endOffset=0;return}}this.startContainer.nodeType===3&&this.startOffset===0&&(a=e.Utils.Dom.searchAdjacentTextNode(this.startContainer.parentNode,e.Utils.Dom.getIndexInParent(this.startContainer),!0),a&&(this.startContainer=this.endContainer=a,this.startOffset=this.endOffset=a.data.length))}else{if(this.startContainer.nodeType===1)if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType===3)this.startContainer=this.startContainer.childNodes[this.startOffset],this.startOffset=0;else if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType===1){b=!1,c=this.startContainer.childNodes[this.startOffset];while(b===!1&&c.childNodes&&c.childNodes.length>0)c=c.childNodes[0],c.nodeType===3&&(b=c);b!==!1&&(this.startContainer=b,this.startOffset=0)}this.startContainer.nodeType===3&&this.startOffset===this.startContainer.data.length&&(a=e.Utils.Dom.searchAdjacentTextNode(this.startContainer.parentNode,e.Utils.Dom.getIndexInParent(this.startContainer)+1,!1),a&&(this.startContainer=a,this.startOffset=0));if(this.endContainer.nodeType===3&&this.endOffset===0)if(this.endContainer.previousSibling&&this.endContainer.previousSibling.nodeType===3)this.endContainer=this.endContainer.previousSibling,this.endOffset=this.endContainer.data.length;else if(this.endContainer.previousSibling&&this.endContainer.previousSibling.nodeType===1&&this.endContainer.parentNode){d=this.endContainer.parentNode;for(f=0;f<d.childNodes.length;++f)if(d.childNodes[f]==this.endContainer){this.endOffset=f;break}this.endContainer=d}this.endContainer.nodeType==1&&this.endOffset===0&&this.endContainer.previousSibling&&(this.endContainer.previousSibling.nodeType===3?(this.endContainer=this.endContainer.previousSibling,this.endOffset=this.endContainer.data.length):this.endContainer.previousSibling.nodeType===1&&this.endContainer.previousSibling.childNodes&&this.endContainer.previousSibling.childNodes.length>0&&(this.endContainer=this.endContainer.previousSibling,this.endOffset=this.endContainer.childNodes.length));if(this.endContainer.nodeType==1)if(this.endOffset>0&&this.endContainer.childNodes[this.endOffset-1].nodeType===3)this.endContainer=this.endContainer.childNodes[this.endOffset-1],this.endOffset=this.endContainer.data.length;else if(this.endOffset>0&&this.endContainer.childNodes[this.endOffset-1].nodeType===1){b=!1,c=this.endContainer.childNodes[this.endOffset-1];while(b===!1&&c.childNodes&&c.childNodes.length>0)c=c.childNodes[c.childNodes.length-1],c.nodeType===3&&(b=c);b!==!1&&(this.endContainer=b,this.endOffset=this.endContainer.data.length)}}},clearCaches:function(){this.commonAncestorContainer=undefined},getRangeTree:function(a){return typeof a=="undefined"&&(a=this.getCommonAncestorContainer()),this.inselection=!1,this.recursiveGetRangeTree(a)},recursiveGetRangeTree:function(b){var c=a(b),d=0,f=this,g=[];return c.contents().each(function(a){var c="none",h=!1,i=!1,j=!1,k=!1,l=!1,m=!1,n;f.isCollapsed()&&b===f.startContainer&&f.startOffset===a&&(g[d]=new e.Utils.RangeTree,g[d].type="collapsed",g[d].domobj=undefined,f.inselection=!1,j=!0,d++);if(!f.inselection&&!j)switch(this.nodeType){case 3:this===f.startContainer&&(f.inselection=!0,c=f.startOffset>0?"partial":"full",h=f.startOffset,i=this.length);break;case 1:this===f.startContainer&&f.startOffset===0&&(f.inselection=!0,c="full"),b===f.startContainer&&f.startOffset===a&&(f.inselection=!0,c="full")}if(f.inselection&&!j){c=="none"&&(c="full");switch(this.nodeType){case 3:this===f.endContainer&&(f.inselection=!1
,f.endOffset<this.length&&(c="partial"),h===!1&&(h=0),i=f.endOffset);break;case 1:this===f.endContainer&&f.endOffset===0&&(f.inselection=!1)}b===f.endContainer&&f.endOffset<=a&&(f.inselection=!1,c="none")}g[d]=new e.Utils.RangeTree,g[d].domobj=this,g[d].type=c,c=="partial"&&(g[d].startOffset=h,g[d].endOffset=i),g[d].children=f.recursiveGetRangeTree(this);if(g[d].children.length>0){for(n=0;n<g[d].children.length;++n)switch(g[d].children[n].type){case"none":k=!0;break;case"full":m=!0;break;case"partial":l=!0}l||m&&k?g[d].type="partial":m&&!l&&!k&&(g[d].type="full")}d++}),this.isCollapsed()&&b===this.startContainer&&this.startOffset==b.childNodes.length&&(g[d]=new e.Utils.RangeTree,g[d].type="collapsed",g[d].domobj=undefined),g},findMarkup:function(b,c,d){var e=this.getContainerParents(c,d),f=!1;return a.each(e,function(a,c){if(b.apply(c))return f=c,!1}),f},getText:function(){return this.isCollapsed()?"":this.recursiveGetText(this.getRangeTree())},recursiveGetText:function(b){if(!b)return"";var c=this,d="";return a.each(b,function(){this.type=="full"?d+=a(this.domobj).text():this.type=="partial"&&this.domobj.nodeType===3?d+=a(this.domobj).text().substring(this.startOffset,this.endOffset):this.type=="partial"&&this.domobj.nodeType===1&&this.children&&(d+=c.recursiveGetText(this.children))}),d}}),e.Utils.RangeTree=c.extend({domobj:{},type:null,children:[]}),e.Utils.RangeObject}),define("aloha/floatingmenu",["aloha/core","aloha/jquery","aloha/ext","util/class","aloha/console","vendor/jquery.store"],function(a,b,c,d,e){function j(c){if(!a.activeEditable)return;var d=c.obj,e=a.activeEditable.obj.offset(),f=c.behaviour==="topalign",g=c.behaviour==="append",h=c.pinned&&parseInt(d.css("left"),10)!=e.left+c.horizontalOffset;if(f&&h||g)return;var i=d.height(),j=b(document).scrollTop(),k=e.top-i+c.marginTop-c.topalignOffset;j>k?e.top=f?j+c.marginTop:c.marginTop:j<=k&&(e.top-=i+(f?c.marginTop+c.topalignOffset:0)),c.floatTo(e)}var f=window.GENTICS,g=d.extend({_constructor:function(a){this.label=a,this.groups=[],this.groupMap={},this.visible=!0},getGroup:function(a){var b=this.groupMap[a];return typeof b=="undefined"&&(b=new h,this.groupMap[a]=b,this.groups.push(b)),b},getExtComponent:function(){var a=this;return this.extPanel||(this.extPanel=new c.Panel({tbar:[],title:this.label,style:"margin-top:0px",bodyStyle:"display:none",autoScroll:!0})),b.each(this.groups,function(b,c){c.extButtonGroup||a.extPanel.getTopToolbar().add(c.getExtComponent())}),this.extPanel},doLayout:function(){var c=this;return a.Log.isDebugEnabled()&&a.Log.debug(this,"doLayout called for tab "+this.label),this.visible=!1,b.each(this.groups,function(a,b){c.visible|=b.doLayout()}),a.Log.isDebugEnabled()&&a.Log.debug(this,"tab "+this.label+(this.visible?" is ":" is not ")+"visible now"),this.visible}}),h=d.extend({_constructor:function(){this.buttons=[],this.fields=[]},addButton:function(b){if(b.button instanceof a.ui.AttributeField){if(!(this.fields.length<2))throw new Error("Too much fields in this group");this.fields.push(b)}else typeof b.button!="undefined"&&this.buttons.push(b)},getExtComponent:function(){var a=this,d,e=[],f=0,g=0,h,i,j;if(typeof this.extButtonGroup=="undefined"){this.fields.length>1&&(g=1),b.each(this.buttons,function(a,b){f+=b.button.size=="small"?1:2}),g+=Math.ceil(f/2),h=this.buttons.length,i=0,j=Math.ceil(this.buttons.length/2)-this.buttons.length%2,this.fields.length>0&&(a.buttons.push(this.fields[0]),e.push(this.fields[0].button.getExtConfigProperties()));while(--h>=j)e.push(this.buttons[i++].button.getExtConfigProperties());++h,this.fields.length>1&&(a.buttons.push(this.fields[1]),e.push(this.fields[1].button.getExtConfigProperties()));while(--h>=0)e.push(this.buttons[i++].button.getExtConfigProperties());this.extButtonGroup=new c.ButtonGroup({columns:g,items:e}),b.each(this.buttons,function(b,c){c.button.extButton=a.extButtonGroup.findById(c.button.id);if(c.button.listenerQueue&&c.button.listenerQueue.length>0)for(;;){d=c.button.listenerQueue.shift();if(!d)break;c.button.extButton.addListener(d.eventName,d.handler,d.scope,d.options)}c.button.extButton.setObjectTypeFilter&&(c.button.objectTypeFilter&&(c.button.extButton.noQuery=!1),c.button.objectTypeFilter=="all"&&(c.button.objectTypeFilter=null),c.button.extButton.setObjectTypeFilter(c.button.objectTypeFilter),c.button.displayField&&(c.button.extButton.displayField=c.button.displayField),c.button.tpl&&(c.button.extButton.tpl=c.button.tpl))})}return this.extButtonGroup},doLayout:function(){var a=!1,c=this;return b.each(this.buttons,function(b,d){if(typeof d.button!="undefined"){var e=c.extButtonGroup.findById(d.button.id),f=d.button.isVisible()&&d.scopeVisible;if(!e)return;f&&e.hidden?e.show():!f&&e&&!e.hidden&&e.hide(),a|=f}}),a&&this.extButtonGroup.hidden?this.extButtonGroup.show():!a&&!this.extButtonGroup.hidden&&this.extButtonGroup.hide(),a}}),i={top:null,left:null},k=d.extend({scopes:{"Aloha.empty":{name:"Aloha.empty",extendedScopes:[],buttons:[]},"Aloha.global":{name:"Aloha.global",extendedScopes:["Aloha.empty"],buttons:[]},"Aloha.continuoustext":{name:"Aloha.continuoustext",extendedScopes:["Aloha.global"],buttons:[]}},tabs:[],tabMap:{},initialized:!1,allButtons:[],top:100,left:100,pinned:!1,window:b(window),behaviour:"float",element:"floatingmenu",topalignOffset:0,horizontalOffset:0,marginTop:10,draggable:!0,pin:!1,buttonsAdded:[],fromConfig:!1,init:function(){a.settings.floatingmenu&&(typeof a.settings.floatingmenu.draggable=="boolean"&&(this.draggable=a.settings.floatingmenu.draggable),typeof a.settings.floatingmenu.behaviour=="string"&&(this.behaviour=a.settings.floatingmenu.behaviour),typeof a.settings.floatingmenu.topalignOffset!="undefined"&&(this.topalignOffset=parseInt(a.settings.floatingmenu.topalignOffset,10)),typeof a.settings.floatingmenu.horizontalOffset!="undefined"&&(this.horizontalOffset=parseInt(a.settings.floatingmenu.horizontalOffset,10)),typeof a.settings.floatingmenu.marginTop=="number"&&(this.marginTop=parseInt(a.settings.floatingmenu.marginTop,10)),typeof a.settings.floatingmenu.element=="string"&&(this.element=a.settings.floatingmenu.element),typeof a.settings.floatingmenu.pin=="boolean"&&(this.pin=a.settings.floatingmenu.pin),typeof a.settings.floatingmenu.width!="undefined"&&(this.width=parseInt(a.settings.floatingmenu.width,10))),b.storage=new b.store,this.currentScope="Aloha.global";var c=this;this.window.unload(function(){c.pinned?(b.storage.set("Aloha.FloatingMenu.pinned","true"),b.storage.set("Aloha.FloatingMenu.top",c.top),b.storage.set("Aloha.FloatingMenu.left",c.left),a.Log.isInfoEnabled()&&a.Log.info(this,"stored FloatingMenu pinned position {"+c.left+", "+c.top+"}")):(b.storage.del("Aloha.FloatingMenu.pinned"),b.storage.del("Aloha.FloatingMenu.top"),b.storage.del("Aloha.FloatingMenu.left")),c.userActivatedTab&&b.storage.set("Aloha.FloatingMenu.activeTab",c.userActivatedTab)}).resize(function(){if(c.behaviour==="float")if(c.pinned)c.fixPinnedPosition(),c.refreshShadow(),c.extTabPanel.setPosition(c.left,c.top);else{var b=c.calcFloatTarget(a.Selection.getRangeObject());b&&c.floatTo(b)}}),a.bind("aloha-ready",function(){c.generateComponent(),c.initialized=!0}),typeof a.settings.toolbar=="object"&&(this.fromConfig=!0)},obj:null,shadow:null,panelBody:null,width:400,initTabsAndGroups:function(){var c=this;if(!this.fromConfig)return;b.each(a.settings.toolbar.tabs,function(a,d){var f=c.tabMap[a];typeof f=="undefined"&&(f=new g(a),c.tabs.push(f),c.tabMap[a]=f),b.each(d,function(d,g){var h=f.getGroup(d),i;b.each(g,function(f,g){if(b.inArray(g,c.buttonsAdded)!==-1){e.warn("Skipping button {"+g+"}. A button can't be added "+"to the floating menu twice. Config key: {Aloha.settings.toolbar."+a+"."+d+"}");return}for(i=0;i<c.allButtons.length;i++)if(g===c.allButtons[i].button.name){h.addButton(c.allButtons[i]),c.buttonsAdded.push(c.allButtons[i].button.name);break}})})})},generateComponent:function(){var d=this,e;this.initTabsAndGroups(),c.QuickTips.init(),c.apply(c.QuickTips.getQuickTip(),{minWidth:10});if(!this.extTabPanel){var f=!1;d.draggable&&(f={insertProxy:!1,onDrag:function(a){var b=this.proxy.getEl();this.x=b.getLeft(!0),this.y=b.getTop(!0),this.panel.shadow.hide()},endDrag:function(a){var c=d.pinned?this.y-b(document).scrollTop():this.y;d.left=this.x,d.top=c,i.left=d.left,i.top=d.top,this.panel.setPosition(this.x,c),d.refreshShadow(),this.panel.shadow.show()}}),this.extTabPanel=new c.TabPanel({activeTab:0,width:d.width,plain:!1,draggable:f,floating:{shadow:!1},defaults:{autoScroll:!0},layoutOnTabChange:!0,shadow:!1,cls:"aloha-floatingmenu ext-root",listeners:{tabchange:{fn:function(c,e){e.title!=d.autoActivatedTab?(a.Log.isDebugEnabled()&&a.Log.debug(d,"User selected tab "+e.title),d.userActivatedTab=e.title):a.Log.isDebugEnabled()&&a.Log.debug(d,"Tab "+e.title+" was activated automatically"),d.autoActivatedTab=undefined,b.each(d.allButtons,function(a,b){typeof b.button!="undefined"&&typeof b.button.extButton!="undefined"&&b.button.extButton!==null&&typeof b.button.extButton.setActiveDOMElement=="function"&&typeof b.button.extButton.activeDOMElement!="undefined"&&b.button.extButton.setActiveDOMElement(b.button.extButton.activeDOMElement)}),d.extTabPanel.isVisible()&&(d.extTabPanel.shadow.show(),d.refreshShadow())}}},enableTabScroll:!0})}b.each(this.tabs,function(b,c){try{d.extTabPanel.add(c.getExtComponent())}catch(e){a.Log.error(d,"Error while inserting tab: "+e)}}),this.extTabPanel.shadow||(this.extTabPanel.shadow=b('<div id="aloha-floatingmenu-shadow" class="aloha-shadow">&#160;</div>').hide(),b("body").append(this.extTabPanel.shadow)),e=this.extTabPanel.add({title:"&#160;"}),this.extTabPanel.render(document.body),b(e.tabEl).addClass("aloha-floatingmenu-pin").html("&#160;").mousedown(function(a){d.togglePin(),a.stopPropagation()}),this.panelBody=b("div.aloha-floatingmenu div.x-tab-panel-bwrap"),this.doLayout(),this.obj=b(this.extTabPanel.getEl().dom),b.storage.get("Aloha.FloatingMenu.pinned")=="true"&&(this.top=parseInt(b.storage.get("Aloha.FloatingMenu.top"),10),this.left=parseInt(b.storage.get("Aloha.FloatingMenu.left"),10),this.fixPinnedPosition(),a.Log.isInfoEnabled()&&a.Log.info(this,"restored FloatingMenu pinned position {"+this.left+", "+this.top+"}"),this.refreshShadow()),b.storage.get("Aloha.FloatingMenu.activeTab")&&(this.userActivatedTab=b.storage.get("Aloha.FloatingMenu.activeTab")),this.extTabPanel.setPosition(this.left,this.top),this.obj.mousedown(function(b){b.originalEvent.stopSelectionUpdate=!0,a.eventHandled=!0}),this.obj.mouseup(function(b){b.originalEvent.stopSelectionUpdate=!0,a.eventHandled=!1}),b(window).scroll(function(){j(d)}),d.draggable||b(".aloha-floatingmenu").hover(function(){b(this).css({background:"none"}),b(".aloha-floatingmenu-pin").hide()});if(this.behaviour==="float")a.bind("aloha-selection-changed",function(a,b){if(!d.pinned){var c=d.calcFloatTarget(b);c&&d.floatTo(c)}});else if(this.behaviour==="append"){var g=b("#"+d.element),h=g.offset();if(!h)return a.Log.warn(d,"Invalid element HTML ID for floating menu: "+d.element),!1;this.floatTo(h),this.pin&&this.togglePin(!0),a.bind("aloha-editable-activated",function(a,b){if(d.pinned)return;d.floatTo(h)})}else this.behaviour==="topalign"&&(this.togglePin(!1),a.bind("aloha-editable-activated",function(a,c){if(d.pinned)return;var e=c.editable.obj,f=90,g=e.offset(),h=g.top-f<b(document).scrollTop();h?(g.top=e.height()<f?g.top+e.height():b(document).scrollTop(),g.top+=d.marginTop):g.top-=f+d.topalignOffset,g.left+=d.horizontalOffset;var i=10,j=g.left+d.width+i-b(window).width();j>0&&(g.left-=j),d.floatTo(g)}))},fixPinnedPosition:function(){if(!this.pinned)return;this.top<30?this.top=30:this.top>this.window.height()-this.extTabPanel.getHeight()&&(this.top=this.window.height()-this.extTabPanel.getHeight()),this.left<0?this.left=0:this.left>this.window.width()-this.extTabPanel.getWidth()&&(this.left=this.window.width()-this.extTabPanel.getWidth())},refreshShadow:function(a){if(this.panelBody){var b={top:this.top+24,left:this.left};if(typeof a=="undefined"||!a)b.width=this.panelBody.width()+"px",b.height=this.panelBody.height()+"px";this.extTabPanel.shadow.css(b)}},togglePin:function(a){var c=b(".aloha-floatingmenu-pin");typeof a=="boolean"&&(this.pinned=!a),this.pinned?(c.removeClass("aloha-floatingmenu-pinned"),this.top=this.obj.offset().top,this.obj.removeClass("fixed").css({top:this.top}),this.extTabPanel.shadow.removeClass("fixed"),this.refreshShadow(),this.pinned=!1):(c.addClass("aloha-floatingmenu-pinned"),this.top=this.obj.offset().top-this.window.scrollTop(),this.obj.addClass("fixed").css({top:this.top}),this.extTabPanel.shadow.addClass("fixed"),this.refreshShadow(),this.pinned=!0)},createScope:function(a,b){typeof b=="undefined"?b=["Aloha.empty"]:typeof b=="string"&&(b=[b]),this.scopes[a]||(this.scopes[a]={name:a,extendedScopes:b,buttons:[]})},addButton:function(b,c,d,f){var h=this.scopes[b],i,j,k;c.name||e.warn("Added button with iconClass {"+c.iconClass+'} which has no property "name"');if(typeof h=="undefined")return a.Log.error("Can't add button to given scope since the scope has not yet been initialized.",b),!1;i={button:c,scopeVisible:!1},this.allButtons.push(i),h.buttons.push(i),this.fromConfig||(j=this.tabMap[d],typeof j=="undefined"&&(j=new g(d),this.tabs.push(j),this.tabMap[d]=j),k=j.getGroup(f),k.addButton(i)),this.initialized&&this.generateComponent()},doLayout:function(){a.Log.isDebugEnabled()&&a.Log.debug(this,"doLayout called for FloatingMenu, scope is "+this.currentScope);if(typeof this.extTabPanel=="undefined")return!1;var c=this,d=!1,e=this.extTabPanel.getActiveTab(),f=!1,g=!1,h=!1,i;b.each(this.tabs,function(b,i){i.extPanel==e&&(f=i);var j=i.visible;i.doLayout()?(g=!0,j||(a.Log.isDebugEnabled()&&a.Log.debug(c,"showing tab strip for tab "+i.label),c.extTabPanel.unhideTabStripItem(i.extPanel)),d||(d=i),c.userActivatedTab==i.extPanel.title&&i.extPanel!=e&&(h=i)):j&&(a.Log.isDebugEnabled()&&a.Log.debug(c,"hiding tab strip for tab "+i.label),c.extTabPanel.hideTabStripItem(i.extPanel))}),h?(a.Log.isDebugEnabled()&&a.Log.debug(this,"Setting active tab to "+h.label),this.extTabPanel.setActiveTab(h.extPanel)):typeof f=="object"&&typeof d=="object"&&(f.visible||(a.Log.isDebugEnabled()&&a.Log.debug(this,"Setting active tab to "+d.label),this.autoActivatedTab=d.extPanel.title,this.extTabPanel.setActiveTab(d.extPanel))),g&&this.extTabPanel.hidden?(this.extTabPanel.show(),this.refreshShadow(),this.extTabPanel.shadow.show(),this.extTabPanel.setPosition(this.left,this.top)):!g&&!this.extTabPanel.hidden&&(i=this.extTabPanel.getPosition(!0),this.left=i[0]<0?100:i[0],this.top=i[1]<0?100:i[1],this.extTabPanel.hide(),this.extTabPanel.shadow.hide()),this.extTabPanel.doLayout()},setScope:function(a){var c=this.scopes[a];typeof c!="undefined"&&this.currentScope!=a&&(this.currentScope=a,b.each(this.allButtons,function(a,b){b.scopeVisible=!1}),this.setButtonScopeVisibility(c),this.doLayout())},setButtonScopeVisibility:function(a){var c=this;b.each(a.buttons,function(a,b){b.scopeVisible=!0}),b.each(a.extendedScopes,function(a,b){var d=c.scopes[b];typeof d=="object"&&c.setButtonScopeVisibility(d)})},nextFloatTargetObj:function(a,b){if(!a||a==b)return a;switch(a.nodeName.toLowerCase()){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"p":case"div":case"td":case"pre":case"ul":case"ol":return a;default:return this.nextFloatTargetObj(a.parentNode,b)}},calcFloatTarget:function(c){var d,e,g,h,i,j,k,l;if(!a.activeEditable||typeof c.getCommonAncestorContainer=="undefined")return!1;for(d=0,g=a.editables.length;d<g;d++)if(a.editables[d].obj.get(0)==c.limitObject&&a.editables[d].isDisabled())return!1;return i=this.nextFloatTargetObj(c.getCommonAncestorContainer(),c.limitObject),i?(j=b(i),k=f.Utils.Position.Scroll.top,!j||!j.offset()?!1:(l=j.offset().top-this.obj.height()-50,l<k&&(l+=80+f.Utils.Position.ScrollCorrection.top),l>this.window.height()+this.window.scrollTop()?!1:(h=a.activeEditable.obj.offset().left,e=b(document).width(),e-this.width<h&&(h=e-this.width-f.Utils.Position.ScrollCorrection.left),{left:h,top:l}))):!1},floatTo:function(a){if(this.pinned)return;var b=this,c=this.obj.offset(),d,e;i.left===null?(d=c.left,e=c.top):(d=i.left,e=i.top);if(d!=a.left||e!=a.top)this.obj.offset({left:d,top:e}),this.obj.animate({top:a.top,left:a.left},{queue:!1,step:function(a,c){c.prop==="top"?b.top=c.now:c.prop==="left"&&(b.left=c.now),b.refreshShadow(!1)},complete:function(){i.left=b.left,i.top=b.top}})},hide:function(){this.obj&&this.obj.hide(),this.shadow&&this.shadow.hide()},activateTabOfButton:function(a){var b=null;for(var c=0;c<this.tabs.length&&!b;c++){var d=this.tabs[c];for(var e=0;e<d.groups.length&&!b;e++){var f=d.groups[e];for(var g=0;g<f.buttons.length&&!b;g++){var h=f.buttons[g];if(h.button.name==a){b=d;break}}}}b&&(this.userActivatedTab=b.label,this.doLayout())}}),l=new k;return l.init(),a.bind("aloha-editable-deactivated",function(){l.setScope("Aloha.empty")}),a.bind("aloha-selection-changed",function(){!a.Selection.isSelectionEditable()&&!a.Selection.isFloatingMenuVisible()&&l.setScope("Aloha.empty")}),l}),define("aloha/selection",["aloha/core","aloha/jquery","aloha/floatingmenu","util/class","util/range","aloha/rangy-core"],function(a,b,c,d,e){function h(a){b.browser.msie&&a.startContainer===a.endContainer&&a.startOffset===a.endOffset&&a.startContainer.nodeType==3&&a.startOffset==a.startContainer.data.length&&a.startContainer.nextSibling&&["OL","UL"].indexOf(a.startContainer.nextSibling.nodeName)!==-1&&(a.startContainer.data[a.startContainer.data.length-1]==" "?a.startOffset=a.endOffset=a.startOffset-1:a.startContainer.data=a.startContainer.data+" ")}function i(a){return h(a),a}var f=window.GENTICS,g=d.extend({_constructor:function(){this.rangeObject={},this.preventSelectionChangedFlag=!1,this.tagHierarchy={textNode:[],abbr:["textNode"],b:["textNode","b","i","em","sup","sub","br","span","img","a","del","ins","u","cite","q","code","abbr","strong"],pre:["textNode","b","i","em","sup","sub","br","span","img","a","del","ins","u","cite","q","code","abbr","code"],blockquote:["textNode","b","i","em","sup","sub","br","span","img","a","del","ins","u","cite","q","code","abbr","p","h1","h2","h3","h4","h5","h6"],ins:["textNode","b","i","em","sup","sub","br","span","img","a","u","p","h1","h2","h3","h4","h5","h6"],ul:["li"],ol:["li"],li:["textNode","b","i","em","sup","sub","br","span","img","ul","ol","h1","h2","h3","h4","h5","h6","del","ins","u","a"],tr:["td","th"],table:["tr"],div:["textNode","b","i","em","sup","sub","br","span","img","ul","ol","table","h1","h2","h3","h4","h5","h6","del","ins","u","p","div","pre","blockquote","a"],h1:["textNode","b","i","em","sup","sub","br","span","img","a","del","ins","u"]},this.tagHierarchy={textNode:this.tagHierarchy.textNode,abbr:this.tagHierarchy.abbr,br:this.tagHierarchy.textNode,img:this.tagHierarchy.textNode,b:this.tagHierarchy.b,strong:this.tagHierarchy.b,code:this.tagHierarchy.b,q:this.tagHierarchy.b,blockquote:this.tagHierarchy.blockquote,cite:this.tagHierarchy.b,i:this.tagHierarchy.b,em:this.tagHierarchy.b,sup:this.tagHierarchy.b,sub:this.tagHierarchy.b,span:this.tagHierarchy.b,del:this.tagHierarchy.del,ins:this.tagHierarchy.ins,u:this.tagHierarchy.b,p:this.tagHierarchy.b,pre:this.tagHierarchy.pre,a:this.tagHierarchy.b,ul:this.tagHierarchy.ul,ol:this.tagHierarchy.ol,li:this.tagHierarchy.li,td:this.tagHierarchy.li,div:this.tagHierarchy.div,h1:this.tagHierarchy.h1,h2:this.tagHierarchy.h1,h3:this.tagHierarchy.h1,h4:this.tagHierarchy.h1,h5:this.tagHierarchy.h1,h6:this.tagHierarchy.h1,table:this.tagHierarchy.table},this.replacingElements={h1:["p","h1","h2","h3","h4","h5","h6","pre","blockquote"]},this.replacingElements={h1:this.replacingElements.h1,h2:this.replacingElements.h1,h3:this.replacingElements.h1,h4:this.replacingElements.h1,h5:this.replacingElements.h1,h6:this.replacingElements.h1,pre:this.replacingElements.h1,p:this.replacingElements.h1,blockquote:this.replacingElements.h1},this.allowedToStealElements={h1:["textNode"]},this.allowedToStealElements={h1:this.allowedToStealElements.h1,h2:this.allowedToStealElements.h1,h3:this.allowedToStealElements.h1,h4:this.allowedToStealElements.h1,h5:this.allowedToStealElements.h1,h6:this.allowedToStealElements.h1,p:this.tagHierarchy.b}},SelectionTree:function(){this.domobj={},this.selection=undefined,this.children=[]},onChange:function(b,c){this.updateSelectionTimeout&&(window.clearTimeout(this.updateSelectionTimeout),this.updateSelectionTimeout=undefined);var d=new a.Selection.SelectionRange(!0);this.updateSelectionTimeout=window.setTimeout(function(){a.Selection._updateSelection(c,d)},5)},preventSelectionChanged:function(){this.preventSelectionChangedFlag=!0},isSelectionChangedPrevented:function(){var a=this.preventSelectionChangedFlag;return this.preventSelectionChangedFlag=!1,a},isSelectionEditable:function(){return this.rangeObject.commonAncestorContainer&&b(this.rangeObject.commonAncestorContainer).contentEditable()},isFloatingMenuVisible:function(){var c=b(a.Selection.rangeObject.commonAncestorContainer).attr("data-aloha-floatingmenu-visible");return c!=="undefined"?c==="true"?!0:!1:!1},updateSelection:function(a){return this._updateSelection(a,null)},_updateSelection:function(d,e){if(d&&d.originalEvent&&d.originalEvent.stopSelectionUpdate===!0)return!1;if(typeof e=="undefined")return!1;this.rangeObject=e||new a.Selection.SelectionRange(!0);if(typeof this.rangeObject!="undefined"&&typeof this.rangeObject.startContainer!="undefined"&&this.rangeObject.endContainer!=="undefined")if(this.rangeObject.startContainer.nodeType===3&&!b(this.rangeObject.startContainer.parentNode).contentEditable()||this.rangeObject.endContainer.nodeType===3&&!b(this.rangeObject.endContainer.parentNode).contentEditable())return a.getSelection().removeAllRanges(),!0;return this.rangeObject.update(),this.isSelectionChangedPrevented()?!0:(d!==undefined&&c.setScope("Aloha.continuoustext"),a.trigger("aloha-selection-changed",[this.rangeObject,d]),!0)},getSelectionTree:function(b){return b?b.commonAncestorContainer?(this.inselection=!1,f.Utils.Dom.doCleanup({merge:!0},b)&&(this.rangeObject.update(),this.rangeObject.select()),this.recursiveGetSelectionTree(b,b.commonAncestorContainer)):(a.Log.error(this,"the rangeObject is missing the commonAncestorContainer"),!1):this.rangeObject.getSelectionTree()},recursiveGetSelectionTree:function(c,d){var e=b(d),f=0,g=this,h=[];return e.contents().each(function(b){var e="none",i=!1,j=!1,k=!1,l,m,n=!1,o=!1,p=!1;c.isCollapsed()&&d===c.startContainer&&c.startOffset==b&&(h[f]=new a.Selection.SelectionTree,h[f].selection="collapsed",h[f].domobj=undefined,g.inselection=!1,k=!0,f++);if(!g.inselection&&!k){var q;try{q=this.nodeType}catch(r){return}switch(q){case 3:this===c.startContainer&&(g.inselection=!0,e=c.startOffset>0?"partial":"full",i=c.startOffset,j=this.length);break;case 1:this===c.startContainer&&c.startOffset===0&&(g.inselection=!0,e="full"),d===c.startContainer&&c.startOffset===b&&(g.inselection=!0,e="full")}}if(g.inselection&&!k){e=="none"&&(e="full");switch(this.nodeType){case 3:this===c.endContainer&&(g.inselection=!1,c.endOffset<this.length&&(e="partial"),i===!1&&(i=0),j=c.endOffset);break;case 1:this===c.endContainer&&c.endOffset===0&&(g.inselection=!1)}d===c.endContainer&&c.endOffset<=b&&(g.inselection=!1,e="none")}h[f]=new a.Selection.SelectionTree,h[f].domobj=this,h[f].selection=e,e=="partial"&&(h[f].startOffset=i,h[f].endOffset=j),h[f].children=g.recursiveGetSelectionTree(c,this),m=h[f].children.length;if(m>0){for(l=0;l<m;++l)switch(h[f].children[l].selection){case"none":n=!0;break;case"full":p=!0;break;case"partial":o=!0}o||p&&n?h[f].selection="partial":p&&!o&&!n&&(h[f].selection="full")}f++}),c.isCollapsed()&&d===c.startContainer&&c.startOffset==d.childNodes.length&&(h[f]=new a.Selection.SelectionTree,h[f].selection="collapsed",h[f].domobj=undefined),h},getRangeObject:function(){return this.rangeObject},isRangeObjectWithinMarkup:function(c,d,e,f,g){var h=d?c.endContainer:c.startContainer,i=this,j=b(h).parents(),k=!1,l=-1;return typeof f!="undefined"&&typeof f!="function"&&a.Log.error(this,"parameter tagComparator is not a function"),typeof f=="undefined"&&(f=function(a,b){return i.standardTextLevelSemanticsComparator(a,b)}),j.length>0&&j.each(function(){if(this===g)return a.Log.debug(i,"reached limit dom obj"),!1;if(f(this,e))return k===!1&&(k=[]),a.Log.debug(i,"reached object equal to markup"),l++,k[l]=this,!0}),k},standardSectionsAndGroupingContentComparator:function(b,c){if(b.nodeType===1){if(c[0].tagName&&a.Selection.replacingElements[b.tagName.toLowerCase()]&&a.Selection.replacingElements[b.tagName.toLowerCase()].indexOf(c[0].tagName.toLowerCase())!=-1)return!0}else a.Log.debug(this,"only element nodes (nodeType == 1) can be compared");return!1},standardTagNameComparator:function(b,c){return b.nodeType===1?b.tagName.toLowerCase()!=c[0].tagName.toLowerCase()?!1:!0:(a.Log.debug(this,"only element nodes (nodeType == 1) can be compared"),!1)},standardTextLevelSemanticsComparator:function(b,c){return b.nodeType===1?b.tagName.toLowerCase()!=c[0].tagName.toLowerCase()?!1:this.standardAttributesComparator(b,c)?!0:!1:(a.Log.debug(this,"only element nodes (nodeType == 1) can be compared"),!1)},standardAttributesComparator:function(b,c){var d,e,f,g,h,i,j,k;b=b.cloneNode(!1);if(b.attributes&&b.attributes.length&&b.attributes.length>0)for(d=0,k=b.attributes.length;d<k;d++)e=b.attributes[d],e.nodeName.toLowerCase()=="class"&&e.nodeValue.length>0&&(f=e.nodeValue,g=f.split(" "));if(c[0].attributes&&c[0].attributes.length&&c[0].attributes.length>0)for(d=0,j=c[0].attributes.length;d<j;d++)e=c[0].attributes[d],e.nodeName.toLowerCase()=="class"&&e.nodeValue.length>0&&(f=e.nodeValue,h=f.split(" "));if(g&&!h||h&&!g)return a.Log.debug(this,"tag comparison for <"+b.tagName.toLowerCase()+"> failed because one element has classes and the other has not"),!1;if(g&&h&&g.length!=h.length)return a.Log.debug(this,"tag comparison for <"+b.tagName.toLowerCase()+"> failed because of a different amount of classes"),!1;if(g&&h&&g.length===h.length&&g.length!==0)for(d=0,i=g.length;d<i;d++)if(!c.hasClass(g[d]))return a.Log.debug(this,"tag comparison for <"+b.tagName.toLowerCase()+"> failed because of different classes"),!1;return!0},changeMarkup:function(c,d,e){var f=d[0].tagName.toLowerCase(),g,h,i,j=this.isRangeObjectWithinMarkup(c,!1,d,e,h),k=this.isRangeObjectWithinMarkup(c,!0,d,e,h),l,m,n,o,p;if(this.replacingElements[f])i=c,c=new this.SelectionRange(c),a.activeEditable?g=a.activeEditable.obj.get(0):g=b("body"),c.update(g),d.isReplacingElement=!0;else if(c.isCollapsed())return a.Log.debug(this,"early returning from applying markup because nothing is currently selected"),!1;a.activeEditable?h=a.activeEditable.obj[0]:h=b("body"),!d.isReplacingElement&&c.startOffset===0&&(n=this.getTextNodeSibling(!1,c.commonAncestorContainer.parentNode,c.startContainer))&&(o=this.isRangeObjectWithinMarkup({startContainer:n,startOffset:0},!1,d,e,h)),!d.isReplacingElement&&c.endOffset===c.endContainer.length&&(l=this.getTextNodeSibling(!0,c.commonAncestorContainer.parentNode,c.endContainer))&&(m=this.isRangeObjectWithinMarkup({startContainer:l,startOffset:0},!1,d,e,h));if(!d.isReplacingElement&&j&&!k)a.Log.info(this,"markup 2 non-markup"),this.prepareForRemoval(c.getSelectionTree(),d,e),b(j).addClass("preparedForRemoval"),this.insertCroppedMarkups(j,c,!1,e);else if(!d.isReplacingElement&&j&&k)a.Log.info(this,"markup 2 markup"),this.prepareForRemoval(c.getSelectionTree(),d,e),this.splitRelevantMarkupObject(j,k,c,e);else if(!d.isReplacingElement&&(!j&&k||m||o))a.Log.info(this,"non-markup 2 markup OR with next2markup"),o&&m?(p=new a.Selection.SelectionRange(c),p.startContainer=b(o[o.length-1]).textNodes()[0],p.startOffset=0,p.endContainer=b(m[m.length-1]).textNodes().last()[0],p.endOffset=p.endContainer.length,p.update(),this.applyMarkup(p.getSelectionTree(),c,d,e),a.Log.info(this,"double extending previous markup(previous and after selection), actually wrapping it ...")):o&&!m&&!k?(this.extendExistingMarkupWithSelection(o,c,!1,e),a.Log.info(this,"extending previous markup")):o&&!m&&k?(p=new a.Selection.SelectionRange(c),p.startContainer=b(o[o.length-1]).textNodes()[0],p.startOffset=0,p.endContainer=b(k[k.length-1]).textNodes().last()[0],p.endOffset=p.endContainer.length,p.update(),this.applyMarkup(p.getSelectionTree(),c,d,e),a.Log.info(this,"double extending previous markup(previous and relevant at the end), actually wrapping it ...")):!o&&m?(this.extendExistingMarkupWithSelection(m,c,!0,e),a.Log.info(this,"extending following markup backwards")):this.extendExistingMarkupWithSelection(k,c,!0,e);else if(d.isReplacingElement||!j&&!k&&!o&&!m)a.Log.info(this,"non-markup 2 non-markup"),this.applyMarkup(c.getSelectionTree(),c,d,e,{setRangeObject2NewMarkup:!0});b(".preparedForRemoval").zap(),c.update(),d.isReplacingElement?i.select():c.select()},areMarkupObjectsAsLongAsRangeObject:function(a,c,d){var e,f,g,h,i;if(d.startOffset!==0)return!1;for(e=0,i=a.length;e<i;e++){f=b(a[e]);if(f.textNodes().first()[0]!==d.startContainer)return!1}for(e=0,h=c.length;e<h;e++){f=b(c[e]),g=f.textNodes().last()[0];if(g!==d.endContainer||g.length!=d.endOffset)return!1}return!0},splitRelevantMarkupObject:function(a,c,d,e){b(a).addClass("preparedForRemoval"),b(c).addClass("preparedForRemoval");if(this.areMarkupObjectsAsLongAsRangeObject(a,c,d))return!0;var f=this.intersectRelevantMarkupObjects(a,c);return f?(this.insertCroppedMarkups([f],d,!1,e),this.insertCroppedMarkups([f],d,!0,e)):(this.insertCroppedMarkups(a,d,!1,e),this.insertCroppedMarkups(c,d,!0,e)),!0},intersectRelevantMarkupObjects:function(a,b){var c=!1,d,e,f,g,h,i;if(!a||!b)return c;h=a.length,i=b.length;for(d=0;d<h;d++){e=a[d];for(f=0;f<i;f++)g=b[f],e===g&&(c=e)}return c},extendExistingMarkupWithSelection:function(a,c,d,e){var f,g,h,i,j,k,l,m;d||(f=!0),d&&(g=!0),h=[];for(i=0,j=a.length;i<j;i++)h[i]=new this.SelectionRange,k=a[i],g&&!f&&(h[i].startContainer=c.startContainer,h[i].startOffset=c.startOffset,l=b(k).textNodes(!0),m=l.length-1,h[i].endContainer=l[m],h[i].endOffset=l[m].length,h[i].update(),this.applyMarkup(h[i].getSelectionTree(),c,this.getClonedMarkup4Wrapping(k),e,{setRangeObject2NewMarkup:!0})),!g&&f&&(l=b(k).textNodes(!0),h[i].startContainer=l[0],h[i].startOffset=0,h[i].endContainer=c.endContainer,h[i].endOffset=c.endOffset,h[i].update(),this.applyMarkup(h[i].getSelectionTree(),c,this.getClonedMarkup4Wrapping(k),e,{setRangeObject2NewMarkup:!0}));return!0},getClonedMarkup4Wrapping:function(a){var c=b(a).clone().removeClass("preparedForRemoval").empty();return c.attr("class").length===0&&c.removeAttr("class"),c},insertCroppedMarkups:function(a,c,d,e){var f,g,h,i,j,k,l;d?g=!0:f=!0,i=[];for(j=0;j<a.length;j++){i[j]=new this.SelectionRange,k=a[j];if(f&&!g){l=b(k).textNodes(!0),i[j].startContainer=l[0],i[j].startOffset=0;if(i[j].startContainer===c.startContainer&&i[j].startOffset===c.startOffset)continue;c.startOffset===0?(i[j].endContainer=this.getTextNodeSibling(!1,k,c.startContainer),i[j].endOffset=i[j].endContainer.length):(i[j].endContainer=c.startContainer,i[j].endOffset=c.startOffset),i[j].update(),this.applyMarkup(i[j].getSelectionTree(),c,this.getClonedMarkup4Wrapping(k),e,{setRangeObject2NextSibling:!0})}!f&&g&&(i[j].startContainer=c.endContainer,i[j].startOffset=c.endOffset,h=b(k).textNodes(!0),i[j].endContainer=h[h.length-1],i[j].endOffset=h[h.length-1].length,i[j].update(),this.applyMarkup(i[j].getSelectionTree(),c,this.getClonedMarkup4Wrapping(k),e,{setRangeObject2PreviousSibling:!0}))}return!0},changeMarkupOnSelection:function(a){this.changeMarkup(this.getRangeObject(),a,this.getStandardTagComparator(a)),f.Utils.Dom.doCleanup({merge:!0},this.rangeObject),this.rangeObject.update(),this.rangeObject.select()},applyMarkup:function(b,c,d,e,f){var g,h,i,j;f=f?f:{},this.prepareForRemoval(b,d,e),g=this.optimizeSelectionTree4Markup(b,d,e),j=!0;for(h=0;h<g.length;h++)i=g[h],i.wrappable?this.wrapMarkupAroundSelectionTree(i.elements,c,d,e,f):(a.Log.debug(this,"dive further into non-wrappable object"),this.applyMarkup(i.element.children,c,d,e,f))},getMarkupType:function(c){var d=b(c)[0].nodeName.toLowerCase();c.outerHtml&&a.Log.debug(this,"Node name detected: "+d+" for: "+c.outerHtml());if(d=="#text")return"textNode";if(this.replacingElements[d])return"sectionOrGroupingContent";if(this.tagHierarchy[d])return"textLevelSemantics";a.Log.warn(this,"unknown markup passed to this.getMarkupType(...): "+c.outerHtml())},getStandardTagComparator:function(a){var b=this,c;switch(this.getMarkupType(a)){case"textNode":c=function(a,b){return!1};break;case"sectionOrGroupingContent":c=function(a,c){return b.standardSectionsAndGroupingContentComparator(a,c)};break;case"textLevelSemantics":default:c=function(
a,c){return b.standardTextLevelSemanticsComparator(a,c)}}return c},prepareForRemoval:function(c,d,e){var f=this,g,h;typeof e!="undefined"&&typeof e!="function"&&a.Log.error(this,"parameter tagComparator is not a function"),typeof e=="undefined"&&(e=this.getStandardTagComparator(d));for(g=0;g<c.length;g++)h=c[g],h.domobj&&(h.selection=="full"||h.selection=="partial"&&d.isReplacingElement)&&h.domobj.nodeType===1&&e(h.domobj,d)&&(a.Log.debug(this,"Marking for removal: "+h.domobj.nodeName),b(h.domobj).addClass("preparedForRemoval")),h.selection!="none"&&h.children.length>0&&this.prepareForRemoval(h.children,d,e)},wrapMarkupAroundSelectionTree:function(c,d,e,f,g){var h=[],i=-1,j=!0,k="",l="",m,n,o,p,q,r,s;a.Log.debug(this,"The formatting <"+e[0].tagName+"> will be wrapped around the selection");for(q=0;q<c.length;q++){r=c[q];if(r.domobj&&!this.canTag1WrapTag2(r.domobj.parentNode.tagName.toLowerCase(),e[0].tagName.toLowerCase())){a.Log.info(this,"Skipping the wrapping of <"+e[0].tagName.toLowerCase()+"> because this tag is not allowed inside <"+r.domobj.parentNode.tagName.toLowerCase()+">");continue}if(r.domobj&&r.domobj.nodeType===3&&b.trim(r.domobj.nodeValue).length===0)continue;if(r.domobj&&r.selection=="partial"&&!e.isReplacingElement)if(r.startOffset!==undefined&&r.endOffset===undefined)i++,k+=r.domobj.data.substr(0,r.startOffset),r.domobj.data=r.domobj.data.substr(r.startOffset,r.domobj.data.length-r.startOffset),h[i]=r.domobj;else if(r.endOffset!==undefined&&r.startOffset===undefined)i++,l+=r.domobj.data.substr(r.endOffset,r.domobj.data.length-r.endOffset),r.domobj.data=r.domobj.data.substr(0,r.endOffset),h[i]=r.domobj;else if(r.endOffset!==undefined&&r.startOffset!==undefined){if(r.startOffset==r.endOffset){a.Log.debug(this,"skipping empty selection");continue}i++,k+=r.domobj.data.substr(0,r.startOffset),s=r.domobj.data.substr(r.startOffset,r.endOffset-r.startOffset),l+=r.domobj.data.substr(r.endOffset,r.domobj.data.length-r.endOffset),r.domobj.data=s,h[i]=r.domobj}else a.Log.debug(this,"diving into object"),this.applyMarkup(r.children,d,e,f,g);r.domobj&&(r.selection=="full"||r.selection=="partial"&&e.isReplacingElement)&&(i++,h[i]=r.domobj)}h.length>0&&(h=b(h),b.each(h,function(a,c){b.browser.msie&&c.nodeType==3&&!c.nextSibling&&!c.previousSibling&&c.parentNode&&c.parentNode.nodeName.toLowerCase()=="li"&&(c.data=b.trim(c.data))}),p=h.wrapAll(e).parent(),p.before(k).after(l),g.setRangeObject2NewMarkup&&(o=h.textNodes(),o.index(d.startContainer)!=-1&&(d.startOffset=0),o.index(d.endContainer)!=-1&&(d.endOffset=d.endContainer.length),j=!0),g.setRangeObject2NextSibling&&(m=!0,n=p.textNodes(!0).last()[0],h.index(d.startContainer)!=-1&&(d.startContainer=this.getTextNodeSibling(m,p.parent(),n),d.startOffset=0),h.index(d.endContainer)!=-1&&(d.endContainer=this.getTextNodeSibling(m,p.parent(),n),d.endOffset=d.endOffset-n.length)),g.setRangeObject2PreviousSibling&&(m=!1,n=p.textNodes(!0).first()[0],h.index(d.startContainer)!=-1&&(d.startContainer=this.getTextNodeSibling(m,p.parent(),n),d.startOffset=0),h.index(d.endContainer)!=-1&&(d.endContainer=this.getTextNodeSibling(m,p.parent(),n),d.endOffset=d.endContainer.length)))},getTextNodeSibling:function(a,c,d){var e=b(c).textNodes(!0),f,g;return g=e.index(d),g==-1?!1:(f=g+(a?1:-1),e[f]?e[f]:!1)},optimizeSelectionTree4Markup:function(a,c,d){var e=[],f=0,g=0,h=this,i,j,k,l;typeof d=="undefined"&&(d=function(a,b){return h.standardTextLevelSemanticsComparator(b)});for(i=0;i<a.length;i++)if(a[i].domobj&&a[i].selection!="none")if(c.isReplacingElement&&d(c[0],b(a[i].domobj)))e[f]!==undefined&&f++,e[f]={},e[f].wrappable=!0,e[f].elements=[],e[f].elements[g]=a[i],f++;else if(this.canMarkupBeApplied2ElementAsWhole([a[i]],c)){e[f]===undefined&&(e[f]={},e[f].wrappable=!0,e[f].elements=[]);if(c.isReplacingElement){l=i;for(j=i-1;j>=0;j--){if(!this.canMarkupBeApplied2ElementAsWhole([a[j]],c)||!this.isMarkupAllowedToStealSelectionTreeElement(a[j],c))break;l=j}k=i;for(j=i+1;j<a.length;j++){if(!this.canMarkupBeApplied2ElementAsWhole([a[j]],c)||!this.isMarkupAllowedToStealSelectionTreeElement(a[j],c))break;k=j}g=0;for(j=l;j<=k;j++)e[f].elements[g]=a[j],e[f].elements[g].selection="full",g++;g=0}else e[f].elements[g]=a[i],g++}else e[f]!==undefined&&f++,e[f]={},e[f].wrappable=!1,e[f].element=a[i],g=0,f++;return e},isMarkupAllowedToStealSelectionTreeElement:function(a,b){if(!a.domobj)return!1;var c=a.domobj.nodeName.toLowerCase(),d;return c=c=="#text"?"textNode":c,d=b[0].nodeName.toLowerCase(),this.allowedToStealElements[d]?this.allowedToStealElements[d].indexOf(c)==-1?!1:!0:!1},canMarkupBeApplied2ElementAsWhole:function(a,b){var c,d,e,f;b.jquery&&(c=b[0].tagName),b.tagName&&(c=b.tagName),f=!0;for(d=0;d<a.length;d++){e=a[d];if(e.domobj&&(e.selection!="none"||b.isReplacingElement)){if(!this.canTag1WrapTag2(c,e.domobj.nodeName))return!1;if(e.children.length>0&&!this.canMarkupBeApplied2ElementAsWhole(e.children,b))return!1}}return f},canTag1WrapTag2:function(a,b){a=a=="#text"?"textNode":a.toLowerCase(),b=b=="#text"?"textNode":b.toLowerCase();if(!this.tagHierarchy[a])return!0;if(!this.tagHierarchy[b])return!0;var c=this.tagHierarchy[a],d=c.indexOf(b)!=-1?!0:!1;return d},mayInsertTag:function(b){if(typeof this.rangeObject.unmodifiableMarkupAtStart=="object"){for(var c=0;c<this.rangeObject.unmodifiableMarkupAtStart.length;++c)if(!this.canTag1WrapTag2(this.rangeObject.unmodifiableMarkupAtStart[c].nodeName,b))return!1;return!0}return a.Log.warn(this,"Unable to determine whether tag "+b+" may be inserted"),!0},toString:function(){return"Aloha.Selection"},SelectionRange:f.Utils.RangeObject.extend({_constructor:function(a){this._super(a),a&&(a.commonAncestorContainer&&(this.commonAncestorContainer=a.commonAncestorContainer),a.selectionTree&&(this.selectionTree=a.selectionTree),a.limitObject&&(this.limitObject=a.limitObject),a.markupEffectiveAtStart&&(this.markupEffectiveAtStart=a.markupEffectiveAtStart),a.unmodifiableMarkupAtStart&&(this.unmodifiableMarkupAtStart=a.unmodifiableMarkupAtStart),a.splitObject&&(this.splitObject=a.splitObject))},commonAncestorContainer:undefined,selectionTree:undefined,markupEffectiveAtStart:[],unmodifiableMarkupAtStart:[],limitObject:undefined,splitObject:undefined,select:function(){this._super(),a.Selection.updateSelection()},update:function(a){this.updatelimitObject(),this.updateMarkupEffectiveAtStart(),this.updateCommonAncestorContainer(a),this.selectionTree=undefined},getSelectionTree:function(){return this.selectionTree||(this.selectionTree=a.Selection.getSelectionTree(this)),this.selectionTree},getSelectedSiblings:function(a){var b=this.getSelectionTree();return this.recursionGetSelectedSiblings(a,b)},recursionGetSelectedSiblings:function(a,b){var c=!1,d=!1,e;for(e=0;e<b.length;++e)if(b[e].domobj===a)d=!0,c=[];else if(!d&&b[e].children){c=this.recursionGetSelectedSiblings(a,b[e].children);if(c!==!1)break}else if(d&&b[e].domobj&&b[e].selection!="collapsed"&&b[e].selection!="none")c.push(b[e].domobj);else if(d&&b[e].selection=="none")break;return c},updateMarkupEffectiveAtStart:function(){this.markupEffectiveAtStart=[],this.unmodifiableMarkupAtStart=[];var a=this.getStartContainerParents(),b=!1,c,d,e;for(d=0;d<a.length;d++)e=a[d],!b&&e!==this.limitObject?(this.markupEffectiveAtStart[d]=e,!c&&f.Utils.Dom.isSplitObject(e)&&(c=!0,this.splitObject=e)):(b=!0,this.unmodifiableMarkupAtStart.push(e));c||(this.splitObject=!1);return},updatelimitObject:function(){if(a.editables&&a.editables.length>0){var c=this.getStartContainerParents(),d=a.editables,e,f,g,h;for(e=0;e<c.length;e++){f=c[e];for(g=0;g<d.length;g++){h=d[g].obj[0];if(f===h)return this.limitObject=f,!0}}}return this.limitObject=b("body"),!0},toString:function(a){return a?"Aloha.Selection.SelectionRange {start ["+this.startContainer.nodeValue+"] offset "+this.startOffset+", end ["+this.endContainer.nodeValue+"] offset "+this.endOffset+"}":"Aloha.Selection.SelectionRange"}})}),j=d.extend({_constructor:function(a){this._nativeSelection=a,this.ranges=[],this.preventChange=!1},anchorNode:null,anchorOffset:0,focusNode:null,focusOffset:0,isCollapsed:!1,rangeCount:0,collapse:function(a,b){this._nativeSelection.collapse(a,b)},collapseToStart:function(){throw"NOT_IMPLEMENTED"},extend:function(a,b){},modify:function(a,b,c){},collapseToEnd:function(){throw"NOT_IMPLEMENTED"},selectAllChildren:function(a){throw"NOT_IMPLEMENTED"},deleteFromDocument:function(){throw"NOT_IMPLEMENTED"},getRangeAt:function(a){return i(this._nativeSelection.getRangeAt(a))},addRange:function(b){this._nativeSelection.addRange(b),this._nativeSelection._ranges[0]=i(b),a.Selection.updateSelection()},removeRange:function(a){this._nativeSelection.removeRange()},removeAllRanges:function(){this._nativeSelection.removeAllRanges()},preventedChange:function(a){},isChangedPrevented:function(){},refresh:function(a){},toString:function(){return"Aloha.Selection"},getRangeCount:function(){return this._nativeSelection.rangeCount}});a.getSelection=function(a){var a=a!==document||a!==window?window:a;return new j(window.rangy.getSelection(a))},a.createRange=function(a){return window.rangy.createRange(a)};var k=new g;return a.Selection=k,k}),define("aloha/markup",["aloha/core","util/class","aloha/jquery","aloha/ecma5shims"],function(a,b,c,d){function g(a){return"BR"===a.nodeName}function h(a){return"false"===c(a).attr("contenteditable")}function i(a){return a&&3===a.nodeType}function j(a){return a?i(a)?a.length:a.childNodes.length:0}function k(a){return a?a.nextSibling?i(a.nextSibling)&&!m(a.nextSibling)?k(a.nextSibling):g(a.nextSibling)&&a.nextSibling===a.parentNode.lastChild?k(a.nextSibling):""===a.nextSibling.innerHTML&&!h(a.nextSibling)?k(a.nextSibling):a.nextSibling:a.parentNode?k(a.parentNode):null:null}function l(a){return a?a.previousSibling?i(a.previousSibling)&&!m(a.previousSibling)?l(a.previousSibling):""===a.previousSibling.innerHTML&&!h(a.previousSibling)?l(a.previouSibling):a.previousSibling:a.parentNode?l(a.parentNode):null:null}function m(a){return 0<a.data.replace(/\s+/g,"").length}function n(a,b){return 0===b||b<=a.data.length-a.data.replace(/^\s+/,"").length}function o(a){return a.parent().hasClass("aloha-editable")}function p(a,b){var c=j(a);if(c===b)return!0;var d=i(a);return d&&a.data.replace(/\s+$/,"").length===b?!0:1===c&&!d?g(a.childNodes[0]):!1}function q(a){return c(a).stop(!0).css({opacity:0}).fadeIn(0).delay(100).fadeIn(function(){c(a).css({opacity:1})}),a}function r(b,d){var g=new e.Utils.RangeObject,i=d?l(b):k(b);if(!i||h(i)){var m=c("<div>&nbsp;</div>");d?c(b).before(m):c(b).after(m),g.startContainer=g.endContainer=m[0],g.startOffset=g.endOffset=0,u(g),window.$_alohaPlaceholder=m}else g.startContainer=g.endContainer=i,g.startOffset=g.endOffset=d?j(i):f?1:0,u(g);g.select(),a.trigger("aloha-block-selected",b),a.Selection.preventSelectionChanged()}function s(a,b){return f?d.compareDocumentPosition(a,b)&16:0<c(a).find(b).length}function t(a){var b=a.startContainer,c=a.endContainer,d=window.$_alohaPlaceholder;return d.is(b)||d.is(c)||s(d[0],b)||s(d[0],c)}function u(a){window.$_alohaPlaceholder&&!t(a)&&(0===window.$_alohaPlaceholder.html().replace(/^(&nbsp;)*$/,"").length&&window.$_alohaPlaceholder.remove(),window.$_alohaPlaceholder=null)}var e=window.GENTICS,f=!!(c.browser.msie&&9>parseInt(c.browser.version,10));return a.Markup=b.extend({keyHandlers:{},addKeyHandler:function(a,b){this.keyHandlers[a]||(this.keyHandlers[a]=[]),this.keyHandlers[a].push(b)},insertBreak:function(){var b=a.Selection.rangeObject,d,f,g;b.isCollapsed()||this.removeSelectedMarkup(),g=c("<br/>"),e.Utils.Dom.insertIntoDOM(g,b,a.activeEditable.obj),f=e.Utils.Dom.searchAdjacentTextNode(g.parent().get(0),e.Utils.Dom.getIndexInParent(g.get(0))+1,!1),f&&(nonWSIndex=f.data.search(/\S/),nonWSIndex>0&&(f.data=f.data.substring(nonWSIndex))),b.startContainer=b.endContainer=g.get(0).parentNode,b.startOffset=b.endOffset=e.Utils.Dom.getIndexInParent(g.get(0))+1,b.correctRange(),b.clearCaches(),b.select()},preProcessKeyStrokes:function(b){if(b.type!=="keydown")return!1;var c=a.Selection.rangeObject,d,e;if(this.keyHandlers[b.keyCode]){d=this.keyHandlers[b.keyCode];for(e=0;e<d.length;++e)if(!d[e](b))return!1}return b.keyCode===37||b.keyCode===39?this.processCursor(c,b.keyCode)?(u(a.Selection.rangeObject),!0):!1:b.keyCode===8?(b.preventDefault(),a.execCommand("delete",!1),!1):b.keyCode===46?(a.execCommand("forwarddelete",!1),!1):b.keyCode===13?b.shiftKey?(a.execCommand("insertlinebreak",!1),!1):(a.execCommand("insertparagraph",!1),!1):!0},processCursor:function(a,b){if(!a.isCollapsed())return!0;var d=a.startContainer;if(!d)return!0;var e;if(f){var g=c(d).parents("[contenteditable=false]"),m=g.length>0;if(m){if(!o(g))return!0;e=g[0]}}if(!e){var q=37===b||38===b,s=a.startOffset;if(i(d)){if(q){var t=f&&1===s;if(!t&&!n(d,s))return!0}else if(!p(d,s))return!0}else d=d.childNodes[s===j(d)?s-1:s];e=q?l(d):k(d)}return h(e)?(r(e,q),!1):!0},processShiftEnter:function(a){this.insertHTMLBreak(a.getSelectionTree(),a)},processEnter:function(a){a.splitObject?this.splitRangeObject(a):this.insertHTMLBreak(a.getSelectionTree(),a)},insertHTMLCode:function(b){var d=a.Selection.rangeObject;this.insertHTMLBreak(d.getSelectionTree(),d,c(b))},insertHTMLBreak:function(b,d,f){var g,h,i,j,k,l,m,n,o;f=f?f:c("<br/>");for(g=0,h=b.length;g<h;++g){i=b[g],j=i.domobj?c(i.domobj):undefined;if(i.selection!=="none")if(i.selection=="collapsed")g>0?(k=c(b[g-1].domobj),k.after(f)):(l=c(b[1].domobj),l.before(f)),d.startContainer=d.endContainer=f[0].parentNode,d.startOffset=d.endOffset=e.Utils.Dom.getIndexInParent(f[0])+1,d.correctRange();else if(i.domobj&&i.domobj.nodeType===3){i.domobj.nextSibling&&i.domobj.nextSibling.nodeType==1&&a.Selection.replacingElements[i.domobj.nextSibling.nodeName.toLowerCase()]&&j.after("<br/>");if(this.needEndingBreak()){o=i.domobj;while(o)if(o.nextSibling)o=!1;else{o=o.parentNode;if(e.Utils.Dom.isBlockLevelElement(o)||e.Utils.Dom.isListElement(o))break;o===d.limitObject&&(o=!1)}o&&c(o).append('<br class="aloha-cleanme" />')}j.between(f,i.startOffset),n=0,m=f[0];while(m)m=m.previousSibling,++n;d.startContainer=f[0].parentNode,d.endContainer=f[0].parentNode,d.startOffset=n,d.endOffset=n,d.correctRange()}else i.domobj&&i.domobj.nodeType===1&&(j.parent().find("br.aloha-ephemera").length===0&&(c(d.limitObject).find("br.aloha-ephemera").remove(),c(d.commonAncestorContainer).append(this.getFillUpElement(d.splitObject))),j.after(f),d.startContainer=d.commonAncestorContainer,d.endContainer=d.startContainer,d.startOffset=g+2,d.endOffset=g+2,d.update())}d.select()},needEndingBreak:function(){return!c.browser.msie},getSelectedText:function(){var b=a.Selection.rangeObject;return b.isCollapsed()?!1:this.getFromSelectionTree(b.getSelectionTree(),!0)},getFromSelectionTree:function(a,b){var d="",e,f,g,h;for(e=0,f=a.length;e<f;e++)g=a[e],g.selection=="partial"?g.domobj.nodeType===3?d+=g.domobj.data.substring(g.startOffset,g.endOffset):g.domobj.nodeType===1&&g.children&&(b?d+=this.getFromSelectionTree(g.children,b):(h=c(g.domobj).clone(!1).empty(),h.html(this.getFromSelectionTree(g.children,b)),d+=h.outerHTML())):g.selection=="full"&&(g.domobj.nodeType===3?d+=c(g.domobj).text():g.domobj.nodeType===1&&g.children&&(d+=b?c(g.domobj).text():c(g.domobj).outerHTML()));return d},getSelectedMarkup:function(){var b=a.Selection.rangeObject;return b.isCollapsed()?null:this.getFromSelectionTree(b.getSelectionTree(),!1)},removeSelectedMarkup:function(){var b=a.Selection.rangeObject,c;if(b.isCollapsed())return;c=new a.Selection.SelectionRange,this.removeFromSelectionTree(b.getSelectionTree(),c),c.update(),e.Utils.Dom.doCleanup({merge:!0,removeempty:!0},a.Selection.rangeObject),a.Selection.rangeObject=c,c.correctRange(),c.update(),c.select(),a.Selection.updateSelection()},removeFromSelectionTree:function(a,b){var d,f,g,h,i,j;for(g=0,j=a.length;g<j;g++)h=a[g],h.selection=="partial"?h.domobj.nodeType===3?(f="",h.startOffset>0&&(f+=h.domobj.data.substring(0,h.startOffset)),h.endOffset<h.domobj.data.length&&(f+=h.domobj.data.substring(h.endOffset,h.domobj.data.length)),h.domobj.data=f,b.startContainer||(b.startContainer=b.endContainer=h.domobj,b.startOffset=b.endOffset=h.startOffset)):h.domobj.nodeType===1&&h.children&&(this.removeFromSelectionTree(h.children,b),d?d.nodeName==h.domobj.nodeName&&(c(d).append(c(h.domobj).contents()),c(h.domobj).remove()):d=h.domobj):h.selection=="full"&&(b.startContainer||(i=e.Utils.Dom.searchAdjacentTextNode(h.domobj.parentNode,e.Utils.Dom.getIndexInParent(h.domobj)+1,!1,{blocklevel:!1}),i?(b.startContainer=b.endContainer=i,b.startOffset=b.endOffset=0):(b.startContainer=b.endContainer=h.domobj.parentNode,b.startOffset=b.endOffset=e.Utils.Dom.getIndexInParent(h.domobj)+1)),c(h.domobj).remove())},splitRangeObject:function(b,d){var f=c(b.splitObject),g,h,i;b.update(b.splitObject),g=b.getSelectionTree(),i=this.getSplitFollowUpContainer(b),this.splitRangeObjectHelper(g,b,i),i.hasClass("preparedForRemoval")&&i.removeClass("preparedForRemoval"),h=this.getInsertAfterObject(b,i),c(i).insertAfter(h),b.splitObject.nodeName.toLowerCase()==="li"&&!a.Selection.standardTextLevelSemanticsComparator(b.splitObject,i)&&c(b.splitObject).remove(),b.startContainer=null;var j=i.contents();j.length>0&&j.get(0).nodeType==1&&j.get(0).nodeName.toLowerCase()==="br"&&(b.startContainer=i.get(0)),b.startContainer||(b.startContainer=i.textNodes(!0,!0).first().get(0)),b.startContainer||(b.startContainer=i.textNodes(!1).first().parent().get(0)),b.startContainer?(b.endContainer=b.startContainer,b.startOffset=0,b.endOffset=0):(b.startContainer=b.endContainer=i.parent().get(0),b.startOffset=b.endOffset=e.Utils.Dom.getIndexInParent(i.get(0))),b.update(),b.select()},getInsertAfterObject:function(b,d){var e,f,g;for(f=0;f<b.markupEffectiveAtStart.length;f++){g=b.markupEffectiveAtStart[f],g===b.splitObject&&(e=!0);if(!e)continue;if(a.Selection.canTag1WrapTag2(c(g).parent()[0].nodeName,d[0].nodeName))return g}return!1},getFillUpElement:function(a){return c.browser.msie?!1:c('<br class="aloha-cleanme"/>')},removeElementContentWhitespaceObj:function(a){var b=0,c=[],d,e,f;for(d=0;d<a.length;++d)e=a[d],e.isElementContentWhitespace&&(c[c.length]=d);for(d=0;d<c.length;++d)f=c[d],a.splice(f-b,1),++b},splitRangeObjectHelper:function(b,d,f,g){f||a.Log.warn(this,"no followUpContainer, no inBetweenMarkup, nothing to do...");var h=this.getFillUpElement(d.splitObject),i=c(d.splitObject),j=!1,k,l,m,n,o,p,q;if(b.length>0){o=f.contents(),o.length!==b.length&&this.removeElementContentWhitespaceObj(o);for(l=0,q=b.length;l<q;++l){k=b[l];if(k.selection==="none"&&j===!1||k.domobj&&k.domobj.nodeType===3&&k===b[b.length-1]&&k.startOffset===k.domobj.data.length){f.textNodes().length>1||k.domobj.nodeType===1&&k.children.length===0?o.eq(l).remove():e.Utils.Dom.isSplitObject(f[0])?h?f.html(h):f.empty():(f.empty(),f.addClass("preparedForRemoval"));continue}k.selection!=="none"?(k.domobj&&k.domobj.nodeType===3&&k.startOffset!==undefined&&(m=k.domobj.data,k.startOffset>0?k.domobj.data=m.substr(0,k.startOffset):b.length>1?c(k.domobj).remove():(p=c(k.domobj).parent(),e.Utils.Dom.isSplitObject(p[0])?h?p.html(h):p.empty():p.remove()),m.length-k.startOffset>0?o[l].data=m.substr(k.startOffset,m.length):o.length>1?o.eq(l).remove():e.Utils.Dom.isBlockLevelElement(f[0])?h?f.html(h):f.empty():(f.empty(),f.addClass("preparedForRemoval"))),j=!0,k.children.length>0&&this.splitRangeObjectHelper(k.children,d,o.eq(l),g)):k.selection==="none"&&j===!0&&(n=c(k.domobj).remove())}}else a.Log.error(this,"can not split splitObject due to an empty selection tree");i.find("br.aloha-ephemera:gt(0)").remove(),f.find("br.aloha-ephemera:gt(0)").remove(),i.find(".preparedForRemoval").remove(),f.find(".preparedForRemoval").remove(),i.contents().length===0&&e.Utils.Dom.isSplitObject(i[0])&&h&&i.html(h),f.contents().length===0&&e.Utils.Dom.isSplitObject(f[0])&&h&&f.html(h)},getSplitFollowUpContainer:function(a){var b=a.splitObject.nodeName.toLowerCase(),d,e,f;switch(b){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":f=c(a.splitObject).textNodes(":not(.aloha-cleanme)").last()[0];if(f&&a.startContainer===f&&a.startOffset===f.length)return d=c("<p></p>"),e=c(a.splitObject).clone().contents(),d.append(e),d;break;case"li":if(a.startContainer.nodeName.toLowerCase()==="br"&&c(a.startContainer).hasClass("aloha-ephemera"))return d=c("<p></p>"),e=c(a.splitObject).clone().contents(),d.append(e),d;if(!a.splitObject.nextSibling&&c.trim(c(a.splitObject).text()).length===0)return d=c("<p></p>"),d}return c(a.splitObject).clone()},transformDomObject:function(a,b,d){var e=c(a),f=c("<"+b+"></"+b+">"),g;if(e[0].attributes)for(g=0;g<e[0].attributes.length;++g)f.attr(e[0].attributes[g].nodeName,e[0].attributes[g].nodeValue);return e[0].style&&e[0].style.cssText&&(f[0].style.cssText=e[0].style.cssText),e.contents().appendTo(f),e.replaceWith(f),d&&(d.startContainer==a&&(d.startContainer=f.get(0)),d.endContainer==a&&(d.endContainer=f.get(0))),f},toString:function(){return"Aloha.Markup"}}),a.Markup=new a.Markup,a.Markup}),define("aloha/observable",["aloha/jquery"],function(a,b){var c=a;return{_eventHandlers:null,bind:function(a,b,c){this._eventHandlers=this._eventHandlers||{},this._eventHandlers[a]||(this._eventHandlers[a]=[]),this._eventHandlers[a].push({handler:b,scope:c?c:window})},unbind:function(a,b){this._eventHandlers=this._eventHandlers||{};if(!this._eventHandlers[a])return;b?this._eventHandlers[a]=c.grep(this._eventHandlers[a],function(a){return a.handler===b?!1:!0}):this._eventHandlers[a]=[]},trigger:function(a){this._eventHandlers=this._eventHandlers||{};if(!this._eventHandlers[a])return;var b=[];c.each(arguments,function(a,c){a>0&&b.push(c)}),c.each(this._eventHandlers[a],function(a,c){c.handler.apply(c.scope,b)})},unbindAll:function(){this._eventHandlers=null}}}),define("aloha/registry",["aloha/jquery","aloha/observable"],function(a,b){return Class.extend(b,{_entries:null,_constructor:function(){this._entries={}},register:function(a,b){this._entries[a]=b,this.trigger("register",b,a)},unregister:function(a){var b=this._entries[a];delete this._entries[a],this.trigger("unregister",b,a)},get:function(a){return this._entries[a]},has:function(a){return this._entries[a]?!0:!1},getEntries:function(){return a.extend({},this._entries)}})}),define("aloha/contenthandlermanager",["aloha/jquery","aloha/registry"],function(a,b){return new(b.extend({createHandler:function(a){if(typeof a.handleContent!="function")throw"ContentHandler has no function handleContent().";var b=Class.extend({handleContent:function(a){}},a);return new b},handleContent:function(b,c){var d,e=this.getEntries();if(typeof c.contenthandler=="undefined"){c.contenthandler=[];for(d in e)e.hasOwnProperty(d)&&c.contenthandler.push(d)}for(d in e)if(e.hasOwnProperty(d)){if(a.inArray(d,c.contenthandler)<0)continue;typeof e[d].handleContent=="function"?b=e[d].handleContent(b,c):console.error("A valid content handler needs the method handleContent.")}return b}}))}),define("aloha/editable",["aloha/core","util/class","aloha/jquery","aloha/pluginmanager","aloha/floatingmenu","aloha/selection","aloha/markup","aloha/contenthandlermanager","aloha/console"],function(a,b,c,d,e,f,g,h,i){var j=window.unescape,k=window.GENTICS,l=!1;a.defaults.contentHandler={},a.defaults.contentHandler.initEditable=["sanitize"],a.defaults.contentHandler.getContents=["sanitize"],typeof a.settings.contentHandler=="undefined"&&(a.settings.contentHandler={});var m=function(a){return c(a).html()},n=m;a.Editable=b.extend({_constructor:function(b){b.attr("id")||b.attr("id",k.Utils.guid()),this.obj=b,this.originalObj=b,this.ready=!1,this.sccDelimiters=[":",";",".","!","?",",",j("%u0009"),j("%u0020"),j("%u0008"),j("%u007F"),"Enter"],this.sccIdle=5e3,this.sccDelay=500,this.sccTimerIdle=!1,this.sccTimerDelay=!1,this.keyCodeMap={93:"Apps",18:"Alt",20:"CapsLock",17:"Control",40:"Down",35:"End",13:"Enter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",36:"Home",45:"Insert",37:"Left",224:"Meta",34:"PageDown",33:"PageUp",19:"Pause",44:"PrintScreen",39:"Right",145:"Scroll",16:"Shift",38:"Up",91:"Win",92:"Win"},this.placeholderClass="aloha-placeholder",a.registerEditable(this),this.init()},init:function(){var b=this;this.settings=a.settings,a.settings&&a.settings.smartContentChange&&(a.settings.smartContentChange.delimiters&&(this.sccDelimiters=a.settings.smartContentChange.delimiters),a.settings.smartContentChange.idle&&(this.sccIdle=a.settings.smartContentChange.idle),a.settings.smartContentChange.delay&&(this.sccDelay=a.settings.smartContentChange.delay));if(!this.check(this.obj)){this.destroy();return}typeof a.settings.contentHandler.initEditable=="undefined"&&(a.settings.contentHandler.initEditable=a.defaults.contentHandler.initEditable);var d=b.obj.html();d=h.handleContent(d,{contenthandler:a.settings.contentHandler.initEditable}),b.obj.html(d),a.bind("aloha-ready",function(){b.obj.addClass("aloha-editable").contentEditable(!0),b.obj.mousedown(function(c){if(!a.eventHandled)return a.eventHandled=!0,b.activate(c)}),b.obj.mouseup(function(b){a.eventHandled=!1}),b.obj.focus(function(a){return b.activate(a)}),b.obj.keydown(function(a){var c=g.preProcessKeyStrokes(a);return b.keyCode=a.which,c||b.smartContentChange(a),c}),b.obj.keypress(function(b){a.activeEditable.smartContentChange(b)}),b.obj.keyup(function(b){if(b.keyCode===27)return a.deactivateEditable(),!1}),b.obj.contentEditableSelectionChange(function(a){return f.onChange(b.obj,a),b.obj}),b.setUnmodified(),b.snapshotContent=b.getContents(),c.browser.mozilla&&b.initEmptyEditable(),b.initPlaceholder(),b.ready=!0,a.trigger("aloha-editable-created",[b])})},isActive:!1,originalContent:null,range:undefined,check:function(){var a=this,b=this.obj,d=b.get(0),e=d.nodeName.toLowerCase(),f=["a","abbr","address","article","aside","b","bdo","blockquote","cite","code","command","del","details","dfn","div","dl","em","footer","h1","h2","h3","h4","h5","h6","header","i","ins","menu","nav","p","pre","q","ruby","section","small","span","strong","sub","sup","var"],g,h;for(g=0;g<f.length;++g)if(e===f[g])return!0;switch(e){case"label":case"button":break;case"textarea":return h=c('<div id="'+this.getId()+'-aloha" class="aloha-textarea" />').insertAfter(b),h.height(b.height()).width(b.width()).html(b.val()),b.hide(),b.parents("form:first").submit(function(){b.val(a.getContents())}),this.obj=h,!0;default:}return!1},initPlaceholder:function(){a.settings.placeholder&&this.isEmpty()&&this.addPlaceholder()},isEmpty:function(){var a=c.trim(this.getContents()),b=a==="<br>"?!0:!1;return a.length===0||b},initEmptyEditable:function(){var a=this.obj;this.empty(this.getContents())&&c(a).prepend('<br class="aloha-cleanme" />')},addPlaceholder:function(){var b=c("<div>"),d=c("<span>"),e,f=this.obj;k.Utils.Dom.allowsNesting(f[0],b[0])?e=b:e=d,c(f).append(e.addClass(this.placeholderClass)),c.each(a.settings.placeholder,function(a,b){f.is(a)&&e.html(b)}),c("br",f).remove()},removePlaceholder:function(a,b){var d=this.placeholderClass,e;if(b===!0){e=f.getRangeObject();if(!e.select)return;e.startContainer=e.endContainer=a.get(0),e.startOffset=e.endOffset=0,e.select(),window.setTimeout(function(){c("."+d,a).remove()},20)}else c("."+d,a).remove()},destroy:function(){this===a.getActiveEditable()&&(this.blur(),e.hide());switch(this.originalObj.get(0).nodeName.toLowerCase()){case"label":case"button":break;case"textarea":this.originalObj.val(this.getContents()),this.obj.remove(),this.originalObj.show();break;default:}this.ready=!1,this.removePlaceholder(this.obj),this.obj.removeClass("aloha-editable").contentEditable(!1).unbind("mousedown click dblclick focus keydown keypress keyup"),a.trigger("aloha-editable-destroyed",[this]),a.unregisterEditable(this)},setUnmodified:function(){this.originalContent=this.getContents()},isModified:function(){return this.originalContent!==this.getContents()},toString:function(){return"Aloha.Editable"},isDisabled:function(){return!this.obj.contentEditable()||this.obj.contentEditable()==="false"},disable:function(){return this.isDisabled()||this.obj.contentEditable(!1)},enable:function(){return this.isDisabled()&&this.obj.contentEditable(!0)},activate:function(b){var c=a.getActiveEditable();if(l){l=!1;return}if(b&&b.type==="focus"&&c!==null&&c.obj.parent().get(0)===b.currentTarget)return;if(this.isActive||this.isDisabled())return;this.obj.addClass("aloha-editable-active"),a.activateEditable(this),l=!0,this.removePlaceholder(this.obj,!0),l=!1,this.isActive=!0,a.trigger("aloha-editable-activated",{oldActive:c,editable:this})},blur:function(){this.obj.blur(),this.isActive=!1,this.initPlaceholder(),this.obj.removeClass("aloha-editable-active"),a.trigger("aloha-editable-deactivated",{editable:this}),a.activeEditable.smartContentChange({type:"blur"},null)},empty:function(a){return null===a||c.trim(a)===""||a==="<br/>"},getContents:function(a){var b=this.obj.clone(!1);return b.find(".aloha-cleanme").remove(),this.removePlaceholder(b),d.makeClean(b),a?b.contents():n(b[0])},setContents:function(b,c){var d=null;return a.getActiveEditable()===this&&(a.deactivateEditable(),d=this),this.obj.html(b),null!==d&&d.activate(),this.smartContentChange({type:"set-contents"}),c?this.obj.contents():n(this.obj[0])},getId:function(){return this.obj.attr("id")},smartContentChange:function(b){var d=this,e=null,f,g;if(b&&(b.metaKey||b.crtlKey||b.altKey))return!1;b&&b.originalEvent&&(f=new RegExp("U\\+(\\w{4})"),g=f.exec(b.originalEvent.keyIdentifier),b.originalEvent.keyIdentifier&&!1?(g!==null&&(e=j("%u"+g[1])),e===null&&(e=b.originalEvent.keyIdentifier)):e=this.keyCodeMap[this.keyCode]||String.fromCharCode(b.which)||"unknown"),c.inArray(e,this.sccDelimiters)>=0?(clearTimeout(this.sccTimerIdle),clearTimeout(this.sccTimerDelay),this.sccTimerDelay=setTimeout(function(){a.trigger("aloha-smart-content-changed",{editable:d,keyIdentifier:b.originalEvent.keyIdentifier,keyCode:b.keyCode,"char":e,triggerType:"keypress",snapshotContent:d.getSnapshotContent()}),i.debug("Aloha.Editable","smartContentChanged: event type keypress triggered")},this.sccDelay)):b&&b.type==="paste"?a.trigger("aloha-smart-content-changed",{editable:d,keyIdentifier:null,keyCode:null,"char":null,triggerType:"paste",snapshotContent:d.getSnapshotContent()}):b&&b.type==="blur"?a.trigger("aloha-smart-content-changed",{editable:d,keyIdentifier:null,keyCode:null,"char":null,triggerType:"blur",snapshotContent:d.getSnapshotContent()}):e!==null&&(clearTimeout(this.sccTimerDelay),clearTimeout(this.sccTimerIdle),this.sccTimerIdle=setTimeout(function(){a.trigger("aloha-smart-content-changed",{editable:d,keyIdentifier:null,keyCode:null,"char":null,triggerType:"idle",snapshotContent:d.getSnapshotContent()})},this.sccIdle))},getSnapshotContent:function(){var a=this.snapshotContent;return this.snapshotContent=this.getContents(),a}}),a.Editable.setContentSerializer=function(a){n=a}}),define("aloha/message",["aloha/core","util/class","aloha/jquery"],function(a,b,c){var d=window.GENTICS;a.Message=b.extend({_constructor:function(a){this.title=a.title,this.text=a.text,this.type=a.type,this.callback=a.callback},toString:function(){return this.type+": "+this.message}}),a.Message.Type={CONFIRM:"confirm",ALERT:"alert",WAIT:"wait"},a.MessageLine=b.extend({messages:[],add:function(a){var b="",d=this.messages.length,e;this.messages[d]=a;while(d>4)this.messages.shift(),--d;for(e=0;e<d;e++)b+=this.messages[e].toString()+"<br/>";c("#gtx_aloha_messageline").html(b)}}),a.MessageLine=new a.MessageLine}),define("aloha/plugin",["aloha/core","aloha/jquery","util/class","aloha/pluginmanager","aloha/console"],function(a,b,c,d,e){var f=c.extend({name:null,defaults:{},settings:{},dependencies:[],_constructor:function(a){typeof a!="string"?e.error("Cannot initialise unnamed plugin, skipping"):this.name=a},checkDependencies:function(){var c=!0,d=this;return b.each(this.dependencies,function(){a.isPluginLoaded(this)||(c=!1,e.error("plugin."+d.name,'Required plugin "'+this+'" not found.'))}),c},init:function(){},getEditableConfig:function(a){var c=null,d=!1,e=this;return this.settings.editables&&b.each(this.settings.editables,function(f,g){if(a.is(f)){d=!0;if(g instanceof Array)c=[],c=b.merge(c,g);else if(typeof g=="object"){c={};for(var h in g)g.hasOwnProperty(h)&&(g[h]instanceof Array||(typeof g[h]=="object"?(c[h]={},c[h]=b.extend(!0,c[h],e.config[h],g[h])):c[h]=g[h]))}else c=g}}),d||(typeof this.settings.config=="undefined"||!this.settings.config?c=this.config:c=this.settings.config),c},makeClean:function(a){},getUID:function(a){return e.deprecated("plugin","getUID() is deprecated. Use plugin.name instead."),this.name},i18n:function(b,c){return e.deprecated("plugin","i18n() is deprecated. Use plugin.t() instead."),a.i18n(this,b,c)},toString:function(
){return this.name},log:function(a,b){e.deprecated("plugin","log() is deprecated. Use Aloha.console instead."),e.log(a,this,b)}});return f.create=function(c,e){var g=new(f.extend(e))(c);return g.settings=b.extendObjects(!0,g.defaults,a.settings[c]),d.register(g),g},f}),define("aloha/engine",["aloha/ecma5shims","aloha/jquery"],function(a,b){function g(a){if(!a)return 0;if(!a.style)return 0;if(typeof a.style.length!="undefined")return a.style.length;var b=0;for(var c in a.style)a.style[c]&&a.style[c]!==0&&a.style[c]!=="false"&&b++;return b}function h(a){if(!a)return null;var b=[],c,d=a.length;for(c=d>>>0;c--;)b[c]=a[c];return b}function i(a){return a.hasChildNodes()?a.firstChild:k(a)}function j(b){if(b.previousSibling){b=b.previousSibling;while(b.hasChildNodes())b=b.lastChild;return b}return b.parentNode&&b.parentNode.nodeType==a.Node.ELEMENT_NODE?b.parentNode:null}function k(a){while(a&&!a.nextSibling)a=a.parentNode;return a?a.nextSibling:null}function l(b,c){return b&&c&&Boolean(a.compareDocumentPosition(b,c)&a.Node.DOCUMENT_POSITION_CONTAINED_BY)}function m(a,b){return(a||b)&&(a==b||l(a,b))}function n(b,c){return c&&b&&Boolean(a.compareDocumentPosition(c,b)&a.Node.DOCUMENT_POSITION_CONTAINED_BY)}function o(b,c){return Boolean(a.compareDocumentPosition(b,c)&a.Node.DOCUMENT_POSITION_FOLLOWING)}function p(b,c){return Boolean(a.compareDocumentPosition(b,c)&a.Node.DOCUMENT_POSITION_PRECEDING)}function q(a){var b=[];while(a.parentNode)b.unshift(a.parentNode),a=a.parentNode;return b}function r(a){var b=[],c=k(a);while((a=i(a))&&a!=c)b.push(a);return b}function s(a){var b={fontFamily:"font-family",fontSize:"font-size",fontStyle:"font-style",fontWeight:"font-weight",textDecoration:"text-decoration"};return typeof b[a]!="undefined"?b[a]:a}function t(a){return{"xx-small":1,small:2,medium:3,large:4,"x-large":5,"xx-large":6,"xxx-large":7}[a]}function u(a){return{1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[a]}function v(a){return a===null||!a||a===c}function w(a){return a.dir=="ltr"?"ltr":a.dir=="rtl"?"rtl":O(a.parentNode)?w(a.parentNode):"ltr"}function x(a){var b=0;while(a.previousSibling)b++,a=a.previousSibling;return b}function y(b){switch(b.nodeType){case a.Node.PROCESSING_INSTRUCTION_NODE:case a.Node.DOCUMENT_TYPE_NODE:return 0;case a.Node.TEXT_NODE:case a.Node.COMMENT_NODE:return b.length;default:return b.childNodes.length}}function z(b,c,d,e){if(b==d){if(c==e)return"equal";if(c<e)return"before";if(c>e)return"after"}if(a.compareDocumentPosition(d,b)&a.Node.DOCUMENT_POSITION_FOLLOWING){var f=z(d,e,b,c);if(f=="before")return"after";if(f=="after")return"before"}if(a.compareDocumentPosition(d,b)&a.Node.DOCUMENT_POSITION_CONTAINS){var g=d;while(g.parentNode!=b)g=g.parentNode;if(x(g)<c)return"after"}return"before"}function A(a){var b=a;while(b.parentNode!=null)b=b.parentNode;return b}function B(a,b){var c=z(a,0,b.startContainer,b.startOffset),d=z(a,y(a),b.endContainer,b.endOffset);return A(a)==A(b.startContainer)&&c=="after"&&d=="before"}function C(a,b){typeof b=="undefined"&&(b=function(){return!0});var c=a.startContainer;c.hasChildNodes()&&a.startOffset<c.childNodes.length?c=c.childNodes[a.startOffset]:a.startOffset==y(c)?c=k(c):c=i(c);var d=a.endContainer;d.hasChildNodes()&&a.endOffset<d.childNodes.length?d=d.childNodes[a.endOffset]:d=k(d);var e=[];while(o(c,d)){if(B(c,a)&&b(c)){e.push(c),c=k(c);continue}c=i(c)}return e}function D(a,b){typeof b=="undefined"&&(b=function(){return!0});var c=a.startContainer;c.hasChildNodes()&&a.startOffset<c.childNodes.length?c=c.childNodes[a.startOffset]:a.startOffset==y(c)?c=k(c):c=i(c);var d=a.endContainer;d.hasChildNodes()&&a.endOffset<d.childNodes.length?d=d.childNodes[a.endOffset]:d=k(d);var e=[];while(o(c,d))B(c,a)&&b(c)&&e.push(c),c=i(c);return e}function E(b){if(b.toLowerCase()=="currentcolor")return null;var c=document.createElement("span");document.body.appendChild(c),c.style.color="black";var d=document.createElement("span");c.appendChild(d),d.style.color=b,b=a.getComputedStyle(d).color;if(b=="rgb(0, 0, 0)"){c.color="white",b=a.getComputedStyle(d).color;if(b!="rgb(0, 0, 0)")return null}return document.body.removeChild(c),/^rgba\([0-9]+, [0-9]+, [0-9]+, 1\)$/.test(b)?b.replace("rgba","rgb").replace(", 1)",")"):b=="transparent"?"rgba(0, 0, 0, 0)":b}function F(b){b=b.toLowerCase();if(a(["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"]).indexOf(b)!=-1)return b;b=E(b);var c=/^rgb\(([0-9]+), ([0-9]+), ([0-9]+)\)$/.exec(b);return c?"#"+parseInt(c[1]).toString(16).replace(/^.$/,"0$&")+parseInt(c[2]).toString(16).replace(/^.$/,"0$&")+parseInt(c[3]).toString(16).replace(/^.$/,"0$&"):null}function H(a,b,c,d){G==0&&typeof c!="undefined"?e=c:G==0&&(e=null,e=c);if(a in f){if(b=="enabled"||b in f[a]){G++;try{var g=d()}catch(h){throw G--,h}return G--,g}throw"INVALID_ACCESS_ERR"}throw"NOT_SUPPORTED_ERR"}function I(a,b,c,d){a=a.toLowerCase();if(arguments.length==1||arguments.length>=4&&typeof b=="undefined")b=!1;if(arguments.length<=2||arguments.length>=4&&typeof c=="undefined")c="";return H(a,"action",d,function(a,b,c){return function(){return J(a)?(f[a].action(c,d),eb(d),!0):!1}}(a,b,c))}function J(b,c){return b=b.toLowerCase(),H(b,"action",c,function(b){return function(){return a(["copy","cut","paste","selectall","stylewithcss","usecss"]).indexOf(b)!=-1||c!==null}}(b))}function K(a,b){return a=a.toLowerCase(),H(a,"indeterm",b,function(a){return function(){return J(a,b)?f[a].indeterm(b):!1}}(a))}function L(a,b){return a=a.toLowerCase(),H(a,"state",b,function(a){return function(){return J(a,b)?typeof gb(a,b)!="undefined"?gb(a,b):f[a].state(b):!1}}(a))}function M(a){return a=a.toLowerCase(),a in f}function N(a,b){return a=a.toLowerCase(),H(a,"value",b,function(){return J(a,b)?a=="fontsize"&&jb("fontsize",b)!==undefined?Mb(jb("fontsize",b)):typeof jb(a,b)!="undefined"?jb(a,b):f[a].value():""})}function O(b,c){return typeof c=="string"&&(c=[c]),typeof c=="object"&&(c=a(c).map(function(a){return a.toUpperCase()})),b&&b.nodeType==a.Node.ELEMENT_NODE&&v(b.namespaceURI)&&(typeof c=="undefined"||a(c).indexOf(b.tagName)!=-1)}function Q(a){return O(a,P)}function R(b){return b&&(b.nodeType==a.Node.ELEMENT_NODE&&a(["inline","inline-block","inline-table","none"]).indexOf(a.getComputedStyle(b).display)==-1||b.nodeType==a.Node.DOCUMENT_NODE||b.nodeType==a.Node.DOCUMENT_FRAGMENT_NODE)}function S(a){return a&&!R(a)}function T(b){return b&&b.nodeType==a.Node.ELEMENT_NODE&&(b.contentEditable=="true"||b.parentNode&&b.parentNode.nodeType==a.Node.DOCUMENT_NODE&&b.parentNode.designMode=="on")}function U(c){return c&&!T(c)&&(c.nodeType!=a.Node.ELEMENT_NODE||c.contentEditable!="false"||b(c).hasClass("aloha-table-wrapper"))&&(T(c.parentNode)||U(c.parentNode))}function V(a){for(var b=0;b<a.childNodes.length;b++)if(U(a.childNodes[b])||V(a.childNodes[b]))return!0;return!1}function W(a){if(T(a))return a;if(U(a)){var b=a.parentNode;while(!T(b))b=b.parentNode;return b}return null}function X(a,b){return W(a)&&W(a)==W(b)}function Y(b){if(!O(b,"br"))return!1;var c=b.parentNode;while(a.getComputedStyle(c).display=="inline")c=c.parentNode;var d=a(c).hasAttribute("style")?c.getAttribute("style"):null;c.style.height="auto",c.style.maxHeight="none",c.style.minHeight="0";var e=document.createTextNode("​"),f=c.offsetHeight;if(f==0)throw"isCollapsedLineBreak: original height is zero, bug?";b.parentNode.insertBefore(e,b.nextSibling);var g=c.offsetHeight;return e.parentNode.removeChild(e),d===null?(c.setAttribute("style",""),c.removeAttribute("style")):c.setAttribute("style",d),f<g-5}function Z(b){if(!O(b,"br"))return!1;if(O(b.parentNode,"li")&&b.parentNode.childNodes.length==1)return!1;var c=b.parentNode;while(a.getComputedStyle(c).display=="inline")c=c.parentNode;var d=a(c).hasAttribute("style")?c.getAttribute("style"):null;c.style.height="auto",c.style.maxHeight="none",c.style.minHeight="0";var e=a(b).hasAttribute("style")?b.getAttribute("style"):null,f=c.offsetHeight;if(f==0)throw"isExtraneousLineBreak: original height is zero, bug?";b.setAttribute("style","display:none");var g=c.offsetHeight;return d===null?(c.setAttribute("style",""),c.removeAttribute("style")):c.setAttribute("style",d),e===null?b.removeAttribute("style"):b.setAttribute("style",e),f==g}function $(b){return b&&b.nodeType==a.Node.TEXT_NODE&&(b.data==""||/^[\t\n\r ]+$/.test(b.data)&&b.parentNode&&b.parentNode.nodeType==a.Node.ELEMENT_NODE&&a(["normal","nowrap"]).indexOf(a.getComputedStyle(b.parentNode).whiteSpace)!=-1||/^[\t\r ]+$/.test(b.data)&&b.parentNode&&b.parentNode.nodeType==a.Node.ELEMENT_NODE&&a.getComputedStyle(b.parentNode).whiteSpace=="pre-line"||/^[\t\n\r ]+$/.test(b.data)&&b.parentNode&&b.parentNode.nodeType==a.Node.DOCUMENT_FRAGMENT_NODE)}function _(b,c){if(!U(b)&&!T(b))return;if(!b||b.nodeType!==a.Node.TEXT_NODE)return;if(a(["pre","pre-wrap"]).indexOf(a.getComputedStyle(b.parentNode).whiteSpace)!=-1)return;if(!/[\t\n\r ]{2,}/.test(b.data))return;var d="",e=c.startContainer==b,f=c.endContainer==b,g=!1;for(var h=0;h<b.data.length;++h)/[\t\n\r ]/.test(b.data[h])?g?(e&&d.length<c.startOffset&&c.startOffset--,f&&d.length<c.endOffset&&c.endOffset--):(d+=" ",g=!0):(d+=b.data[h],g=!1);b.data=d}function ab(b){if(!$(b))return!1;if(b.data=="")return!0;var c=b.parentNode;if(!c)return!0;if(a(q(b)).some(function(b){return b.nodeType==a.Node.ELEMENT_NODE&&a.getComputedStyle(b).display=="none"}))return!0;while(!R(c)&&c.parentNode)c=c.parentNode;var d=b;while(d!=c){d=j(d);if(R(d)||O(d,"br"))return!0;if(d.nodeType==a.Node.TEXT_NODE&&!$(d)||O(d,"img"))break}d=b;var e=k(c);while(d!=e){d=i(d);if(R(d)||O(d,"br"))return!0;if(d&&d.nodeType==a.Node.TEXT_NODE&&!$(d)||O(d,"img"))break}return!1}function bb(b){if(!b)return!1;if(a(q(b).concat(b)).filter(function(b){return b.nodeType==a.Node.ELEMENT_NODE},!0).some(function(b){return a.getComputedStyle(b).display=="none"}))return!1;if(R(b)||b.nodeType==a.Node.TEXT_NODE&&!ab(b)||O(b,"img")||O(b,"br")&&!Z(b))return!0;for(var c=0;c<b.childNodes.length;c++)if(bb(b.childNodes[c]))return!0;return!1}function cb(a){return a&&!bb(a)}function db(b){if(Y(b)&&!Z(b))return!0;if(!S(b)||b.nodeType!=a.Node.ELEMENT_NODE)return!1;var c=!1;for(var d=0;d<b.childNodes.length;d++){if(!cb(b.childNodes[d])&&!db(b.childNodes[d]))return!1;db(b.childNodes[d])&&(c=!0)}return c}function eb(a){var b=new window.GENTICS.Utils.RangeObject;b.startContainer=a.startContainer,b.startOffset=a.startOffset,b.endContainer=a.endContainer,b.endOffset=a.endOffset,b.select()}function fb(){var b;if(e)b=e;else{if(!Aloha.getSelection().rangeCount)return null;b=Aloha.getSelection().getRangeAt(0)}if(a([a.Node.TEXT_NODE,a.Node.ELEMENT_NODE]).indexOf(b.startContainer.nodeType)==-1||a([a.Node.TEXT_NODE,a.Node.ELEMENT_NODE]).indexOf(b.endContainer.nodeType)==-1||!b.startContainer.ownerDocument||!b.endContainer.ownerDocument||!n(b.startContainer,b.startContainer.ownerDocument)||!n(b.endContainer,b.endContainer.ownerDocument))throw"Invalid active range; test bug?";return b}function mb(b,c,d,e){d==-1&&(d=c.childNodes.length);var f=b.parentNode,g=x(b),h=[e];for(var i=0;i<Aloha.getSelection().rangeCount;i++)h.push(Aloha.getSelection().getRangeAt(i));var j=[];a(h).forEach(function(a){j.push([a.startContainer,a.startOffset]),j.push([a.endContainer,a.endOffset])}),a(j).forEach(function(a){a[0]==c&&a[1]>d&&a[1]++,a[0]==f&&(a[1]==g||a[1]==g+1)&&(a[0]=c,a[1]+=d-g),a[0]==f&&a[1]>g+1&&a[1]--}),c.childNodes.length==d?c.appendChild(b):c.insertBefore(b,c.childNodes[d]);if(j[0][1]>j[0][0].childNodes.length&&j[1][1]>j[1][0].childNodes.length)e.setStart(b,0),e.setEnd(b,0);else{e.setStart(j[0][0],j[0][1]),e.setEnd(j[1][0],j[1][1]),Aloha.getSelection().removeAllRanges();for(var i=1;i<h.length;i++){var k=Aloha.createRange();k.setStart(j[2*i][0],j[2*i][1]),k.setEnd(j[2*i+1][0],j[2*i+1][1]),Aloha.getSelection().addRange(k)}k&&(e=k)}}function nb(a,b,c){if(O(a,b.toUpperCase()))return a;if(!a.parentNode)return a;var d=a.ownerDocument.createElement(b);a.parentNode.insertBefore(d,a);for(var e=0;e<a.attributes.length;e++)typeof d.setAttributeNS=="function"?d.setAttributeNS(a.attributes[e].namespaceURI,a.attributes[e].name,a.attributes[e].value):d.setAttribute(a.attributes[e].name,a.attributes[e].value);while(a.childNodes.length)mb(a.firstChild,d,d.childNodes.length,c);return a.parentNode.removeChild(a),c.startContainer===a&&c.setStart(d,c.startOffset),c.endContainer===a&&c.setEnd(d,c.endOffset),d}function ob(a){var b=a.previousSibling;if(!b)return;while(b.hasChildNodes())b=b.lastChild;while(cb(b)&&!Z(b)&&b!=a.parentNode)b=j(b);U(b)&&Z(b)&&b.parentNode.removeChild(b)}function pb(a){var b=a;while(b.hasChildNodes())b=b.lastChild;while(cb(b)&&!Z(b)&&b!=a)b=j(b);U(b)&&Z(b)&&b.parentNode.removeChild(b)}function qb(a){ob(a),pb(a)}function rb(a,b,c,d){typeof b=="undefined"&&(b=function(){return!1}),typeof c=="undefined"&&(c=function(){return null});if(!a.length||!U(a[0]))return null;S(a[a.length-1])&&!O(a[a.length-1],"br")&&O(a[a.length-1].nextSibling,"br")&&a.push(a[a.length-1].nextSibling);var f;U(a[0].previousSibling)&&b(a[0].previousSibling)?f=a[0].previousSibling:U(a[a.length-1].nextSibling)&&b(a[a.length-1].nextSibling)?f=a[a.length-1].nextSibling:f=c();if(!f)return null;if(!f.parentNode){a[0].parentNode.insertBefore(f,a[0]);var g=d.startContainer,h=d.startOffset,i=d.endContainer,j=d.endOffset;g==f.parentNode&&h>=x(f)&&d.setStart(g,h+1),i==f.parentNode&&j>=x(f)&&d.setEnd(i,j+1),e&&e!==d&&(g=e.startContainer,h=e.startOffset,i=e.endContainer,j=e.endOffset,g==f.parentNode&&h>=x(f)&&e.setStart(g,h+1),i==f.parentNode&&j>=x(f)&&e.setEnd(i,j+1))}var k=a[0].parentNode;if(o(f,a[0])){!S(f)&&S(f.lastChild)&&S(a[0])&&!O(f.lastChild,"BR")&&f.appendChild(f.ownerDocument.createElement("br"));for(var l=0;l<a.length;l++)mb(a[l],f,-1,d)}else{!S(f)&&S(f.firstChild)&&S(a[a.length-1])&&!O(a[a.length-1],"BR")&&f.insertBefore(f.ownerDocument.createElement("br"),f.firstChild);for(var l=a.length-1;l>=0;l--)mb(a[l],f,0,d)}U(k)&&!k.hasChildNodes()&&k.parentNode.removeChild(k);if(U(f.nextSibling)&&b(f.nextSibling)){!S(f)&&S(f.lastChild)&&S(f.nextSibling.firstChild)&&!O(f.lastChild,"BR")&&f.appendChild(f.ownerDocument.createElement("br"));while(f.nextSibling.hasChildNodes())mb(f.nextSibling.firstChild,f,-1,d);f.parentNode.removeChild(f.nextSibling)}return qb(f),f}function tb(a){return O(a,sb)}function ub(b,c){if((a(["colgroup","table","tbody","tfoot","thead","tr"]).indexOf(c)!=-1||O(c,["colgroup","table","tbody","tfoot","thead","tr"]))&&typeof b=="object"&&b.nodeType==a.Node.TEXT_NODE&&!/^[ \t\n\f\r]*$/.test(b.data))return!1;if(a(["script","style","plaintext","xmp"]).indexOf(c)==-1&&!O(c,["script","style","plaintext","xmp"])||typeof b=="object"&&b.nodeType==a.Node.TEXT_NODE){if(typeof b!="object"||b.nodeType!=a.Node.DOCUMENT_NODE&&b.nodeType!=a.Node.DOCUMENT_FRAGMENT_NODE&&b.nodeType!=a.Node.DOCUMENT_TYPE_NODE){O(b)&&(b=b.tagName.toLowerCase());if(typeof b!="string")return!0;if(O(c)){var d=c;while(d){if(b=="a"&&O(d,"a"))return!1;if(a(P).indexOf(b)!=-1&&tb(d))return!1;if(/^h[1-6]$/.test(b)&&O(d)&&/^H[1-6]$/.test(d.tagName))return!1;d=d.parentNode}c=c.tagName.toLowerCase()}if(typeof c!="object"||c.nodeType!=a.Node.ELEMENT_NODE&&c.nodeType!=a.Node.DOCUMENT_FRAGMENT_NODE){if(typeof c!="string")return!1;switch(c){case"colgroup":return b=="col";case"table":return a(["caption","col","colgroup","tbody","td","tfoot","th","thead","tr"]).indexOf(b)!=-1;case"tbody":case"thead":case"tfoot":return a(["td","th","tr"]).indexOf(b)!=-1;case"tr":return a(["td","th"]).indexOf(b)!=-1;case"dl":return a(["dt","dd"]).indexOf(b)!=-1;case"dir":case"ol":case"ul":return a(["dir","li","ol","ul"]).indexOf(b)!=-1;case"hgroup":return/^h[1-6]$/.test(b)}if(a(["body","caption","col","colgroup","frame","frameset","head","html","tbody","td","tfoot","th","thead","tr"]).indexOf(b)!=-1)return!1;if(a(["dd","dt"]).indexOf(b)!=-1&&c!="dl")return!1;if(b=="li"&&c!="ol"&&c!="ul")return!1;var e=[[["a"],["a"]],[["dd","dt"],["dd","dt"]],[["h1","h2","h3","h4","h5","h6"],["h1","h2","h3","h4","h5","h6"]],[["li"],["li"]],[["nobr"],["nobr"]],[sb,P],[["td","th"],["caption","col","colgroup","tbody","td","tfoot","th","thead","tr"]]];for(var f=0;f<e.length;f++)if(a(e[f][0]).indexOf(c)!=-1&&a(e[f][1]).indexOf(b)!=-1)return!1;return!0}return!0}return!1}return!1}function vb(b,c){return c.collapsed?!1:B(b,c)?!0:b==c.startContainer&&b.nodeType==a.Node.TEXT_NODE&&y(b)!=c.startOffset?!0:b==c.endContainer&&b.nodeType==a.Node.TEXT_NODE&&c.endOffset!=0?!0:b.hasChildNodes()&&a(b.childNodes).every(function(a){return vb(a,c)})&&(!n(c.startContainer,b)||c.startContainer.nodeType!=a.Node.TEXT_NODE||c.startOffset==0)&&(!n(c.endContainer,b)||c.endContainer.nodeType!=a.Node.TEXT_NODE||c.endOffset==y(c.endContainer))?!0:!1}function wb(a,b){typeof b=="undefined"&&(b=function(){return!0});var c=a.startContainer;while(vb(c.parentNode,a))c=c.parentNode;var d=k(a.endContainer),e=[];while(o(c,d)){if(vb(c,a)&&b(c)){e.push(c),c=k(c);continue}c=i(c)}return e}function xb(a,b){typeof b=="undefined"&&(b=function(){return!0});var c=a.startContainer;while(vb(c.parentNode,a))c=c.parentNode;var d=k(a.endContainer),e=[];while(o(c,d))vb(c,a)&&b(c)&&e.push(c),c=i(c);return e}function yb(b){if(!O(b))return!1;if(a(["B","EM","I","S","SPAN","STRIKE","STRONG","SUB","SUP","U"]).indexOf(b.tagName)!=-1){if(b.attributes.length==0)return!0;if(b.attributes.length==1&&a(b).hasAttribute("style"))return!0}if(b.tagName=="FONT"||b.tagName=="A"){var c=b.attributes.length;a(b).hasAttribute("style")&&c--,b.tagName=="FONT"&&(a(b).hasAttribute("color")&&c--,a(b).hasAttribute("face")&&c--,a(b).hasAttribute("size")&&c--),b.tagName=="A"&&a(b).hasAttribute("href")&&c--;if(c==0)return!0}return!1}function zb(b){return O(b)?a(["A","B","EM","FONT","I","S","SPAN","STRIKE","STRONG","SUB","SUP","U"]).indexOf(b.tagName)==-1?!1:b.attributes.length==0?!0:b.attributes.length>1?!1:a(b).hasAttribute("style")&&g(b)==0?!0:b.tagName=="A"&&a(b).hasAttribute("href")?!0:b.tagName=="FONT"&&(a(b).hasAttribute("color")||a(b).hasAttribute("face")||a(b).hasAttribute("size"))?!0:b.tagName!="B"&&b.tagName!="STRONG"||!a(b).hasAttribute("style")||g(b)!=1||b.style.fontWeight==""?b.tagName!="I"&&b.tagName!="EM"||!a(b).hasAttribute("style")||g(b)!=1||b.style.fontStyle==""?b.tagName!="A"&&b.tagName!="FONT"&&b.tagName!="SPAN"||!a(b).hasAttribute("style")||g(b)!=1||b.style.textDecoration!=""?a(["A","FONT","S","SPAN","STRIKE","U"]).indexOf(b.tagName)==-1||!a(b).hasAttribute("style")||g(b)!=1||b.style.textDecoration!="line-through"&&b.style.textDecoration!="underline"&&b.style.textDecoration!="overline"&&b.style.textDecoration!="none"?!1:!0:!0:!0:!0:!1}function Ab(a,b,c){return b===null&&c===null?!0:typeof b!="string"||typeof c!="string"||b!=c||"equivalentValues"in f[a]?typeof b=="string"&&typeof c=="string"&&"equivalentValues"in f[a]&&f[a].equivalentValues(b,c)?!0:!1:!0}function Bb(b,c,d){if(Ab(b,c,d))return!0;if(b!="fontsize"||typeof c!="string"||typeof d!="string")return!1;var e=Bb;if(e.sizeMap===undefined){e.sizeMap={};var f=document.createElement("font");document.body.appendChild(f),a(["xx-small","small","medium","large","x-large","xx-large","xxx-large"]).forEach(function(b){f.size=t(b),e.sizeMap[b]=a.getComputedStyle(f).fontSize}),document.body.removeChild(f)}return c===e.sizeMap[d]||d===e.sizeMap[c]}function Cb(b,c){if(b.nodeType==a.Node.ELEMENT_NODE||!!b.parentNode&&b.parentNode.nodeType==a.Node.ELEMENT_NODE){if(b.nodeType!=a.Node.ELEMENT_NODE)return Cb(b.parentNode,c);if(c=="createlink"||c=="unlink"){while(b&&(!O(b)||b.tagName!="A"||!a(b).hasAttribute("href")))b=b.parentNode;return b?b.getAttribute("href"):null}if(c=="backcolor"||c=="hilitecolor"){while((a.getComputedStyle(b).backgroundColor=="rgba(0, 0, 0, 0)"||a.getComputedStyle(b).backgroundColor===""||a.getComputedStyle(b).backgroundColor=="transparent")&&b.parentNode&&b.parentNode.nodeType==a.Node.ELEMENT_NODE)b=b.parentNode;return a.getComputedStyle(b).backgroundColor=="rgba(0, 0, 0, 0)"||a.getComputedStyle(b).backgroundColor===""||a.getComputedStyle(b).backgroundColor=="transparent"?"rgb(255, 255, 255)":a.getComputedStyle(b).backgroundColor}if(c=="subscript"||c=="superscript"){var d=!1,e=!1;while(S(b)){var g=a.getComputedStyle(b).verticalAlign;O(b,"sub")?d=!0:O(b,"sup")&&(e=!0),b=b.parentNode}return d&&e?"mixed":d?"subscript":e?"superscript":null}if(c=="strikethrough"){do{if(a.getComputedStyle(b).textDecoration.indexOf("line-through")!=-1)return"line-through";b=b.parentNode}while(b&&b.nodeType==a.Node.ELEMENT_NODE);return null}if(c=="underline"){do{if(a.getComputedStyle(b).textDecoration.indexOf("underline")!=-1)return"underline";b=b.parentNode}while(b&&b.nodeType==a.Node.ELEMENT_NODE);return null}if("relevantCssProperty"in f[c])return a.getComputedStyle(b)[f[c].relevantCssProperty].toString();throw"Bug: no relevantCssProperty for "+c+" in getEffectiveCommandValue"}return null}function Db(b,c){if(c!="backcolor"&&c!="hilitecolor"||a.getComputedStyle(b).display=="inline"){if(c=="createlink"||c=="unlink")return O(b)&&b.tagName=="A"&&a(b).hasAttribute("href")?b.getAttribute("href"):null;if(c=="subscript"||c=="superscript")return O(b,"sup")?"superscript":O(b,"sub")?"subscript":null;if(c=="strikethrough"&&b.style.textDecoration!="")return b.style.textDecoration.indexOf("line-through")!=-1?"line-through":null;if(c=="strikethrough"&&O(b,["S","STRIKE"]))return"line-through";if(c=="underline"&&b.style.textDecoration!="")return b.style.textDecoration.indexOf("underline")!=-1?"underline":null;if(c=="underline"&&O(b,"U"))return"underline";var d=f[c].relevantCssProperty;if(d===null)return null;if(b.style[d]!="")return b.style[d];if(v(b.namespaceURI)&&b.tagName=="FONT"){if(d=="color"&&a(b).hasAttribute("color"))return b.color;if(d=="fontFamily"&&a(b).hasAttribute("face"))return b.face;if(d=="fontSize"&&a(b).hasAttribute("size")){var e=parseInt(b.size);return e<1&&(e=1),e>7&&(e=7),{1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[e]}}return d!="fontWeight"||b.tagName!="B"&&b.tagName!="STRONG"?d!="fontStyle"||b.tagName!="I"&&b.tagName!="EM"?null:"italic":"bold"}return null}function Eb(a,b,c,d){var e=a;while(yb(e)&&e.childNodes.length==1&&yb(e.firstChild)&&(!zb(e)||!Ab(b,Db(e,b),c)))e=e.firstChild;if(e==a||!zb(e)||!Ab(b,Db(e,b),c)||!Bb(b,Cb(e,b),c))return;while(e.hasChildNodes())mb(e.firstChild,e.parentNode,x(e),d);a.parentNode.insertBefore(e,a.nextSibling),mb(a,e,-1,d)}function Fb(b){var c=[];return a(b).forEach(function(b){a(["subscript","bold","fontname","fontsize","forecolor","hilitecolor","italic","strikethrough","underline"]).forEach(function(d){var e=b;e.nodeType!=a.Node.ELEMENT_NODE&&(e=e.parentNode);while(e&&e.nodeType==a.Node.ELEMENT_NODE&&Db(e,d)===null)e=e.parentNode;e&&e.nodeType==a.Node.ELEMENT_NODE?c.push([b,d,Db(e,d)]):c.push([b,d,null])})}),c}function Gb(b,c){a(b).forEach(function(b){var d=b[0],e=b[1],f=b[2],g=d;if(!g||g.nodeType!=a.Node.ELEMENT_NODE)g=g.parentNode;while(g&&g.nodeType==a.Node.ELEMENT_NODE&&Db(g,e)===null)g=g.parentNode;f===null&&g&&g.nodeType==a.Node.ELEMENT_NODE?Ib(d,e,null,c):(g&&g.nodeType==a.Node.ELEMENT_NODE&&!Ab(e,Db(g,e),f)||(!g||g.nodeType!=a.Node.ELEMENT_NODE)&&f!==null)&&Jb(d,e,f,c)})}function Hb(a,b,c){if(!U(a))return[];if(Db(a,b)===null)return[];if(zb(a)){var d=Array.prototype.slice.call(h(a.childNodes));for(var e=0;e<d.length;e++)mb(d[e],a.parentNode,x(a),c);return a.parentNode.removeChild(a),d}return b=="strikethrough"&&a.style.textDecoration.indexOf("line-through")!=-1&&(a.style.textDecoration=="line-through"?a.style.textDecoration="":a.style.textDecoration=a.style.textDecoration.replace("line-through",""),a.getAttribute("style")==""&&a.removeAttribute("style")),b=="underline"&&a.style.textDecoration.indexOf("underline")!=-1&&(a.style.textDecoration=="underline"?a.style.textDecoration="":a.style.textDecoration=a.style.textDecoration.replace("underline",""),a.getAttribute("style")==""&&a.removeAttribute("style")),f[b].relevantCssProperty!==null&&(a.style[f[b].relevantCssProperty]="",a.getAttribute("style")==""&&a.removeAttribute("style")),v(a.namespaceURI)&&a.tagName=="FONT"&&(b=="forecolor"&&a.removeAttribute("color"),b=="fontname"&&a.removeAttribute("face"),b=="fontsize"&&a.removeAttribute("size")),O(a,"A")&&(b=="createlink"||b=="unlink")&&a.removeAttribute("href"),Db(a,b)===null?[]:[nb(a,"span",c)]}function Ib(b,c,d,e){if(!b.parentNode||b.parentNode.nodeType!=a.Node.ELEMENT_NODE)return;if(Bb(c,Cb(b,c),d))return;var f=b.parentNode,g=[];while(U(f)&&f.nodeType==a.Node.ELEMENT_NODE&&!Bb(c,Cb(f,c),d))g.push(f),f=f.parentNode;if(!g.length)return;var i=Db(g[g.length-1],c);if(i===null&&i!=d)return;if(d!==null&&!Bb(c,Cb(g[g.length-1].parentNode,c),d))return;while(g.length){var f=g.pop();Db(f,c)!==null&&(i=Db(f,c));var j=Array.prototype.slice.call(h(f.childNodes));Db(f,c)!==null&&Hb(f,c,e);for(var k=0;k<j.length;k++){var l=j[k];if(l==b)continue;if(l.nodeType==a.Node.ELEMENT_NODE&&Db(l,c)!==null&&!Ab(c,i,Db(l,c)))continue;if(l==g[g.length-1])continue;Jb(l,c,i,e)}}}function Jb(c,e,g,h){if(!c.parentNode)return;if(g===null)return;ub(c,"span")&&(Eb(c.previousSibling,e,g,h),Eb(c.nextSibling,e,g,h),rb([c],function(a){return zb(a)&&Ab(e,Db(a,e),g)&&Bb(e,Cb(a,e),g)},function(){return null},h));if(Bb(e,Cb(c,e),g))return;if(!ub(c,"span")){var i=[];for(var j=0;j<c.childNodes.length;j++){if(c.childNodes[j].nodeType==a.Node.ELEMENT_NODE){var k=Db(c.childNodes[j],e);if(k!==null&&!Ab(e,g,k))continue}i.push(c.childNodes[j])}for(var j=0;j<i.length;j++)Jb(i[j],e,g,h);return}if(Bb(e,Cb(c,e),g))return;var l=null;d||(e=="bold"&&(g=="bold"||g=="700")&&(l=c.ownerDocument.createElement("b")),e=="italic"&&g=="italic"&&(l=c.ownerDocument.createElement("i")),e=="strikethrough"&&g=="line-through"&&(l=c.ownerDocument.createElement("s")),e=="underline"&&g=="underline"&&(l=c.ownerDocument.createElement("u")),e=="forecolor"&&F(g)&&(l=c.ownerDocument.createElement("span"),b(l).css("color",F(g))),e=="fontname"&&(l=c.ownerDocument.createElement("font"),l.face=g));if(e=="createlink"||e=="unlink"){l=c.ownerDocument.createElement("a"),l.setAttribute("href",g);var m=c.parentNode;while(m)O(m,"A")&&(m=nb(m,"span",h)),m=m.parentNode}e=="fontsize"&&a(["xx-small","small","medium","large","x-large","xx-large","xxx-large"]).indexOf(g)!=-1&&(!d||g=="xxx-large")&&(l=c.ownerDocument.createElement("font"),l.size=t(g)),(e=="subscript"||e=="superscript")&&g=="subscript"&&(l=c.ownerDocument.createElement("sub")),(e=="subscript"||e=="superscript")&&g=="superscript"&&(l=c.ownerDocument.createElement("sup")),l||(l=c.ownerDocument.createElement("span")),c.parentNode.insertBefore(l,c);var n=f[e].relevantCssProperty;n!==null&&!Bb(e,Cb(l,e),g)&&(l.style[n]=g),e=="strikethrough"&&g=="line-through"&&Cb(l,"strikethrough")!="line-through"&&(l.style.textDecoration="line-through"),e=="underline"&&g=="underline"&&Cb(l,"underline")!="underline"&&(l.style.textDecoration="underline"),mb(c,l,l.childNodes.length,h);if(c.nodeType==a.Node.ELEMENT_NODE&&!Ab(e,Cb(c,e),g)){mb(c,l.parentNode,x(l),h),l.parentNode.removeChild(l);var i=[];for(var j=0;j<c.childNodes.length;j++){if(c.childNodes[j].nodeType==a.Node.ELEMENT_NODE){var k=Db(c.childNodes[j],e);if(k!==null&&!Ab(e,g,k))continue}i.push(c.childNodes[j])}for(var j=0;j<i.length;j++)Jb(i[j],e,g,h)}}function Kb(b,c,d){d=d||fb();if(!a(xb(d)).filter(function(b){return b.nodeType==a.Node.TEXT_NODE},!0).some(U)){"inlineCommandActivatedValues"in f[b]&&hb(b,a(f[b].inlineCommandActivatedValues).indexOf(c)!=-1,d),b=="subscript"&&ib("superscript",d),b=="superscript"&&ib("subscript",d),c===null?lb(b,d):"value"in f[b]&&kb(b,c,d);return}if(U(d.startContainer)&&d.startContainer.nodeType==a.Node.TEXT_NODE&&d.startOffset!=0&&d.startOffset!=y(d.startContainer)){var e=d.startContainer.splitText(d.startOffset),g=Aloha.createRange();if(d.startContainer==d.endContainer){var h=d.endOffset-d.startOffset;g.setEnd(e,h),d.setEnd(e,h)}g.setStart(e,0),Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(g),d.setStart(e,0)}if(U(d.endContainer)&&d.endContainer.nodeType==a.Node.TEXT_NODE&&d.endOffset!=0&&d.endOffset!=y(d.endContainer)){var i=d,j=[i.startContainer,i.startOffset],k=[i.endContainer,i.endOffset];i.endContainer.splitText(i.endOffset),i.setStart(j[0],j[1]),i.setEnd(k[0],k[1]),Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(i)}a(xb(fb(),function(b){return U(b)&&b.nodeType==a.Node.ELEMENT_NODE})).forEach(function(a){Hb(a,b,d)}),a(xb(d,U)).forEach(function(a){Ib(a,b,c,d),Jb(a,b,c,d)})}function Lb(b){b=a(b).trim();if(/^[-+]?[0-9]+(\.[0-9]+)?([eE][-+]?[0-9]+)?$/.test(b)){var c;b[0]=="+"?(b=b.slice(1),c="relative-plus"):b[0]=="-"?(b=b.slice(1),c="relative-minus"):c="absolute";var d=parseInt(b);c=="relative-plus"&&(d+=3),c=="relative-minus"&&(d=3-d),d<1&&(d=1),d>7&&(d=7),b={1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[d]}return b}function Mb(b){b=Lb(b);if(a(["xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large"]).indexOf(b)==-1&&!/^[0-9]+(\.[0-9]+)?(cm|mm|in|pt|pc|px)$/.test(b))return null;var c=document.createElement("font");document.body.appendChild(c),b=="xxx-large"?c.size=7:c.style.fontSize=b;var d=parseInt(a.getComputedStyle(c).fontSize);document.body.removeChild(c);var e=1;while(e<7){var c=document.createElement("font");c.size=e,document.body.appendChild(c);var f=parseInt(a.getComputedStyle(c).fontSize);c.size=1+e;var g=parseInt(a.getComputedStyle(c).fontSize);document.body.removeChild(c);var h=(g+f)/2;if(d<h)return String(e);e++}return"7"}function Nb(a){if(!O(a))return!1;if(a.tagName=="BLOCKQUOTE")return!0;if(a.tagName!="DIV")return!1;if(typeof a.style.length!="undefined"){for(var b=0;b<a.style.length;b++)if(/^(-[a-z]+-)?margin/.test(a.style[b]))return!0}else for(var c in a.style)if(/^(-[a-z]+-)?margin/.test(c)&&a.style[c]&&a.style[c]!==0)return!0;return!1}function Ob(b){if(!Nb(b))return!1;if(b.tagName!="BLOCKQUOTE"&&b.tagName!="DIV")return!1;for(var c=0;c<b.attributes.length;c++)if(!v(b.attributes[c].namespaceURI)||a(["style","class","dir"]).indexOf(b.attributes[c].name)==-1)return!1;if(typeof b.style.length!="undefined"){for(var c=0;c<b.style.length;c++)if(!/^(-[a-z]+-)?(margin|border|padding)/.test(b.style[c]))return!1}else for(var d in b.style)if(!/^(-[a-z]+-)?(margin|border|padding)/.test(d)&&b.style[d]&&b.style[d]!==0&&b.style[d]!=="false")return!1;return!0}function Pb(a){return O(a,["address","div","h1","h2","h3","h4","h5","h6","listing","p","pre","xmp"])}function Qb(a){return Pb(a)||O(a,["li","dt","dd"])}function Sb(c,d){if(!U(c))return;if(a(q(c)).every(function(a){return!X(c,a)||!ub(c,a)})&&!O(c,Rb)){if(O(c,["dd","dt"])){rb([c],function(a){return O(a,"dl")&&!a.attributes.length},function(){return document.createElement("dl")},d);return}if(!Q(c))return;c=nb(c,Rb,d),Sb(c,d);var e=r(c);for(var f=0;f<e.length;f++)Sb(e[f],d);return}var g=Fb([c]);while(!ub(c,c.parentNode)){for(var f=c.parentNode.childNodes.length-1;f>=0;--f)c.parentNode.childNodes[f].nodeType==3&&c.parentNode.childNodes[f].data.length==0&&(c.parentNode.removeChild(c.parentNode.childNodes[f]),d.startContainer==c.parentNode&&d.startOffset>f&&d.startOffset--,d.endContainer==
c.parentNode&&d.endOffset>f&&d.endOffset--);if(c.parentNode.childNodes.length==1){var h=!1,i=!1;d.startContainer===c.parentNode&&(h=!0),d.endContainer===c.parentNode&&(i=!0),b(c).unwrap(),h&&(d.startContainer=c.parentNode,d.startOffset=d.startOffset+x(c)),i&&(d.endContainer=c.parentNode,d.endOffset=d.endOffset+x(c))}else fc([c],d)}Gb(g,d)}function Tb(b,c){if(!O(b,"LI")||!U(b)||!U(b.parentNode))return;var d=null;while(a(b.childNodes).some(function(a){return O(a,["OL","UL"])})){var e=b.lastChild;O(e,["OL","UL"])||!d&&e.nodeType==a.Node.TEXT_NODE&&/^[ \t\n\f\r]*$/.test(e.data)?(d=null,mb(e,b.parentNode,1+x(b),c)):(d||(d=b.ownerDocument.createElement("li"),b.parentNode.insertBefore(d,b.nextSibling)),mb(e,d,0,c))}}function Ub(a,c){if(!O(a,["OL","UL"])||!U(a))return;var d=b(a);d.children("ol,ul").each(function(a,b){O(b.previousSibling,"LI")&&mb(b,b.previousSibling,b.previousSibling.childNodes.length,c)})}function Vb(){var b=$b(fb()),c=C(b,function(a){return U(a)&&!Nb(a)&&(O(a,["ol","ul"])||O(a.parentNode,["ol","ul"])||ub(a,"li"))});if(!c.length)return"none";if(a(c).every(function(a){return O(a,"ol")||O(a.parentNode,"ol")||O(a.parentNode,"li")&&O(a.parentNode.parentNode,"ol")})&&!a(c).some(function(a){return O(a,"ul")||"querySelector"in a&&a.querySelector("ul")}))return"ol";if(a(c).every(function(a){return O(a,"ul")||O(a.parentNode,"ul")||O(a.parentNode,"li")&&O(a.parentNode.parentNode,"ul")})&&!a(c).some(function(a){return O(a,"ol")||"querySelector"in a&&a.querySelector("ol")}))return"ul";var d=a(c).some(function(a){return O(a,"ol")||O(a.parentNode,"ol")||"querySelector"in a&&a.querySelector("ol")||O(a.parentNode,"li")&&O(a.parentNode.parentNode,"ol")}),e=a(c).some(function(a){return O(a,"ul")||O(a.parentNode,"ul")||"querySelector"in a&&a.querySelector("ul")||O(a.parentNode,"li")&&O(a.parentNode.parentNode,"ul")});return d&&e?"mixed":d?"mixed ol":e?"mixed ul":"none"}function Wb(b){while(b&&b.nodeType!=a.Node.ELEMENT_NODE||b.nodeType==a.Node.ELEMENT_NODE&&a(["inline","none"]).indexOf(a.getComputedStyle(b).display)!=-1)b=b.parentNode;if(!b||b.nodeType!=a.Node.ELEMENT_NODE)return"left";var c=a.getComputedStyle(b).textAlign.replace(/^-(moz|webkit)-/,"").replace(/^auto$/,"start");return c=="start"?w(b)=="ltr"?"left":"right":c=="end"?w(b)=="ltr"?"right":"left":a(["center","justify","left","right"]).indexOf(c)!=-1?c:"left"}function Xb(a,b){return!a.parentNode&&b==0||0<=b-1&&b-1<a.childNodes.length&&bb(a.childNodes[b-1])&&(R(a.childNodes[b-1])||O(a.childNodes[b-1],"br"))}function Yb(a,b){return!a.parentNode&&b==y(a)||b<a.childNodes.length&&bb(a.childNodes[b])&&R(a.childNodes[b])}function Zb(a,b){return Xb(a,b)||Yb(a,b)}function $b(b){var c=b.startContainer,d=b.startOffset,e=b.endContainer,f=b.endOffset,g=a(q(c).concat(c)).filter(function(a){return O(a,"li")}).slice(-1);g.length&&(d=x(g[0]),c=g[0].parentNode);if(!Xb(c,d))do d==0?(d=x(c),c=c.parentNode):d--;while(!Zb(c,d));while(d==0&&c.parentNode)d=x(c),c=c.parentNode;var g=a(q(e).concat(e)).filter(function(a){return O(a,"li")}).slice(-1);g.length&&(f=1+x(g[0]),e=g[0].parentNode);if(!Yb(e,f))do f==y(e)?(f=1+x(e),e=e.parentNode):f++;while(!Zb(e,f));while(f==y(e)&&e.parentNode)f=1+x(e),e=e.parentNode;var h=Aloha.createRange();return h.setStart(c,d),h.setEnd(e,f),h}function _b(a){var b=0;while(!Zb(a,b)){if(0<=b-1&&b-1<a.childNodes.length&&bb(a.childNodes[b-1]))return!1;b==0||!a.hasChildNodes()?(b=x(a),a=a.parentNode):(a=a.childNodes[b-1],b=y(a))}return!0}function ac(a){var b=y(a);while(!Zb(a,b)){if(b<a.childNodes.length&&bb(a.childNodes[b]))return!1;b==y(a)||!a.hasChildNodes()?(b=1+x(a),a=a.parentNode):(a=a.childNodes[b],b=0)}return!0}function bc(b){var c=[];return jb("createlink",b)!==undefined&&c.push(["createlink",jb("createlink",b)]),a(["bold","italic","strikethrough","subscript","superscript","underline"]).forEach(function(a){gb(a,b)!==undefined&&c.push([a,gb(a,b)])}),a(["fontname","fontsize","forecolor","hilitecolor"]).forEach(function(a){jb(a,b)!==undefined&&c.push([a,jb(a,b)])}),c}function cc(b){var c=[],d=a(xb(b)).filter(function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE})[0];return d?(c.push(["createlink",f.createlink.value(b)]),a(["bold","italic","strikethrough","subscript","superscript","underline"]).forEach(function(b){a(f[b].inlineCommandActivatedValues).indexOf(Cb(d,b))!=-1?c.push([b,!0]):c.push([b,!1])}),a(["fontname","fontsize","forecolor","hilitecolor"]).forEach(function(a){c.push([a,f[a].value(b)])}),c.push("fontsize",Cb(d,"fontsize")),c):c}function dc(b,c){var d=a(xb(c)).filter(function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE})[0];if(d)for(var e=0;e<b.length;e++){var f=b[e][0],g=b[e][1];if(typeof g=="boolean"&&L(f)!=g)I(f);else if(typeof g=="string"&&f!="fontsize"&&!Ab(f,N(f),g))I(f,!1,g);else{if(typeof g!="string"||f!="fontsize"||!(jb("fontsize",c)!==undefined&&jb("fontsize",c)!==g||jb("fontsize",c)===undefined&&!Bb(f,Cb(d,"fontsize"),g)))continue;I("fontsize",!1,g)}d=a(xb(c)).filter(function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE})[0]||d}else for(var e=0;e<b.length;e++){var f=b[e][0],g=b[e][1];typeof g=="boolean"&&hb(f,g,c),typeof g=="string"&&kb(f,g,c)}}function ec(){var b,c={};arguments.length<3?b=arguments[0]:(b=Aloha.createRange(),b.setStart(arguments[0],arguments[1]),b.setEnd(arguments[2],arguments[3])),arguments.length==2&&(c=arguments[1]),arguments.length==5&&(c=arguments[4]);var d="blockMerging"in c?!!c.blockMerging:!0,e="stripWrappers"in c?!!c.stripWrappers:!0;if(!b)return;var f=b.startContainer,g=b.startOffset,i=b.endContainer,j=b.endOffset;while(f.hasChildNodes()){if(g==y(f)&&X(f,f.parentNode)&&S(f)){g=1+x(f),f=f.parentNode;continue}if(g==y(f))break;var k=f.childNodes[g];if(R(k)||k.nodeType==a.Node.ELEMENT_NODE&&!k.hasChildNodes()||k.nodeType!=a.Node.ELEMENT_NODE&&k.nodeType!=a.Node.TEXT_NODE)break;f=k,g=0}while(i.hasChildNodes()){if(j==0&&X(i,i.parentNode)&&S(i)){j=x(i),i=i.parentNode;continue}if(j==0)break;var k=i.childNodes[j-1];if(R(k)||k.nodeType==a.Node.ELEMENT_NODE&&!k.hasChildNodes()||k.nodeType!=a.Node.ELEMENT_NODE&&k.nodeType!=a.Node.TEXT_NODE)break;i=k,j=y(k)}if(z(i,j,f,g)!=="after"){b.setEnd(b.startContainer,b.startOffset);return}f.nodeType!=a.Node.TEXT_NODE||g!=0||f==i,i.nodeType==a.Node.TEXT_NODE&&j==y(i)&&f!=i&&(j=1+x(i),i=i.parentNode),b.setStart(f,g),b.setEnd(i,j);var m=b.startContainer;while(X(m,m.parentNode)&&S(m))m=m.parentNode;if(!R(m)&&!T(m)||!ub("span",m)||O(m,["td","th"]))m=null;var o=b.endContainer;while(X(o,o.parentNode)&&S(o))o=o.parentNode;if(!R(o)&&!T(o)||!ub("span",o)||O(o,["td","th"]))o=null;var p=cc(b);if(f==i&&U(f)&&f.nodeType==a.Node.TEXT_NODE){var q=f.parentNode;f.deleteData(g,j-g),ic(f,g),b.setEnd(b.startContainer,b.startOffset),dc(p,b),(U(q)||T(q))&&!S(q)&&q.offsetHeight===0&&q.appendChild(nc());return}U(f)&&f.nodeType==a.Node.TEXT_NODE&&f.deleteData(g,y(f)-g);var r=C(b,function(a){return U(a)&&!O(a,["thead","tbody","tfoot","tr","th","td"])});for(var s=0;s<r.length;s++){var t=r[s],q=t.parentNode;q.removeChild(t);if(e||!l(q,f)&&q!=f)while(U(q)&&S(q)&&y(q)==0){var u=q.parentNode;u.removeChild(q),q=u}(U(q)||T(q))&&!S(q)&&!q.hasChildNodes()&&q.offsetHeight===0&&q.appendChild(nc())}U(i)&&i.nodeType==a.Node.TEXT_NODE&&i.deleteData(0,j),ic(b.startContainer,b.startOffset),ic(b.endContainer,b.endOffset);if(!d||!m||!o||!X(m,o)||m==o){b.setEnd(b.startContainer,b.startOffset),dc(p,b);return}m.children.length==1&&db(m.firstChild)&&m.removeChild(m.firstChild),o.children.length==1&&db(o.firstChild)&&o.removeChild(o.firstChild);if(l(m,o)){var k=o;while(k.parentNode!=m)k=k.parentNode;b.setStart(m,x(k)),b.setEnd(m,x(k));if(!o.hasChildNodes()){while(U(o)&&o.parentNode.childNodes.length==1&&o.parentNode!=m){var q=o;q.removeChild(o),o=q}U(o)&&!S(o)&&S(o.previousSibling)&&S(o.nextSibling)&&o.parentNode.insertBefore(document.createElement("br"),o.nextSibling),U(o)&&o.parentNode.removeChild(o),dc(p,b);return}if(!S(o.firstChild)){dc(p,b);return}var v=[];v.push(o.firstChild);while(!O(v[v.length-1],"br")&&S(v[v.length-1].nextSibling))v.push(v[v.length-1].nextSibling);var w=Fb(v);while(v[0].parentNode!=m)fc(v,b);U(v[0].previousSibling)&&O(v[0].previousSibling,"br")&&v[0].parentNode.removeChild(v[0].previousSibling)}else if(n(m,o)){b.setStart(m,y(m)),b.setEnd(m,y(m));var k=m;while(k.parentNode!=o)k=k.parentNode;S(k.nextSibling)&&O(m.lastChild,"br")&&m.removeChild(m.lastChild);var A=[];k.nextSibling&&!O(k.nextSibling,"br")&&!R(k.nextSibling)&&A.push(k.nextSibling),A.length&&A[A.length-1].nextSibling&&!O(A[A.length-1].nextSibling,"br")&&!R(A[A.length-1].nextSibling)&&A.push(A[A.length-1].nextSibling);var w=Fb(A);a(A).forEach(function(a){mb(a,m,-1,b)}),O(k.nextSibling,"br")&&k.parentNode.removeChild(k.nextSibling)}else{b.setStart(m,y(m)),b.setEnd(m,y(m)),S(o.firstChild)&&O(m.lastChild,"br")&&m.removeChild(m.lastChild);var w=Fb([].slice.call(h(o.childNodes)));while(o.hasChildNodes())mb(o.firstChild,m,-1,b);while(!o.hasChildNodes()){var q=o.parentNode;q.removeChild(o),o=q}}Gb(w,b),!m.hasChildNodes()&&m.offsetHeight==0&&m.appendChild(nc()),dc(p,b)}function fc(b,c){var d=b[0].parentNode;if(!U(d)||!d.parentNode)return;a(b).indexOf(d.firstChild)!=-1&&ob(d);var e=a(b).indexOf(d.firstChild)!=-1&&_b(d),f=a(b).indexOf(d.lastChild)!=-1&&ac(d);if(a(b).indexOf(d.firstChild)==-1&&a(b).indexOf(d.lastChild)!=-1){for(var g=b.length-1;g>=0;g--)mb(b[g],d.parentNode,1+x(d),c);f&&!ac(b[b.length-1])&&b[b.length-1].parentNode.insertBefore(document.createElement("br"),b[b.length-1].nextSibling),pb(d);return}if(a(b).indexOf(d.firstChild)==-1){var h=d.cloneNode(!1);d.removeAttribute("id"),d.parentNode.insertBefore(h,d);while(b[0].previousSibling)mb(d.firstChild,h,h.childNodes.length,c)}for(var g=0;g<b.length;g++)mb(b[g],d.parentNode,x(d),c);e&&!_b(b[0])&&b[0].parentNode.insertBefore(document.createElement("br"),b[0]),S(b[b.length-1])&&!O(b[b.length-1],"br")&&O(d.firstChild,"br")&&!S(d)&&d.removeChild(d.firstChild),d.hasChildNodes()?ob(d):(d.parentNode===c.startContainer&&d.parentNode===c.endContainer&&c.startContainer===c.endContainer&&c.startOffset===c.endOffset&&d.parentNode.childNodes.length===c.startOffset&&(c.startOffset=d.parentNode.childNodes.length-1,c.endOffset=c.startOffset),d.parentNode.removeChild(d),f&&!ac(b[b.length-1])&&b[b.length-1].parentNode.insertBefore(document.createElement("br"),b[b.length-1].nextSibling)),!b[b.length-1].nextSibling&&b[b.length-1].parentNode&&pb(b[b.length-1].parentNode)}function gc(a,b){a.hasChildNodes()?fc([].slice.call(h(a.childNodes)),b):a.parentNode.removeChild(a)}function hc(a,b,c){if(a==0)return"";if(a==1&&!b&&!c)return" ";if(a==1)return" ";var d="",e;b?e="  ":e="  ";while(a>3)d+=e,a-=2;return a==3?d+=!b&&!c?"   ":b&&!c?"   ":!b&&c?"   ":b&&c?"   ":"impossible":d+=!b&&!c?"  ":b&&!c?"  ":!b&&c?"  ":b&&c?"  ":"impossible",d}function ic(b,c){if(!U(b)&&!T(b))return;var d=b,e=c;for(;;)if(0<=e-1&&X(d,d.childNodes[e-1]))d=d.childNodes[e-1],e=y(d);else if(e==0&&!_b(d)&&X(d,d.parentNode))e=x(d),d=d.parentNode;else{if(d.nodeType!=a.Node.TEXT_NODE||a(["pre","pre-wrap"]).indexOf(a.getComputedStyle(d.parentNode).whiteSpace)!=-1||e==0||!/[ \xa0]/.test(d.data[e-1]))break;e--}var f=d,g=e,h=0,i=!1;for(;;)if(g<f.childNodes.length&&X(f,f.childNodes[g]))f=f.childNodes[g],g=0;else if(g==y(f)&&!ac(f)&&X(f,f.parentNode))g=1+x(f),f=f.parentNode;else{if(f.nodeType!=a.Node.TEXT_NODE||a(["pre","pre-wrap"]).indexOf(a.getComputedStyle(f.parentNode).whiteSpace)!=-1||g==y(f)||!/[ \xa0]/.test(f.data[g]))break;if(i&&" "==f.data[g]){f.deleteData(g,1);continue}i=" "==f.data[g],g++,h++}var j=hc(h,e==0&&_b(d),g==y(f)&&ac(f));while(z(d,e,f,g)=="before")if(e<d.childNodes.length)d=d.childNodes[e],e=0;else if(d.nodeType!=a.Node.TEXT_NODE||e==y(d))e=1+x(d),d=d.parentNode;else{var k=j[0];j=j.slice(1),k!=d.data[e]&&(d.insertData(e,k),d.deleteData(e+1,1)),e++}}function jc(a,b){if(!a.length)return;var c=a[0];if(O(c.parentNode,["OL","UL"])){var d=c.parentNode.tagName;rb(a,function(a){return O(a,d)},function(){return c.ownerDocument.createElement(d)},b);return}var e=rb(a,function(a){return Ob(a)},function(){return c.ownerDocument.createElement("blockquote")},b);Sb(e,b)}function kc(b,c){if(!U(b))return;if(Ob(b)){gc(b,c);return}if(Nb(b)){b.removeAttribute("class"),b.removeAttribute("dir"),b.style.margin="",b.style.padding="",b.style.border="",b.getAttribute("style")==""&&b.removeAttribute("style"),nb(b,"div",c);return}var d=b.parentNode,e=[];while(U(d)&&d.nodeType==a.Node.ELEMENT_NODE&&!Ob(d)&&!O(d,["ol","ul"]))e.push(d),d=d.parentNode;if(!U(d)||!Ob(d)){d=b.parentNode,e=[];while(U(d)&&d.nodeType==a.Node.ELEMENT_NODE&&!Nb(d)&&!O(d,["ol","ul"]))e.push(d),d=d.parentNode}if(O(b,["OL","UL"])&&(!U(d)||!Nb(d))){b.removeAttribute("reversed"),b.removeAttribute("start"),b.removeAttribute("type");var f=[].slice.call(h(b.childNodes));if(b.attributes.length&&!O(b.parentNode,["OL","UL"]))nb(b,"div",c);else{var g=Fb([].slice.call(h(b.childNodes)));gc(b,c),Gb(g,c)}for(var i=0;i<f.length;i++)Sb(f[i],c);return}if(!U(d)||!Nb(d))return;e.push(d);var j=d;while(e.length){d=e.pop();var k=b.parentNode==d?b:e[e.length-1];S(k)&&!O(k,"BR")&&O(k.nextSibling,"BR")&&k.parentNode.removeChild(k.nextSibling);var l=[].slice.call(h(d.childNodes),0,x(k)),m=[].slice.call(h(d.childNodes),1+x(k));jc(l,c),jc(m,c)}kc(j,c)}function lc(b,c){var d=Vb()==b?"disable":"enable";b=b.toUpperCase();var e=b=="OL"?"UL":"OL",f=[];(function(){for(var a=c.endContainer;a!=c.commonAncestorContainer;a=a.parentNode)O(a,"li")&&f.unshift(a);for(var a=c.startContainer;a;a=a.parentNode)O(a,"li")&&f.unshift(a)})(),a(f).forEach(function(a){Tb(a,c)});var g=$b(c);d=="enable"&&a(D(g,function(a){return U(a)&&O(a,e)})).forEach(function(a){if(U(a.previousSibling)&&O(a.previousSibling,b)||U(a.nextSibling)&&O(a.nextSibling,b)){var d=[].slice.call(h(a.childNodes)),e=Fb(d);fc(d,c),rb(d,function(a){return O(a,b)},function(){return null},c),Gb(e,c)}else nb(a,b,c)});var i=C(g,function(a){return U(a)&&!Nb(a)&&(O(a,["OL","UL"])||O(a.parentNode,["OL","UL"])||ub(a,"li"))});d=="enable"&&(i=a(i).filter(function(a){return!O(a,["ol","ul"])||O(a.parentNode,["ol","ul"])}));if(d=="disable")while(i.length){var j=[];j.push(i.shift());if(O(j[0],b)){kc(j[0],c);continue}while(i.length&&i[0]==j[j.length-1].nextSibling&&!O(i[0],b))j.push(i.shift());var k=Fb(j);fc(j,c);for(var l=0;l<j.length;l++)Sb(j[l],c);Gb(k,c)}else while(i.length){var j=[];while(!j.length||i.length&&i[0]==j[j.length-1].nextSibling)if(O(i[0],["p","div"]))j.push(nb(i[0],"li",c)),i.shift();else if(O(i[0],["li","ol","ul"]))j.push(i.shift());else{var m=[];while(!m.length||i.length&&i[0]==m[m.length-1].nextSibling&&S(i[0])&&S(m[m.length-1])&&!O(m[m.length-1],"br"))m.push(i.shift());j.push(rb(m,undefined,function(){return document.createElement("li")},c))}if(O(j[0].parentNode,b)||a(j).every(function(a){return O(a,["ol","ul"])}))continue;if(O(j[0].parentNode,e)){var k=Fb(j);fc(j,c),rb(j,function(a){return O(a,b)},function(){return document.createElement(b)},c),Gb(k,c);continue}Sb(rb(j,function(a){return O(a,b)},function(){if(!U(j[0].parentNode)||!Ob(j[0].parentNode)||!U(j[0].parentNode.previousSibling)||!O(j[0].parentNode.previousSibling,b))return document.createElement(b);var a=j[0].parentNode.previousSibling;return Tb(a.lastChild,c),(!U(a.lastChild)||!O(a.lastChild,b))&&a.appendChild(document.createElement(b)),a.lastChild},c),c)}}function mc(b,c){var d=$b(c),f=D(d,function(b){return b.nodeType==a.Node.ELEMENT_NODE&&U(b)&&(a(b).hasAttribute("align")||b.style.textAlign!=""||O(b,"center"))});for(var h=0;h<f.length;h++){var i=f[h];i.removeAttribute("align"),i.style.textAlign="",i.getAttribute("style")==""&&i.removeAttribute("style"),O(i,["div","span","center"])&&!i.attributes.length&&gc(i,c),O(i,"center")&&i.attributes.length&&nb(i,"div",c)}d=$b(e);var j=[];j=C(d,function(a){return U(a)&&ub(a,"div")&&Wb(a)!=b});while(j.length){var k=[];k.push(j.shift());while(j.length&&j[0]==k[k.length-1].nextSibling)k.push(j.shift());rb(k,function(c){return O(c,"div")&&a(c.attributes).every(function(a){return a.name=="align"&&a.value.toLowerCase()==b||a.name=="style"&&g(c)==1&&c.style.textAlign==b})},function(){var a=document.createElement("div");return a.setAttribute("style","text-align: "+b),a},c)}}function nc(){var a=document.createElement("br");return a.setAttribute("class","aloha-end-br"),a}var c="http://www.w3.org/1999/xhtml",d=!1,e=null,f={},G=0,P=["address","article","aside","blockquote","caption","center","col","colgroup","dd","details","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","listing","menu","nav","ol","p","plaintext","pre","section","summary","table","tbody","td","tfoot","th","thead","tr","ul","xmp"],gb,hb,ib,jb,kb,lb;(function(){function d(d){if(!c||c.startContainer!=d.startContainer||c.endContainer!=d.endContainer||c.startOffset!=d.startOffset||c.endOffset!=d.endOffset)a={},b={},c=d.cloneRange()}var a={},b={},c=null;gb=function(b,c){return d(c),a[b]},hb=function(b,c,e){d(e),a[b]=c},ib=function(b,c){d(c),delete a[b]},jb=function(a,c){return d(c),b[a]},kb=function(a,c,e){d(e),b[a]=c,a=="backcolor"?b.hilitecolor=c:a=="hilitecolor"&&(b.backcolor=c)},lb=function(a,c){d(c),delete b[a],a=="backcolor"?delete b.hilitecolor:a=="hilitecolor"&&delete b.backcolor}})();var sb=["a","abbr","b","bdi","bdo","cite","code","dfn","em","h1","h2","h3","h4","h5","h6","i","kbd","mark","p","pre","q","rp","rt","ruby","s","samp","small","span","strong","sub","sup","u","var","acronym","listing","strike","xmp","big","blink","font","marquee","nobr","tt"];f.backcolor={action:function(a){/^([0-9a-fA-F]{3}){1,2}$/.test(a)&&(a="#"+a);if(!/^(rgba?|hsla?)\(.*\)$/.test(a)&&!F(a)&&a.toLowerCase()!="transparent")return;Kb("backcolor",a)},standardInlineValueCommand:!0,relevantCssProperty:"backgroundColor",equivalentValues:function(a,b){return E(a)===E(b)}},f.bold={action:function(a,b){L("bold",b)?Kb("bold","normal",b):Kb("bold","bold",b)},inlineCommandActivatedValues:["bold","600","700","800","900"],relevantCssProperty:"fontWeight",equivalentValues:function(a,b){return a==b||a=="bold"&&b=="700"||a=="700"&&b=="bold"||a=="normal"&&b=="400"||a=="400"&&b=="normal"}},f.createlink={action:function(b){if(b==="")return;a(xb(fb())).forEach(function(c){a(q(c)).forEach(function(c){U(c)&&O(c,"a")&&a(c).hasAttribute("href")&&c.setAttribute("href",b)})}),Kb("createlink",b)},standardInlineValueCommand:!0},f.fontname={action:function(a){Kb("fontname",a)},standardInlineValueCommand:!0,relevantCssProperty:"fontFamily"},f.fontsize={action:function(b){if(b==="")return;b=Lb(b);if(a(["xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large"]).indexOf(b)==-1&&!/^[0-9]+(\.[0-9]+)?(cm|mm|in|pt|pc)$/.test(b))return;Kb("fontsize",b)},indeterm:function(){return a(xb(fb(),function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE})).map(function(a){return Cb(a,"fontsize")},!0).filter(function(b,c,d){return a(d.slice(0,c)).indexOf(b)==-1}).length>=2},value:function(b){var c=xb(b,function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE})[0];c===undefined&&(c=b.startContainer);var d=Cb(c,"fontsize");return Mb(d)},relevantCssProperty:"fontSize"},f.forecolor={action:function(a){/^([0-9a-fA-F]{3}){1,2}$/.test(a)&&(a="#"+a);if(!/^(rgba?|hsla?)\(.*\)$/.test(a)&&!F(a)&&a.toLowerCase()!="transparent")return;Kb("forecolor",a)},standardInlineValueCommand:!0,relevantCssProperty:"color",equivalentValues:function(a,b){return E(a)===E(b)}},f.hilitecolor={action:function(a){/^([0-9a-fA-F]{3}){1,2}$/.test(a)&&(a="#"+a);if(!/^(rgba?|hsla?)\(.*\)$/.test(a)&&!F(a)&&a.toLowerCase()!="transparent")return;Kb("hilitecolor",a)},indeterm:function(){return a(xb(fb(),function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE})).map(function(a){return Cb(a,"hilitecolor")},!0).filter(function(b,c,d){return a(d.slice(0,c)).indexOf(b)==-1}).length>=2},standardInlineValueCommand:!0,relevantCssProperty:"backgroundColor",equivalentValues:function(a,b){return E(a)===E(b)}},f.italic={action:function(a,b){L("italic",b)?Kb("italic","normal",b):Kb("italic","italic",b)},inlineCommandActivatedValues:["italic","oblique"],relevantCssProperty:"fontStyle"},f.removeformat={action:function(){function b(a){return U(a)&&O(a,["abbr","acronym","b","bdi","bdo","big","blink","cite","code","dfn","em","font","i","ins","kbd","mark","nobr","q","s","samp","small","span","strike","strong","sub","sup","tt","u","var"])}var c=xb(fb(),b);a(c).forEach(function(a){while(a.hasChildNodes())mb(a.firstChild,a.parentNode,x(a),range);a.parentNode.removeChild(a)});if(U(fb().startContainer)&&fb().startContainer.nodeType==a.Node.TEXT_NODE&&fb().startOffset!=0&&fb().startOffset!=y(fb().startContainer))if(fb().startContainer==fb().endContainer){var d=fb().endOffset-fb().startOffset,e=fb().startContainer.splitText(fb().startOffset);fb().setStart(e,0),fb().setEnd(e,d)}else fb().setStart(fb().startContainer.splitText(fb().startOffset),0);if(U(fb().endContainer)&&fb().endContainer.nodeType==a.Node.TEXT_NODE&&fb().endOffset!=0&&fb().endOffset!=y(fb().endContainer)){var f=[fb().startContainer,fb().startOffset],d=[fb().endContainer,fb().endOffset];fb().setEnd(document.documentElement,0),d[0].splitText(d[1]),fb().setStart(f[0],f[1]),fb().setEnd(d[0],d[1])}a(xb(fb(),U)).forEach(function(a){while(b(a.parentNode)&&X(a.parentNode,a))fc([a],range)}),a(["subscript","bold","fontname","fontsize","forecolor","hilitecolor","italic","strikethrough","underline"]).forEach(function(a){Kb(a,null)})}},f.strikethrough={action:function(){L("strikethrough")?Kb("strikethrough",null):Kb("strikethrough","line-through")},inlineCommandActivatedValues:["line-through"]},f.subscript={action:function(){var a=L("subscript");Kb("subscript",null),a||Kb("subscript","subscript")},indeterm:function(){var b=xb(fb(),function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE});return a(b).some(function(a){return Cb(a,"subscript")=="subscript"})&&a(b).some(function(a){return Cb(a,"subscript")!="subscript"})||a(b).some(function(a){return Cb(a,"subscript")=="mixed"})},inlineCommandActivatedValues:["subscript"]},f.superscript={action:function(){var a=L("superscript");Kb("superscript",null),a||Kb("superscript","superscript")},indeterm:function(){var b=xb(fb(),function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE});return a(b).some(function(a){return Cb(a,"superscript")=="superscript"})&&a(b).some(function(a){return Cb(a,"superscript")!="superscript"})||a(b).some(function(a){return Cb(a,"superscript")=="mixed"})},inlineCommandActivatedValues:["superscript"]},f.underline={action:function(){L("underline")?Kb("underline",null):Kb("underline","underline")},inlineCommandActivatedValues:["underline"]},f.unlink={action:function(){var b=fb(),c=[];for(var d=b.startContainer;d;d=d.parentNode)O(d,"A")&&a(d).hasAttribute("href")&&c.unshift(d);for(var d=b.startContainer;d!=k(b.endContainer);d=i(d))O(d,"A")&&a(d).hasAttribute("href")&&(B(d,b)||l(d,b.endContainer)||d==b.endContainer)&&c.push(d);for(var e=0;e<c.length;e++)Hb(c[e],"unlink",b)},standardInlineValueCommand:!0};var Rb="p";f["delete"]={action:function(b,c){if(!c.collapsed){ec(c);return}ic(c.startContainer,c.startOffset);var d=c.startContainer,e=c.startOffset,f=!1,g=!1;for(;;){e>0&&(f=O(d.childNodes[e-1],"br")||!1,g=O(d.childNodes[e-1],"hr")||!1);if(e==0&&U(d.previousSibling)&&cb(d.previousSibling))d.parentNode.removeChild(d.previousSibling);else if(0<=e-1&&e-1<d.childNodes.length&&U(d.childNodes[e-1])&&(cb(d.childNodes[e-1])||f||g)){d.removeChild(d.childNodes[e-1]),e--;if(f||g){c.setStart(d,e),c.setEnd(d,e);return}}else if(e==0&&S(d)||cb(d))e=x(d),d=d.parentNode;else{if(0<=e-1&&e-1<d.childNodes.length&&U(d.childNodes[e-1])&&O(d.childNodes[e-1],"a")){gc(d.childNodes[e-1],c);return}if(!(0<=e-1&&e-1<d.childNodes.length&&!R(d.childNodes[e-1])&&!O(d.childNodes[e-1],["br","img"])))break;d=d.childNodes[e-1],e=y(d)}}_(d,c),e=c.startOffset;if(d.nodeType==a.Node.TEXT_NODE&&e!=0){c.setStart(d,e),c.setEnd(d,e),c.startOffset-=1,ec(c);return}if(S(d))return;if(0<=e-1&&e-1<d.childNodes.length&&O(d.childNodes[e-1],["br","hr","img"])){c.setStart(d,e),c.setEnd(d,e),ec(c);return}if(O(d,["li","dt","dd"])&&d==d.parentNode.firstChild&&e==0){var h=[];for(var i=d.parentNode;i;i=i.parentNode)O(i,"li")&&h.unshift(i);for(var j=0;j<h.length;j++)Tb(h[j],c);var k=Fb([d]);fc([d],c),Gb(k,c),O(d,["dd","dt"])&&a(q(d)).every(function(a){return!X(d,a)||!ub(d,a)})&&(d=nb(d,Rb,c)),Sb(d,c);for(var j=0;j<h.length;j++)Ub(h[j].parentNode,c);return}var l=d,n=e;for(;;)if(n==0)n=x(l),l=l.parentNode;else{if(!(0<=n-1&&n-1<l.childNodes.length&&U(l.childNodes[n-1])&&cb(l.childNodes[n-1])))break;l.removeChild(l.childNodes[n-1]),n--}if(e==0&&a(q(d).concat(d)).filter(function(a){return U(a)&&X(a,d)&&Nb(a)}).length){var o=Aloha.createRange();o.setStart(d,0),o.setEnd(d,0),o=$b(o);var p=C(o,function(a){return U(a)&&!V(a)});for(var j=0;j<p.length;j++)kc(p[j],c);return}if(O(l.childNodes[n],"table"))return;if(0<=n-1&&n-1<l.childNodes.length&&O(l.childNodes[n-1],"table")){c.setStart(l,n-1),c.setEnd(l,n);return}if(e==0&&(O(l.childNodes[n-1],"hr")||O(l.childNodes[n-1],"br")&&(O(l.childNodes[n-1].previousSibling,"br")||!S(l.childNodes[n-1].previousSibling)))){c.setStart(d,e),c.setEnd(d,e),ec(l,n-1,l,n);return}if(O(l.childNodes[n],["li","dt","dd"])&&S(l.childNodes[n].firstChild)&&n!=0){var r=l.childNodes[n-1];S(r.lastChild)&&!O(r.lastChild,"br")&&r.appendChild(document.createElement("br")),S(r.lastChild)&&r.appendChild(document.createElement("br"))}if(O(l.childNodes[n],["li","dt","dd"])&&O(l.childNodes[n-1],["li","dt","dd"]))l=l.childNodes[n-1],n=y(l),d=l.nextSibling,e=0;else while(0<=n-1&&n-1<l.childNodes.length)U(l.childNodes[n-1])&&cb(l.childNodes[n-1])?(l.removeChild(l.childNodes[n-1]),n--):(l=l.childNodes[n-1],n=y(l));var s=Aloha.createRange();s.setStart(l,n),s.setEnd(d,e),ec(s),m(document.body,c.startContainer)||(s.startContainer.hasChildNodes()||s.startContainer.nodeType==a.Node.TEXT_NODE?(c.setStart(s.startContainer,s.startOffset),c.setEnd(s.startContainer,s.startOffset)):(c.setStart(s.startContainer.parentNode,x(s.startContainer)),c.setEnd(s.startContainer.parentNode,x(s.startContainer))))}};var oc=["address","dd","div","dt","h1","h2","h3","h4","h5","h6","p","pre"];return f.formatblock={action:function(b){/^<.*>$/.test(b)&&(b=b.slice(1,-1)),b=b.toLowerCase();if(a(oc).indexOf(b)==-1)return;var c=$b(fb()),d=C(c,function(b){return U(b)&&(Pb(b)||ub(b,"p")||O(b,["dd","dt"]))&&!a(r(b)).some(Q)}),e=Fb(d);for(var f=0;f<d.length;f++){var g=d[f];while(a(q(g)).some(function(b){return U(b)&&X(b,g)&&O(b,oc)&&!a(r(b)).some(Q)}))fc([g],range)}Gb(e,range);while(d.length){var i;if(Qb(d[0])){i=[].slice.call(h(d[0].childNodes));var e=Fb(i);gc(d[0],range),Gb(e,range),d.shift()}else{i=[],i.push(d.shift());while(d.length&&d[0]==i[i.length-1].nextSibling&&!Qb(d[0])&&!O(i[i.length-1],"BR"))i.push(d.shift())}Sb(rb(i,a(["div","p"]).indexOf(b)==-1?function(a){return O(a,b)&&!a.attributes.length}:function(){return!1},function(){return document.createElement(b)},range),range)}},indeterm:function(){var b=$b(fb()),c=D(b,function(a){return bb(a)&&U(a)&&!a.hasChildNodes()});if(!c.length)return!1;var d=null;for(var e=0;e<c.length;e++){var f=c[e];while(U(f.parentNode)&&X(f,f.parentNode)&&!O(f,oc))f=f.parentNode;var g="";U(f)&&O(f,oc)&&!a(r(f)).some(Q)&&(g=f.tagName);if(d===null)d=g;else if(d!=g)return!0}return!1},value:function(){var b=$b(fb()),c=D(b,function(a){return bb(a)&&U(a)&&!a.hasChildNodes()});if(!c.length)return"";var d=c[0];while(U(d.parentNode)&&X(d,d.parentNode)&&!O(d,oc))d=d.parentNode;return U(d)&&O(d,oc)&&!a(r(d)).some(Q)?d.tagName.toLowerCase():""}},f.forwarddelete={action:function(b,c){if(!c.collapsed){ec(c);return}ic(c.startContainer,c.startOffset);var d=c.startContainer,e=c.startOffset,f=!1,g=!1;for(;;){e<d.childNodes.length&&(f=O(d.childNodes[e],"br")||!1,g=O(d.childNodes[e],"hr")||!1);if(e==y(d)&&U(d.nextSibling)&&cb(d.nextSibling))d.parentNode.removeChild(d.nextSibling);else if(e<d.childNodes.length&&U(d.childNodes[e])&&(cb(d.childNodes[e])||f||g)){d.removeChild(d.childNodes[e]);if(f||g){c.setStart(d,e),c.setEnd(d,e);return}}else if(e<d.childNodes.length&&db(d.childNodes[e]))e++;else if(e==y(d)&&S(d)||cb(d))e=1+x(d),d=d.parentNode;else{if(!(e<d.childNodes.length&&!R(d.childNodes[e])&&!O(d.childNodes[e],["br","img"])))break;d=d.childNodes[e],e=0}}_(d,c),e=c.startOffset;if(d.nodeType==a.Node.TEXT_NODE&&e!=y(d)){c.setStart(d,e),c.setEnd(d,e);var h=e+1;while(h!=d.length&&/^[\u0300-\u036f\u0591-\u05bd\u05c1\u05c2]$/.test(d.data[h]))h++;ec(d,e,d,h);return}if(S(d))return;if(e<d.childNodes.length&&O(d.childNodes[e],["br","hr","img"])){c.setStart(d,e),c.setEnd(d,e),ec(d,e,d,e+1);return}var i=d,h=e;for(;;)if(h==y(i))h=1+x(i),i=i.parentNode;else{if(!(h<i.childNodes.length&&U(i.childNodes[h])&&cb(i.childNodes[h])))break;i.removeChild(i.childNodes[h])}if(O(i.childNodes[h-1],"table"))return;if(O(i.childNodes[h],"table")){c.setStart(i,h),c.setEnd(i,h+1);return}if(e==y(d)&&O(i.childNodes[h],["br","hr"])){c.setStart(d,e),c.setEnd(d,e),ec(i,h,i,h+1);return}while(h<i.childNodes.length)U(i.childNodes[h])&&cb(i.childNodes[h])?i.removeChild(i.childNodes[h]):(i=i.childNodes[h],h=0);ec(d,e,i,h)}},f.indent={action:function(){var a=[];for(var b=fb().endContainer;b!=fb().commonAncestorContainer;b=b.parentNode)O(b,"LI")&&a.unshift(b);for(var b=fb().startContainer;b!=fb().commonAncestorContainer;b=b.parentNode)O(b,"LI")&&a.unshift(b);for(var b=fb().commonAncestorContainer;b;b=b.parentNode)O(b,"LI")&&a.unshift(b);for(var c=0;c<a.length;c++)Tb(a[c,range]);var d=$b(fb()),e=[];e=C(d,function(a){return U(a)&&(ub(a,"div")||ub(a,"ol"))}),e.length&&O(e[0],"LI")&&O(e[0].parentNode,["OL","UL"])&&O(e[0].previousSibling,"LI")&&Tb(e[0].previousSibling,range);while(e.length){var f=[];f.push(e.shift());while(e.length&&e[0]==f[f.length-1].nextSibling)f.push(e.shift());jc(f,range)}}},f.inserthorizontalrule={action:function(b,c){while(c.startOffset==0&&c.startContainer.parentNode)c.setStart(c.startContainer.parentNode,x(c.startContainer));while(c.endOffset==y(c.endContainer)&&c.endContainer.parentNode)c.setEnd(c.endContainer.parentNode,1+x(c.endContainer));ec(c,{blockMerging:!1});if(!U(fb().startContainer)&&!T(fb().startContainer))return;fb().startContainer.nodeType==a.Node.TEXT_NODE&&fb().startOffset==0&&(fb().setStart(fb().startContainer.parentNode,x(fb().startContainer)),fb().collapse(!0)),fb().startContainer.nodeType==a.Node.TEXT_NODE&&fb().startOffset==y(fb().startContainer)&&(fb().setStart(fb().startContainer.parentNode,1+x(fb().startContainer)),fb().collapse(!0));var d=document.createElement("hr");c.insertNode(d),Sb(d,c),c.setStart(d.parentNode,1+x(d)),c.setEnd(d.parentNode,1+x(d)),Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(c)}},f.inserthtml={action:function(b,c){ec(c);if(!U(c.startContainer)&&!T(c.startContainer))return;var d=c.createContextualFragment(b),e=d.lastChild;if(!e)return;var f=r(d);R(c.startContainer)&&a(c.startContainer.childNodes).filter(function(a,b){return U(a)&&db(a)&&x(a)>=b.startOffset},!0).forEach(function(a){a.parentNode.removeChild(a)}),c.insertNode(d),R(c.startContainer)&&!a(c.startContainer.childNodes).some(bb)&&c.startContainer.appendChild(nc()),c.setStart(e.parentNode,1+x(e)),c.setEnd(e.parentNode,1+x(e));for(var g=0;g<f.length;g++)Sb(f[g],c);eb(c)}},f.insertimage={action:function(a){if(a==="")return;var b=fb();ec(b,{stripWrappers:!1});if(!U(fb().startContainer)&&!T(fb().startContainer))return;R(b.startContainer)&&b.startContainer.childNodes.length==1&&O(b.startContainer.firstChild,"br")&&b.startOffset==0&&b.startContainer.removeChild(b.startContainer.firstChild);var c=document.createElement("img");c.setAttribute("src",a),b.insertNode(c),b.setStart(c.parentNode,1+x(c)),b.setEnd(c.parentNode,1+x(c)),Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(b),c.removeAttribute("width"),c.removeAttribute("height")}},f.insertlinebreak={action:function(b,c){ec(c,{stripWrappers:!1});if(!U(c.startContainer)&&!T(c.startContainer))return;if(c.startContainer.nodeType==a.Node.ELEMENT_NODE&&!ub("br",c.startContainer))return;if(c.startContainer.nodeType!=a.Node.ELEMENT_NODE&&!ub("br",c.startContainer.parentNode))return;if(c.startContainer.nodeType==a.Node.TEXT_NODE&&c.startOffset==0){var d=c.startContainer.parentNode,e=x(c.startContainer);Aloha.getSelection().collapse(d,e),c.setStart(d,e),c.setEnd(d,e)}if(c.startContainer.nodeType==a.Node.TEXT_NODE&&c.startOffset==y(c.startContainer)){var d=c.startContainer.parentNode,e=1+x(c.startContainer);Aloha.getSelection().collapse(d,e),c.setStart(d,e),c.setEnd(d,e)}var f=document.createElement("br");c.insertNode(f),Aloha.getSelection().collapse(f.parentNode,1+x(f)),c.setStart(f.parentNode,1+x(f)),c.setEnd(f.parentNode,1+x(f)),Y(f)&&(c.insertNode(nc()),Aloha.getSelection().collapse(f.parentNode,1+x(f)),c.setStart(f.parentNode,1+x(f)),c.setEnd(f.parentNode,1+x(f)))}},f.insertorderedlist={action
:function(){lc("ol")},indeterm:function(){return/^mixed( ol)?$/.test(Vb())},state:function(){return Vb()=="ol"}},f.insertparagraph={action:function(b,c){ec(c);if(!U(c.startContainer)&&!T(c.startContainer))return;var d=c.startContainer,e=c.startOffset;d.nodeType==a.Node.TEXT_NODE&&e!=0&&e!=y(d)&&d.splitText(e),d.nodeType==a.Node.TEXT_NODE&&e==y(d)&&(e=1+x(d),d=d.parentNode);if(d.nodeType==a.Node.TEXT_NODE||d.nodeType==a.Node.COMMENT_NODE)e=x(d),d=d.parentNode;Aloha.getSelection().collapse(d,e),c.setStart(d,e),c.setEnd(d,e);var f=d;while(!Qb(f)&&U(f.parentNode)&&X(d,f.parentNode))f=f.parentNode;if(!U(f)||!X(f,d)||!Qb(f)){var g=Rb,h=$b(c),j=C(h,function(a){return ub(a,"p")}).slice(0,1);if(!j.length){if(!ub(g,c.startContainer))return;f=document.createElement(g),c.insertNode(f),f.appendChild(nc()),Aloha.getSelection().collapse(f,0),c.setStart(f,0),c.setEnd(f,0);return}while(j[j.length-1].nextSibling&&ub(j[j.length-1].nextSibling,"p"))j.push(j[j.length-1].nextSibling);f=rb(j,function(){return!1},function(){return document.createElement(g)},c)}if(f.tagName=="ADDRESS"||f.tagName=="LISTING"||f.tagName=="PRE"){var k=document.createElement("br"),l=f.offsetHeight;c.insertNode(k);var m=f.offsetHeight;Aloha.getSelection().collapse(d,e+1),c.setStart(d,e+1),c.setEnd(d,e+1),l==m&&!n(i(k),f)&&(c.insertNode(nc()),Aloha.getSelection().collapse(d,e+1),c.setEnd(d,e+1));return}if(a(["LI","DT","DD"]).indexOf(f.tagName)!=-1&&(!f.hasChildNodes()||f.childNodes.length==1&&O(f.firstChild,"br"))){fc([f],c);if(!f.hasChildNodes()){var l=f.offsetHeight,o=nc();f.appendChild(o),f.offsetHeight!==l&&f.removeChild(o)}O(f,["dd","dt"])&&a(q(f)).every(function(a){return!X(f,a)||!ub(f,a)})&&(f=nb(f,Rb,c)),Sb(f,c);if(O(f,"li")&&O(f.nextSibling,"li")&&O(f.nextSibling.firstChild,["ol","ul"])){var p=f.nextSibling,s=f.nextSibling.childNodes.length;for(var t=0;t<s;t++)f.appendChild(p.childNodes[t]);p.parentNode.removeChild(p)}return}var u=Aloha.createRange();u.setStart(c.startContainer,c.startOffset),u.setEnd(f,y(f));while(u.startOffset==0&&u.startContainer!=f)u.setStart(u.startContainer.parentNode,x(u.startContainer));while(u.startOffset==y(u.startContainer)&&u.startContainer!=f)u.setStart(u.startContainer.parentNode,1+x(u.startContainer));var v=C(u),w=!v.length||v.length==1&&O(v[0],"br"),z;/^H[1-6]$/.test(f.tagName)&&w?z=Rb:f.tagName=="DT"&&w?z="dd":f.tagName=="DD"&&w?z="dt":z=f.tagName.toLowerCase();var A=document.createElement(z);for(var t=0;t<f.attributes.length;t++)typeof A.setAttributeNS=="function"?A.setAttributeNS(f.attributes[t].namespaceURI,f.attributes[t].name,f.attributes[t].value):f.attributes[t].value.length>0&&f.attributes[t].value!="null"&&f.attributes[t].value>0&&A.setAttribute(f.attributes[t].name,f.attributes[t].value);A.removeAttribute("id"),f.parentNode.insertBefore(A,f.nextSibling);var B=D(u),E=u.extractContents(),F=r(E);for(var t=0;t<F.length;t++)F[t].nodeType==a.Node.ELEMENT_NODE&&a(B).indexOf(F[t])==-1&&F[t].removeAttribute("id");var G=[],H=E.firstChild;if(H)do $(H)||G.push(H);while(H=H.nextSibling);if(O(A,"li")&&G.length&&O(G[0],["ul","ol"])){var l=A.offsetHeight,o=nc();A.appendChild(o);var m=A.offsetHeight;l!==m&&A.removeChild(o)}A.appendChild(E),f.offsetHeight==0&&!a(f.childNodes).some(bb)&&f.appendChild(nc()),A.offsetHeight==0&&!a(A.childNodes).some(bb)&&A.appendChild(nc()),Aloha.getSelection().collapse(A,0),c.setStart(A,0),c.setEnd(A,0)}},f.inserttext={action:function(b,c){ec(c,{stripWrappers:!1});if(!U(c.startContainer)&&!T(c.startContainer))return;if(b.length>1){for(var d=0;d<b.length;d++)f.inserttext.action(b[d],c);return}if(b=="")return;if(b=="\n"){f.insertparagraph.action("",c);return}var e=c.startContainer,g=c.startOffset;0<=g-1&&g-1<e.childNodes.length&&e.childNodes[g-1].nodeType==a.Node.TEXT_NODE&&(e=e.childNodes[g-1],g=y(e)),0<=g&&g<e.childNodes.length&&e.childNodes[g].nodeType==a.Node.TEXT_NODE&&(e=e.childNodes[g],g=0);var h=e.nodeType==a.Node.ELEMENT_NODE?e:e.parentNode;b==" "&&h.nodeType==a.Node.ELEMENT_NODE&&a(["pre","pre-wrap"]).indexOf(a.getComputedStyle(h).whiteSpace)==-1&&(b=" ");var i=bc(c);if(e.nodeType==a.Node.TEXT_NODE)e.insertData(g,b),Aloha.getSelection().collapse(e,g),c.setStart(e,g),Aloha.getSelection().extend(e,g+1),c.setEnd(e,g+1);else{e.childNodes.length==1&&Y(e.firstChild)&&e.removeChild(e.firstChild);var j=document.createTextNode(b);c.insertNode(j),Aloha.getSelection().collapse(j,0),c.setStart(j,0),Aloha.getSelection().extend(j,1),c.setEnd(j,1)}dc(i),ic(c.startContainer,c.startOffset),ic(c.endContainer,c.endOffset),Aloha.getSelection().collapseToEnd(),c.collapse(!1)}},f.insertunorderedlist={action:function(){lc("ul")},indeterm:function(){return/^mixed( ul)?$/.test(Vb())},state:function(){return Vb()=="ul"}},f.justifycenter={action:function(a,b){mc("center",b)},indeterm:function(){var b=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return a(b).some(function(a){return Wb(a)=="center"})&&a(b).some(function(a){return Wb(a)!="center"})},state:function(){var b=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return b.length&&a(b).every(function(a){return Wb(a)=="center"})},value:function(){var a=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return a.length?Wb(a[0]):"left"}},f.justifyfull={action:function(a,b){mc("justify",b)},indeterm:function(){var b=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return a(b).some(function(a){return Wb(a)=="justify"})&&a(b).some(function(a){return Wb(a)!="justify"})},state:function(){var b=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return b.length&&a(b).every(function(a){return Wb(a)=="justify"})},value:function(){var a=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return a.length?Wb(a[0]):"left"}},f.justifyleft={action:function(a,b){mc("left",b)},indeterm:function(){var b=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return a(b).some(function(a){return Wb(a)=="left"})&&a(b).some(function(a){return Wb(a)!="left"})},state:function(){var b=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return b.length&&a(b).every(function(a){return Wb(a)=="left"})},value:function(){var a=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return a.length?Wb(a[0]):"left"}},f.justifyright={action:function(a,b){mc("right",b)},indeterm:function(){var b=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return a(b).some(function(a){return Wb(a)=="right"})&&a(b).some(function(a){return Wb(a)!="right"})},state:function(){var b=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return b.length&&a(b).every(function(a){return Wb(a)=="right"})},value:function(){var a=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return a.length?Wb(a[0]):"left"}},f.outdent={action:function(){var b=[];(function(){for(var a=fb().endContainer;a!=fb().commonAncestorContainer;a=a.parentNode)O(a,"li")&&b.unshift(a);for(var a=fb().startContainer;a;a=a.parentNode)O(a,"li")&&b.unshift(a)})(),a(b).forEach(function(a){Tb(a,range)});var c=$b(fb()),d=C(c,function(b){return U(b)&&(!a(r(b)).some(U)||O(b,["ol","ul"])||O(b,"li")&&O(b.parentNode,["ol","ul"]))});while(d.length){while(d.length&&(O(d[0],["OL","UL"])||!O(d[0].parentNode,["OL","UL"])))kc(d.shift(),range);if(!d.length)break;var e=[];e.push(d.shift());while(d.length&&d[0]==e[e.length-1].nextSibling&&!O(d[0],["OL","UL"]))e.push(d.shift());var f=Fb(e);fc(e,range),a(e).forEach(Sb),Gb(f,range)}}},f.selectall={action:function(){var a=document.body;a||(a=document.documentElement),a?Aloha.getSelection().selectAllChildren(a):Aloha.getSelection().removeAllRanges()}},f.stylewithcss={action:function(a){d=String(a).toLowerCase()!="false"},state:function(){return d}},f.usecss={action:function(a){d=String(a).toLowerCase()=="false"}},function(){var b=[];for(var c in f)b.push(c);a(b).forEach(function(b){"relevantCssProperty"in f[b]||(f[b].relevantCssProperty=null),"inlineCommandActivatedValues"in f[b]&&!("indeterm"in f[b])&&(f[b].indeterm=function(c){var d=a(xb(c,function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE})).map(function(a){return Cb(a,b)}),e=a(d).filter(function(c){return a(f[b].inlineCommandActivatedValues).indexOf(c)!=-1});return e.length>=1&&d.length-e.length>=1}),"inlineCommandActivatedValues"in f[b]&&(f[b].state=function(c){var d=xb(c,function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE});return d.length==0?a(f[b].inlineCommandActivatedValues).indexOf(Cb(c.startContainer,b))!=-1:a(d).every(function(c){return a(f[b].inlineCommandActivatedValues).indexOf(Cb(c,b))!=-1})}),"standardInlineValueCommand"in f[b]&&(f[b].indeterm=function(){var c=a(xb(fb())).filter(function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE},!0).map(function(a){return Cb(a,b)});for(var d=1;d<c.length;d++)if(c[d]!=c[d-1])return!0;return!1},f[b].value=function(c){var d=xb(c,function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE})[0];return typeof d=="undefined"&&(d=c.startContainer),Cb(d,b)})})}(),{commands:f,execCommand:I,queryCommandIndeterm:K,queryCommandState:L,queryCommandValue:N,queryCommandEnabled:J,queryCommandSupported:M}}),define("aloha/command",["aloha/core","aloha/registry","aloha/engine","util/dom","aloha/contenthandlermanager"],function(a,b,c,d,e){var f={execCommand:function(b,f,g,h){if(!h){if(!a.getSelection().getRangeCount())return;h=a.getSelection().getRangeAt(0)}b=="insertHTML"&&(g=e.handleContent(g,{contenthandler:a.settings.contentHandler.insertHtml})),c.execCommand(b,f,g,h);if(a.getSelection().getRangeCount()){h=a.getSelection().getRangeAt(0);var i=h.commonAncestorContainer.parentNode,j=new window.GENTICS.Utils.RangeObject;j.startContainer=h.startContainer,j.startOffset=h.startOffset,j.endContainer=h.endContainer,j.endOffset=h.endOffset,d.doCleanup({merge:!0,removeempty:!1},j,i),j.select()}a.trigger("aloha-command-executed",b)},queryCommandEnabled:function(b,d){if(!d){if(!a.getSelection().getRangeCount())return;d=a.getSelection().getRangeAt(0)}return c.queryCommandEnabled(b,d)},queryCommandIndeterm:function(b,d){if(!d){if(!a.getSelection().getRangeCount())return;d=a.getSelection().getRangeAt(0)}return c.queryCommandIndeterm(b,d)},queryCommandState:function(b,d){if(!d){if(!a.getSelection().getRangeCount())return;d=a.getSelection().getRangeAt(0)}return c.queryCommandState(b,d)},queryCommandSupported:function(a){return c.queryCommandSupported(a)},queryCommandValue:function(b,d){if(!d){if(!a.getSelection().getRangeCount())return;d=a.getSelection().getRangeAt(0)}return c.queryCommandValue(b,d)},querySupportedCommands:function(){var a=[],b;for(b in c.commands)a.push(b);return a}};return f=new(b.extend(f)),a.execCommand=f.execCommand,a.queryCommandEnabled=f.queryCommandEnabled,a.queryCommandIndeterm=f.queryCommandIndeterm,a.queryCommandState=f.queryCommandState,a.queryCommandSupported=f.queryCommandSupported,a.queryCommandValue=f.queryCommandValue,a.querySupportedCommands=f.querySupportedCommands,f}),define("aloha/jquery.patch",["aloha/jquery"],function(a){a.data=function(a){return function(b,c,d,e){if(!a.acceptData(b))return;var f=a.expando,g=typeof c=="string",h,i=b.nodeType,j=i?a.cache:b,k=i?b[a.expando]:b[a.expando]&&a.expando;if((!k||e&&k&&(!j[k]||!j[k][f]))&&g&&d===undefined)return;k||(i?b[a.expando]=k=++a.uuid:k=a.expando),j[k]||(j[k]={},i||(j[k].toJSON=a.noop));if(typeof c=="object"||typeof c=="function")e?j[k][f]=a.extend(j[k][f],c):j[k]=a.extend(j[k],c);return h=j[k],e&&(h[f]||(h[f]={}),h=h[f]),d!==undefined&&(h[a.camelCase(c)]=d),c==="events"&&!h[c]?h[f]&&h[f].events:g?h[a.camelCase(c)]:h}}(a)}),define("aloha/jquery.aloha",["aloha/core","aloha/selection","aloha/jquery","aloha/console"],function(a,b,c,d){var e=window.XMLSerializer;c.fn.between=function(a,b){var c,d;this[0].nodeType!==3?(c=this.children().size(),b>c&&(b=c),b<=0?this.prepend(a):this.children().eq(b-1).after(a)):b<=0?this.before(a):b>=this[0].length?this.after(a):(d=this[0].data,this[0].data=d.substring(0,b),this.after(d.substring(b,d.length)),this.after(a))},c.fn.contentEditable=function(a){var b=c(this),e="contenteditable";return c.browser.msie&&parseInt(c.browser.version,10)==7&&(e="contentEditable"),typeof a=="undefined"?typeof b[0]=="undefined"?(d.error("The jquery object did not contain any valid elements."),undefined):typeof b[0].isContentEditable=="undefined"?(d.warn("Could not determine whether the is editable or not. I assume it is."),!0):b[0].isContentEditable:(a===""?b.removeAttr(e):(a&&a!=="false"?a="true":a="false",b.attr(e,a)),b)},c.fn.aloha=function(){var b=c(this);return a.bind("aloha-ready",function(){b.each(function(){a.isEditable(this)||new a.Editable(c(this))})}),b},c.fn.mahalo=function(){return this.each(function(){a.isEditable(this)&&a.getEditableById(c(this).attr("id")).destroy()})},c.fn.contentEditableSelectionChange=function(a){var d=this;return this.keyup(function(c){var d=b.getRangeObject();a(c)}),this.dblclick(function(b){a(b)}),this.mousedown(function(a){d.selectionStarted=!0}),c(document).mouseup(function(c){b.eventOriginalTarget=d,d.selectionStarted&&a(c),b.eventOriginalTarget=!1,d.selectionStarted=!1}),this},c.fn.outerHtml=c.fn.outerHtml||function(){var a=c(this),b=a.get(0);if(typeof b.outerHTML!="undefined")return b.outerHTML;try{return(new e).serializeToString(b)}catch(d){try{return b.xml}catch(d){}}},c.fn.zap=function(){return this.each(function(){c(this.childNodes).insertBefore(this)}).remove()},c.fn.textNodes=function(a,b){var d=[],e=function(f){if(f.nodeType===3&&c.trim(f.data)&&!b||f.nodeType===3&&b||f.nodeName=="BR"&&!a)d.push(f);else for(var g=0,h=f.childNodes.length;g<h;++g)e(f.childNodes[g])};return e(this[0]),c(d)},c.extendObjects=c.fn.extendObjects=function(){var a,b,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;typeof h=="boolean"&&(k=h,h=arguments[1]||{},i=2),typeof h!="object"&&!c.isFunction(h)&&(h={}),j===i&&(h=this,--i);for(;i<j;i++)if((a=arguments[i])!=null)for(b in a){d=h[b],e=a[b];if(h===e)continue;k&&e&&(c.isPlainObject(e)||(f=c.isArray(e)))?(f?(f=!1,g=d&&c.isArray(d)?d:[]):g=d&&c.isPlainObject(d)?d:{},c.isArray(e)?h[b]=e:h[b]=c.extendObjects(k,g,e)):e!==undefined&&(h[b]=e)}return h},c.isBoolean=function(a){return a===!0||a===!1},c.isNumeric=function(a){return!isNaN(a-0)}}),define("aloha/sidebar",["aloha/core","aloha/jquery","aloha/selection"],function(a,b,c,d){function j(a,b){return a.replace(/\{([a-z0-9\-\_]+)\}/ig,function(a,c,d,e){var f=b[c]||a;return typeof f=="function"?f():f})}function k(a){return typeof a=="string"?j(a,i):a}function l(){var a=[],c=g;return b.each(arguments,function(){a.push("."+(this==""?c:c+"-"+this))}),b.trim(a.join(" "))}function m(){var a=[],c=g;return b.each(arguments,function(){a.push(this==""?c:c+"-"+this)}),b.trim(a.join(" "))}var e=b,f=void 0,g="aloha-sidebar",h=+(new Date),i={bar:m("bar"),handle:m("handle"),inner:m("inner"),panels:m("panels"),"config-btn":m("config-btn"),"handle-icon":m("handle-icon"),"panel-content":m("panel-content"),"panel-content-inner":m("panel-content-inner"),"panel-content-inner-text":m("panel-content-inner-text"),"panel-title":m("panel-title"),"panel-title-arrow":m("panel-title-arrow"),"panel-title-text":m("panel-title-text")};b.easing.easeOutExpo||b.extend(b.easing,{easeOutExpo:function(a,b,c,d,e){return b==e?c+d:d*(-Math.pow(2,-10*b/e)+1)+c},easeOutElastic:function(a,b,c,d,e){var f=Math,g=1.70158,h=0,i=d;if(!b)return c;if((b/=e)==1)return c+d;h||(h=e*.3);if(i<f.abs(d)){i=d;var g=h/4}else var g=h/(2*f.PI)*f.asin(d/i);return i*f.pow(2,-10*b)*f.sin((b*e-g)*2*f.PI/h)+d+c}});var n=function(d){var e=this;this.id=m(++h),this.panels={},this.container=b(k('<div class="{bar}"><div class="{handle}"><span class="{handle-icon}"></span></div><div class="{inner}"><ul class="{panels}"></ul></div></div>')),this.width=300,this.opened=!1,this.isOpen=!1,this.settings={rotateIcons:!b.browser.msie,overlayPage:!0},b(function(){(typeof a.settings.sidebar=="undefined"||!a.settings.sidebar.disabled)&&e.init(d)})};b.extend(n.prototype,{init:function(a){var c=this,d;typeof a=="object"&&(d=a.panels,delete a.panels),b.extend(this,a),typeof d=="object"&&b.each(d,function(){c.addPanel(this,!0)});var e=this.container;this.position=="right"&&e.addClass(m("right")),e.hide().appendTo(b("body")).click(function(){c.barClicked.apply(c,arguments)}).find(l("panels")).width(this.width),e.width(this.width),this.width=e.width(),b(window).resize(function(){c.updateHeight()}),this.updateHeight(),this.roundCorners(),this.initToggler(),this.container.css(this.position=="right"?"marginRight":"marginLeft",-this.width),this.opened&&this.open(0),this.toggleHandleIcon(this.isOpen),this.subscribeToEvents(),b(window).resize(function(){c.correctHeight()}),this.correctHeight()},show:function(){return this.container.css("display","block"),this},hide:function(){return this.container.css("display","none"),this},checkActivePanels:function(a){var c=[];if(typeof a!="undefined"&&typeof a.markupEffectiveAtStart!="undefined"){var d=a.markupEffectiveAtStart.length;for(var e=0;e<d;++e)c.push(b(a.markupEffectiveAtStart[e]))}var f=this;b.each(this.panels,function(){f.showActivePanel(this,c)}),this.correctHeight()},subscribeToEvents:function(){var b=this,c=this.container;a.bind("aloha-selection-changed",function(a,c){b.checkActivePanels(c)}),c.mousedown(function(b){b.originalEvent.stopSelectionUpdate=!0,a.eventHandled=!0}),c.mouseup(function(b){b.originalEvent.stopSelectionUpdate=!0,a.eventHandled=!1}),a.bind("aloha-editable-deactivated",function(a,c){b.checkActivePanels()})},correctHeight:function(){var a=this.container.find(l("inner")).height()-30,c=[];b.each(this.panels,function(){this.isActive&&c.push(this)});if(c.length==0)return;var d=a-(c[0].title.outerHeight()+10)*c.length,e,f,g,h,i,j=0,k=Math;while(c.length>0&&d>0){d+=j,j=0,i=[];for(var m=c.length-1;m>=0;--m)e=c[m],g=e.content.find(l("panel-content-inner")),f=k.min(g.height("auto").height(),k.floor(d/(m+1))),g.height(f),d-=f,h=g.find(l("panel-content-inner-text")),h.height()>f?(i.push(e),j+=f,g.css({"overflow-x":"hidden","overflow-y":"scroll"})):g.css("overflow-y","hidden"),e.expanded&&e.expand();c=i}},showActivePanel:function(a,c){c.push(null);var d=c.length,e=0,f=a.content.parent("li"),g=a.activeOn,h=b();for(var i=0;i<d;++i)g(c[i])&&(++e,c[i]&&b.merge(h,c[i]));e?a.activate(h):a.deactivate(),this.roundCorners()},initToggler:function(){var c=this,d=this.container,e=d.find(l("handle-icon")),f=m("toggled"),g,h=this.position=="right";this.opened&&this.rotateHandleArrow(h?0:180,0),b(function(){typeof a.settings.sidebar!="undefined"&&a.settings.sidebar.handle&&a.settings.sidebar.handle.top&&(b(d.find(l("handle"))).get(0).style.top=a.settings.sidebar.handle.top)}),d.find(l("handle")).click(function(){g&&clearInterval(g),e.stop().css("marginLeft",4),c.isOpen?(b(this).removeClass(f),c.close(),c.isOpen=!1):(b(this).addClass(f),c.open(),c.isOpen=!0)}).hover(function(){var a=c.isOpen?-1:1;g&&clearInterval(g),e.stop(),b(this).stop().animate(h?{marginLeft:"-="+a*5}:{marginRight:"-="+a*5},200),g=setInterval(function(){a*=-1,e.animate(h?{left:"-="+a*4}:{right:"-="+a*4},300)},300)},function(){g&&clearInterval(g),e.stop().css(h?"left":"right",5),b(this).stop().animate(h?{marginLeft:0}:{marginRight:0},600,"easeOutElastic")})},roundCorners:function(){var a=this.container,b=a.find(l("panels>li:not(","deactivated)")),c=m("panel-top"),d=m("panel-bottom");a.find(l("panel-top,","panel-bottom")).removeClass(c).removeClass(d),b.first().find(l("panel-title")).addClass(c),b.last().find(l("panel-content")).addClass(d)},updateHeight:function(){var a=b(window).height();this.container.height(a).find(l("inner")).height(a)},barClicked:function(a){this.handleBarclick(b(a.target))},handleBarclick:function(a){a.hasClass(m("panel-title"))?this.togglePanel(a):a.hasClass(m("panel-content"))||a.hasClass(m("handle"))||a.hasClass(m("bar"))||this.handleBarclick(a.parent())},getPanelById:function(a){return this.panels[a]},getPanelByElement:function(a){var b=a[0].tagName=="LI"?a:a.parent("li");return this.getPanelById(b[0].id)},togglePanel:function(a){this.getPanelByElement(a).toggle()},rotateHandleIcon:function(a,b){var c=this.container.find(l("handle-icon"));c.animate({angle:a},{duration:typeof b=="number"||typeof b=="string"?b:500,easing:"easeOutExpo",step:function(a,b){c.css({"-o-transform":"rotate("+a+"deg)","-webkit-transform":"rotate("+a+"deg)","-moz-transform":"rotate("+a+"deg)","-ms-transform":"rotate("+a+"deg)"})}})},toggleHandleIcon:function(a){var b=this.position=="right"^a;if(this.settings.rotateIcons)this.rotateHandleIcon(b?180:0,0);else{var c=this.container.find(l("handle-icon"));b?c.addClass(m("handle-icon-left")):c.removeClass(m("handle-icon-left"))}},open:function(a,c){if(this.isOpen)return this;var d=this.position=="right",e=d?{marginRight:0}:{marginLeft:0};return this.toggleHandleIcon(!0),this.container.animate(e,typeof a=="number"||typeof a=="string"?a:500,"easeOutExpo"),this.settings.overlayPage||b("body").animate(d?{marginRight:"+="+this.width}:{marginLeft:"+="+this.width},500,"easeOutExpo"),this.isOpen=!0,b("body").trigger(m("opened"),this),this},close:function(a,c){if(!this.isOpen)return this;var d=this.position=="right",e=d?{marginRight:-this.width}:{marginLeft:-this.width};return this.toggleHandleIcon(!1),this.container.animate(e,typeof a=="number"||typeof a=="string"?a:500,"easeOutExpo"),this.settings.overlayPage||b("body").animate(d?{marginRight:"-="+this.width}:{marginLeft:"-="+this.width},500,"easeOutExpo"),this.isOpen=!1,this},activatePanel:function(a,b){return typeof a=="string"&&(a=this.getPanelById(a)),a&&a.activate(b),this.roundCorners(),this},expandPanel:function(a,b){return typeof a=="string"&&(a=this.getPanelById(a)),a&&a.expand(b),this},collapsePanel:function(a,b){return typeof a=="string"&&(a=this.getPanelById(a)),a&&a.collapse(b),this},addPanel:function(a,b){return a instanceof o||(a.width||(a.width=this.width),a.sidebar=this,a=new o(a)),this.panels[a.id]=a,this.container.find(l("panels")).append(a.element),b!==!0&&this.roundCorners(),this.checkActivePanels(c.getRangeObject()),a}});var o=function(c){this.id=null,this.folds={},this.button=null,this.title=b(k('						 			<div class="{panel-title}">							 				<span class="{panel-title-arrow}"></span>		 				<span class="{panel-title-text}">Untitled</span> 			</div>												 		')),this.content=b(k('								<div class="{panel-content}">									<div class="{panel-content-inner}">								<div class="{panel-content-inner-text}">					</div>													</div>													</div>													')),this.element=null,this.expanded=!1,this.effectiveElement=null,this.isActive=!0,this.init(c)};b.extend(o.prototype,{init:function(a){this.setTitle(a.title).setContent(a.content),delete a.title,delete a.content,b.extend(this,a),this.id||(this.id=m(++h));var c=this.element=b('<li id="'+this.id+'">').append(this.title,this.content);this.expanded&&this.content.height("auto"),this.toggleTitleIcon(this.expanded),this.coerceActiveOn(),this.title.attr("unselectable","on").css("-moz-user-select","none").each(function(){this.onselectstart=function(){return!1}}),typeof this.onInit=="function"&&this.onInit.apply(this)},toggleTitleIcon:function(a){if(this.sidebar.settings.rotateIcons)this.rotateTitleIcon(a?90:0);else{var b=this.title.find(l("panel-title-arrow"));a?b.addClass(m("panel-title-arrow-down")):b.removeClass(m("panel-title-arrow-down"))}},coerceActiveOn:function(){if(typeof this.activeOn!="function"){var a=this.activeOn;this.activeOn=function(){var b=typeof a,c;return b=="boolean"?c=function(){return a}:b=="undefined"?c=function(){return!0}:b=="string"?c=function(b){return b?b.is(a):!1}:c=function(){return!1},c}()}},activate:function(a){this.isActive=!0,this.content.parent("li").show().removeClass(m("deactivated")),this.effectiveElement=a,typeof this.onActivate=="function"&&this.onActivate.call(this,a)},deactivate:function(){this.isActive=!1,this.content.parent("li").hide().addClass(m("deactivated")),this.effectiveElement=null},toggle:function(){this.expanded?this.collapse():this.expand()},expand:function(a){var b=this,c=this.content,d=c.height(),e=c.height("auto").height();return c.height(d).stop().animate({height:e},500,"easeOutExpo",function(){typeof a=="function"&&a.call(b)}),this.element.removeClass("collapsed"),this.toggleTitleIcon(!0),this.expanded=!0,this},collapse:function(a,b){var c=this;return this.element.addClass("collapsed"),this.content.stop().animate({height:5},250,"easeOutExpo",function(){typeof b=="function"&&b.call(c)}),this.toggleTitleIcon(!1),this.expanded=!1,this},setTitle:function(a){return this.title.find(l("panel-title-text")).html(a),this},setContent:function(a){if(!a||a=="")a="&nbsp;";return this.content.find(l("panel-content-inner-text")).html(a),this},rotateTitleIcon:function(a,b){var c=this.title.find(l("panel-title-arrow"));c.animate({angle:a},{duration:typeof b=="number"?b:500,easing:"easeOutExpo",step:function(a,b){c.css({"-o-transform":"rotate("+a+"deg)","-webkit-transform":"rotate("+a+"deg)","-moz-transform":"rotate("+a+"deg)","-ms-transform":"rotate("+a+"deg)"})}})},renderEffectiveParents:function(a,c){var d=a.first(),e=[],f=[],g=this.activeOn,h,i;while(d.length>0&&!d.is(".aloha-editable")){if(g(d)){f.push("<span>"+d[0].tagName.toLowerCase()+"</span>"),h=f.length,i=[];while(h--)i.push(f[h]);e.push(j('<div class="aloha-sidebar-panel-parent"><div class="aloha-sidebar-panel-parent-path">{path}</div><div class="aloha-sidebar-panel-parent-content aloha-sidebar-opened">{content}</div></div>',{path:i.join(""),content:typeof c=="function"?c(d):"----"}))}d=d.parent()}this.setContent(e.join("")),b(".aloha-sidebar-panel-parent-path").click(function(){var a=b(this).parent().find(".aloha-sidebar-panel-parent-content");a.hasClass("aloha-sidebar-opened")?a.hide().removeClass("aloha-sidebar-opened"):a.show().addClass("aloha-sidebar-opened")}),this.content.height("auto").find(".aloha-sidebar-panel-content-inner").height("auto")}});var p=new n({position:"left",width:250}),q=new n({position:"right",width:250});return a.Sidebar={left:p,right:q},a.Sidebar}),GENTICS=window.GENTICS||{},GENTICS.Utils=GENTICS.Utils||{},define("util/position",["aloha/jquery"],function(a){var b=a,c=window.GENTICS,d=window.Class,e=window.console;c.Utils.Position={},c.Utils.Position.w=a(window),c.Utils.Position.Scroll={top:0,left:0,isScrolling:!1},c.Utils.Position.ScrollCorrection={top:100,left:50},c.Utils.Position.Mouse={x:0,y:0,oldX:0,oldY:0,isMoving:!1,triggeredMouseStop:!0},c.Utils.Position.mouseStopCallbacks=[],c.Utils.Position.mouseMoveCallbacks=[],c.Utils.Position.update=function(){var a=this.w.scrollTop(),b=this.w.scrollLeft(),c;if(this.Scroll.isScrolling)this.Scroll.top==a&&this.Scroll.left==b&&(this.Scroll.isScrolling=!1);else if(this.Scroll.top!=a||this.Scroll.left!=b)this.Scroll.isScrolling=!0;this.Scroll.top=a,this.Scroll.left=b;if(this.Mouse.x==this.Mouse.oldX&&this.Mouse.y==this.Mouse.oldY){this.Mouse.isMoving=!1;if(!this.Mouse.triggeredMouseStop){this.Mouse.triggeredMouseStop=!0;for(c=0;c<this.mouseStopCallbacks.length;c++)this.mouseStopCallbacks[c].call()}}else{this.Mouse.isMoving=!0,this.Mouse.triggeredMouseStop=!1;for(c=0;c<this.mouseMoveCallbacks.length;c++)this.mouseMoveCallbacks[c].call()}this.Mouse.oldX=this.Mouse.x,this.Mouse.oldY=this.Mouse.y},c.Utils.Position.addMouseStopCallback=function(a){return this.mouseStopCallbacks.push(a),this.mouseStopCallbacks.length-1},c.Utils.Position.addMouseMoveCallback=function(a){return this.mouseMoveCallbacks.push(a),this.mouseMoveCallbacks.length-1},a(function(){setInterval(function(){c.Utils.Position.update()},500)}),a("html").mousemove(function(a){c.Utils.Position.Mouse.x=a.pageX,c.Utils.Position.Mouse.y=a.pageY})}),define("aloha/repositorymanager",["aloha/core","util/class","aloha/jquery","aloha/console"],function(a,b,c,d){return a.RepositoryManager=b.extend({repositories:[],settings:{},init:function(){var b=this.repositories,d=0,e=b.length,f;a.settings&&a.settings.repositories&&(this.settings=a.settings.repositories),this.settings.timeout=this.settings.timeout||5e3;for(;d<e;++d)f=b[d],f.settings||(f.settings={}),this.settings[f.repositoryId]&&c.extend(f.settings,this.settings[f.repositoryId]),f.init()},register:function(a){this.getRepository(a.repositoryId)?d.warn(this,"A repository with name { "+a.repositoryId+" } already registerd. Ignoring this."):this.repositories.push(a)},getRepository:function(a){var b=this.repositories,c=0,d=b.length;for(;c<d;++c)if(b[c].repositoryId===a)return b[c];return null},query:function(a,b){var d=this,e,f=[],g={numItems:0,hasMoreItems:!1},h=[],i=0,j,k,l,m=function(a,e){if(i===0)return;var h=a?a.length:0;if(h){if(!a[0].repositoryId){var k=this.repositoryId,l;for(l=0;l<h;++l)a[l].repositoryId=k}c.merge(f,a)}e&&g?(c.isNumeric(e.numItems)&&c.isNumeric(g.numItems)?g.numItems+=e.numItems:g.numItems=undefined,c.isBoolean(e.hasMoreItems)&&c.isBoolean(g.hasMoreItems)?g.hasMoreItems=g.hasMoreItems||e.hasMoreItems:g.hasMoreItems=undefined):g=undefined,--i===0&&d.queryCallback(b,f,g,j)},n=parseInt(a.timeout,10)||this.settings.timeout;j=setTimeout(function(){i=0,d.queryCallback(b,f,g,j)},n),a.repositoryId?h.push(this.getRepository(a.repositoryId)):h=this.repositories,l=h.length;var o=[];for(k=0;k<l;++k)e=h[k],typeof e.query=="function"&&(++i,o.push(e));l=o.length;for(k=0;k<l;++k)e=o[k],e.query(a,function(){m.apply(e,arguments)});i===0&&this.queryCallback(b,f,g,j)},queryCallback:function(a,b,c,d){d&&(clearTimeout(d),d=undefined);var e={items:b,results:b.length};c&&(e.numItems=c.numItems,e.hasMoreItems=c.hasMoreItems),a.call(this,e)},getChildren:function(b,d){var e=this,f,g=[],h=[],i=0,j,k,l,m=function(a){if(i===0)return;c.merge(g,a),--i===0&&e.getChildrenCallback(d,g,j)};if(b.inFolderId==="aloha"){var n=b.repositoryFilter,o=n&&n.length;l=this.repositories.length;for(k=0;k<l;++k)f=this.repositories[k],(!o||c.inArray(f.repositoryId,n)>-1)&&h.push(new a.RepositoryFolder({id:f.repositoryId,name:f.repositoryName,repositoryId:f.repositoryId,type:"repository",hasMoreItems:!0}));e.getChildrenCallback(d,h,null);return}h=this.repositories;var p=parseInt(b.timeout,10)||this.settings.timeout;j=setTimeout(function(){i=0,e.getChildrenCallback(d,g,j)},p),l=h.length;for(k=0;k<l;++k)f=h[k],typeof f.getChildren=="function"&&(++i,f.getChildren(b,function(){m.apply(f,arguments)}));i===0&&this.getChildrenCallback(d,g,j)},getChildrenCallback:function(a,b,c){c&&(clearTimeout(c),c=undefined),a.call(this,b)},makeClean:function(a){var b=this,c={},e=0,f=b.repositories.length;a.find("[data-gentics-aloha-repository="+this.prefix+"]").each(function(){for(;e<f;++e)c.makeClean(a);d.debug(b,"Passing contents of HTML Element with id { "+this.attr("id")+" } for cleaning to repository { "+c.repositoryId+" }"),c.makeClean(this)})},markObject:function(a,b){if(!a)return;if(b){var e=this.getRepository(b.repositoryId);e?(c(a).attr({"data-gentics-aloha-repository":b.repositoryId,"data-gentics-aloha-object-id":b.id}),e.markObject(a,b)):d.error(this,"Trying to apply a repository { "+b.name+" } to an object, but item has no repositoryId.")}else c(a).removeAttr("data-gentics-aloha-repository").removeAttr("data-gentics-aloha-object-id")},getObject:function(a,b){var d=this,e=c(a),f=this.getRepository(e.attr("data-gentics-aloha-repository")),g=e.attr("data-gentics-aloha-object-id");f&&g&&(this.itemCache=this.itemCache||[],this.itemCache[f.repositoryId]=this.itemCache[f.repositoryId]||[],this.itemCache[f.repositoryId][g]?b.call(this,[this.itemCache[f.repositoryId][g]]):f.getObjectById(g,function(a){d.itemCache[f.repositoryId][g]=a[0],b.call(this,a)}))},toString:function(){return"repositorymanager"}}),a.RepositoryManager=new a.RepositoryManager,a.RepositoryManager}),function(){function b(a,b,c,d,e,f){b[a]&&(c.push(a),(b[a]===!0||b[a]===1)&&d.push(e+a+"/"+f))}function c(a,b,c,d,e){var f=d+b+"/"+e;require._fileExists(a.nameToUrl(f,null))&&c.push(f)}var a=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",{version:"0.24.0",load:function(d,e,f,g){g=g||{};var h,i=a.exec(d),j=i[1],k=i[4],l=i[5],m=k.split("-"),n=[],o={},p,q,r="";i[5]?(j=i[1],h=j+l):(h=d,l=i[4],k=g.locale||(g.locale=typeof navigator=="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),m=k.split("-"));if(g.isBuild){n.push(h),c(e,"root",n,j,l);for(p=0;q=m[p];p++)r+=(r?"-":"")+q,c(e,r,n,j,l);e(n),f()}else e([h],function(a){var c=[];b("root",a,c,n,j,l);for(p=0;q=m[p];p++)r+=(r?"-":"")+q,b(r,a,c,n,j,l);e(n,function(){var b,d;for(b=c.length-1;b>-1&&(q=c[b]);b--){d=a[q];if(d===!0||d===1)d=e(j+q+"/"+l);require.mixin(o,d)}o.t=function(a){return this[a]?this[a]:a},f(o)})})}})}(),define("aloha/nls/i18n",{root:{"plugin.abbr.floatingmenu.tab.abbr":"Abbreviation","floatingmenu.tab.format":"Format","floatingmenu.tab.insert":"Insert",yes:"Yes",no:"No",cancel:"Cancel","repository.no_item_found":"No item found."
,"repository.loading":"Loading","repository.no_items_found_yet":"No items found yet..."},de:!0}),define("aloha/ext-alohaproxy",["aloha/jquery","aloha/ext","aloha/repositorymanager","aloha/console","i18n!aloha/nls/i18n"],function(a,b,c,d){b.data.AlohaProxy=function(){var a={};a[b.data.Api.actions.read]=!0,b.data.AlohaProxy.superclass.constructor.call(this,{api:a}),this.params={queryString:null,objectTypeFilter:null,filter:null,inFolderId:null,orderBy:null,maxItems:null,skipCount:null,renditionFilter:null,repositoryId:null}};var e=Aloha.require("i18n!aloha/nls/i18n");b.extend(b.data.AlohaProxy,b.data.DataProxy,{doRequest:function(b,e,f,g,h,i,j){a.extend(this.params,f);try{c.query(this.params,function(a){h.call(i,g.readRecords(a),j,!0)})}catch(k){return d.error("Ext.data.AlohaProxy","An error occured while querying repositories."),this.fireEvent("loadexception",this,null,j,k),this.fireEvent("exception",this,"response",b,j,null,k),!1}},setObjectTypeFilter:function(a){this.params.objectTypeFilter=a},getObjectTypeFilter:function(){return this.params.objectTypeFilter},setParams:function(b){a.extend(this.params,b)}})}),define("aloha/ext-alohareader",["aloha/ext"],function(a){a.data.AlohaObjectReader=function(b,c){b={},a.applyIf(b,{idProperty:"id",root:"items",totalProperty:"results",fields:["id","url","name","type","weight","path","repositoryId"]}),a.data.JsonReader.superclass.constructor.call(this,b,b.fields)},a.extend(a.data.AlohaObjectReader,a.data.JsonReader,{})}),define("aloha/ext-alohatreeloader",["aloha/ext","aloha/repositorymanager"],function(a,b){a.tree.AlohaTreeLoader=function(b){a.apply(this,b),a.tree.AlohaTreeLoader.superclass.constructor.call(this)},a.extend(a.tree.AlohaTreeLoader,a.tree.TreeLoader,{paramOrder:["node","id"],nodeParameter:"id",directFn:function(a,c,d){var e={inFolderId:a.id,objectTypeFilter:this.objectTypeFilter,repositoryId:a.repositoryId};b.getChildren(e,function(b){var c={};c={status:!0,scope:this,argument:{callback:d,node:a}},typeof d=="function"&&d(b,c)})},createNode:function(b){return b.name&&(b.text=b.name),b.hasMoreItems&&(b.leaf=!b.hasMoreItems),b.objectType&&(b.cls=b.objectType),a.tree.TreeLoader.prototype.createNode.call(this,b)},objectTypeFilter:null,setObjectTypeFilter:function(a){this.objectTypeFilter=a},getObjectTypeFilter:function(){return this.objectTypeFilter}})}),define("aloha/ui",["aloha/core","util/class","aloha/jquery","aloha/floatingmenu","aloha/ext","aloha/console","i18n!aloha/nls/i18n"],function(a,b,c,d,e,f,g){var h=window.GENTICS;return a.ui=a.ui||{},e.MessageBox.buttonText.yes=g.t("yes"),e.MessageBox.buttonText.no=g.t("no"),e.MessageBox.buttonText.cancel=g.t("cancel"),e.ux.GENTICSMenu=e.extend(e.menu.Menu,{onRender:function(){e.ux.GENTICSMenu.superclass.onRender.apply(this,arguments),c(this.el.dom).mousedown(function(a){a.stopPropagation()})}}),a.ui.Button=b.extend({_constructor:function(a){this.init(a)},init:function(a){this.label=!1,this.name=!1,this.iconClass=!1,this.icon=!1,this.onclick=!1,this.menu=null,this.toggle=!1,this.pressed=!1,this.visible=!0,this.enabled=!0,this.tooltip=!1,this.extButton=null,this.listenerQueue=[],h.Utils.applyProperties(this,a),this.name===!1&&(this.name=this.iconClass),this.id=this.generateId()},generateId:function(){return a.ui.Button.idCounter=a.ui.Button.idCounter+1,"aloha-button"+a.ui.Button.idCounter},setPressed:function(a){this.toggle&&(this.pressed=a,typeof this.extButton=="object"&&this.extButton!=null&&this.extButton.pressed!=a&&this.extButton.toggle(this.pressed))},isPressed:function(){return this.toggle?this.pressed:!1},show:function(){this.visible=!0},hide:function(){this.visible=!1},isVisible:function(){return this.visible},enable:function(){this.enabled=!0,typeof this.extButton=="object"&&this.extButton.enable()},disable:function(){this.enabled=!1,typeof this.extButton=="object"&&this.extButton.disable()},isEnabled:function(){return this.enabled},getExtMenu:function(){var a,b,c;if(this.menu&&typeof this.menu=="object"){a=new e.ux.GENTICSMenu;for(b=0;b<this.menu.length;++b)c=this.menu[b],a.addItem(new e.menu.Item(c.getExtMenuConfigProperties()))}return a},getExtMenuConfigProperties:function(){var a=this,b=this.getExtMenu();return{text:this.label,icon:this.icon,iconCls:this.iconClass,handler:function(){typeof a.onclick=="function"&&a.onclick()},menu:b}},getExtConfigProperties:function(){var a=this,b=this.getExtMenu(),c={text:this.label,enableToggle:this.toggle,pressed:this.pressed,icon:this.icon,iconCls:this.iconClass,scale:this.scale||this.size,width:this.width||undefined,rowspan:this.rowspan||(this.size=="large"||this.size=="medium"?2:1),menu:b,handler:function(b,c){typeof a.onclick=="function"&&a.onclick.apply(a,[b,c]),a.toggle&&(a.pressed=!a.pressed)},xtype:b&&typeof this.onclick=="function"?"splitbutton":"button",tooltipType:"qtip",tooltip:this.tooltip,id:this.id,arrowAlign:this.arrowAlign||(this.size=="large"||this.size=="small"?"right":"bottom")};return c}}),a.ui.Button.idCounter=0,e.ux.MultiSplitButton=e.extend(e.Component,{initComponent:function(){var a=this;this.on("beforehide",function(){a.closePanel()})},autoEl:{cls:"aloha-multisplit-wrapper"},ulObj:null,panelButton:null,wrapper:null,panelOpened:!1,_getItems:function(){var b=this,d=[],e,f;return a.settings.components&&a.settings.components[this.name]&&typeof a.settings.components[this.name]=="object"?(c.each(a.settings.components[this.name],function(a,c){for(e=0,f=b.items.length;e<f;e++)if(b.items[e].name===c){d.push(b.items[e]);break}}),d):this.items},onRender:function(){e.ux.MultiSplitButton.superclass.onRender.apply(this,arguments),this.wrapper=c(this.el.dom);var a=this,b,f,g,h='<ul class="aloha-multisplit">';g=this._getItems();for(b=0;b<g.length;b++){f=g[b],typeof f.visible=="undefined"&&(f.visible=!0);if(f.wide)continue;h+='<li><button xmlns:ext="http://www.extjs.com/" class="'+f.iconClass+'" ext:qtip="'+f.tooltip+'" gtxmultisplititem="'+b+'">&#160;</button>'+"</li>"}for(b=0;b<g.length;b++){f=g[b];if(!f.wide)continue;h+='<li><button xmlns:ext="http://www.extjs.com/" class="aloha-multisplit-wide '+f.iconClass+'" ext:qtip="'+f.tooltip+'" gtxmultisplititem="'+b+'">'+f.text+"</button>"+"</li>"}h+="</ul>",d.extTabPanel.on("move",function(){a.closePanel()}),d.extTabPanel.on("tabchange",function(){a.closePanel()}),this.ulObj=c(this.el.createChild(h).dom).click(function(b){a.onClick(b)}),this.panelButton=c(this.el.createChild('<button class="aloha-multisplit-toggle aloha-multisplit-toggle-open">&#160;</button>').dom).click(function(){a.togglePanel()})},onClick:function(a){if(!a.target.attributes.gtxmultisplititem)return;var b=c(a.target);this.closePanel(),b.hasClass("aloha-multisplit-wide")||this.setActiveDOMElement(b),this.items[a.target.attributes.gtxmultisplititem.value].click()},setActiveItem:function(a){var b;this.closePanel(),b=c("#"+this.id+" .aloha-button-"+a),b.length===1?(this.setActiveDOMElement(b),this.activeItem=a):(this.setActiveDOMElement(null),this.activeItem=null)},setActiveDOMElement:function(a){var b=this,d;while(typeof b!="undefined"){if(b.hidden){this.activeDOMElement=a;return}b=b.ownerCt}c(this.ulObj).find(".aloha-multisplit-activeitem").removeClass("aloha-multisplit-activeitem"),a&&a.parent().addClass("aloha-multisplit-activeitem");if(!a||a.parent().is(":hidden"))return;a&&this.ulObj&&(this.ulObj.css("margin-top",0),d=a.position().top,this.ulObj.css({"margin-top":-d+6,height:46+d-6})),this.activeDOMElement=undefined},togglePanel:function(){this.panelOpened?this.closePanel():this.openPanel()},openPanel:function(){if(this.panelOpened)return;var a=this.wrapper.offset();this.ulObj.appendTo(c("body")).addClass("aloha-multisplit-expanded").mousedown(function(a){a.stopPropagation()}).css({top:a.top-1,left:a.left-1}).animate({height:this.ulObj.prop?this.ulObj.prop("scrollHeight"):this.ulObj.attr("scrollHeight")}),this.panelButton.removeClass("aloha-multisplit-toggle-open").addClass("aloha-multisplit-toggle-close"),this.panelOpened=!0},closePanel:function(){if(!this.panelOpened)return;this.ulObj.removeClass("aloha-multisplit-expanded").appendTo(this.wrapper),this.panelButton.addClass("aloha-multisplit-toggle-open").removeClass("aloha-multisplit-toggle-close"),this.panelOpened=!1},hideItem:function(a){for(var b=0;b<this.items.length;b++)if(this.items[b].name==a){this.items[b].visible=!1,c("#"+this.id+" [gtxmultisplititem="+b+"]").parent().hide();return}},showItem:function(a){for(var b=0;b<this.items.length;b++)if(this.items[b].name==a){this.items[b].visible=!0,c("#"+this.id+" [gtxmultisplititem="+b+"]").parent().show();return}}}),e.reg("alohamultisplitbutton",e.ux.MultiSplitButton),a.ui.MultiSplitButton=b.extend({_constructor:function(a){this.items=[],h.Utils.applyProperties(this,a),this.id=this.generateId()},generateId:function(){return a.ui.MultiSplitButton.idCounter=a.ui.MultiSplitButton.idCounter+1,"aloha-multisplitbutton"+a.ui.MultiSplitButton.idCounter},getExtConfigProperties:function(){return{xtype:"alohamultisplitbutton",items:this.items,name:this.name,id:this.id}},setActiveItem:function(a){this.extButton&&typeof a!="undefined"&&this.extButton.setActiveItem(a)},isVisible:function(){for(var a=0;a<this.items.length;a++)if(this.items[a].visible)return!0;return!1},showItem:function(a){if(typeof this.extButton=="undefined")return;this.extButton.showItem(a)},hideItem:function(a){if(typeof this.extButton=="undefined")return;this.extButton.hideItem(a)}}),a.i18n=function(a,b,c){return f.deprecated("Aloha",'i18n() is deprecated. Use module "i18n!aloha/nls/i18n" instead.'),b},a.showMessage=function(b){d.obj&&d.obj.css("z-index",8900);switch(b.type){case a.Message.Type.ALERT:e.MessageBox.alert(b.title,b.text,b.callback);break;case a.Message.Type.CONFIRM:e.MessageBox.confirm(b.title,b.text,b.callback);break;case a.Message.Type.WAIT:e.MessageBox.wait(b.text,b.title);break;default:a.log("warn",this,"Unknown message type for message {"+b.toString()+"}")}},a.hideMessage=function(){e.MessageBox.hide()},a.isMessageVisible=function(){return e.MessageBox.isVisible()},a.ui.MultiSplitButton.idCounter=0,a.ui}),define("aloha/ui-attributefield",["aloha/core","aloha/jquery","aloha/ext","i18n!aloha/nls/i18n","aloha/ui","aloha/repositorymanager","aloha/selection","aloha/ext-alohaproxy","aloha/ext-alohareader"],function(a,b,c,d,e,f,g){var h=void 0,i=function(a){return a?a='<tpl for="."><div class="x-combo-list-item"><tpl if="this.hasRepositoryTemplate(values)">{[ this.renderRepositoryTemplate(values) ]}</tpl><tpl if="!this.hasRepositoryTemplate(values)">'+a+"</tpl>"+"</div></tpl>":a='<tpl for="."><div class="x-combo-list-item"><tpl if="this.hasRepositoryTemplate(values)">{[ this.renderRepositoryTemplate(values) ]}</tpl><tpl if="!this.hasRepositoryTemplate(values)"><span><b>{name}</b></span></tpl></div></tpl>',new c.XTemplate(a,{hasRepositoryTemplate:function(a){var b=f.getRepository(a.repositoryId);return b&&b.hasTemplate()},renderRepositoryTemplate:function(a){var b=f.getRepository(a.repositoryId);if(b&&b.hasTemplate()){if(!b._ExtTPL||b.template!==b._ExtTPLcache)b._ExtTPL=new c.XTemplate(b.template),b._ExtTPLcache=b.template;return b._ExtTPL.apply(a)}}})},j;c.ux.AlohaAttributeField=c.extend(c.form.ComboBox,{typeAhead:!1,mode:"remote",triggerAction:"all",width:300,hideTrigger:!0,minChars:3,valueField:"id",displayField:"name",listEmptyText:d.t("repository.no_item_found"),loadingText:d.t("repository.loading")+"...",enableKeyEvents:!0,store:new c.data.Store({proxy:new c.data.AlohaProxy,reader:new c.data.AlohaObjectReader}),clickAttached:!1,tpl:i(),onSelect:function(a){this.setItem(a.data),typeof this.alohaButton.onSelect=="function"&&this.alohaButton.onSelect.call(this.alohaButton,a.data),this.collapse()},finishEditing:function(){var a=b(this.getTargetObject()),c;a&&((c=a.attr("data-original-background-color"))?b(a).css("background-color",c):b(a).css("background-color",""),b(a).removeAttr("data-original-background-color"));if(j===a.attr(this.targetAttribute))return;this.resourceItem||f.markObject(this.targetObject),this.getValue()===""&&(this.wrap&&b(this.wrap.dom.children[0]).css("color","#AAA"),this.setValue(this.placeholder))},listeners:{beforequery:function(a){if(this.noQuery){a.cancel=!0;return}this.store!==null&&this.store.proxy!==null&&this.store.proxy.setParams({objectTypeFilter:this.getObjectTypeFilter(),queryString:a.query})},afterrender:function(a,c){b(this.wrap.dom.children[0]).css("color","#AAA"),this.setValue(this.placeholder)},keydown:function(a,b){if(b.keyCode==13||b.keyCode==27)this.isExpanded()?this.ALOHAwasExpanded=!0:this.ALOHAwasExpanded=!1,b.preventDefault()},keyup:function(a,b){(b.keyCode==13||b.keyCode==27)&&!this.ALOHAwasExpanded&&setTimeout(function(){g.getRangeObject().select()},0),this.resourceItem&&this.resourceValue!==this.wrap.dom.children[0].value&&(this.resourceItem=null,this.resourceValue=null);if(!this.resourceItem){var c=this.wrap.dom.children[0].value;this.setAttribute(this.targetAttribute,c)}},focus:function(a,c){var d=b(this.getTargetObject()),e=d.css("background-color");this.getValue()===this.placeholder&&(this.setValue(""),b(this.wrap.dom.children[0]).css("color","black")),d&&d.context&&d.context.style&&d.context.style["background-color"]&&d.attr("data-original-background-color",d.context.style["background-color"]),d.css("background-color","#80B5F2")},blur:function(a,b){this.finishEditing()},hide:function(a,b){this.finishEditing()},expand:function(b){this.noQuery&&this.collapse();if(!this.clickAttached){var c=this;this.mon(this.innerList,"mousedown",function(b){a.eventHandled=!0},this),this.mon(this.innerList,"mouseup",function(b){a.eventHandled=!1},this),this.clickAttached=!0}}},setItem:function(a,b){this.resourceItem=a;if(a){b=b?b:this.displayField;var c=a[b];this.setValue(c),this.resourceValue=c,this.setAttribute(this.targetAttribute,a[this.valueField]),f.markObject(this.targetObject,a)}else this.resourceValue=null},getItem:function(){return this.resourceItem},setAttribute:function(a,c,d,e){var f=!0,g;this.targetObject&&(typeof e!="undefined"&&(g=new RegExp(d),e.match(g)||(f=!1)),f?b(this.targetObject).attr(a,c):b(this.targetObject).removeAttr(a))},setTargetObject:function(a,c){var d=this;this.targetObject=a,this.targetAttribute=c,this.setItem(null),a&&c&&(j=b(a).attr(c)),this.targetObject&&this.targetAttribute?this.setValue(b(this.targetObject).attr(this.targetAttribute)):this.setValue("");var d=this;f.getObject(a,function(a){a&&a.length>0&&d.setItem(a[0])})},getTargetObject:function(){return this.targetObject},setObjectTypeFilter:function(a){this.objectTypeFilter=a},getObjectTypeFilter:function(){return this.objectTypeFilter},noQuery:!0}),c.reg("alohaattributefield",c.ux.AlohaAttributeField),e.AttributeField=e.Button.extend({_constructor:function(a){this.onSelect=null,this.listenerQueue=[],this.objectTypeFilter=null,this.tpl=null,this.displayField=null,this.valueField=null,this.init(a)},getExtConfigProperties:function(){var a={alohaButton:this,xtype:"alohaattributefield",rowspan:this.rowspan||h,width:this.width||h,placeholder:this.placeholder||h,id:this.id,cls:this.cls||h};return this.valueField&&(a.valueField=this.valueField),this.displayField&&(a.displayField=this.displayField),this.minChars&&(a.minChars=this.minChars),a},setTargetObject:function(a,b){this.extButton&&this.extButton.setTargetObject(a,b)},getTargetObject:function(){return this.extButton?this.extButton.getTargetObject():null},focus:function(){this.extButton&&(this.extButton.focus(),this.extButton.getValue().length>0&&this.extButton.selectText(0,this.extButton.getValue().length))},addListener:function(a,b,c){var d;this.extButton?this.extButton.addListener(a,b,null):(d={eventName:a,handler:b,scope:c,options:null},this.listenerQueue.push(d))},setAttribute:function(a,b,c,d){this.extButton&&this.extButton.setAttribute(a,b,c,d)},setObjectTypeFilter:function(a){this.extButton?(this.noQuery=!1,this.extButton.setObjectType(a)):(a||(a="all"),this.objectTypeFilter=a)},setItem:function(a,b){this.extButton&&this.extButton.setItem(a,b)},getItem:function(){return this.extButton?this.extButton.getItem():null},getValue:function(){return this.extButton?this.extButton.getValue():null},setValue:function(a){this.extButton&&this.extButton.setValue(a)},getQueryValue:function(){return this.extButton?this.extButton.getValue():null},setDisplayField:function(a){var b;return this.extButton?b=this.extButton.displayField=a:b=this.displayField=a,b},setTemplate:function(a){var b;return this.extButton?b=this.extButton.tpl=i(a):b=this.tpl=i(a),b}})}),define("aloha/ui-browser",["aloha/ext","aloha/ui"],function(a,b){var c=window.Class;b.Browser=c.extend({_constructor:function(){this.onSelect=null;var b=this;this.grid=new a.grid.GridPanel({region:"center",autoScroll:!0,store:new a.data.Store({proxy:new a.data.AlohaProxy,reader:new a.data.AlohaObjectReader}),columns:[{id:"name",header:"Name",width:100,sortable:!0,dataIndex:"name"},{header:"URL",renderer:function(a){return a},width:300,sortable:!0,dataIndex:"url"}],stripeRows:!0,autoExpandColumn:"name",height:350,width:600,title:"Objectlist",stateful:!0,stateId:"grid",selModel:new a.grid.RowSelectionModel({singleSelect:!0}),listeners:{dblclick:function(a){b.onItemSelect()}}}),this.grid.getSelectionModel().on({selectionchange:function(a,c,d){var e=b.grid.getSelectionModel().getSelected();e?this.win.buttons[1].enable():this.win.buttons[1].disable()},scope:this}),this.tree=new a.tree.TreePanel({region:"center",useArrows:!0,autoScroll:!0,animate:!0,enableDD:!0,containerScroll:!0,border:!1,loader:new a.tree.AlohaTreeLoader,root:{nodeType:"async",text:"Aloha Repositories",draggable:!1,id:"aloha"},rootVisible:!1,listeners:{beforeload:function(a){this.loader.baseParams={node:a.attributes}}}}),this.tree.getSelectionModel().on({selectionchange:function(a,c){if(c){var d=c.attributes;b.grid.store.load({params:{inFolderId:d.id,objectTypeFilter:b.objectTypeFilter,repositoryId:d.repositoryId}})}},scope:this}),this.nav=new a.Panel({title:"Navigation",region:"west",width:300,layout:"fit",collapsible:!0,items:[this.tree]}),this.win=new a.Window({title:"Resource Selector",layout:"border",width:800,height:300,closeAction:"hide",onEsc:function(){this.hide()},defaultButton:this.nav,plain:!0,initHidden:!0,items:[this.nav,this.grid],buttons:[{text:"Close",handler:function(){b.win.hide()}},{text:"Select",disabled:!0,handler:function(){b.onItemSelect()}}],toFront:function(b){return this.manager=this.manager||a.WindowMgr,this.manager.bringToFront(this),this.setZIndex(9999999999),this}}),this.onItemSelect=function(){var a=this.grid.getSelectionModel(),b=a?a.getSelected():null,c=b?b.data:null;this.win.hide(),typeof this.onSelect=="function"&&this.onSelect.call(this,c)}},setObjectTypeFilter:function(a){this.objectTypeFilter=a},getObjectTypeFilter:function(){return this.objectTypeFilter},show:function(){this.win.show(),this.win.toFront(!0),this.win.focus()}})}),define("aloha/repository",["aloha/core","util/class","aloha/repositorymanager"],function(a,b,c){var d=b.extend({_constructor:function(a,b){this.repositoryId=a,this.settings={},this.repositoryName=b?b:a,c.register(this)},init:function(){},query:null,getChildren:null,makeClean:function(a){},markObject:function(a,b){},setTemplate:function(a){a?this.template=a:this.template=null},hasTemplate:function(){return this.template?!0:!1},getTemplate:function(){return this.template},getObjectById:function(a,b){return!0}});return a.AbstractRepository=d,d}),define("aloha/repositoryobjects",["aloha/core","util/class"],function(a,b){var c=window.GENTICS;a.RepositoryObject=function(){},a.RepositoryDocument=b.extend({_constructor:function(a){var b=a;this.type="document";if(!b.id||!b.name||!b.repositoryId)return;c.Utils.applyProperties(this,a),this.baseType="document"}}),a.RepositoryFolder=b.extend({_constructor:function(a){var b=a;this.type="folder";if(!b.id||!b.name||!b.repositoryId)return;c.Utils.applyProperties(this,a),this.baseType="folder"}})}),function(){function d(){var a="./",b,c=document.getElementsByTagName("script"),d,e=c.length,f=/\/aloha.js$/,g=/[^\/]*\.js$/;for(d=0;d<e&&(b=c[d]);++d){if(f.test(b.src)){a=b.src.replace(f,"");break}a==="./"&&b.getAttribute("data-aloha-plugins")&&g.test(b.src)&&(a=b.src.replace(g,""))}return a}"use strict";var a=window.jQuery.noConflict(!0),b,c;window.Aloha=window.Aloha||{},Aloha.defaults={},Aloha.settings=Aloha.settings||{},Aloha.jQuery=Aloha.settings.jQuery||Aloha.jQuery||a||null,Aloha._require=require,Aloha.define=define,Aloha.settings.baseUrl=Aloha.settings.baseUrl||d(),Aloha.settings.requireConfig={context:"aloha",baseUrl:Aloha.settings.baseUrl,locale:Aloha.settings.locale},c=require.config(Aloha.settings.requireConfig),Aloha.require=function(a){return arguments.length==1&&typeof a=="function"?c(["aloha"],a):c.apply(this,arguments)},b=Aloha.jQuery.Deferred(),Aloha.bind=function(a,c){return a=="aloha-ready"?Aloha.stage!="alohaReady"?b.done(c):c():Aloha.jQuery(Aloha,"body").bind(a,c),this},Aloha.trigger=function(a,c){return a=="aloha-ready"&&Aloha.jQuery(b.resolve),Aloha.jQuery(Aloha,"body").trigger(a,c),this},Aloha.ready=function(a){return this.bind("aloha-ready",a),this},function(a){require.onError=function(b){var c=[],d=Aloha.jQuery.trim(b.requireModules).split(" ");for(var e=0;e<d.length;e++)switch(b.requireType){case"timeout":/^aloha\/.+/.test(d[e])?c.push(d[e]):window.console&&typeof window.console.error=="function"&&window.console.error("Aloha-Editor Error: The following module failed to load: "+d[e]);break;default:a.apply({},arguments)}throw"Aloha-Editor Exception: The following core file"+(c.length?"s have":" has")+" timed-out while loading: "+c.join(", ")}}(require.onError)}(),define("aloha",[],function(){return Aloha}),require(Aloha.settings.requireConfig,["aloha/jquery","aloha/ext","util/json2"],function(){require(Aloha.settings.requireConfig,["vendor/jquery.json-2.2.min","vendor/jquery.store","aloha/rangy-core","util/class","util/lang","util/range","util/dom","aloha/core","aloha/editable","aloha/console","aloha/markup","aloha/message","aloha/plugin","aloha/selection","aloha/command","aloha/jquery.patch","aloha/jquery.aloha","aloha/sidebar","util/position","aloha/ext-alohaproxy","aloha/ext-alohareader","aloha/ext-alohatreeloader","aloha/ui","aloha/ui-attributefield","aloha/ui-browser","aloha/floatingmenu","aloha/repositorymanager","aloha/repository","aloha/repositoryobjects","aloha/contenthandlermanager"],function(){Aloha.jQuery(Aloha.init)})});