/*!
* This file is part of Aloha Editor Project http://aloha-editor.org
* Copyright Â© 2010-2011 Gentics Software GmbH, aloha@gentics.com
* Contributors http://aloha-editor.org/contribution.php 
* Licensed unter the terms of http://www.aloha-editor.org/license.html
*/
/*
* Aloha Editor is free software: you can redistribute it and/or modify
* it under the terms of the GNU Affero General Public License as published by
* the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.*
*
* Aloha Editor is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
* GNU Affero General Public License for more details.
*
* You should have received a copy of the GNU Affero General Public License
* along with this program. If not, see <http://www.gnu.org/licenses/>.
*/
define(["aloha/core","util/class","aloha/jquery","aloha/floatingmenu","aloha/ext","aloha/console","i18n!aloha/nls/i18n"],function(e,t,n,r,i,s,o){var u=window.GENTICS;return e.ui=e.ui||{},i.MessageBox.buttonText.yes=o.t("yes"),i.MessageBox.buttonText.no=o.t("no"),i.MessageBox.buttonText.cancel=o.t("cancel"),i.ux.GENTICSMenu=i.extend(i.menu.Menu,{onRender:function(){i.ux.GENTICSMenu.superclass.onRender.apply(this,arguments),n(this.el.dom).mousedown(function(e){e.stopPropagation()})}}),e.ui.Button=t.extend({_constructor:function(e){this.init(e)},init:function(e){this.label=!1,this.name=!1,this.iconClass=!1,this.icon=!1,this.onclick=!1,this.menu=null,this.toggle=!1,this.pressed=!1,this.visible=!0,this.enabled=!0,this.tooltip=!1,this.extButton=null,this.listenerQueue=[],u.Utils.applyProperties(this,e),this.name===!1&&(this.name=this.iconClass),this.id=this.generateId()},generateId:function(){return e.ui.Button.idCounter=e.ui.Button.idCounter+1,"aloha-button"+e.ui.Button.idCounter},setPressed:function(e){this.toggle&&(this.pressed=e,typeof this.extButton=="object"&&this.extButton!=null&&this.extButton.pressed!=e&&this.extButton.toggle(this.pressed))},isPressed:function(){return this.toggle?this.pressed:!1},show:function(){this.visible=!0},hide:function(){this.visible=!1},isVisible:function(){return this.visible},enable:function(){this.enabled=!0,typeof this.extButton=="object"&&this.extButton.enable()},disable:function(){this.enabled=!1,typeof this.extButton=="object"&&this.extButton.disable()},isEnabled:function(){return this.enabled},getExtMenu:function(){var e,t,n;if(this.menu&&typeof this.menu=="object"){e=new i.ux.GENTICSMenu;for(t=0;t<this.menu.length;++t)n=this.menu[t],e.addItem(new i.menu.Item(n.getExtMenuConfigProperties()))}return e},getExtMenuConfigProperties:function(){var e=this,t=this.getExtMenu();return{text:this.label,icon:this.icon,iconCls:this.iconClass,handler:function(){typeof e.onclick=="function"&&e.onclick()},menu:t}},getExtConfigProperties:function(){var e=this,t=this.getExtMenu(),n={text:this.label,enableToggle:this.toggle,pressed:this.pressed,icon:this.icon,iconCls:this.iconClass,scale:this.scale||this.size,width:this.width||undefined,rowspan:this.rowspan||(this.size=="large"||this.size=="medium"?2:1),menu:t,handler:function(t,n){typeof e.onclick=="function"&&e.onclick.apply(e,[t,n]),e.toggle&&(e.pressed=!e.pressed)},xtype:t&&typeof this.onclick=="function"?"splitbutton":"button",tooltipType:"qtip",tooltip:this.tooltip,id:this.id,arrowAlign:this.arrowAlign||(this.size=="large"||this.size=="small"?"right":"bottom")};return n}}),e.ui.Button.idCounter=0,i.ux.MultiSplitButton=i.extend(i.Component,{initComponent:function(){var e=this;this.on("beforehide",function(){e.closePanel()})},autoEl:{cls:"aloha-multisplit-wrapper"},ulObj:null,panelButton:null,wrapper:null,panelOpened:!1,_getItems:function(){var t=this,r=[],i,s;return e.settings.components&&e.settings.components[this.name]&&typeof e.settings.components[this.name]=="object"?(n.each(e.settings.components[this.name],function(e,n){for(i=0,s=t.items.length;i<s;i++)if(t.items[i].name===n){r.push(t.items[i]);break}}),r):this.items},onRender:function(){i.ux.MultiSplitButton.superclass.onRender.apply(this,arguments),this.wrapper=n(this.el.dom);var e=this,t,s,o,u='<ul class="aloha-multisplit">';o=this._getItems();for(t=0;t<o.length;t++){s=o[t],typeof s.visible=="undefined"&&(s.visible=!0);if(s.wide)continue;u+='<li><button xmlns:ext="http://www.extjs.com/" class="'+s.iconClass+'" ext:qtip="'+s.tooltip+'" gtxmultisplititem="'+t+'">&#160;</button>'+"</li>"}for(t=0;t<o.length;t++){s=o[t];if(!s.wide)continue;u+='<li><button xmlns:ext="http://www.extjs.com/" class="aloha-multisplit-wide '+s.iconClass+'" ext:qtip="'+s.tooltip+'" gtxmultisplititem="'+t+'">'+s.text+"</button>"+"</li>"}u+="</ul>",r.extTabPanel.on("move",function(){e.closePanel()}),r.extTabPanel.on("tabchange",function(){e.closePanel()}),this.ulObj=n(this.el.createChild(u).dom).click(function(t){e.onClick(t)}),this.panelButton=n(this.el.createChild('<button class="aloha-multisplit-toggle aloha-multisplit-toggle-open">&#160;</button>').dom).click(function(){e.togglePanel()})},onClick:function(e){if(!e.target.attributes.gtxmultisplititem)return;var t=n(e.target);this.closePanel(),t.hasClass("aloha-multisplit-wide")||this.setActiveDOMElement(t),this.items[e.target.attributes.gtxmultisplititem.value].click()},setActiveItem:function(e){var t;this.closePanel(),t=n("#"+this.id+" .aloha-button-"+e),t.length===1?(this.setActiveDOMElement(t),this.activeItem=e):(this.setActiveDOMElement(null),this.activeItem=null)},setActiveDOMElement:function(e){var t=this,r;while(typeof t!="undefined"){if(t.hidden){this.activeDOMElement=e;return}t=t.ownerCt}n(this.ulObj).find(".aloha-multisplit-activeitem").removeClass("aloha-multisplit-activeitem"),e&&e.parent().addClass("aloha-multisplit-activeitem");if(!e||e.parent().is(":hidden"))return;e&&this.ulObj&&(this.ulObj.css("margin-top",0),r=e.position().top,this.ulObj.css({"margin-top":-r+6,height:46+r-6})),this.activeDOMElement=undefined},togglePanel:function(){this.panelOpened?this.closePanel():this.openPanel()},openPanel:function(){if(this.panelOpened)return;var e=this.wrapper.offset();this.ulObj.appendTo(n("body")).addClass("aloha-multisplit-expanded").mousedown(function(e){e.stopPropagation()}).css({top:e.top-1,left:e.left-1}).animate({height:this.ulObj.prop?this.ulObj.prop("scrollHeight"):this.ulObj.attr("scrollHeight")}),this.panelButton.removeClass("aloha-multisplit-toggle-open").addClass("aloha-multisplit-toggle-close"),this.panelOpened=!0},closePanel:function(){if(!this.panelOpened)return;this.ulObj.removeClass("aloha-multisplit-expanded").appendTo(this.wrapper),this.panelButton.addClass("aloha-multisplit-toggle-open").removeClass("aloha-multisplit-toggle-close"),this.panelOpened=!1},hideItem:function(e){for(var t=0;t<this.items.length;t++)if(this.items[t].name==e){this.items[t].visible=!1,n("#"+this.id+" [gtxmultisplititem="+t+"]").parent().hide();return}},showItem:function(e){for(var t=0;t<this.items.length;t++)if(this.items[t].name==e){this.items[t].visible=!0,n("#"+this.id+" [gtxmultisplititem="+t+"]").parent().show();return}}}),i.reg("alohamultisplitbutton",i.ux.MultiSplitButton),e.ui.MultiSplitButton=t.extend({_constructor:function(e){this.items=[],u.Utils.applyProperties(this,e),this.id=this.generateId()},generateId:function(){return e.ui.MultiSplitButton.idCounter=e.ui.MultiSplitButton.idCounter+1,"aloha-multisplitbutton"+e.ui.MultiSplitButton.idCounter},getExtConfigProperties:function(){return{xtype:"alohamultisplitbutton",items:this.items,name:this.name,id:this.id}},setActiveItem:function(e){this.extButton&&typeof e!="undefined"&&this.extButton.setActiveItem(e)},isVisible:function(){for(var e=0;e<this.items.length;e++)if(this.items[e].visible)return!0;return!1},showItem:function(e){if(typeof this.extButton=="undefined")return;this.extButton.showItem(e)},hideItem:function(e){if(typeof this.extButton=="undefined")return;this.extButton.hideItem(e)}}),e.i18n=function(e,t,n){return s.deprecated("Aloha",'i18n() is deprecated. Use module "i18n!aloha/nls/i18n" instead.'),t},e.showMessage=function(t){r.obj&&r.obj.css("z-index",8900);switch(t.type){case e.Message.Type.ALERT:i.MessageBox.alert(t.title,t.text,t.callback);break;case e.Message.Type.CONFIRM:i.MessageBox.confirm(t.title,t.text,t.callback);break;case e.Message.Type.WAIT:i.MessageBox.wait(t.text,t.title);break;default:e.log("warn",this,"Unknown message type for message {"+t.toString()+"}")}},e.hideMessage=function(){i.MessageBox.hide()},e.isMessageVisible=function(){return i.MessageBox.isVisible()},e.ui.MultiSplitButton.idCounter=0,e.ui});