/*!
* This file is part of Aloha Editor Project http://aloha-editor.org
* Copyright Â© 2010-2011 Gentics Software GmbH, aloha@gentics.com
* Contributors http://aloha-editor.org/contribution.php 
* Licensed unter the terms of http://www.aloha-editor.org/license.html
*/
/*
* Aloha Editor is free software: you can redistribute it and/or modify
* it under the terms of the GNU Affero General Public License as published by
* the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.*
*
* Aloha Editor is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
* GNU Affero General Public License for more details.
*
* You should have received a copy of the GNU Affero General Public License
* along with this program. If not, see <http://www.gnu.org/licenses/>.
*/
define(["aloha/core","util/class","aloha/jquery","aloha/floatingmenu","aloha/ext","aloha/console","i18n!aloha/nls/i18n"],function(a,b,c,d,e,f,g){var h=window.GENTICS;return a.ui=a.ui||{},e.MessageBox.buttonText.yes=g.t("yes"),e.MessageBox.buttonText.no=g.t("no"),e.MessageBox.buttonText.cancel=g.t("cancel"),e.ux.GENTICSMenu=e.extend(e.menu.Menu,{onRender:function(){e.ux.GENTICSMenu.superclass.onRender.apply(this,arguments),c(this.el.dom).mousedown(function(a){a.stopPropagation()})}}),a.ui.Button=b.extend({_constructor:function(a){this.init(a)},init:function(a){this.label=!1,this.name=!1,this.iconClass=!1,this.icon=!1,this.onclick=!1,this.menu=null,this.toggle=!1,this.pressed=!1,this.visible=!0,this.enabled=!0,this.tooltip=!1,this.extButton=null,this.listenerQueue=[],h.Utils.applyProperties(this,a),this.name===!1&&(this.name=this.iconClass),this.id=this.generateId()},generateId:function(){return a.ui.Button.idCounter=a.ui.Button.idCounter+1,"aloha-button"+a.ui.Button.idCounter},setPressed:function(a){this.toggle&&(this.pressed=a,typeof this.extButton=="object"&&this.extButton!=null&&this.extButton.pressed!=a&&this.extButton.toggle(this.pressed))},isPressed:function(){return this.toggle?this.pressed:!1},show:function(){this.visible=!0},hide:function(){this.visible=!1},isVisible:function(){return this.visible},enable:function(){this.enabled=!0,typeof this.extButton=="object"&&this.extButton.enable()},disable:function(){this.enabled=!1,typeof this.extButton=="object"&&this.extButton.disable()},isEnabled:function(){return this.enabled},getExtMenu:function(){var a,b,c;if(this.menu&&typeof this.menu=="object"){a=new e.ux.GENTICSMenu;for(b=0;b<this.menu.length;++b)c=this.menu[b],a.addItem(new e.menu.Item(c.getExtMenuConfigProperties()))}return a},getExtMenuConfigProperties:function(){var a=this,b=this.getExtMenu();return{text:this.label,icon:this.icon,iconCls:this.iconClass,handler:function(){typeof a.onclick=="function"&&a.onclick()},menu:b}},getExtConfigProperties:function(){var a=this,b=this.getExtMenu(),c={text:this.label,enableToggle:this.toggle,pressed:this.pressed,icon:this.icon,iconCls:this.iconClass,scale:this.scale||this.size,width:this.width||undefined,rowspan:this.rowspan||(this.size=="large"||this.size=="medium"?2:1),menu:b,handler:function(b,c){typeof a.onclick=="function"&&a.onclick.apply(a,[b,c]),a.toggle&&(a.pressed=!a.pressed)},xtype:b&&typeof this.onclick=="function"?"splitbutton":"button",tooltipType:"qtip",tooltip:this.tooltip,id:this.id,arrowAlign:this.arrowAlign||(this.size=="large"||this.size=="small"?"right":"bottom")};return c}}),a.ui.Button.idCounter=0,e.ux.MultiSplitButton=e.extend(e.Component,{initComponent:function(){var a=this;this.on("beforehide",function(){a.closePanel()})},autoEl:{cls:"aloha-multisplit-wrapper"},ulObj:null,panelButton:null,wrapper:null,panelOpened:!1,_getItems:function(){var b=this,d=[],e,f;return a.settings.components&&a.settings.components[this.name]&&typeof a.settings.components[this.name]=="object"?(c.each(a.settings.components[this.name],function(a,c){for(e=0,f=b.items.length;e<f;e++)if(b.items[e].name===c){d.push(b.items[e]);break}}),d):this.items},onRender:function(){e.ux.MultiSplitButton.superclass.onRender.apply(this,arguments),this.wrapper=c(this.el.dom);var a=this,b,f,g,h='<ul class="aloha-multisplit">';g=this._getItems();for(b=0;b<g.length;b++){f=g[b],typeof f.visible=="undefined"&&(f.visible=!0);if(f.wide)continue;h+='<li><button xmlns:ext="http://www.extjs.com/" class="'+f.iconClass+'" ext:qtip="'+f.tooltip+'" gtxmultisplititem="'+b+'">&#160;</button>'+"</li>"}for(b=0;b<g.length;b++){f=g[b];if(!f.wide)continue;h+='<li><button xmlns:ext="http://www.extjs.com/" class="aloha-multisplit-wide '+f.iconClass+'" ext:qtip="'+f.tooltip+'" gtxmultisplititem="'+b+'">'+f.text+"</button>"+"</li>"}h+="</ul>",d.extTabPanel.on("move",function(){a.closePanel()}),d.extTabPanel.on("tabchange",function(){a.closePanel()}),this.ulObj=c(this.el.createChild(h).dom).click(function(b){a.onClick(b)}),this.panelButton=c(this.el.createChild('<button class="aloha-multisplit-toggle aloha-multisplit-toggle-open">&#160;</button>').dom).click(function(){a.togglePanel()})},onClick:function(a){if(!a.target.attributes.gtxmultisplititem)return;var b=c(a.target);this.closePanel(),b.hasClass("aloha-multisplit-wide")||this.setActiveDOMElement(b),this.items[a.target.attributes.gtxmultisplititem.value].click()},setActiveItem:function(a){var b;this.closePanel(),b=c("#"+this.id+" .aloha-button-"+a),b.length===1?(this.setActiveDOMElement(b),this.activeItem=a):(this.setActiveDOMElement(null),this.activeItem=null)},setActiveDOMElement:function(a){var b=this,d;while(typeof b!="undefined"){if(b.hidden){this.activeDOMElement=a;return}b=b.ownerCt}c(this.ulObj).find(".aloha-multisplit-activeitem").removeClass("aloha-multisplit-activeitem"),a&&a.parent().addClass("aloha-multisplit-activeitem");if(!a||a.parent().is(":hidden"))return;a&&this.ulObj&&(this.ulObj.css("margin-top",0),d=a.position().top,this.ulObj.css({"margin-top":-d+6,height:46+d-6})),this.activeDOMElement=undefined},togglePanel:function(){this.panelOpened?this.closePanel():this.openPanel()},openPanel:function(){if(this.panelOpened)return;var a=this.wrapper.offset();this.ulObj.appendTo(c("body")).addClass("aloha-multisplit-expanded").mousedown(function(a){a.stopPropagation()}).css({top:a.top-1,left:a.left-1}).animate({height:this.ulObj.prop?this.ulObj.prop("scrollHeight"):this.ulObj.attr("scrollHeight")}),this.panelButton.removeClass("aloha-multisplit-toggle-open").addClass("aloha-multisplit-toggle-close"),this.panelOpened=!0},closePanel:function(){if(!this.panelOpened)return;this.ulObj.removeClass("aloha-multisplit-expanded").appendTo(this.wrapper),this.panelButton.addClass("aloha-multisplit-toggle-open").removeClass("aloha-multisplit-toggle-close"),this.panelOpened=!1},hideItem:function(a){for(var b=0;b<this.items.length;b++)if(this.items[b].name==a){this.items[b].visible=!1,c("#"+this.id+" [gtxmultisplititem="+b+"]").parent().hide();return}},showItem:function(a){for(var b=0;b<this.items.length;b++)if(this.items[b].name==a){this.items[b].visible=!0,c("#"+this.id+" [gtxmultisplititem="+b+"]").parent().show();return}}}),e.reg("alohamultisplitbutton",e.ux.MultiSplitButton),a.ui.MultiSplitButton=b.extend({_constructor:function(a){this.items=[],h.Utils.applyProperties(this,a),this.id=this.generateId()},generateId:function(){return a.ui.MultiSplitButton.idCounter=a.ui.MultiSplitButton.idCounter+1,"aloha-multisplitbutton"+a.ui.MultiSplitButton.idCounter},getExtConfigProperties:function(){return{xtype:"alohamultisplitbutton",items:this.items,name:this.name,id:this.id}},setActiveItem:function(a){this.extButton&&typeof a!="undefined"&&this.extButton.setActiveItem(a)},isVisible:function(){for(var a=0;a<this.items.length;a++)if(this.items[a].visible)return!0;return!1},showItem:function(a){if(typeof this.extButton=="undefined")return;this.extButton.showItem(a)},hideItem:function(a){if(typeof this.extButton=="undefined")return;this.extButton.hideItem(a)}}),a.i18n=function(a,b,c){return f.deprecated("Aloha",'i18n() is deprecated. Use module "i18n!aloha/nls/i18n" instead.'),b},a.showMessage=function(b){d.obj&&d.obj.css("z-index",8900);switch(b.type){case a.Message.Type.ALERT:e.MessageBox.alert(b.title,b.text,b.callback);break;case a.Message.Type.CONFIRM:e.MessageBox.confirm(b.title,b.text,b.callback);break;case a.Message.Type.WAIT:e.MessageBox.wait(b.text,b.title);break;default:a.log("warn",this,"Unknown message type for message {"+b.toString()+"}")}},a.hideMessage=function(){e.MessageBox.hide()},a.isMessageVisible=function(){return e.MessageBox.isVisible()},a.ui.MultiSplitButton.idCounter=0,a.ui});