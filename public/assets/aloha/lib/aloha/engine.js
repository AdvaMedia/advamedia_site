define(["aloha/ecma5shims","aloha/jquery"],function(a,b){function g(a){if(!a)return 0;if(!a.style)return 0;if(typeof a.style.length!="undefined")return a.style.length;var b=0;for(var c in a.style)a.style[c]&&a.style[c]!==0&&a.style[c]!=="false"&&b++;return b}function h(a){if(!a)return null;var b=[],c,d=a.length;for(c=d>>>0;c--;)b[c]=a[c];return b}function i(a){return a.hasChildNodes()?a.firstChild:k(a)}function j(b){if(b.previousSibling){b=b.previousSibling;while(b.hasChildNodes())b=b.lastChild;return b}return b.parentNode&&b.parentNode.nodeType==a.Node.ELEMENT_NODE?b.parentNode:null}function k(a){while(a&&!a.nextSibling)a=a.parentNode;return a?a.nextSibling:null}function l(b,c){return b&&c&&Boolean(a.compareDocumentPosition(b,c)&a.Node.DOCUMENT_POSITION_CONTAINED_BY)}function m(a,b){return(a||b)&&(a==b||l(a,b))}function n(b,c){return c&&b&&Boolean(a.compareDocumentPosition(c,b)&a.Node.DOCUMENT_POSITION_CONTAINED_BY)}function o(b,c){return Boolean(a.compareDocumentPosition(b,c)&a.Node.DOCUMENT_POSITION_FOLLOWING)}function p(b,c){return Boolean(a.compareDocumentPosition(b,c)&a.Node.DOCUMENT_POSITION_PRECEDING)}function q(a){var b=[];while(a.parentNode)b.unshift(a.parentNode),a=a.parentNode;return b}function r(a){var b=[],c=k(a);while((a=i(a))&&a!=c)b.push(a);return b}function s(a){var b={fontFamily:"font-family",fontSize:"font-size",fontStyle:"font-style",fontWeight:"font-weight",textDecoration:"text-decoration"};return typeof b[a]!="undefined"?b[a]:a}function t(a){return{"xx-small":1,small:2,medium:3,large:4,"x-large":5,"xx-large":6,"xxx-large":7}[a]}function u(a){return{1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[a]}function v(a){return a===null||!a||a===c}function w(a){return a.dir=="ltr"?"ltr":a.dir=="rtl"?"rtl":O(a.parentNode)?w(a.parentNode):"ltr"}function x(a){var b=0;while(a.previousSibling)b++,a=a.previousSibling;return b}function y(b){switch(b.nodeType){case a.Node.PROCESSING_INSTRUCTION_NODE:case a.Node.DOCUMENT_TYPE_NODE:return 0;case a.Node.TEXT_NODE:case a.Node.COMMENT_NODE:return b.length;default:return b.childNodes.length}}function z(b,c,d,e){if(b==d){if(c==e)return"equal";if(c<e)return"before";if(c>e)return"after"}if(a.compareDocumentPosition(d,b)&a.Node.DOCUMENT_POSITION_FOLLOWING){var f=z(d,e,b,c);if(f=="before")return"after";if(f=="after")return"before"}if(a.compareDocumentPosition(d,b)&a.Node.DOCUMENT_POSITION_CONTAINS){var g=d;while(g.parentNode!=b)g=g.parentNode;if(x(g)<c)return"after"}return"before"}function A(a){var b=a;while(b.parentNode!=null)b=b.parentNode;return b}function B(a,b){var c=z(a,0,b.startContainer,b.startOffset),d=z(a,y(a),b.endContainer,b.endOffset);return A(a)==A(b.startContainer)&&c=="after"&&d=="before"}function C(a,b){typeof b=="undefined"&&(b=function(){return!0});var c=a.startContainer;c.hasChildNodes()&&a.startOffset<c.childNodes.length?c=c.childNodes[a.startOffset]:a.startOffset==y(c)?c=k(c):c=i(c);var d=a.endContainer;d.hasChildNodes()&&a.endOffset<d.childNodes.length?d=d.childNodes[a.endOffset]:d=k(d);var e=[];while(o(c,d)){if(B(c,a)&&b(c)){e.push(c),c=k(c);continue}c=i(c)}return e}function D(a,b){typeof b=="undefined"&&(b=function(){return!0});var c=a.startContainer;c.hasChildNodes()&&a.startOffset<c.childNodes.length?c=c.childNodes[a.startOffset]:a.startOffset==y(c)?c=k(c):c=i(c);var d=a.endContainer;d.hasChildNodes()&&a.endOffset<d.childNodes.length?d=d.childNodes[a.endOffset]:d=k(d);var e=[];while(o(c,d))B(c,a)&&b(c)&&e.push(c),c=i(c);return e}function E(b){if(b.toLowerCase()=="currentcolor")return null;var c=document.createElement("span");document.body.appendChild(c),c.style.color="black";var d=document.createElement("span");c.appendChild(d),d.style.color=b,b=a.getComputedStyle(d).color;if(b=="rgb(0, 0, 0)"){c.color="white",b=a.getComputedStyle(d).color;if(b!="rgb(0, 0, 0)")return null}return document.body.removeChild(c),/^rgba\([0-9]+, [0-9]+, [0-9]+, 1\)$/.test(b)?b.replace("rgba","rgb").replace(", 1)",")"):b=="transparent"?"rgba(0, 0, 0, 0)":b}function F(b){b=b.toLowerCase();if(a(["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"]).indexOf(b)!=-1)return b;b=E(b);var c=/^rgb\(([0-9]+), ([0-9]+), ([0-9]+)\)$/.exec(b);return c?"#"+parseInt(c[1]).toString(16).replace(/^.$/,"0$&")+parseInt(c[2]).toString(16).replace(/^.$/,"0$&")+parseInt(c[3]).toString(16).replace(/^.$/,"0$&"):null}function H(a,b,c,d){G==0&&typeof c!="undefined"?e=c:G==0&&(e=null,e=c);if(a in f){if(b=="enabled"||b in f[a]){G++;try{var g=d()}catch(h){throw G--,h}return G--,g}throw"INVALID_ACCESS_ERR"}throw"NOT_SUPPORTED_ERR"}function I(a,b,c,d){a=a.toLowerCase();if(arguments.length==1||arguments.length>=4&&typeof b=="undefined")b=!1;if(arguments.length<=2||arguments.length>=4&&typeof c=="undefined")c="";return H(a,"action",d,function(a,b,c){return function(){return J(a)?(f[a].action(c,d),eb(d),!0):!1}}(a,b,c))}function J(b,c){return b=b.toLowerCase(),H(b,"action",c,function(b){return function(){return a(["copy","cut","paste","selectall","stylewithcss","usecss"]).indexOf(b)!=-1||c!==null}}(b))}function K(a,b){return a=a.toLowerCase(),H(a,"indeterm",b,function(a){return function(){return J(a,b)?f[a].indeterm(b):!1}}(a))}function L(a,b){return a=a.toLowerCase(),H(a,"state",b,function(a){return function(){return J(a,b)?typeof gb(a,b)!="undefined"?gb(a,b):f[a].state(b):!1}}(a))}function M(a){return a=a.toLowerCase(),a in f}function N(a,b){return a=a.toLowerCase(),H(a,"value",b,function(){return J(a,b)?a=="fontsize"&&jb("fontsize",b)!==undefined?Mb(jb("fontsize",b)):typeof jb(a,b)!="undefined"?jb(a,b):f[a].value():""})}function O(b,c){return typeof c=="string"&&(c=[c]),typeof c=="object"&&(c=a(c).map(function(a){return a.toUpperCase()})),b&&b.nodeType==a.Node.ELEMENT_NODE&&v(b.namespaceURI)&&(typeof c=="undefined"||a(c).indexOf(b.tagName)!=-1)}function Q(a){return O(a,P)}function R(b){return b&&(b.nodeType==a.Node.ELEMENT_NODE&&a(["inline","inline-block","inline-table","none"]).indexOf(a.getComputedStyle(b).display)==-1||b.nodeType==a.Node.DOCUMENT_NODE||b.nodeType==a.Node.DOCUMENT_FRAGMENT_NODE)}function S(a){return a&&!R(a)}function T(b){return b&&b.nodeType==a.Node.ELEMENT_NODE&&(b.contentEditable=="true"||b.parentNode&&b.parentNode.nodeType==a.Node.DOCUMENT_NODE&&b.parentNode.designMode=="on")}function U(c){return c&&!T(c)&&(c.nodeType!=a.Node.ELEMENT_NODE||c.contentEditable!="false"||b(c).hasClass("aloha-table-wrapper"))&&(T(c.parentNode)||U(c.parentNode))}function V(a){for(var b=0;b<a.childNodes.length;b++)if(U(a.childNodes[b])||V(a.childNodes[b]))return!0;return!1}function W(a){if(T(a))return a;if(U(a)){var b=a.parentNode;while(!T(b))b=b.parentNode;return b}return null}function X(a,b){return W(a)&&W(a)==W(b)}function Y(b){if(!O(b,"br"))return!1;var c=b.parentNode;while(a.getComputedStyle(c).display=="inline")c=c.parentNode;var d=a(c).hasAttribute("style")?c.getAttribute("style"):null;c.style.height="auto",c.style.maxHeight="none",c.style.minHeight="0";var e=document.createTextNode("​"),f=c.offsetHeight;if(f==0)throw"isCollapsedLineBreak: original height is zero, bug?";b.parentNode.insertBefore(e,b.nextSibling);var g=c.offsetHeight;return e.parentNode.removeChild(e),d===null?(c.setAttribute("style",""),c.removeAttribute("style")):c.setAttribute("style",d),f<g-5}function Z(b){if(!O(b,"br"))return!1;if(O(b.parentNode,"li")&&b.parentNode.childNodes.length==1)return!1;var c=b.parentNode;while(a.getComputedStyle(c).display=="inline")c=c.parentNode;var d=a(c).hasAttribute("style")?c.getAttribute("style"):null;c.style.height="auto",c.style.maxHeight="none",c.style.minHeight="0";var e=a(b).hasAttribute("style")?b.getAttribute("style"):null,f=c.offsetHeight;if(f==0)throw"isExtraneousLineBreak: original height is zero, bug?";b.setAttribute("style","display:none");var g=c.offsetHeight;return d===null?(c.setAttribute("style",""),c.removeAttribute("style")):c.setAttribute("style",d),e===null?b.removeAttribute("style"):b.setAttribute("style",e),f==g}function $(b){return b&&b.nodeType==a.Node.TEXT_NODE&&(b.data==""||/^[\t\n\r ]+$/.test(b.data)&&b.parentNode&&b.parentNode.nodeType==a.Node.ELEMENT_NODE&&a(["normal","nowrap"]).indexOf(a.getComputedStyle(b.parentNode).whiteSpace)!=-1||/^[\t\r ]+$/.test(b.data)&&b.parentNode&&b.parentNode.nodeType==a.Node.ELEMENT_NODE&&a.getComputedStyle(b.parentNode).whiteSpace=="pre-line"||/^[\t\n\r ]+$/.test(b.data)&&b.parentNode&&b.parentNode.nodeType==a.Node.DOCUMENT_FRAGMENT_NODE)}function _(b,c){if(!U(b)&&!T(b))return;if(!b||b.nodeType!==a.Node.TEXT_NODE)return;if(a(["pre","pre-wrap"]).indexOf(a.getComputedStyle(b.parentNode).whiteSpace)!=-1)return;if(!/[\t\n\r ]{2,}/.test(b.data))return;var d="",e=c.startContainer==b,f=c.endContainer==b,g=!1;for(var h=0;h<b.data.length;++h)/[\t\n\r ]/.test(b.data[h])?g?(e&&d.length<c.startOffset&&c.startOffset--,f&&d.length<c.endOffset&&c.endOffset--):(d+=" ",g=!0):(d+=b.data[h],g=!1);b.data=d}function ab(b){if(!$(b))return!1;if(b.data=="")return!0;var c=b.parentNode;if(!c)return!0;if(a(q(b)).some(function(b){return b.nodeType==a.Node.ELEMENT_NODE&&a.getComputedStyle(b).display=="none"}))return!0;while(!R(c)&&c.parentNode)c=c.parentNode;var d=b;while(d!=c){d=j(d);if(R(d)||O(d,"br"))return!0;if(d.nodeType==a.Node.TEXT_NODE&&!$(d)||O(d,"img"))break}d=b;var e=k(c);while(d!=e){d=i(d);if(R(d)||O(d,"br"))return!0;if(d&&d.nodeType==a.Node.TEXT_NODE&&!$(d)||O(d,"img"))break}return!1}function bb(b){if(!b)return!1;if(a(q(b).concat(b)).filter(function(b){return b.nodeType==a.Node.ELEMENT_NODE},!0).some(function(b){return a.getComputedStyle(b).display=="none"}))return!1;if(R(b)||b.nodeType==a.Node.TEXT_NODE&&!ab(b)||O(b,"img")||O(b,"br")&&!Z(b))return!0;for(var c=0;c<b.childNodes.length;c++)if(bb(b.childNodes[c]))return!0;return!1}function cb(a){return a&&!bb(a)}function db(b){if(Y(b)&&!Z(b))return!0;if(!S(b)||b.nodeType!=a.Node.ELEMENT_NODE)return!1;var c=!1;for(var d=0;d<b.childNodes.length;d++){if(!cb(b.childNodes[d])&&!db(b.childNodes[d]))return!1;db(b.childNodes[d])&&(c=!0)}return c}function eb(a){var b=new window.GENTICS.Utils.RangeObject;b.startContainer=a.startContainer,b.startOffset=a.startOffset,b.endContainer=a.endContainer,b.endOffset=a.endOffset,b.select()}function fb(){var b;if(e)b=e;else{if(!Aloha.getSelection().rangeCount)return null;b=Aloha.getSelection().getRangeAt(0)}if(a([a.Node.TEXT_NODE,a.Node.ELEMENT_NODE]).indexOf(b.startContainer.nodeType)==-1||a([a.Node.TEXT_NODE,a.Node.ELEMENT_NODE]).indexOf(b.endContainer.nodeType)==-1||!b.startContainer.ownerDocument||!b.endContainer.ownerDocument||!n(b.startContainer,b.startContainer.ownerDocument)||!n(b.endContainer,b.endContainer.ownerDocument))throw"Invalid active range; test bug?";return b}function mb(b,c,d,e){d==-1&&(d=c.childNodes.length);var f=b.parentNode,g=x(b),h=[e];for(var i=0;i<Aloha.getSelection().rangeCount;i++)h.push(Aloha.getSelection().getRangeAt(i));var j=[];a(h).forEach(function(a){j.push([a.startContainer,a.startOffset]),j.push([a.endContainer,a.endOffset])}),a(j).forEach(function(a){a[0]==c&&a[1]>d&&a[1]++,a[0]==f&&(a[1]==g||a[1]==g+1)&&(a[0]=c,a[1]+=d-g),a[0]==f&&a[1]>g+1&&a[1]--}),c.childNodes.length==d?c.appendChild(b):c.insertBefore(b,c.childNodes[d]);if(j[0][1]>j[0][0].childNodes.length&&j[1][1]>j[1][0].childNodes.length)e.setStart(b,0),e.setEnd(b,0);else{e.setStart(j[0][0],j[0][1]),e.setEnd(j[1][0],j[1][1]),Aloha.getSelection().removeAllRanges();for(var i=1;i<h.length;i++){var k=Aloha.createRange();k.setStart(j[2*i][0],j[2*i][1]),k.setEnd(j[2*i+1][0],j[2*i+1][1]),Aloha.getSelection().addRange(k)}k&&(e=k)}}function nb(a,b,c){if(O(a,b.toUpperCase()))return a;if(!a.parentNode)return a;var d=a.ownerDocument.createElement(b);a.parentNode.insertBefore(d,a);for(var e=0;e<a.attributes.length;e++)typeof d.setAttributeNS=="function"?d.setAttributeNS(a.attributes[e].namespaceURI,a.attributes[e].name,a.attributes[e].value):d.setAttribute(a.attributes[e].name,a.attributes[e].value);while(a.childNodes.length)mb(a.firstChild,d,d.childNodes.length,c);return a.parentNode.removeChild(a),c.startContainer===a&&c.setStart(d,c.startOffset),c.endContainer===a&&c.setEnd(d,c.endOffset),d}function ob(a){var b=a.previousSibling;if(!b)return;while(b.hasChildNodes())b=b.lastChild;while(cb(b)&&!Z(b)&&b!=a.parentNode)b=j(b);U(b)&&Z(b)&&b.parentNode.removeChild(b)}function pb(a){var b=a;while(b.hasChildNodes())b=b.lastChild;while(cb(b)&&!Z(b)&&b!=a)b=j(b);U(b)&&Z(b)&&b.parentNode.removeChild(b)}function qb(a){ob(a),pb(a)}function rb(a,b,c,d){typeof b=="undefined"&&(b=function(){return!1}),typeof c=="undefined"&&(c=function(){return null});if(!a.length||!U(a[0]))return null;S(a[a.length-1])&&!O(a[a.length-1],"br")&&O(a[a.length-1].nextSibling,"br")&&a.push(a[a.length-1].nextSibling);var f;U(a[0].previousSibling)&&b(a[0].previousSibling)?f=a[0].previousSibling:U(a[a.length-1].nextSibling)&&b(a[a.length-1].nextSibling)?f=a[a.length-1].nextSibling:f=c();if(!f)return null;if(!f.parentNode){a[0].parentNode.insertBefore(f,a[0]);var g=d.startContainer,h=d.startOffset,i=d.endContainer,j=d.endOffset;g==f.parentNode&&h>=x(f)&&d.setStart(g,h+1),i==f.parentNode&&j>=x(f)&&d.setEnd(i,j+1),e&&e!==d&&(g=e.startContainer,h=e.startOffset,i=e.endContainer,j=e.endOffset,g==f.parentNode&&h>=x(f)&&e.setStart(g,h+1),i==f.parentNode&&j>=x(f)&&e.setEnd(i,j+1))}var k=a[0].parentNode;if(o(f,a[0])){!S(f)&&S(f.lastChild)&&S(a[0])&&!O(f.lastChild,"BR")&&f.appendChild(f.ownerDocument.createElement("br"));for(var l=0;l<a.length;l++)mb(a[l],f,-1,d)}else{!S(f)&&S(f.firstChild)&&S(a[a.length-1])&&!O(a[a.length-1],"BR")&&f.insertBefore(f.ownerDocument.createElement("br"),f.firstChild);for(var l=a.length-1;l>=0;l--)mb(a[l],f,0,d)}U(k)&&!k.hasChildNodes()&&k.parentNode.removeChild(k);if(U(f.nextSibling)&&b(f.nextSibling)){!S(f)&&S(f.lastChild)&&S(f.nextSibling.firstChild)&&!O(f.lastChild,"BR")&&f.appendChild(f.ownerDocument.createElement("br"));while(f.nextSibling.hasChildNodes())mb(f.nextSibling.firstChild,f,-1,d);f.parentNode.removeChild(f.nextSibling)}return qb(f),f}function tb(a){return O(a,sb)}function ub(b,c){if((a(["colgroup","table","tbody","tfoot","thead","tr"]).indexOf(c)!=-1||O(c,["colgroup","table","tbody","tfoot","thead","tr"]))&&typeof b=="object"&&b.nodeType==a.Node.TEXT_NODE&&!/^[ \t\n\f\r]*$/.test(b.data))return!1;if(a(["script","style","plaintext","xmp"]).indexOf(c)==-1&&!O(c,["script","style","plaintext","xmp"])||typeof b=="object"&&b.nodeType==a.Node.TEXT_NODE){if(typeof b!="object"||b.nodeType!=a.Node.DOCUMENT_NODE&&b.nodeType!=a.Node.DOCUMENT_FRAGMENT_NODE&&b.nodeType!=a.Node.DOCUMENT_TYPE_NODE){O(b)&&(b=b.tagName.toLowerCase());if(typeof b!="string")return!0;if(O(c)){var d=c;while(d){if(b=="a"&&O(d,"a"))return!1;if(a(P).indexOf(b)!=-1&&tb(d))return!1;if(/^h[1-6]$/.test(b)&&O(d)&&/^H[1-6]$/.test(d.tagName))return!1;d=d.parentNode}c=c.tagName.toLowerCase()}if(typeof c!="object"||c.nodeType!=a.Node.ELEMENT_NODE&&c.nodeType!=a.Node.DOCUMENT_FRAGMENT_NODE){if(typeof c!="string")return!1;switch(c){case"colgroup":return b=="col";case"table":return a(["caption","col","colgroup","tbody","td","tfoot","th","thead","tr"]).indexOf(b)!=-1;case"tbody":case"thead":case"tfoot":return a(["td","th","tr"]).indexOf(b)!=-1;case"tr":return a(["td","th"]).indexOf(b)!=-1;case"dl":return a(["dt","dd"]).indexOf(b)!=-1;case"dir":case"ol":case"ul":return a(["dir","li","ol","ul"]).indexOf(b)!=-1;case"hgroup":return/^h[1-6]$/.test(b)}if(a(["body","caption","col","colgroup","frame","frameset","head","html","tbody","td","tfoot","th","thead","tr"]).indexOf(b)!=-1)return!1;if(a(["dd","dt"]).indexOf(b)!=-1&&c!="dl")return!1;if(b=="li"&&c!="ol"&&c!="ul")return!1;var e=[[["a"],["a"]],[["dd","dt"],["dd","dt"]],[["h1","h2","h3","h4","h5","h6"],["h1","h2","h3","h4","h5","h6"]],[["li"],["li"]],[["nobr"],["nobr"]],[sb,P],[["td","th"],["caption","col","colgroup","tbody","td","tfoot","th","thead","tr"]]];for(var f=0;f<e.length;f++)if(a(e[f][0]).indexOf(c)!=-1&&a(e[f][1]).indexOf(b)!=-1)return!1;return!0}return!0}return!1}return!1}function vb(b,c){return c.collapsed?!1:B(b,c)?!0:b==c.startContainer&&b.nodeType==a.Node.TEXT_NODE&&y(b)!=c.startOffset?!0:b==c.endContainer&&b.nodeType==a.Node.TEXT_NODE&&c.endOffset!=0?!0:b.hasChildNodes()&&a(b.childNodes).every(function(a){return vb(a,c)})&&(!n(c.startContainer,b)||c.startContainer.nodeType!=a.Node.TEXT_NODE||c.startOffset==0)&&(!n(c.endContainer,b)||c.endContainer.nodeType!=a.Node.TEXT_NODE||c.endOffset==y(c.endContainer))?!0:!1}function wb(a,b){typeof b=="undefined"&&(b=function(){return!0});var c=a.startContainer;while(vb(c.parentNode,a))c=c.parentNode;var d=k(a.endContainer),e=[];while(o(c,d)){if(vb(c,a)&&b(c)){e.push(c),c=k(c);continue}c=i(c)}return e}function xb(a,b){typeof b=="undefined"&&(b=function(){return!0});var c=a.startContainer;while(vb(c.parentNode,a))c=c.parentNode;var d=k(a.endContainer),e=[];while(o(c,d))vb(c,a)&&b(c)&&e.push(c),c=i(c);return e}function yb(b){if(!O(b))return!1;if(a(["B","EM","I","S","SPAN","STRIKE","STRONG","SUB","SUP","U"]).indexOf(b.tagName)!=-1){if(b.attributes.length==0)return!0;if(b.attributes.length==1&&a(b).hasAttribute("style"))return!0}if(b.tagName=="FONT"||b.tagName=="A"){var c=b.attributes.length;a(b).hasAttribute("style")&&c--,b.tagName=="FONT"&&(a(b).hasAttribute("color")&&c--,a(b).hasAttribute("face")&&c--,a(b).hasAttribute("size")&&c--),b.tagName=="A"&&a(b).hasAttribute("href")&&c--;if(c==0)return!0}return!1}function zb(b){return O(b)?a(["A","B","EM","FONT","I","S","SPAN","STRIKE","STRONG","SUB","SUP","U"]).indexOf(b.tagName)==-1?!1:b.attributes.length==0?!0:b.attributes.length>1?!1:a(b).hasAttribute("style")&&g(b)==0?!0:b.tagName=="A"&&a(b).hasAttribute("href")?!0:b.tagName=="FONT"&&(a(b).hasAttribute("color")||a(b).hasAttribute("face")||a(b).hasAttribute("size"))?!0:b.tagName!="B"&&b.tagName!="STRONG"||!a(b).hasAttribute("style")||g(b)!=1||b.style.fontWeight==""?b.tagName!="I"&&b.tagName!="EM"||!a(b).hasAttribute("style")||g(b)!=1||b.style.fontStyle==""?b.tagName!="A"&&b.tagName!="FONT"&&b.tagName!="SPAN"||!a(b).hasAttribute("style")||g(b)!=1||b.style.textDecoration!=""?a(["A","FONT","S","SPAN","STRIKE","U"]).indexOf(b.tagName)==-1||!a(b).hasAttribute("style")||g(b)!=1||b.style.textDecoration!="line-through"&&b.style.textDecoration!="underline"&&b.style.textDecoration!="overline"&&b.style.textDecoration!="none"?!1:!0:!0:!0:!0:!1}function Ab(a,b,c){return b===null&&c===null?!0:typeof b!="string"||typeof c!="string"||b!=c||"equivalentValues"in f[a]?typeof b=="string"&&typeof c=="string"&&"equivalentValues"in f[a]&&f[a].equivalentValues(b,c)?!0:!1:!0}function Bb(b,c,d){if(Ab(b,c,d))return!0;if(b!="fontsize"||typeof c!="string"||typeof d!="string")return!1;var e=Bb;if(e.sizeMap===undefined){e.sizeMap={};var f=document.createElement("font");document.body.appendChild(f),a(["xx-small","small","medium","large","x-large","xx-large","xxx-large"]).forEach(function(b){f.size=t(b),e.sizeMap[b]=a.getComputedStyle(f).fontSize}),document.body.removeChild(f)}return c===e.sizeMap[d]||d===e.sizeMap[c]}function Cb(b,c){if(b.nodeType==a.Node.ELEMENT_NODE||!!b.parentNode&&b.parentNode.nodeType==a.Node.ELEMENT_NODE){if(b.nodeType!=a.Node.ELEMENT_NODE)return Cb(b.parentNode,c);if(c=="createlink"||c=="unlink"){while(b&&(!O(b)||b.tagName!="A"||!a(b).hasAttribute("href")))b=b.parentNode;return b?b.getAttribute("href"):null}if(c=="backcolor"||c=="hilitecolor"){while((a.getComputedStyle(b).backgroundColor=="rgba(0, 0, 0, 0)"||a.getComputedStyle(b).backgroundColor===""||a.getComputedStyle(b).backgroundColor=="transparent")&&b.parentNode&&b.parentNode.nodeType==a.Node.ELEMENT_NODE)b=b.parentNode;return a.getComputedStyle(b).backgroundColor=="rgba(0, 0, 0, 0)"||a.getComputedStyle(b).backgroundColor===""||a.getComputedStyle(b).backgroundColor=="transparent"?"rgb(255, 255, 255)":a.getComputedStyle(b).backgroundColor}if(c=="subscript"||c=="superscript"){var d=!1,e=!1;while(S(b)){var g=a.getComputedStyle(b).verticalAlign;O(b,"sub")?d=!0:O(b,"sup")&&(e=!0),b=b.parentNode}return d&&e?"mixed":d?"subscript":e?"superscript":null}if(c=="strikethrough"){do{if(a.getComputedStyle(b).textDecoration.indexOf("line-through")!=-1)return"line-through";b=b.parentNode}while(b&&b.nodeType==a.Node.ELEMENT_NODE);return null}if(c=="underline"){do{if(a.getComputedStyle(b).textDecoration.indexOf("underline")!=-1)return"underline";b=b.parentNode}while(b&&b.nodeType==a.Node.ELEMENT_NODE);return null}if("relevantCssProperty"in f[c])return a.getComputedStyle(b)[f[c].relevantCssProperty].toString();throw"Bug: no relevantCssProperty for "+c+" in getEffectiveCommandValue"}return null}function Db(b,c){if(c!="backcolor"&&c!="hilitecolor"||a.getComputedStyle(b).display=="inline"){if(c=="createlink"||c=="unlink")return O(b)&&b.tagName=="A"&&a(b).hasAttribute("href")?b.getAttribute("href"):null;if(c=="subscript"||c=="superscript")return O(b,"sup")?"superscript":O(b,"sub")?"subscript":null;if(c=="strikethrough"&&b.style.textDecoration!="")return b.style.textDecoration.indexOf("line-through")!=-1?"line-through":null;if(c=="strikethrough"&&O(b,["S","STRIKE"]))return"line-through";if(c=="underline"&&b.style.textDecoration!="")return b.style.textDecoration.indexOf("underline")!=-1?"underline":null;if(c=="underline"&&O(b,"U"))return"underline";var d=f[c].relevantCssProperty;if(d===null)return null;if(b.style[d]!="")return b.style[d];if(v(b.namespaceURI)&&b.tagName=="FONT"){if(d=="color"&&a(b).hasAttribute("color"))return b.color;if(d=="fontFamily"&&a(b).hasAttribute("face"))return b.face;if(d=="fontSize"&&a(b).hasAttribute("size")){var e=parseInt(b.size);return e<1&&(e=1),e>7&&(e=7),{1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[e]}}return d!="fontWeight"||b.tagName!="B"&&b.tagName!="STRONG"?d!="fontStyle"||b.tagName!="I"&&b.tagName!="EM"?null:"italic":"bold"}return null}function Eb(a,b,c,d){var e=a;while(yb(e)&&e.childNodes.length==1&&yb(e.firstChild)&&(!zb(e)||!Ab(b,Db(e,b),c)))e=e.firstChild;if(e==a||!zb(e)||!Ab(b,Db(e,b),c)||!Bb(b,Cb(e,b),c))return;while(e.hasChildNodes())mb(e.firstChild,e.parentNode,x(e),d);a.parentNode.insertBefore(e,a.nextSibling),mb(a,e,-1,d)}function Fb(b){var c=[];return a(b).forEach(function(b){a(["subscript","bold","fontname","fontsize","forecolor","hilitecolor","italic","strikethrough","underline"]).forEach(function(d){var e=b;e.nodeType!=a.Node.ELEMENT_NODE&&(e=e.parentNode);while(e&&e.nodeType==a.Node.ELEMENT_NODE&&Db(e,d)===null)e=e.parentNode;e&&e.nodeType==a.Node.ELEMENT_NODE?c.push([b,d,Db(e,d)]):c.push([b,d,null])})}),c}function Gb(b,c){a(b).forEach(function(b){var d=b[0],e=b[1],f=b[2],g=d;if(!g||g.nodeType!=a.Node.ELEMENT_NODE)g=g.parentNode;while(g&&g.nodeType==a.Node.ELEMENT_NODE&&Db(g,e)===null)g=g.parentNode;f===null&&g&&g.nodeType==a.Node.ELEMENT_NODE?Ib(d,e,null,c):(g&&g.nodeType==a.Node.ELEMENT_NODE&&!Ab(e,Db(g,e),f)||(!g||g.nodeType!=a.Node.ELEMENT_NODE)&&f!==null)&&Jb(d,e,f,c)})}function Hb(a,b,c){if(!U(a))return[];if(Db(a,b)===null)return[];if(zb(a)){var d=Array.prototype.slice.call(h(a.childNodes));for(var e=0;e<d.length;e++)mb(d[e],a.parentNode,x(a),c);return a.parentNode.removeChild(a),d}return b=="strikethrough"&&a.style.textDecoration.indexOf("line-through")!=-1&&(a.style.textDecoration=="line-through"?a.style.textDecoration="":a.style.textDecoration=a.style.textDecoration.replace("line-through",""),a.getAttribute("style")==""&&a.removeAttribute("style")),b=="underline"&&a.style.textDecoration.indexOf("underline")!=-1&&(a.style.textDecoration=="underline"?a.style.textDecoration="":a.style.textDecoration=a.style.textDecoration.replace("underline",""),a.getAttribute("style")==""&&a.removeAttribute("style")),f[b].relevantCssProperty!==null&&(a.style[f[b].relevantCssProperty]="",a.getAttribute("style")==""&&a.removeAttribute("style")),v(a.namespaceURI)&&a.tagName=="FONT"&&(b=="forecolor"&&a.removeAttribute("color"),b=="fontname"&&a.removeAttribute("face"),b=="fontsize"&&a.removeAttribute("size")),O(a,"A")&&(b=="createlink"||b=="unlink")&&a.removeAttribute("href"),Db(a,b)===null?[]:[nb(a,"span",c)]}function Ib(b,c,d,e){if(!b.parentNode||b.parentNode.nodeType!=a.Node.ELEMENT_NODE)return;if(Bb(c,Cb(b,c),d))return;var f=b.parentNode,g=[];while(U(f)&&f.nodeType==a.Node.ELEMENT_NODE&&!Bb(c,Cb(f,c),d))g.push(f),f=f.parentNode;if(!g.length)return;var i=Db(g[g.length-1],c);if(i===null&&i!=d)return;if(d!==null&&!Bb(c,Cb(g[g.length-1].parentNode,c),d))return;while(g.length){var f=g.pop();Db(f,c)!==null&&(i=Db(f,c));var j=Array.prototype.slice.call(h(f.childNodes));Db(f,c)!==null&&Hb(f,c,e);for(var k=0;k<j.length;k++){var l=j[k];if(l==b)continue;if(l.nodeType==a.Node.ELEMENT_NODE&&Db(l,c)!==null&&!Ab(c,i,Db(l,c)))continue;if(l==g[g.length-1])continue;Jb(l,c,i,e)}}}function Jb(c,e,g,h){if(!c.parentNode)return;if(g===null)return;ub(c,"span")&&(Eb(c.previousSibling,e,g,h),Eb(c.nextSibling,e,g,h),rb([c],function(a){return zb(a)&&Ab(e,Db(a,e),g)&&Bb(e,Cb(a,e),g)},function(){return null},h));if(Bb(e,Cb(c,e),g))return;if(!ub(c,"span")){var i=[];for(var j=0;j<c.childNodes.length;j++){if(c.childNodes[j].nodeType==a.Node.ELEMENT_NODE){var k=Db(c.childNodes[j],e);if(k!==null&&!Ab(e,g,k))continue}i.push(c.childNodes[j])}for(var j=0;j<i.length;j++)Jb(i[j],e,g,h);return}if(Bb(e,Cb(c,e),g))return;var l=null;d||(e=="bold"&&(g=="bold"||g=="700")&&(l=c.ownerDocument.createElement("b")),e=="italic"&&g=="italic"&&(l=c.ownerDocument.createElement("i")),e=="strikethrough"&&g=="line-through"&&(l=c.ownerDocument.createElement("s")),e=="underline"&&g=="underline"&&(l=c.ownerDocument.createElement("u")),e=="forecolor"&&F(g)&&(l=c.ownerDocument.createElement("span"),b(l).css("color",F(g))),e=="fontname"&&(l=c.ownerDocument.createElement("font"),l.face=g));if(e=="createlink"||e=="unlink"){l=c.ownerDocument.createElement("a"),l.setAttribute("href",g);var m=c.parentNode;while(m)O(m,"A")&&(m=nb(m,"span",h)),m=m.parentNode}e=="fontsize"&&a(["xx-small","small","medium","large","x-large","xx-large","xxx-large"]).indexOf(g)!=-1&&(!d||g=="xxx-large")&&(l=c.ownerDocument.createElement("font"),l.size=t(g)),(e=="subscript"||e=="superscript")&&g=="subscript"&&(l=c.ownerDocument.createElement("sub")),(e=="subscript"||e=="superscript")&&g=="superscript"&&(l=c.ownerDocument.createElement("sup")),l||(l=c.ownerDocument.createElement("span")),c.parentNode.insertBefore(l,c);var n=f[e].relevantCssProperty;n!==null&&!Bb(e,Cb(l,e),g)&&(l.style[n]=g),e=="strikethrough"&&g=="line-through"&&Cb(l,"strikethrough")!="line-through"&&(l.style.textDecoration="line-through"),e=="underline"&&g=="underline"&&Cb(l,"underline")!="underline"&&(l.style.textDecoration="underline"),mb(c,l,l.childNodes.length,h);if(c.nodeType==a.Node.ELEMENT_NODE&&!Ab(e,Cb(c,e),g)){mb(c,l.parentNode,x(l),h),l.parentNode.removeChild(l);var i=[];for(var j=0;j<c.childNodes.length;j++){if(c.childNodes[j].nodeType==a.Node.ELEMENT_NODE){var k=Db(c.childNodes[j],e);if(k!==null&&!Ab(e,g,k))continue}i.push(c.childNodes[j])}for(var j=0;j<i.length;j++)Jb(i[j],e,g,h)}}function Kb(b,c,d){d=d||fb();if(!a(xb(d)).filter(function(b){return b.nodeType==a.Node.TEXT_NODE},!0).some(U)){"inlineCommandActivatedValues"in f[b]&&hb(b,a(f[b].inlineCommandActivatedValues).indexOf(c)!=-1,d),b=="subscript"&&ib("superscript",d),b=="superscript"&&ib("subscript",d),c===null?lb(b,d):"value"in f[b]&&kb(b,c,d);return}if(U(d.startContainer)&&d.startContainer.nodeType==a.Node.TEXT_NODE&&d.startOffset!=0&&d.startOffset!=y(d.startContainer)){var e=d.startContainer.splitText(d.startOffset),g=Aloha.createRange();if(d.startContainer==d.endContainer){var h=d.endOffset-d.startOffset;g.setEnd(e,h),d.setEnd(e,h)}g.setStart(e,0),Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(g),d.setStart(e,0)}if(U(d.endContainer)&&d.endContainer.nodeType==a.Node.TEXT_NODE&&d.endOffset!=0&&d.endOffset!=y(d.endContainer)){var i=d,j=[i.startContainer,i.startOffset],k=[i.endContainer,i.endOffset];i.endContainer.splitText(i.endOffset),i.setStart(j[0],j[1]),i.setEnd(k[0],k[1]),Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(i)}a(xb(fb(),function(b){return U(b)&&b.nodeType==a.Node.ELEMENT_NODE})).forEach(function(a){Hb(a,b,d)}),a(xb(d,U)).forEach(function(a){Ib(a,b,c,d),Jb(a,b,c,d)})}function Lb(b){b=a(b).trim();if(/^[-+]?[0-9]+(\.[0-9]+)?([eE][-+]?[0-9]+)?$/.test(b)){var c;b[0]=="+"?(b=b.slice(1),c="relative-plus"):b[0]=="-"?(b=b.slice(1),c="relative-minus"):c="absolute";var d=parseInt(b);c=="relative-plus"&&(d+=3),c=="relative-minus"&&(d=3-d),d<1&&(d=1),d>7&&(d=7),b={1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[d]}return b}function Mb(b){b=Lb(b);if(a(["xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large"]).indexOf(b)==-1&&!/^[0-9]+(\.[0-9]+)?(cm|mm|in|pt|pc|px)$/.test(b))return null;var c=document.createElement("font");document.body.appendChild(c),b=="xxx-large"?c.size=7:c.style.fontSize=b;var d=parseInt(a.getComputedStyle(c).fontSize);document.body.removeChild(c);var e=1;while(e<7){var c=document.createElement("font");c.size=e,document.body.appendChild(c);var f=parseInt(a.getComputedStyle(c).fontSize);c.size=1+e;var g=parseInt(a.getComputedStyle(c).fontSize);document.body.removeChild(c);var h=(g+f)/2;if(d<h)return String(e);e++}return"7"}function Nb(a){if(!O(a))return!1;if(a.tagName=="BLOCKQUOTE")return!0;if(a.tagName!="DIV")return!1;if(typeof a.style.length!="undefined"){for(var b=0;b<a.style.length;b++)if(/^(-[a-z]+-)?margin/.test(a.style[b]))return!0}else for(var c in a.style)if(/^(-[a-z]+-)?margin/.test(c)&&a.style[c]&&a.style[c]!==0)return!0;return!1}function Ob(b){if(!Nb(b))return!1;if(b.tagName!="BLOCKQUOTE"&&b.tagName!="DIV")return!1;for(var c=0;c<b.attributes.length;c++)if(!v(b.attributes[c].namespaceURI)||a(["style","class","dir"]).indexOf(b.attributes[c].name)==-1)return!1;if(typeof b.style.length!="undefined"){for(var c=0;c<b.style.length;c++)if(!/^(-[a-z]+-)?(margin|border|padding)/.test(b.style[c]))return!1}else for(var d in b.style)if(!/^(-[a-z]+-)?(margin|border|padding)/.test(d)&&b.style[d]&&b.style[d]!==0&&b.style[d]!=="false")return!1;return!0}function Pb(a){return O(a,["address","div","h1","h2","h3","h4","h5","h6","listing","p","pre","xmp"])}function Qb(a){return Pb(a)||O(a,["li","dt","dd"])}function Sb(c,d){if(!U(c))return;if(a(q(c)).every(function(a){return!X(c,a)||!ub(c,a)})&&!O(c,Rb)){if(O(c,["dd","dt"])){rb([c],function(a){return O(a,"dl")&&!a.attributes.length},function(){return document.createElement("dl")},d);return}if(!Q(c))return;c=nb(c,Rb,d),Sb(c,d);var e=r(c);for(var f=0;f<e.length;f++)Sb(e[f],d);return}var g=Fb([c]);while(!ub(c,c.parentNode)){for(var f=c.parentNode.childNodes.length-1;f>=0;--f)c.parentNode.childNodes[f].nodeType==3&&c.parentNode.childNodes[f].data.length==0&&(c.parentNode.removeChild(c.parentNode.childNodes[f]),d.startContainer==c.parentNode&&d.startOffset>f&&d.startOffset--,d.endContainer==c.parentNode&&d.endOffset>f&&d.endOffset--);if(c.parentNode.childNodes.length==1){var h=!1,i=!1;d.startContainer===c.parentNode&&(h=!0),d.endContainer===c.parentNode&&(i=!0),b(c).unwrap(),h&&(d.startContainer=c.parentNode,d.startOffset=d.startOffset+x(c)),i&&(d.endContainer=c.parentNode
,d.endOffset=d.endOffset+x(c))}else fc([c],d)}Gb(g,d)}function Tb(b,c){if(!O(b,"LI")||!U(b)||!U(b.parentNode))return;var d=null;while(a(b.childNodes).some(function(a){return O(a,["OL","UL"])})){var e=b.lastChild;O(e,["OL","UL"])||!d&&e.nodeType==a.Node.TEXT_NODE&&/^[ \t\n\f\r]*$/.test(e.data)?(d=null,mb(e,b.parentNode,1+x(b),c)):(d||(d=b.ownerDocument.createElement("li"),b.parentNode.insertBefore(d,b.nextSibling)),mb(e,d,0,c))}}function Ub(a,c){if(!O(a,["OL","UL"])||!U(a))return;var d=b(a);d.children("ol,ul").each(function(a,b){O(b.previousSibling,"LI")&&mb(b,b.previousSibling,b.previousSibling.childNodes.length,c)})}function Vb(){var b=$b(fb()),c=C(b,function(a){return U(a)&&!Nb(a)&&(O(a,["ol","ul"])||O(a.parentNode,["ol","ul"])||ub(a,"li"))});if(!c.length)return"none";if(a(c).every(function(a){return O(a,"ol")||O(a.parentNode,"ol")||O(a.parentNode,"li")&&O(a.parentNode.parentNode,"ol")})&&!a(c).some(function(a){return O(a,"ul")||"querySelector"in a&&a.querySelector("ul")}))return"ol";if(a(c).every(function(a){return O(a,"ul")||O(a.parentNode,"ul")||O(a.parentNode,"li")&&O(a.parentNode.parentNode,"ul")})&&!a(c).some(function(a){return O(a,"ol")||"querySelector"in a&&a.querySelector("ol")}))return"ul";var d=a(c).some(function(a){return O(a,"ol")||O(a.parentNode,"ol")||"querySelector"in a&&a.querySelector("ol")||O(a.parentNode,"li")&&O(a.parentNode.parentNode,"ol")}),e=a(c).some(function(a){return O(a,"ul")||O(a.parentNode,"ul")||"querySelector"in a&&a.querySelector("ul")||O(a.parentNode,"li")&&O(a.parentNode.parentNode,"ul")});return d&&e?"mixed":d?"mixed ol":e?"mixed ul":"none"}function Wb(b){while(b&&b.nodeType!=a.Node.ELEMENT_NODE||b.nodeType==a.Node.ELEMENT_NODE&&a(["inline","none"]).indexOf(a.getComputedStyle(b).display)!=-1)b=b.parentNode;if(!b||b.nodeType!=a.Node.ELEMENT_NODE)return"left";var c=a.getComputedStyle(b).textAlign.replace(/^-(moz|webkit)-/,"").replace(/^auto$/,"start");return c=="start"?w(b)=="ltr"?"left":"right":c=="end"?w(b)=="ltr"?"right":"left":a(["center","justify","left","right"]).indexOf(c)!=-1?c:"left"}function Xb(a,b){return!a.parentNode&&b==0||0<=b-1&&b-1<a.childNodes.length&&bb(a.childNodes[b-1])&&(R(a.childNodes[b-1])||O(a.childNodes[b-1],"br"))}function Yb(a,b){return!a.parentNode&&b==y(a)||b<a.childNodes.length&&bb(a.childNodes[b])&&R(a.childNodes[b])}function Zb(a,b){return Xb(a,b)||Yb(a,b)}function $b(b){var c=b.startContainer,d=b.startOffset,e=b.endContainer,f=b.endOffset,g=a(q(c).concat(c)).filter(function(a){return O(a,"li")}).slice(-1);g.length&&(d=x(g[0]),c=g[0].parentNode);if(!Xb(c,d))do d==0?(d=x(c),c=c.parentNode):d--;while(!Zb(c,d));while(d==0&&c.parentNode)d=x(c),c=c.parentNode;var g=a(q(e).concat(e)).filter(function(a){return O(a,"li")}).slice(-1);g.length&&(f=1+x(g[0]),e=g[0].parentNode);if(!Yb(e,f))do f==y(e)?(f=1+x(e),e=e.parentNode):f++;while(!Zb(e,f));while(f==y(e)&&e.parentNode)f=1+x(e),e=e.parentNode;var h=Aloha.createRange();return h.setStart(c,d),h.setEnd(e,f),h}function _b(a){var b=0;while(!Zb(a,b)){if(0<=b-1&&b-1<a.childNodes.length&&bb(a.childNodes[b-1]))return!1;b==0||!a.hasChildNodes()?(b=x(a),a=a.parentNode):(a=a.childNodes[b-1],b=y(a))}return!0}function ac(a){var b=y(a);while(!Zb(a,b)){if(b<a.childNodes.length&&bb(a.childNodes[b]))return!1;b==y(a)||!a.hasChildNodes()?(b=1+x(a),a=a.parentNode):(a=a.childNodes[b],b=0)}return!0}function bc(b){var c=[];return jb("createlink",b)!==undefined&&c.push(["createlink",jb("createlink",b)]),a(["bold","italic","strikethrough","subscript","superscript","underline"]).forEach(function(a){gb(a,b)!==undefined&&c.push([a,gb(a,b)])}),a(["fontname","fontsize","forecolor","hilitecolor"]).forEach(function(a){jb(a,b)!==undefined&&c.push([a,jb(a,b)])}),c}function cc(b){var c=[],d=a(xb(b)).filter(function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE})[0];return d?(c.push(["createlink",f.createlink.value(b)]),a(["bold","italic","strikethrough","subscript","superscript","underline"]).forEach(function(b){a(f[b].inlineCommandActivatedValues).indexOf(Cb(d,b))!=-1?c.push([b,!0]):c.push([b,!1])}),a(["fontname","fontsize","forecolor","hilitecolor"]).forEach(function(a){c.push([a,f[a].value(b)])}),c.push("fontsize",Cb(d,"fontsize")),c):c}function dc(b,c){var d=a(xb(c)).filter(function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE})[0];if(d)for(var e=0;e<b.length;e++){var f=b[e][0],g=b[e][1];if(typeof g=="boolean"&&L(f)!=g)I(f);else if(typeof g=="string"&&f!="fontsize"&&!Ab(f,N(f),g))I(f,!1,g);else{if(typeof g!="string"||f!="fontsize"||!(jb("fontsize",c)!==undefined&&jb("fontsize",c)!==g||jb("fontsize",c)===undefined&&!Bb(f,Cb(d,"fontsize"),g)))continue;I("fontsize",!1,g)}d=a(xb(c)).filter(function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE})[0]||d}else for(var e=0;e<b.length;e++){var f=b[e][0],g=b[e][1];typeof g=="boolean"&&hb(f,g,c),typeof g=="string"&&kb(f,g,c)}}function ec(){var b,c={};arguments.length<3?b=arguments[0]:(b=Aloha.createRange(),b.setStart(arguments[0],arguments[1]),b.setEnd(arguments[2],arguments[3])),arguments.length==2&&(c=arguments[1]),arguments.length==5&&(c=arguments[4]);var d="blockMerging"in c?!!c.blockMerging:!0,e="stripWrappers"in c?!!c.stripWrappers:!0;if(!b)return;var f=b.startContainer,g=b.startOffset,i=b.endContainer,j=b.endOffset;while(f.hasChildNodes()){if(g==y(f)&&X(f,f.parentNode)&&S(f)){g=1+x(f),f=f.parentNode;continue}if(g==y(f))break;var k=f.childNodes[g];if(R(k)||k.nodeType==a.Node.ELEMENT_NODE&&!k.hasChildNodes()||k.nodeType!=a.Node.ELEMENT_NODE&&k.nodeType!=a.Node.TEXT_NODE)break;f=k,g=0}while(i.hasChildNodes()){if(j==0&&X(i,i.parentNode)&&S(i)){j=x(i),i=i.parentNode;continue}if(j==0)break;var k=i.childNodes[j-1];if(R(k)||k.nodeType==a.Node.ELEMENT_NODE&&!k.hasChildNodes()||k.nodeType!=a.Node.ELEMENT_NODE&&k.nodeType!=a.Node.TEXT_NODE)break;i=k,j=y(k)}if(z(i,j,f,g)!=="after"){b.setEnd(b.startContainer,b.startOffset);return}f.nodeType!=a.Node.TEXT_NODE||g!=0||f==i,i.nodeType==a.Node.TEXT_NODE&&j==y(i)&&f!=i&&(j=1+x(i),i=i.parentNode),b.setStart(f,g),b.setEnd(i,j);var m=b.startContainer;while(X(m,m.parentNode)&&S(m))m=m.parentNode;if(!R(m)&&!T(m)||!ub("span",m)||O(m,["td","th"]))m=null;var o=b.endContainer;while(X(o,o.parentNode)&&S(o))o=o.parentNode;if(!R(o)&&!T(o)||!ub("span",o)||O(o,["td","th"]))o=null;var p=cc(b);if(f==i&&U(f)&&f.nodeType==a.Node.TEXT_NODE){var q=f.parentNode;f.deleteData(g,j-g),ic(f,g),b.setEnd(b.startContainer,b.startOffset),dc(p,b),(U(q)||T(q))&&!S(q)&&q.offsetHeight===0&&q.appendChild(nc());return}U(f)&&f.nodeType==a.Node.TEXT_NODE&&f.deleteData(g,y(f)-g);var r=C(b,function(a){return U(a)&&!O(a,["thead","tbody","tfoot","tr","th","td"])});for(var s=0;s<r.length;s++){var t=r[s],q=t.parentNode;q.removeChild(t);if(e||!l(q,f)&&q!=f)while(U(q)&&S(q)&&y(q)==0){var u=q.parentNode;u.removeChild(q),q=u}(U(q)||T(q))&&!S(q)&&!q.hasChildNodes()&&q.offsetHeight===0&&q.appendChild(nc())}U(i)&&i.nodeType==a.Node.TEXT_NODE&&i.deleteData(0,j),ic(b.startContainer,b.startOffset),ic(b.endContainer,b.endOffset);if(!d||!m||!o||!X(m,o)||m==o){b.setEnd(b.startContainer,b.startOffset),dc(p,b);return}m.children.length==1&&db(m.firstChild)&&m.removeChild(m.firstChild),o.children.length==1&&db(o.firstChild)&&o.removeChild(o.firstChild);if(l(m,o)){var k=o;while(k.parentNode!=m)k=k.parentNode;b.setStart(m,x(k)),b.setEnd(m,x(k));if(!o.hasChildNodes()){while(U(o)&&o.parentNode.childNodes.length==1&&o.parentNode!=m){var q=o;q.removeChild(o),o=q}U(o)&&!S(o)&&S(o.previousSibling)&&S(o.nextSibling)&&o.parentNode.insertBefore(document.createElement("br"),o.nextSibling),U(o)&&o.parentNode.removeChild(o),dc(p,b);return}if(!S(o.firstChild)){dc(p,b);return}var v=[];v.push(o.firstChild);while(!O(v[v.length-1],"br")&&S(v[v.length-1].nextSibling))v.push(v[v.length-1].nextSibling);var w=Fb(v);while(v[0].parentNode!=m)fc(v,b);U(v[0].previousSibling)&&O(v[0].previousSibling,"br")&&v[0].parentNode.removeChild(v[0].previousSibling)}else if(n(m,o)){b.setStart(m,y(m)),b.setEnd(m,y(m));var k=m;while(k.parentNode!=o)k=k.parentNode;S(k.nextSibling)&&O(m.lastChild,"br")&&m.removeChild(m.lastChild);var A=[];k.nextSibling&&!O(k.nextSibling,"br")&&!R(k.nextSibling)&&A.push(k.nextSibling),A.length&&A[A.length-1].nextSibling&&!O(A[A.length-1].nextSibling,"br")&&!R(A[A.length-1].nextSibling)&&A.push(A[A.length-1].nextSibling);var w=Fb(A);a(A).forEach(function(a){mb(a,m,-1,b)}),O(k.nextSibling,"br")&&k.parentNode.removeChild(k.nextSibling)}else{b.setStart(m,y(m)),b.setEnd(m,y(m)),S(o.firstChild)&&O(m.lastChild,"br")&&m.removeChild(m.lastChild);var w=Fb([].slice.call(h(o.childNodes)));while(o.hasChildNodes())mb(o.firstChild,m,-1,b);while(!o.hasChildNodes()){var q=o.parentNode;q.removeChild(o),o=q}}Gb(w,b),!m.hasChildNodes()&&m.offsetHeight==0&&m.appendChild(nc()),dc(p,b)}function fc(b,c){var d=b[0].parentNode;if(!U(d)||!d.parentNode)return;a(b).indexOf(d.firstChild)!=-1&&ob(d);var e=a(b).indexOf(d.firstChild)!=-1&&_b(d),f=a(b).indexOf(d.lastChild)!=-1&&ac(d);if(a(b).indexOf(d.firstChild)==-1&&a(b).indexOf(d.lastChild)!=-1){for(var g=b.length-1;g>=0;g--)mb(b[g],d.parentNode,1+x(d),c);f&&!ac(b[b.length-1])&&b[b.length-1].parentNode.insertBefore(document.createElement("br"),b[b.length-1].nextSibling),pb(d);return}if(a(b).indexOf(d.firstChild)==-1){var h=d.cloneNode(!1);d.removeAttribute("id"),d.parentNode.insertBefore(h,d);while(b[0].previousSibling)mb(d.firstChild,h,h.childNodes.length,c)}for(var g=0;g<b.length;g++)mb(b[g],d.parentNode,x(d),c);e&&!_b(b[0])&&b[0].parentNode.insertBefore(document.createElement("br"),b[0]),S(b[b.length-1])&&!O(b[b.length-1],"br")&&O(d.firstChild,"br")&&!S(d)&&d.removeChild(d.firstChild),d.hasChildNodes()?ob(d):(d.parentNode===c.startContainer&&d.parentNode===c.endContainer&&c.startContainer===c.endContainer&&c.startOffset===c.endOffset&&d.parentNode.childNodes.length===c.startOffset&&(c.startOffset=d.parentNode.childNodes.length-1,c.endOffset=c.startOffset),d.parentNode.removeChild(d),f&&!ac(b[b.length-1])&&b[b.length-1].parentNode.insertBefore(document.createElement("br"),b[b.length-1].nextSibling)),!b[b.length-1].nextSibling&&b[b.length-1].parentNode&&pb(b[b.length-1].parentNode)}function gc(a,b){a.hasChildNodes()?fc([].slice.call(h(a.childNodes)),b):a.parentNode.removeChild(a)}function hc(a,b,c){if(a==0)return"";if(a==1&&!b&&!c)return" ";if(a==1)return" ";var d="",e;b?e="  ":e="  ";while(a>3)d+=e,a-=2;return a==3?d+=!b&&!c?"   ":b&&!c?"   ":!b&&c?"   ":b&&c?"   ":"impossible":d+=!b&&!c?"  ":b&&!c?"  ":!b&&c?"  ":b&&c?"  ":"impossible",d}function ic(b,c){if(!U(b)&&!T(b))return;var d=b,e=c;for(;;)if(0<=e-1&&X(d,d.childNodes[e-1]))d=d.childNodes[e-1],e=y(d);else if(e==0&&!_b(d)&&X(d,d.parentNode))e=x(d),d=d.parentNode;else{if(d.nodeType!=a.Node.TEXT_NODE||a(["pre","pre-wrap"]).indexOf(a.getComputedStyle(d.parentNode).whiteSpace)!=-1||e==0||!/[ \xa0]/.test(d.data[e-1]))break;e--}var f=d,g=e,h=0,i=!1;for(;;)if(g<f.childNodes.length&&X(f,f.childNodes[g]))f=f.childNodes[g],g=0;else if(g==y(f)&&!ac(f)&&X(f,f.parentNode))g=1+x(f),f=f.parentNode;else{if(f.nodeType!=a.Node.TEXT_NODE||a(["pre","pre-wrap"]).indexOf(a.getComputedStyle(f.parentNode).whiteSpace)!=-1||g==y(f)||!/[ \xa0]/.test(f.data[g]))break;if(i&&" "==f.data[g]){f.deleteData(g,1);continue}i=" "==f.data[g],g++,h++}var j=hc(h,e==0&&_b(d),g==y(f)&&ac(f));while(z(d,e,f,g)=="before")if(e<d.childNodes.length)d=d.childNodes[e],e=0;else if(d.nodeType!=a.Node.TEXT_NODE||e==y(d))e=1+x(d),d=d.parentNode;else{var k=j[0];j=j.slice(1),k!=d.data[e]&&(d.insertData(e,k),d.deleteData(e+1,1)),e++}}function jc(a,b){if(!a.length)return;var c=a[0];if(O(c.parentNode,["OL","UL"])){var d=c.parentNode.tagName;rb(a,function(a){return O(a,d)},function(){return c.ownerDocument.createElement(d)},b);return}var e=rb(a,function(a){return Ob(a)},function(){return c.ownerDocument.createElement("blockquote")},b);Sb(e,b)}function kc(b,c){if(!U(b))return;if(Ob(b)){gc(b,c);return}if(Nb(b)){b.removeAttribute("class"),b.removeAttribute("dir"),b.style.margin="",b.style.padding="",b.style.border="",b.getAttribute("style")==""&&b.removeAttribute("style"),nb(b,"div",c);return}var d=b.parentNode,e=[];while(U(d)&&d.nodeType==a.Node.ELEMENT_NODE&&!Ob(d)&&!O(d,["ol","ul"]))e.push(d),d=d.parentNode;if(!U(d)||!Ob(d)){d=b.parentNode,e=[];while(U(d)&&d.nodeType==a.Node.ELEMENT_NODE&&!Nb(d)&&!O(d,["ol","ul"]))e.push(d),d=d.parentNode}if(O(b,["OL","UL"])&&(!U(d)||!Nb(d))){b.removeAttribute("reversed"),b.removeAttribute("start"),b.removeAttribute("type");var f=[].slice.call(h(b.childNodes));if(b.attributes.length&&!O(b.parentNode,["OL","UL"]))nb(b,"div",c);else{var g=Fb([].slice.call(h(b.childNodes)));gc(b,c),Gb(g,c)}for(var i=0;i<f.length;i++)Sb(f[i],c);return}if(!U(d)||!Nb(d))return;e.push(d);var j=d;while(e.length){d=e.pop();var k=b.parentNode==d?b:e[e.length-1];S(k)&&!O(k,"BR")&&O(k.nextSibling,"BR")&&k.parentNode.removeChild(k.nextSibling);var l=[].slice.call(h(d.childNodes),0,x(k)),m=[].slice.call(h(d.childNodes),1+x(k));jc(l,c),jc(m,c)}kc(j,c)}function lc(b,c){var d=Vb()==b?"disable":"enable";b=b.toUpperCase();var e=b=="OL"?"UL":"OL",f=[];(function(){for(var a=c.endContainer;a!=c.commonAncestorContainer;a=a.parentNode)O(a,"li")&&f.unshift(a);for(var a=c.startContainer;a;a=a.parentNode)O(a,"li")&&f.unshift(a)})(),a(f).forEach(function(a){Tb(a,c)});var g=$b(c);d=="enable"&&a(D(g,function(a){return U(a)&&O(a,e)})).forEach(function(a){if(U(a.previousSibling)&&O(a.previousSibling,b)||U(a.nextSibling)&&O(a.nextSibling,b)){var d=[].slice.call(h(a.childNodes)),e=Fb(d);fc(d,c),rb(d,function(a){return O(a,b)},function(){return null},c),Gb(e,c)}else nb(a,b,c)});var i=C(g,function(a){return U(a)&&!Nb(a)&&(O(a,["OL","UL"])||O(a.parentNode,["OL","UL"])||ub(a,"li"))});d=="enable"&&(i=a(i).filter(function(a){return!O(a,["ol","ul"])||O(a.parentNode,["ol","ul"])}));if(d=="disable")while(i.length){var j=[];j.push(i.shift());if(O(j[0],b)){kc(j[0],c);continue}while(i.length&&i[0]==j[j.length-1].nextSibling&&!O(i[0],b))j.push(i.shift());var k=Fb(j);fc(j,c);for(var l=0;l<j.length;l++)Sb(j[l],c);Gb(k,c)}else while(i.length){var j=[];while(!j.length||i.length&&i[0]==j[j.length-1].nextSibling)if(O(i[0],["p","div"]))j.push(nb(i[0],"li",c)),i.shift();else if(O(i[0],["li","ol","ul"]))j.push(i.shift());else{var m=[];while(!m.length||i.length&&i[0]==m[m.length-1].nextSibling&&S(i[0])&&S(m[m.length-1])&&!O(m[m.length-1],"br"))m.push(i.shift());j.push(rb(m,undefined,function(){return document.createElement("li")},c))}if(O(j[0].parentNode,b)||a(j).every(function(a){return O(a,["ol","ul"])}))continue;if(O(j[0].parentNode,e)){var k=Fb(j);fc(j,c),rb(j,function(a){return O(a,b)},function(){return document.createElement(b)},c),Gb(k,c);continue}Sb(rb(j,function(a){return O(a,b)},function(){if(!U(j[0].parentNode)||!Ob(j[0].parentNode)||!U(j[0].parentNode.previousSibling)||!O(j[0].parentNode.previousSibling,b))return document.createElement(b);var a=j[0].parentNode.previousSibling;return Tb(a.lastChild,c),(!U(a.lastChild)||!O(a.lastChild,b))&&a.appendChild(document.createElement(b)),a.lastChild},c),c)}}function mc(b,c){var d=$b(c),f=D(d,function(b){return b.nodeType==a.Node.ELEMENT_NODE&&U(b)&&(a(b).hasAttribute("align")||b.style.textAlign!=""||O(b,"center"))});for(var h=0;h<f.length;h++){var i=f[h];i.removeAttribute("align"),i.style.textAlign="",i.getAttribute("style")==""&&i.removeAttribute("style"),O(i,["div","span","center"])&&!i.attributes.length&&gc(i,c),O(i,"center")&&i.attributes.length&&nb(i,"div",c)}d=$b(e);var j=[];j=C(d,function(a){return U(a)&&ub(a,"div")&&Wb(a)!=b});while(j.length){var k=[];k.push(j.shift());while(j.length&&j[0]==k[k.length-1].nextSibling)k.push(j.shift());rb(k,function(c){return O(c,"div")&&a(c.attributes).every(function(a){return a.name=="align"&&a.value.toLowerCase()==b||a.name=="style"&&g(c)==1&&c.style.textAlign==b})},function(){var a=document.createElement("div");return a.setAttribute("style","text-align: "+b),a},c)}}function nc(){var a=document.createElement("br");return a.setAttribute("class","aloha-end-br"),a}var c="http://www.w3.org/1999/xhtml",d=!1,e=null,f={},G=0,P=["address","article","aside","blockquote","caption","center","col","colgroup","dd","details","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","listing","menu","nav","ol","p","plaintext","pre","section","summary","table","tbody","td","tfoot","th","thead","tr","ul","xmp"],gb,hb,ib,jb,kb,lb;(function(){function d(d){if(!c||c.startContainer!=d.startContainer||c.endContainer!=d.endContainer||c.startOffset!=d.startOffset||c.endOffset!=d.endOffset)a={},b={},c=d.cloneRange()}var a={},b={},c=null;gb=function(b,c){return d(c),a[b]},hb=function(b,c,e){d(e),a[b]=c},ib=function(b,c){d(c),delete a[b]},jb=function(a,c){return d(c),b[a]},kb=function(a,c,e){d(e),b[a]=c,a=="backcolor"?b.hilitecolor=c:a=="hilitecolor"&&(b.backcolor=c)},lb=function(a,c){d(c),delete b[a],a=="backcolor"?delete b.hilitecolor:a=="hilitecolor"&&delete b.backcolor}})();var sb=["a","abbr","b","bdi","bdo","cite","code","dfn","em","h1","h2","h3","h4","h5","h6","i","kbd","mark","p","pre","q","rp","rt","ruby","s","samp","small","span","strong","sub","sup","u","var","acronym","listing","strike","xmp","big","blink","font","marquee","nobr","tt"];f.backcolor={action:function(a){/^([0-9a-fA-F]{3}){1,2}$/.test(a)&&(a="#"+a);if(!/^(rgba?|hsla?)\(.*\)$/.test(a)&&!F(a)&&a.toLowerCase()!="transparent")return;Kb("backcolor",a)},standardInlineValueCommand:!0,relevantCssProperty:"backgroundColor",equivalentValues:function(a,b){return E(a)===E(b)}},f.bold={action:function(a,b){L("bold",b)?Kb("bold","normal",b):Kb("bold","bold",b)},inlineCommandActivatedValues:["bold","600","700","800","900"],relevantCssProperty:"fontWeight",equivalentValues:function(a,b){return a==b||a=="bold"&&b=="700"||a=="700"&&b=="bold"||a=="normal"&&b=="400"||a=="400"&&b=="normal"}},f.createlink={action:function(b){if(b==="")return;a(xb(fb())).forEach(function(c){a(q(c)).forEach(function(c){U(c)&&O(c,"a")&&a(c).hasAttribute("href")&&c.setAttribute("href",b)})}),Kb("createlink",b)},standardInlineValueCommand:!0},f.fontname={action:function(a){Kb("fontname",a)},standardInlineValueCommand:!0,relevantCssProperty:"fontFamily"},f.fontsize={action:function(b){if(b==="")return;b=Lb(b);if(a(["xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large"]).indexOf(b)==-1&&!/^[0-9]+(\.[0-9]+)?(cm|mm|in|pt|pc)$/.test(b))return;Kb("fontsize",b)},indeterm:function(){return a(xb(fb(),function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE})).map(function(a){return Cb(a,"fontsize")},!0).filter(function(b,c,d){return a(d.slice(0,c)).indexOf(b)==-1}).length>=2},value:function(b){var c=xb(b,function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE})[0];c===undefined&&(c=b.startContainer);var d=Cb(c,"fontsize");return Mb(d)},relevantCssProperty:"fontSize"},f.forecolor={action:function(a){/^([0-9a-fA-F]{3}){1,2}$/.test(a)&&(a="#"+a);if(!/^(rgba?|hsla?)\(.*\)$/.test(a)&&!F(a)&&a.toLowerCase()!="transparent")return;Kb("forecolor",a)},standardInlineValueCommand:!0,relevantCssProperty:"color",equivalentValues:function(a,b){return E(a)===E(b)}},f.hilitecolor={action:function(a){/^([0-9a-fA-F]{3}){1,2}$/.test(a)&&(a="#"+a);if(!/^(rgba?|hsla?)\(.*\)$/.test(a)&&!F(a)&&a.toLowerCase()!="transparent")return;Kb("hilitecolor",a)},indeterm:function(){return a(xb(fb(),function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE})).map(function(a){return Cb(a,"hilitecolor")},!0).filter(function(b,c,d){return a(d.slice(0,c)).indexOf(b)==-1}).length>=2},standardInlineValueCommand:!0,relevantCssProperty:"backgroundColor",equivalentValues:function(a,b){return E(a)===E(b)}},f.italic={action:function(a,b){L("italic",b)?Kb("italic","normal",b):Kb("italic","italic",b)},inlineCommandActivatedValues:["italic","oblique"],relevantCssProperty:"fontStyle"},f.removeformat={action:function(){function b(a){return U(a)&&O(a,["abbr","acronym","b","bdi","bdo","big","blink","cite","code","dfn","em","font","i","ins","kbd","mark","nobr","q","s","samp","small","span","strike","strong","sub","sup","tt","u","var"])}var c=xb(fb(),b);a(c).forEach(function(a){while(a.hasChildNodes())mb(a.firstChild,a.parentNode,x(a),range);a.parentNode.removeChild(a)});if(U(fb().startContainer)&&fb().startContainer.nodeType==a.Node.TEXT_NODE&&fb().startOffset!=0&&fb().startOffset!=y(fb().startContainer))if(fb().startContainer==fb().endContainer){var d=fb().endOffset-fb().startOffset,e=fb().startContainer.splitText(fb().startOffset);fb().setStart(e,0),fb().setEnd(e,d)}else fb().setStart(fb().startContainer.splitText(fb().startOffset),0);if(U(fb().endContainer)&&fb().endContainer.nodeType==a.Node.TEXT_NODE&&fb().endOffset!=0&&fb().endOffset!=y(fb().endContainer)){var f=[fb().startContainer,fb().startOffset],d=[fb().endContainer,fb().endOffset];fb().setEnd(document.documentElement,0),d[0].splitText(d[1]),fb().setStart(f[0],f[1]),fb().setEnd(d[0],d[1])}a(xb(fb(),U)).forEach(function(a){while(b(a.parentNode)&&X(a.parentNode,a))fc([a],range)}),a(["subscript","bold","fontname","fontsize","forecolor","hilitecolor","italic","strikethrough","underline"]).forEach(function(a){Kb(a,null)})}},f.strikethrough={action:function(){L("strikethrough")?Kb("strikethrough",null):Kb("strikethrough","line-through")},inlineCommandActivatedValues:["line-through"]},f.subscript={action:function(){var a=L("subscript");Kb("subscript",null),a||Kb("subscript","subscript")},indeterm:function(){var b=xb(fb(),function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE});return a(b).some(function(a){return Cb(a,"subscript")=="subscript"})&&a(b).some(function(a){return Cb(a,"subscript")!="subscript"})||a(b).some(function(a){return Cb(a,"subscript")=="mixed"})},inlineCommandActivatedValues:["subscript"]},f.superscript={action:function(){var a=L("superscript");Kb("superscript",null),a||Kb("superscript","superscript")},indeterm:function(){var b=xb(fb(),function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE});return a(b).some(function(a){return Cb(a,"superscript")=="superscript"})&&a(b).some(function(a){return Cb(a,"superscript")!="superscript"})||a(b).some(function(a){return Cb(a,"superscript")=="mixed"})},inlineCommandActivatedValues:["superscript"]},f.underline={action:function(){L("underline")?Kb("underline",null):Kb("underline","underline")},inlineCommandActivatedValues:["underline"]},f.unlink={action:function(){var b=fb(),c=[];for(var d=b.startContainer;d;d=d.parentNode)O(d,"A")&&a(d).hasAttribute("href")&&c.unshift(d);for(var d=b.startContainer;d!=k(b.endContainer);d=i(d))O(d,"A")&&a(d).hasAttribute("href")&&(B(d,b)||l(d,b.endContainer)||d==b.endContainer)&&c.push(d);for(var e=0;e<c.length;e++)Hb(c[e],"unlink",b)},standardInlineValueCommand:!0};var Rb="p";f["delete"]={action:function(b,c){if(!c.collapsed){ec(c);return}ic(c.startContainer,c.startOffset);var d=c.startContainer,e=c.startOffset,f=!1,g=!1;for(;;){e>0&&(f=O(d.childNodes[e-1],"br")||!1,g=O(d.childNodes[e-1],"hr")||!1);if(e==0&&U(d.previousSibling)&&cb(d.previousSibling))d.parentNode.removeChild(d.previousSibling);else if(0<=e-1&&e-1<d.childNodes.length&&U(d.childNodes[e-1])&&(cb(d.childNodes[e-1])||f||g)){d.removeChild(d.childNodes[e-1]),e--;if(f||g){c.setStart(d,e),c.setEnd(d,e);return}}else if(e==0&&S(d)||cb(d))e=x(d),d=d.parentNode;else{if(0<=e-1&&e-1<d.childNodes.length&&U(d.childNodes[e-1])&&O(d.childNodes[e-1],"a")){gc(d.childNodes[e-1],c);return}if(!(0<=e-1&&e-1<d.childNodes.length&&!R(d.childNodes[e-1])&&!O(d.childNodes[e-1],["br","img"])))break;d=d.childNodes[e-1],e=y(d)}}_(d,c),e=c.startOffset;if(d.nodeType==a.Node.TEXT_NODE&&e!=0){c.setStart(d,e),c.setEnd(d,e),c.startOffset-=1,ec(c);return}if(S(d))return;if(0<=e-1&&e-1<d.childNodes.length&&O(d.childNodes[e-1],["br","hr","img"])){c.setStart(d,e),c.setEnd(d,e),ec(c);return}if(O(d,["li","dt","dd"])&&d==d.parentNode.firstChild&&e==0){var h=[];for(var i=d.parentNode;i;i=i.parentNode)O(i,"li")&&h.unshift(i);for(var j=0;j<h.length;j++)Tb(h[j],c);var k=Fb([d]);fc([d],c),Gb(k,c),O(d,["dd","dt"])&&a(q(d)).every(function(a){return!X(d,a)||!ub(d,a)})&&(d=nb(d,Rb,c)),Sb(d,c);for(var j=0;j<h.length;j++)Ub(h[j].parentNode,c);return}var l=d,n=e;for(;;)if(n==0)n=x(l),l=l.parentNode;else{if(!(0<=n-1&&n-1<l.childNodes.length&&U(l.childNodes[n-1])&&cb(l.childNodes[n-1])))break;l.removeChild(l.childNodes[n-1]),n--}if(e==0&&a(q(d).concat(d)).filter(function(a){return U(a)&&X(a,d)&&Nb(a)}).length){var o=Aloha.createRange();o.setStart(d,0),o.setEnd(d,0),o=$b(o);var p=C(o,function(a){return U(a)&&!V(a)});for(var j=0;j<p.length;j++)kc(p[j],c);return}if(O(l.childNodes[n],"table"))return;if(0<=n-1&&n-1<l.childNodes.length&&O(l.childNodes[n-1],"table")){c.setStart(l,n-1),c.setEnd(l,n);return}if(e==0&&(O(l.childNodes[n-1],"hr")||O(l.childNodes[n-1],"br")&&(O(l.childNodes[n-1].previousSibling,"br")||!S(l.childNodes[n-1].previousSibling)))){c.setStart(d,e),c.setEnd(d,e),ec(l,n-1,l,n);return}if(O(l.childNodes[n],["li","dt","dd"])&&S(l.childNodes[n].firstChild)&&n!=0){var r=l.childNodes[n-1];S(r.lastChild)&&!O(r.lastChild,"br")&&r.appendChild(document.createElement("br")),S(r.lastChild)&&r.appendChild(document.createElement("br"))}if(O(l.childNodes[n],["li","dt","dd"])&&O(l.childNodes[n-1],["li","dt","dd"]))l=l.childNodes[n-1],n=y(l),d=l.nextSibling,e=0;else while(0<=n-1&&n-1<l.childNodes.length)U(l.childNodes[n-1])&&cb(l.childNodes[n-1])?(l.removeChild(l.childNodes[n-1]),n--):(l=l.childNodes[n-1],n=y(l));var s=Aloha.createRange();s.setStart(l,n),s.setEnd(d,e),ec(s),m(document.body,c.startContainer)||(s.startContainer.hasChildNodes()||s.startContainer.nodeType==a.Node.TEXT_NODE?(c.setStart(s.startContainer,s.startOffset),c.setEnd(s.startContainer,s.startOffset)):(c.setStart(s.startContainer.parentNode,x(s.startContainer)),c.setEnd(s.startContainer.parentNode,x(s.startContainer))))}};var oc=["address","dd","div","dt","h1","h2","h3","h4","h5","h6","p","pre"];return f.formatblock={action:function(b){/^<.*>$/.test(b)&&(b=b.slice(1,-1)),b=b.toLowerCase();if(a(oc).indexOf(b)==-1)return;var c=$b(fb()),d=C(c,function(b){return U(b)&&(Pb(b)||ub(b,"p")||O(b,["dd","dt"]))&&!a(r(b)).some(Q)}),e=Fb(d);for(var f=0;f<d.length;f++){var g=d[f];while(a(q(g)).some(function(b){return U(b)&&X(b,g)&&O(b,oc)&&!a(r(b)).some(Q)}))fc([g],range)}Gb(e,range);while(d.length){var i;if(Qb(d[0])){i=[].slice.call(h(d[0].childNodes));var e=Fb(i);gc(d[0],range),Gb(e,range),d.shift()}else{i=[],i.push(d.shift());while(d.length&&d[0]==i[i.length-1].nextSibling&&!Qb(d[0])&&!O(i[i.length-1],"BR"))i.push(d.shift())}Sb(rb(i,a(["div","p"]).indexOf(b)==-1?function(a){return O(a,b)&&!a.attributes.length}:function(){return!1},function(){return document.createElement(b)},range),range)}},indeterm:function(){var b=$b(fb()),c=D(b,function(a){return bb(a)&&U(a)&&!a.hasChildNodes()});if(!c.length)return!1;var d=null;for(var e=0;e<c.length;e++){var f=c[e];while(U(f.parentNode)&&X(f,f.parentNode)&&!O(f,oc))f=f.parentNode;var g="";U(f)&&O(f,oc)&&!a(r(f)).some(Q)&&(g=f.tagName);if(d===null)d=g;else if(d!=g)return!0}return!1},value:function(){var b=$b(fb()),c=D(b,function(a){return bb(a)&&U(a)&&!a.hasChildNodes()});if(!c.length)return"";var d=c[0];while(U(d.parentNode)&&X(d,d.parentNode)&&!O(d,oc))d=d.parentNode;return U(d)&&O(d,oc)&&!a(r(d)).some(Q)?d.tagName.toLowerCase():""}},f.forwarddelete={action:function(b,c){if(!c.collapsed){ec(c);return}ic(c.startContainer,c.startOffset);var d=c.startContainer,e=c.startOffset,f=!1,g=!1;for(;;){e<d.childNodes.length&&(f=O(d.childNodes[e],"br")||!1,g=O(d.childNodes[e],"hr")||!1);if(e==y(d)&&U(d.nextSibling)&&cb(d.nextSibling))d.parentNode.removeChild(d.nextSibling);else if(e<d.childNodes.length&&U(d.childNodes[e])&&(cb(d.childNodes[e])||f||g)){d.removeChild(d.childNodes[e]);if(f||g){c.setStart(d,e),c.setEnd(d,e);return}}else if(e<d.childNodes.length&&db(d.childNodes[e]))e++;else if(e==y(d)&&S(d)||cb(d))e=1+x(d),d=d.parentNode;else{if(!(e<d.childNodes.length&&!R(d.childNodes[e])&&!O(d.childNodes[e],["br","img"])))break;d=d.childNodes[e],e=0}}_(d,c),e=c.startOffset;if(d.nodeType==a.Node.TEXT_NODE&&e!=y(d)){c.setStart(d,e),c.setEnd(d,e);var h=e+1;while(h!=d.length&&/^[\u0300-\u036f\u0591-\u05bd\u05c1\u05c2]$/.test(d.data[h]))h++;ec(d,e,d,h);return}if(S(d))return;if(e<d.childNodes.length&&O(d.childNodes[e],["br","hr","img"])){c.setStart(d,e),c.setEnd(d,e),ec(d,e,d,e+1);return}var i=d,h=e;for(;;)if(h==y(i))h=1+x(i),i=i.parentNode;else{if(!(h<i.childNodes.length&&U(i.childNodes[h])&&cb(i.childNodes[h])))break;i.removeChild(i.childNodes[h])}if(O(i.childNodes[h-1],"table"))return;if(O(i.childNodes[h],"table")){c.setStart(i,h),c.setEnd(i,h+1);return}if(e==y(d)&&O(i.childNodes[h],["br","hr"])){c.setStart(d,e),c.setEnd(d,e),ec(i,h,i,h+1);return}while(h<i.childNodes.length)U(i.childNodes[h])&&cb(i.childNodes[h])?i.removeChild(i.childNodes[h]):(i=i.childNodes[h],h=0);ec(d,e,i,h)}},f.indent={action:function(){var a=[];for(var b=fb().endContainer;b!=fb().commonAncestorContainer;b=b.parentNode)O(b,"LI")&&a.unshift(b);for(var b=fb().startContainer;b!=fb().commonAncestorContainer;b=b.parentNode)O(b,"LI")&&a.unshift(b);for(var b=fb().commonAncestorContainer;b;b=b.parentNode)O(b,"LI")&&a.unshift(b);for(var c=0;c<a.length;c++)Tb(a[c,range]);var d=$b(fb()),e=[];e=C(d,function(a){return U(a)&&(ub(a,"div")||ub(a,"ol"))}),e.length&&O(e[0],"LI")&&O(e[0].parentNode,["OL","UL"])&&O(e[0].previousSibling,"LI")&&Tb(e[0].previousSibling,range);while(e.length){var f=[];f.push(e.shift());while(e.length&&e[0]==f[f.length-1].nextSibling)f.push(e.shift());jc(f,range)}}},f.inserthorizontalrule={action:function(b,c){while(c.startOffset==0&&c.startContainer.parentNode)c.setStart(c.startContainer.parentNode,x(c.startContainer));while(c.endOffset==y(c.endContainer)&&c.endContainer.parentNode)c.setEnd(c.endContainer.parentNode,1+x(c.endContainer));ec(c,{blockMerging:!1});if(!U(fb().startContainer)&&!T(fb().startContainer))return;fb().startContainer.nodeType==a.Node.TEXT_NODE&&fb().startOffset==0&&(fb().setStart(fb().startContainer.parentNode,x(fb().startContainer)),fb().collapse(!0)),fb().startContainer.nodeType==a.Node.TEXT_NODE&&fb().startOffset==y(fb().startContainer)&&(fb().setStart(fb().startContainer.parentNode,1+x(fb().startContainer)),fb().collapse(!0));var d=document.createElement("hr");c.insertNode(d),Sb(d,c),c.setStart(d.parentNode,1+x(d)),c.setEnd(d.parentNode,1+x(d)),Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(c)}},f.inserthtml={action:function(b,c){ec(c);if(!U(c.startContainer)&&!T(c.startContainer))return;var d=c.createContextualFragment(b),e=d.lastChild;if(!e)return;var f=r(d);R(c.startContainer)&&a(c.startContainer.childNodes).filter(function(a,b){return U(a)&&db(a)&&x(a)>=b.startOffset},!0).forEach(function(a){a.parentNode.removeChild(a)}),c.insertNode(d),R(c.startContainer)&&!a(c.startContainer.childNodes).some(bb)&&c.startContainer.appendChild(nc()),c.setStart(e.parentNode,1+x(e)),c.setEnd(e.parentNode,1+x(e));for(var g=0;g<f.length;g++)Sb(f[g],c);eb(c)}},f.insertimage={action:function(a){if(a==="")return;var b=fb();ec(b,{stripWrappers:!1});if(!U(fb().startContainer)&&!T(fb().startContainer))return;R(b.startContainer)&&b.startContainer.childNodes.length==1&&O(b.startContainer.firstChild,"br")&&b.startOffset==0&&b.startContainer.removeChild(b.startContainer.firstChild);var c=document.createElement("img");c.setAttribute("src",a),b.insertNode(c),b.setStart(c.parentNode,1+x(c)),b.setEnd(c.parentNode,1+x(c)),Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(b),c.removeAttribute("width"),c.removeAttribute("height")}},f.insertlinebreak={action:function(b,c){ec(c,{stripWrappers:!1});if(!U(c.startContainer)&&!T(c.startContainer))return;if(c.startContainer.nodeType==a.Node.ELEMENT_NODE&&!ub("br",c.startContainer))return;if(c.startContainer.nodeType!=a.Node.ELEMENT_NODE&&!ub("br",c.startContainer.parentNode))return;if(c.startContainer.nodeType==a.Node.TEXT_NODE&&c.startOffset==0){var d=c.startContainer.parentNode,e=x(c.startContainer);Aloha.getSelection().collapse(d,e),c.setStart(d,e),c.setEnd(d,e)}if(c.startContainer.nodeType==a.Node.TEXT_NODE&&c.startOffset==y(c.startContainer)){var d=c.startContainer.parentNode,e=1+x(c.startContainer);Aloha.getSelection().collapse(d,e),c.setStart(d,e),c.setEnd(d,e)}var f=document.createElement("br");c.insertNode(f),Aloha.getSelection().collapse(f.parentNode,1+x(f)),c.setStart(f.parentNode,1+x(f)),c.setEnd(f.parentNode,1+x(f)),Y(f)&&(c.insertNode(nc()),Aloha.getSelection().collapse(f.parentNode,1+x(f)),c.setStart(f.parentNode,1+x(f)),c.setEnd(f.parentNode,1+x(f)))}},f.insertorderedlist={action:function(){lc("ol")},indeterm:function(){return/^mixed( ol)?$/.test(Vb())},state:function(){return Vb()=="ol"}},f.insertparagraph={action:function(b,c){ec(c);if(!U(c.startContainer)&&!T(c.startContainer))return;var d=c.startContainer,e=c.startOffset;d.nodeType==a.Node.TEXT_NODE&&e!=0&&
e!=y(d)&&d.splitText(e),d.nodeType==a.Node.TEXT_NODE&&e==y(d)&&(e=1+x(d),d=d.parentNode);if(d.nodeType==a.Node.TEXT_NODE||d.nodeType==a.Node.COMMENT_NODE)e=x(d),d=d.parentNode;Aloha.getSelection().collapse(d,e),c.setStart(d,e),c.setEnd(d,e);var f=d;while(!Qb(f)&&U(f.parentNode)&&X(d,f.parentNode))f=f.parentNode;if(!U(f)||!X(f,d)||!Qb(f)){var g=Rb,h=$b(c),j=C(h,function(a){return ub(a,"p")}).slice(0,1);if(!j.length){if(!ub(g,c.startContainer))return;f=document.createElement(g),c.insertNode(f),f.appendChild(nc()),Aloha.getSelection().collapse(f,0),c.setStart(f,0),c.setEnd(f,0);return}while(j[j.length-1].nextSibling&&ub(j[j.length-1].nextSibling,"p"))j.push(j[j.length-1].nextSibling);f=rb(j,function(){return!1},function(){return document.createElement(g)},c)}if(f.tagName=="ADDRESS"||f.tagName=="LISTING"||f.tagName=="PRE"){var k=document.createElement("br"),l=f.offsetHeight;c.insertNode(k);var m=f.offsetHeight;Aloha.getSelection().collapse(d,e+1),c.setStart(d,e+1),c.setEnd(d,e+1),l==m&&!n(i(k),f)&&(c.insertNode(nc()),Aloha.getSelection().collapse(d,e+1),c.setEnd(d,e+1));return}if(a(["LI","DT","DD"]).indexOf(f.tagName)!=-1&&(!f.hasChildNodes()||f.childNodes.length==1&&O(f.firstChild,"br"))){fc([f],c);if(!f.hasChildNodes()){var l=f.offsetHeight,o=nc();f.appendChild(o),f.offsetHeight!==l&&f.removeChild(o)}O(f,["dd","dt"])&&a(q(f)).every(function(a){return!X(f,a)||!ub(f,a)})&&(f=nb(f,Rb,c)),Sb(f,c);if(O(f,"li")&&O(f.nextSibling,"li")&&O(f.nextSibling.firstChild,["ol","ul"])){var p=f.nextSibling,s=f.nextSibling.childNodes.length;for(var t=0;t<s;t++)f.appendChild(p.childNodes[t]);p.parentNode.removeChild(p)}return}var u=Aloha.createRange();u.setStart(c.startContainer,c.startOffset),u.setEnd(f,y(f));while(u.startOffset==0&&u.startContainer!=f)u.setStart(u.startContainer.parentNode,x(u.startContainer));while(u.startOffset==y(u.startContainer)&&u.startContainer!=f)u.setStart(u.startContainer.parentNode,1+x(u.startContainer));var v=C(u),w=!v.length||v.length==1&&O(v[0],"br"),z;/^H[1-6]$/.test(f.tagName)&&w?z=Rb:f.tagName=="DT"&&w?z="dd":f.tagName=="DD"&&w?z="dt":z=f.tagName.toLowerCase();var A=document.createElement(z);for(var t=0;t<f.attributes.length;t++)typeof A.setAttributeNS=="function"?A.setAttributeNS(f.attributes[t].namespaceURI,f.attributes[t].name,f.attributes[t].value):f.attributes[t].value.length>0&&f.attributes[t].value!="null"&&f.attributes[t].value>0&&A.setAttribute(f.attributes[t].name,f.attributes[t].value);A.removeAttribute("id"),f.parentNode.insertBefore(A,f.nextSibling);var B=D(u),E=u.extractContents(),F=r(E);for(var t=0;t<F.length;t++)F[t].nodeType==a.Node.ELEMENT_NODE&&a(B).indexOf(F[t])==-1&&F[t].removeAttribute("id");var G=[],H=E.firstChild;if(H)do $(H)||G.push(H);while(H=H.nextSibling);if(O(A,"li")&&G.length&&O(G[0],["ul","ol"])){var l=A.offsetHeight,o=nc();A.appendChild(o);var m=A.offsetHeight;l!==m&&A.removeChild(o)}A.appendChild(E),f.offsetHeight==0&&!a(f.childNodes).some(bb)&&f.appendChild(nc()),A.offsetHeight==0&&!a(A.childNodes).some(bb)&&A.appendChild(nc()),Aloha.getSelection().collapse(A,0),c.setStart(A,0),c.setEnd(A,0)}},f.inserttext={action:function(b,c){ec(c,{stripWrappers:!1});if(!U(c.startContainer)&&!T(c.startContainer))return;if(b.length>1){for(var d=0;d<b.length;d++)f.inserttext.action(b[d],c);return}if(b=="")return;if(b=="\n"){f.insertparagraph.action("",c);return}var e=c.startContainer,g=c.startOffset;0<=g-1&&g-1<e.childNodes.length&&e.childNodes[g-1].nodeType==a.Node.TEXT_NODE&&(e=e.childNodes[g-1],g=y(e)),0<=g&&g<e.childNodes.length&&e.childNodes[g].nodeType==a.Node.TEXT_NODE&&(e=e.childNodes[g],g=0);var h=e.nodeType==a.Node.ELEMENT_NODE?e:e.parentNode;b==" "&&h.nodeType==a.Node.ELEMENT_NODE&&a(["pre","pre-wrap"]).indexOf(a.getComputedStyle(h).whiteSpace)==-1&&(b=" ");var i=bc(c);if(e.nodeType==a.Node.TEXT_NODE)e.insertData(g,b),Aloha.getSelection().collapse(e,g),c.setStart(e,g),Aloha.getSelection().extend(e,g+1),c.setEnd(e,g+1);else{e.childNodes.length==1&&Y(e.firstChild)&&e.removeChild(e.firstChild);var j=document.createTextNode(b);c.insertNode(j),Aloha.getSelection().collapse(j,0),c.setStart(j,0),Aloha.getSelection().extend(j,1),c.setEnd(j,1)}dc(i),ic(c.startContainer,c.startOffset),ic(c.endContainer,c.endOffset),Aloha.getSelection().collapseToEnd(),c.collapse(!1)}},f.insertunorderedlist={action:function(){lc("ul")},indeterm:function(){return/^mixed( ul)?$/.test(Vb())},state:function(){return Vb()=="ul"}},f.justifycenter={action:function(a,b){mc("center",b)},indeterm:function(){var b=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return a(b).some(function(a){return Wb(a)=="center"})&&a(b).some(function(a){return Wb(a)!="center"})},state:function(){var b=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return b.length&&a(b).every(function(a){return Wb(a)=="center"})},value:function(){var a=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return a.length?Wb(a[0]):"left"}},f.justifyfull={action:function(a,b){mc("justify",b)},indeterm:function(){var b=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return a(b).some(function(a){return Wb(a)=="justify"})&&a(b).some(function(a){return Wb(a)!="justify"})},state:function(){var b=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return b.length&&a(b).every(function(a){return Wb(a)=="justify"})},value:function(){var a=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return a.length?Wb(a[0]):"left"}},f.justifyleft={action:function(a,b){mc("left",b)},indeterm:function(){var b=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return a(b).some(function(a){return Wb(a)=="left"})&&a(b).some(function(a){return Wb(a)!="left"})},state:function(){var b=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return b.length&&a(b).every(function(a){return Wb(a)=="left"})},value:function(){var a=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return a.length?Wb(a[0]):"left"}},f.justifyright={action:function(a,b){mc("right",b)},indeterm:function(){var b=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return a(b).some(function(a){return Wb(a)=="right"})&&a(b).some(function(a){return Wb(a)!="right"})},state:function(){var b=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return b.length&&a(b).every(function(a){return Wb(a)=="right"})},value:function(){var a=D($b(fb()),function(a){return U(a)&&bb(a)&&!a.hasChildNodes()});return a.length?Wb(a[0]):"left"}},f.outdent={action:function(){var b=[];(function(){for(var a=fb().endContainer;a!=fb().commonAncestorContainer;a=a.parentNode)O(a,"li")&&b.unshift(a);for(var a=fb().startContainer;a;a=a.parentNode)O(a,"li")&&b.unshift(a)})(),a(b).forEach(function(a){Tb(a,range)});var c=$b(fb()),d=C(c,function(b){return U(b)&&(!a(r(b)).some(U)||O(b,["ol","ul"])||O(b,"li")&&O(b.parentNode,["ol","ul"]))});while(d.length){while(d.length&&(O(d[0],["OL","UL"])||!O(d[0].parentNode,["OL","UL"])))kc(d.shift(),range);if(!d.length)break;var e=[];e.push(d.shift());while(d.length&&d[0]==e[e.length-1].nextSibling&&!O(d[0],["OL","UL"]))e.push(d.shift());var f=Fb(e);fc(e,range),a(e).forEach(Sb),Gb(f,range)}}},f.selectall={action:function(){var a=document.body;a||(a=document.documentElement),a?Aloha.getSelection().selectAllChildren(a):Aloha.getSelection().removeAllRanges()}},f.stylewithcss={action:function(a){d=String(a).toLowerCase()!="false"},state:function(){return d}},f.usecss={action:function(a){d=String(a).toLowerCase()=="false"}},function(){var b=[];for(var c in f)b.push(c);a(b).forEach(function(b){"relevantCssProperty"in f[b]||(f[b].relevantCssProperty=null),"inlineCommandActivatedValues"in f[b]&&!("indeterm"in f[b])&&(f[b].indeterm=function(c){var d=a(xb(c,function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE})).map(function(a){return Cb(a,b)}),e=a(d).filter(function(c){return a(f[b].inlineCommandActivatedValues).indexOf(c)!=-1});return e.length>=1&&d.length-e.length>=1}),"inlineCommandActivatedValues"in f[b]&&(f[b].state=function(c){var d=xb(c,function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE});return d.length==0?a(f[b].inlineCommandActivatedValues).indexOf(Cb(c.startContainer,b))!=-1:a(d).every(function(c){return a(f[b].inlineCommandActivatedValues).indexOf(Cb(c,b))!=-1})}),"standardInlineValueCommand"in f[b]&&(f[b].indeterm=function(){var c=a(xb(fb())).filter(function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE},!0).map(function(a){return Cb(a,b)});for(var d=1;d<c.length;d++)if(c[d]!=c[d-1])return!0;return!1},f[b].value=function(c){var d=xb(c,function(b){return U(b)&&b.nodeType==a.Node.TEXT_NODE})[0];return typeof d=="undefined"&&(d=c.startContainer),Cb(d,b)})})}(),{commands:f,execCommand:I,queryCommandIndeterm:K,queryCommandState:L,queryCommandValue:N,queryCommandEnabled:J,queryCommandSupported:M}});