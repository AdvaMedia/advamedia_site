(function(){window.Locomotive={mounted_on:window.Locomotive.mounted_on,Models:{},Collections:{},Views:{}},window.Locomotive.Views.Memberships={}}).call(this),function(){var a;window.Aloha=(a=window.Aloha)!=null?a:window.Aloha={},window.Aloha.settings={logLevels:{error:!0,warn:!0,info:!1,debug:!1},errorhandling:!0,plugins:{format:{config:["b","i","u","del","sub","sup","p","title","h1","h2","h3","h4","h5","h6","pre","removeFormat"],editables:{".editable-short-text":["b","i","u"]}},link:{config:["a"],editables:{".editable-short-text":[]}},list:{config:["ul"],editables:{".editable-short-text":[]}},image:{ui:{insert:!1,crop:!1}}},i18n:{available:["en","fr","pt-BR","es","de","no","ru","nl"]},sidebar:{disabled:!0}}}.call(this),function(){String.prototype.trim=function(){return this.replace(/^\s+/g,"").replace(/\s+$/g,"")},String.prototype.repeat=function(a){for(var b=0,c="";b<a;b++)c+=this;return c},String.prototype.truncate=function(a){return this.length>a?this.slice(0,a-3)+"...":this},String.prototype.slugify=function(a){typeof a=="undefined"&&(a="_");var b=new RegExp("[^\\w\\"+a+"]","g"),c=new RegExp("[\\"+a+"]{2,}","g");return this.replace(/\s/g,a).replace(b,"").replace(c,a).toLowerCase()},window.addParameterToURL=function(a,b,c){typeof c=="undefined"&&(c=document),a=encodeURIComponent(a),b=encodeURIComponent(b);var d=c.location.search.substr(1).split("&"),e=d.length,f;while(e--){f=d[e].split("=");if(f[0]==a){f[1]=b,d[e]=f.join("=");break}}e<0&&(d[d.length]=[a,b].join("=")),c.location.search=d.join("&")},window.addJavascript=function(a,b,c){var d=a.createElement("script");d.type="text/javascript",d.src=b,c&&c.onload&&(d.onload=c.onload,delete c.onload);for(var e in c)d.setAttribute(e,c[e]);a.body.appendChild(d)},window.addStylesheet=function(a,b,c){var d=a.createElement("link");d.style="text/css",d.href=b,d.media="screen",d.rel="stylesheet",a.head.appendChild(d)}}(),$.growl.settings.noticeTemplate='<div class="notice %title%">  <p>%message%</p></div>',$.growl.settings.dockCss={position:"fixed",bottom:"20px",left:"0px",width:"100%",zIndex:5e4},function(){Handlebars.registerHelper("each_with_index",function(a,b){var c,d,e,f,g;e="";for(f=0,g=a.length;f<g;f++)d=a[f],c=a[d],c._index=d,e+=b(c);return e})}.call(this),function(){window.Locomotive.tinyMCE={defaultSettings:{theme:"advanced",skin:"locomotive",plugins:"safari,jqueryinlinepopups,locomotive_media,fullscreen",extended_valid_elements:"iframe[width|height|frameborder|allowfullscreen|src|title]",theme_advanced_buttons1:"fullscreen,code,|,bold,italic,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,bullist,numlist,|,outdent,indent,blockquote,|,link,unlink,|,locomotive_media",theme_advanced_buttons2:"formatselect,fontselect,fontsizeselect",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",height:"300",width:"709",convert_urls:!1,fullscreen_new_window:!1,fullscreen_settings:{theme_advanced_path_location:"top"}},minimalSettings:{theme:"advanced",skin:"locomotive",plugins:"safari,jqueryinlinepopups,locomotive_media",theme_advanced_buttons1:"code,|,bold,italic,strikethrough,|,fontselect,fontsizeselect,|,link,unlink,|,locomotive_media",theme_advanced_buttons2:"",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",height:"20",width:"709",convert_urls:!1},popupSettings:{theme:"advanced",skin:"locomotive",plugins:"safari,jqueryinlinepopups,locomotive_media,fullscreen",extended_valid_elements:"iframe[width|height|frameborder|allowfullscreen|src|title]",theme_advanced_buttons1:"fullscreen,code,|,bold,italic,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,bullist,numlist,|,outdent,indent,blockquote,|,link,unlink,|,locomotive_media",theme_advanced_buttons2:"formatselect,fontselect,fontsizeselect",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",height:"300",width:"545",convert_urls:!1,fullscreen_new_window:!1,fullscreen_settings:{theme_advanced_path_location:"top"}}}}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Locomotive.Models.Account=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.paramRoot="account",c.prototype.urlRoot=""+Locomotive.mounted_on+"/accounts",c}(Backbone.Model),Locomotive.Models.CurrentAccount=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.url=""+Locomotive.mounted_on+"/my_account",c}(Locomotive.Models.Account)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Locomotive.Models.ContentAsset=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.paramRoot="content_asset",c.prototype.urlRoot=""+Locomotive.mounted_on+"/content_assets",c.prototype.initialize=function(){return this.prepare()},c.prototype.prepare=function(){return this.set({image:this.get("content_type")==="image"}),this},c}(Backbone.Model),Locomotive.Models.ContentAssetsCollection=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.model=Locomotive.Models.ContentAsset,c.prototype.url=""+Locomotive.mounted_on+"/content_assets",c}(Backbone.Collection)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Locomotive.Models.ContentEntry=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.paramRoot="content_entry",c.prototype.urlRoot=""+Locomotive.mounted_on+"/content_types/:slug/entries",c.prototype.initialize=function(){var a=this;return this.urlRoot=this.urlRoot.replace(":slug",this.get("content_type_slug")),_.each(this.get("has_many_custom_fields"),function(b){var c,d;return d=b[0],c=new Locomotive.Models.ContentEntriesCollection(a.get(d)),a.set_attribute(d,c)}),_.each(this.get("many_to_many_custom_fields"),function(b){var c,d;return d=b[0],c=new Locomotive.Models.ContentEntriesCollection(a.get(d)),c.comparator=function(a){return a.get("__position")||0},a.set_attribute(d,c)})},c.prototype.set_attribute=function(a,b){var c;return c={},c[a]=b,this.set(c)},c.prototype.update_attributes=function(a){var b=this;return _.each(a.file_custom_fields,function(c){var d;return d=""+c+"_url",b.set_attribute(d,a[d]),b.set_attribute("remove_"+c,!1)})},c.prototype.toMinJSON=function(){var a=this;return _.tap({},function(b){return _.each(a.attributes,function(a,c){if(c==="id"||c==="_destroy"||c.indexOf("position_in_")===0)return b[c]=a})})},c.prototype.toJSON=function(){var a=this;return _.tap(c.__super__.toJSON.apply(this,arguments),function(b){return b._slug===null&&(b._slug=""),_.each(_.keys(b),function(c){if(!_.include(a.get("safe_attributes"),c))return delete b[c]}),_.each(a.get("has_many_custom_fields"),function(c){var d;d=c[0];if(a.get(d).length>0)return b[""+d+"_attributes"]=a.get(d).toMinJSON()}),_.each(a.get("many_to_many_custom_fields"),function(c){var d,e;return d=c[0],e=c[1],b[e]=a.get(d).sort().map(function(a){return a.id})})})},c}(Backbone.Model),Locomotive.Models.ContentEntriesCollection=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.model=Locomotive.Models.ContentEntry,c.prototype.url=""+Locomotive.mounted_on+"/content_types/:slug/entries",c.prototype.toMinJSON=function(){var a=this;return this.map(function(a){return a.toMinJSON()})},c}(Backbone.Collection)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Locomotive.Models.ContentType=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.paramRoot="content_type",c.prototype.urlRoot=""+Locomotive.mounted_on+"/content_types",c.prototype.initialize=function(){return this._normalize()},c.prototype._normalize=function(){return this.set({entries_custom_fields:new Locomotive.Models.CustomFieldsCollection(this.get("entries_custom_fields"))})},c.prototype.toJSON=function(){var a=this;return _.tap(c.__super__.toJSON.apply(this,arguments),function(b){delete b.entries_custom_fields;if(a.get("entries_custom_fields")!=null&&a.get("entries_custom_fields").length>0)return b.entries_custom_fields_attributes=a.get("entries_custom_fields").toJSONForSave()})},c}(Backbone.Model),Locomotive.Models.ContentTypesCollection=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.model=Locomotive.Models.ContentType,c.prototype.url=""+Locomotive.mounted_on+"/content_types",c}(Backbone.Collection)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Locomotive.Models.CustomField=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.initialize=function(){this._normalize();if(this.get("name")==null)return this.set({name:this.get("label").slugify()})},c.prototype._normalize=function(){return this.set({select_options:new Locomotive.Models.CustomFieldSelectOptionsCollection(this.get("select_options"))})},c.prototype._undesired_fields=["select_options","type_text","text_formatting_text","inverse_of_text","class_name_text","undefined_text","undefined","created_at","updated_at"],c.prototype._relationship_fields=["class_name","inverse_of","ui_enabled"],c.prototype.is_relationship_type=function(){return _.include(["belongs_to","has_many","many_to_many"],this.get("type"))},c.prototype.toJSONForSave=function(){var a=this;return _.tap({},function(b){var c,d,e;e=a.toJSON();for(c in e)d=e[c],_.include(a._undesired_fields,c)||(_.include(a._relationship_fields,c)?a.is_relationship_type()&&(b[c]=d):b[c]=d);if(a.get("select_options")!=null&&a.get("select_options").length>0)return b.select_options_attributes=a.get("select_options").toJSONForSave()})},c}(Backbone.Model),Locomotive.Models.CustomFieldsCollection=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.model=Locomotive.Models.CustomField,c.prototype.toJSONForSave=function(){var a=this;return this.map(function(a){return a.toJSONForSave()})},c}(Backbone.Collection)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Locomotive.Models.CustomFieldSelectOption=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.toJSONForSave=function(){var a=this;return _.tap({},function(b){var c,d,e,f;e=a.toJSON(),f=[];for(c in e)d=e[c],_.include(["created_at","updated_at"],c)?f.push(void 0):f.push(b[c]=d);return f})},c}(Backbone.Model),Locomotive.Models.CustomFieldSelectOptionsCollection=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.model=Locomotive.Models.CustomFieldSelectOption,c.prototype.toJSONForSave=function(){var a=this;return this.map(function(a){return a.toJSONForSave()})},c}(Backbone.Collection)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Locomotive.Models.Domain=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c}(Backbone.Model)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Locomotive.Models.EditableElement=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.toJSONForSave=function(){var a=this;return _.tap({},function(b){var c,d,e;e=a.toJSON();for(c in e)d=e[c],_.include(["id","source","content","remove_source"],c)&&(b[c]=d);return a.get("type")==="EditableFile"?delete b.content:delete b.source})},c}(Backbone.Model),Locomotive.Models.EditableElementsCollection=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.model=Locomotive.Models.EditableElement,c.prototype.blocks=function(){var a,b=this;return a=_.uniq(this.map(function(a,b){return a.get("block_name")})),_.tap([],function(b){return _.each(a,function(a,c){return b.push({name:a,index:c})})})},c.prototype.by_block=function(a){return this.filter(function(b){return b.get("block_name")===a})},c.prototype.toJSONForSave=function(){var a=this;return this.map(function(a){return a.toJSONForSave()})},c}(Backbone.Collection)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Locomotive.Models.Membership=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.toJSONForSave=function(){var a=this;return _.tap({},function(b){var c,d,e,f;e=a.toJSON(),f=[];for(c in e)d=e[c],_.include(["id","_id","role","_destroy"],c)?f.push(b[c]=d):f.push(void 0);return f})},c}(Backbone.Model),Locomotive.Models.MembershipsCollection=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.model=Locomotive.Models.Membership,c.prototype.toJSONForSave=function(){var a=this;return this.map(function(a){return a.toJSONForSave()})},c}(Backbone.Collection)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Locomotive.Models.Page=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.paramRoot="page",c.prototype.urlRoot=""+Locomotive.mounted_on+"/pages",c.prototype.initialize=function(){return this._normalize(),this.set({edit_url:""+Locomotive.mounted_on+"/pages/"+this.id+"/edit"})},c.prototype._normalize=function(){return this.set({editable_elements:new Locomotive.Models.EditableElementsCollection(this.get("editable_elements")||[])})},c.prototype.toJSON=function(){var a=this;return _.tap(c.__super__.toJSON.apply(this,arguments),function(b){_.each(["fullpath","localized_fullpaths","templatized_from_parent","target_klass_name_text","content_type_id_text","edit_url","parent_id_text","response_type_text"],function(a){return delete b[a]}),delete b.editable_elements,a.get("editable_elements")!=null&&a.get("editable_elements").length>0&&(b.editable_elements=a.get("editable_elements").toJSONForSave()),delete b.target_klass_name;if(a.get("templatized")===!0)return b.target_klass_name=a.get("target_klass_name")})},c}(Backbone.Model),Locomotive.Models.PagesCollection=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c}(Backbone.Collection)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Locomotive.Models.Site=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.paramRoot="site",c.prototype.urlRoot=""+Locomotive.mounted_on+"/sites",c.prototype.initialize=function(){var a,b,c=this;return a=_.map(this.get("domains_without_subdomain"),function(a){return new Locomotive.Models.Domain({name:a})}),b=new Locomotive.Models.MembershipsCollection(this.get("memberships")),this.set({domains:a,memberships:b})},c.prototype.includes_domain=function(a){return a===this.domain_with_domain()||_.any(this.get("domains"),function(b){return b.get("name")===a})},c.prototype.domain_with_domain=function(){return""+this.get("subdomain")+"."+this.get("domain_name")},c.prototype.toJSON=function(){var a=this;return _.tap(c.__super__.toJSON.apply(this,arguments),function(b){return delete b.memberships,a.get("memberships")!=null&&a.get("memberships").length>0&&(b.memberships_attributes=a.get("memberships").toJSONForSave()),delete b.domains,b.domains=_.map(a.get("domains"),function(a){return a.get("name")})})},c}(Backbone.Model),Locomotive.Models.CurrentSite=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.url=""+Locomotive.mounted_on+"/current_site",c}(Locomotive.Models.Site)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Locomotive.Models.Snippet=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.paramRoot="snippet",c.prototype.urlRoot=""+Locomotive.mounted_on+"/snippets",c}(Backbone.Model),Locomotive.Models.SnippetsCollection=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.model=Locomotive.Models.Snippet,c.prototype.url=""+Locomotive.mounted_on+"/snippets",c}(Backbone.Collection)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Locomotive.Models.ThemeAsset=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.paramRoot="theme_asset",c.prototype.urlRoot=""+Locomotive.mounted_on+"/theme_assets",c}(Backbone.Model),Locomotive.Models.ThemeAssetsCollection=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.model=Locomotive.Models.ThemeAsset,c.prototype.url=""+Locomotive.mounted_on+"/theme_assets",c}(Backbone.Collection)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Locomotive.Views.ApplicationView=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.el="body",c.prototype.render=function(){return this.render_flash_messages(this.options.flash),this.add_submenu_behaviours(),this.center_ui_dialog(),this.enable_sites_picker(),this.enable_content_locale_picker(),this.options.view!=null&&(this.view=new this.options.view(this.options.view_data||{}),this.view.render()),window.Locomotive.tinyMCE.defaultSettings.language=window.locale,window.Locomotive.tinyMCE.minimalSettings.language=window.locale,this},c.prototype.render_flash_messages=function(a){return _.each(a,function(a){return $.growl(a[0],a[1])})},c.prototype.center_ui_dialog=function(){return $(window).resize(function(){return $(".ui-dialog-content:visible").dialog("option","position","center")})},c.prototype.add_submenu_behaviours=function(){var a;$("#submenu ul li.hoverable").each(function(){var a,b,c;return c=null,a=$(this),(b=a.find(".popup")).removeClass("popup").addClass("submenu-popup").bind("show",function(){return a.find("a").addClass("hover")&b.css({top:a.offset().top+a.height()-2,left:a.offset().left-parseInt(b.css("padding-left"))}).show()}).bind("hide",function(){return a.find("a").removeClass("hover")&$(this).hide()}).bind("mouseleave",function(){return b.trigger("hide")}).bind("mouseenter",function(){return clearTimeout(c)}),$(document.body).append(b),a.hover(function(){return b.trigger("show")},function(){return c=window.setTimeout(function(){return b.trigger("hide")},30)})}),a=$("#submenu > ul").attr("class");if(a!=="")return $("#submenu > ul > li."+a).addClass("on")},c.prototype.enable_sites_picker=function(){var a,b,c;b=this.$("#sites-picker-link"),c=this.$("#sites-picker");if(c.size()===0)return;return a=b.position().left+b.parent().position().left-(c.width()-b.width()),c.css("left",a),b.bind("click",function(a){return a.stopPropagation()&a.preventDefault(),c.toggle()})},c.prototype.enable_content_locale_picker=function(){var a,b;a=this.$("#content-locale-picker-link"),b=this.$("#content-locale-picker");if(b.size()===0)return;return a.bind("click",function(a){return a.stopPropagation()&a.preventDefault(),b.toggle()}),b.find("li").bind("click",function(a){var b;return b=$(this).attr("data-locale"),window.addParameterToURL("content_locale",b)})},c}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).ContentAssets||(a.ContentAssets={}),Locomotive.Views.ContentAssets.PickerItemView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.tagName="li",b.prototype.className="asset",b.prototype.events={"click h4 a, .icon, .image":"select_asset","click a.remove":"remove_asset"},b.prototype.render=function(){return $(this.el).html(ich.content_asset(this.model.toJSON())),this},b.prototype.select_asset=function(a){return a.stopPropagation()&a.preventDefault(),this.on_select(this.model)},b.prototype.on_select=function(){if(this.options.parent.options.on_select)return this.options.parent.options.on_select(this.model)},b.prototype.remove_asset=function(a){var b;a.stopPropagation()&a.preventDefault(),b=$(a.target).attr("data-confirm")||$(a.target).parent().attr("data-confirm");if(confirm(b))return this.model.destroy()},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).Shared||(a.Shared={}),Locomotive.Views.Shared.AssetPickerView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.tag="div",b.prototype.initialize=function(){return _.bindAll(this,"add_assets","add_asset","remove_asset"),this.collection.bind("reset",this.add_assets),this.collection.bind("add",this.add_asset),this.collection.bind("remove",this.remove_asset)},b.prototype.render=function(){return this._reset(),$(this.el).html(this.template()()),this.fetch_assets(),this},b.prototype.template=function(){},b.prototype.fetch_assets=function(){},b.prototype.build_uploader=function(a,b){},b.prototype.create_dialog=function(){var a=this;return this.dialog=$(this.el).dialog({autoOpen:!1,modal:!0,zIndex:996,width:650,create:function(b,c){var d;return $(".ui-widget-overlay").bind("click",function(){return a.close()}),$(a.el).prev().find(".ui-dialog-title").html(a.$("h2").html()),a.$("h2").remove(),d=a.$(".dialog-actions").appendTo($(a.el).parent()).addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),d.find("#close-link").click(function(b){return a.close(b)})},open:function(b,c,d){var e,f,g;return e=$(a.el).parent().find(".ui-dialog-buttonpane"),f=e.find("input[type=file]"),g=e.find("#upload-link"),a.build_uploader(f,g)}}),this.open()},b.prototype.open=function(){return $(this.el).dialog("open")},b.prototype.close=function(a){return a!=null&&a.stopPropagation()&a.preventDefault(),$(this.el).dialog("close")},b.prototype.shake=function(){return $(this.el).parents(".ui-dialog").effect("shake",{times:4},100)},b.prototype.center=function(){return $(this.el).dialog("option","position","center")},b.prototype.add_assets=function(a){var b=this;return a.each(function(a){return b.add_asset(a,!0)}),this._refresh(),setTimeout(function(){return b.create_dialog()},30)},b.prototype.add_asset=function(a,b){},b.prototype.remove_asset=function(a){},b.prototype._move_to_last_asset=function(){var a;a=this.$("ul.list li.clear").position();if(a!=null)return this.$("ul.list").animate({scrollTop:a.top},100)},b.prototype._refresh=function(){this.collection.length===0?this.$("ul.list").hide()&this.$("p.no-items").show():(this.$("p.no-items").hide()&this.$("ul.list").show(),this._on_refresh());if(this.dialog!=null)return this.center()},b.prototype._on_refresh=function(){},b.prototype._reset=function(){$(".ui-widget-overlay").unbind("click"),this.$(".actions input[type=file]").remove();if(this.dialog!=null)return this.dialog.dialog("destroy")},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).ContentAssets||(a.ContentAssets={}),Locomotive.Views.ContentAssets.PickerView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.number_items_per_row=4,b.prototype._item_views=[],b.prototype.template=function(){return ich.content_asset_picker},b.prototype.fetch_assets=function(){return this.collection.fetch()},b.prototype.build_uploader=function(a,b){var c=this;return b.bind("click",function(b){return b.stopPropagation()&b.preventDefault(),a.click()}),a.bind("change",function(a){return _.each(a.target.files,function(a){var b;return b=new Locomotive.Models.ContentAsset({source:a}),b.save({},{headers:{"X-Flash":!0},success:function(a,b){return c.collection.add(a.prepare())},error:function(){return c.shake()}})})})},b.prototype.add_asset=function(a,b){var c;c=new Locomotive.Views.ContentAssets.PickerItemView({model:a,parent:this}),(this._item_views||(this._item_views=[])).push(c),this.$("ul.list .clear").before(c.render().el),this._refresh();if(b!==!0)return this._move_to_last_asset()},b.prototype.remove_asset=function(a){var b;return b=_.find(this._item_views,function(b){return b.model===a}),b!=null&&b.remove(),this._refresh()},b.prototype._on_refresh=function(){var a;return a=this,this.$("ul.list li.asset").each(function(b){return(b+1)%a.number_items_per_row===0?$(this).addClass("last"):$(this).removeClass("last")})},b.prototype._reset=function(){return _.each(this._item_views||[],function(a){return a.remove()}),b.__super__._reset.call(this)},b}(Locomotive.Views.Shared.AssetPickerView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).Shared||(a.Shared={}),Locomotive.Views.Shared.FormView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.el="#content",b.prototype.render=function(){return this.make_title_editable(),this._hide_last_separator(),this.make_inputs_foldable(),this.enable_save_with_keys_combination(),this.enable_form_notifications(),this},b.prototype.save=function(a){},b.prototype.save_in_ajax=function(a,b){var c,d,e=this;return a.stopPropagation()&a.preventDefault(),c=$(a.target).trigger("ajax:beforeSend"),this.clear_errors(),b||(b={headers:{},on_success:null,on_error:null}),d=_.clone(this.model.attributes),this.model.save({},{headers:b.headers,silent:!0,success:function(a,e,f){c.trigger("ajax:complete"),a.attributes=d;if(b.on_success)return b.on_success(e,f)},error:function(a,d){var f;c.trigger("ajax:complete"),f=JSON.parse(d.responseText),e.show_errors(f);if(b.on_error)return b.on_error()}})},b.prototype.make_title_editable=function(){var a,b,c=this;b=this.$("h2 a.editable");if(b.size()>0)return a=this.$("#"+b.attr("rel")),a.parent().hide(),b.click(function(c){var d;c.stopPropagation()&c.preventDefault(),d=prompt(b.attr("title"),b.html());if(d&&d!=="")return b.html(d),a.val(d).trigger("change")})},b.prototype.make_inputs_foldable=function(){var a;return a=this,this.$(".formtastic fieldset.foldable.folded ol").hide(),this.$(".formtastic fieldset.foldable legend").click(function(){var b,c;return c=$(this).parent(),b=$(this).next(),c.hasClass("folded")?(c.removeClass("folded"),b.slideDown(100,function(){return a.after_inputs_fold(c)})):b.slideUp(100,function(){return c.addClass("folded")})})},b.prototype.enable_save_with_keys_combination=function(){var a=this;return $.cmd("S",function(){return a.$("form input[type=submit]").trigger("click")},[],{ignoreCase:!0})},b.prototype.enable_form_notifications=function(){return this.$("form").formSubmitNotification()},b.prototype.after_inputs_fold=function(){},b.prototype.clear_errors=function(){return this.$(".inline-errors").remove()},b.prototype.show_errors=function(a){var b,c,d,e;e=[];for(b in a)d=a[b],_.isString(d[0])?(c=$('<div class="inline-errors"><p>'+d[0]+"</p></div>"),e.push(this.show_error(b,d[0],c))):e.push(this.show_error(b,d));return e},b.prototype.show_error=function(a,b,c){var d,e;e=this.$("#"+this.model.paramRoot+"_"+a),e.size()===0&&(e=this.$("#"+this.model.paramRoot+"_"+a+"_id"));if(e.size()>0)return d=e.parent().find(".error-anchor"),d.size()===0&&(d=e),d.after(c);return},b.prototype._enable_checkbox=function(a,b){var c,d=this;return b||(b={}),c=b.model_name||this.model.paramRoot,this.$("li#"+c+"_"+a+"_input input[type=checkbox]").checkToggle({on_callback:function(){return _.each(b.features,function(a){return this.$("li#"+c+"_"+a+"_input").hide()}),b.on_callback!=null&&b.on_callback(),d._hide_last_separator()},off_callback:function(){return _.each(b.features,function(a){return this.$("li#"+c+"_"+a+"_input").show()}),b.off_callback!=null&&b.off_callback(),d._hide_last_separator()}})},b.prototype._hide_last_separator=function(){var a=this;return _.each(this.$("fieldset"),function(a){return $(a).find("li.last").removeClass("last"),$(_.last($(a).find("li.input:visible"))).addClass("last")})},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).ContentEntries||(a.ContentEntries={}),Locomotive.Views.ContentEntries.FormView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.el="#content",b.prototype._file_field_views=[],b.prototype._has_many_field_views=[],b.prototype._many_to_many_field_views=[],b.prototype.events={submit:"save"},b.prototype.initialize=function(){return this.model||(this.model=new Locomotive.Models.ContentEntry(this.options.content_entry)),Backbone.ModelBinding.bind(this)},b.prototype.render=function(){return b.__super__.render.call(this),this.enable_checkboxes(),this.enable_datepickers(),this.enable_richtexteditor(),this.enable_file_fields(),this.enable_has_many_fields(),this.enable_many_to_many_fields(),this.slugify_label_field(),this},b.prototype.enable_checkboxes=function(){return this.$("li.input.toggle input[type=checkbox]").checkToggle()},b.prototype.enable_datepickers=function(){return this.$("li.input.date input[type=text]").datepicker()},b.prototype.enable_richtexteditor=function(){var a=this;return _.each(this.$("li.input.rte textarea.html"),function(b){var c;return c=_.extend({},a.tinyMCE_settings(),{oninit:function(c){return $.cmd("S",function(){return c.save(),$(b).trigger("changeSilently"),a.$("form").trigger("submit")},[],{ignoreCase:!0,document:c.dom.doc})},onchange_callback:function(a){return a.save(),$(b).trigger("changeSilently")}}),$(b).tinymce(c)})},b.prototype.enable_file_fields=function(){var a=this;return _.each(this.model.get("file_custom_fields"),function(b){var c;return c=new Locomotive.Views.Shared.Fields.FileView({model:a.model,name:b}),a._file_field_views.push(c),a.$("#"+a.model.paramRoot+"_"+b+"_input label").after(c.render().el)})},b.prototype.enable_has_many_fields=function(){var a=this;if(!this.model.isNew())return _.each(this.model.get("has_many_custom_fields"),function(b,c){var d,e,f,g;e=b[0],d=b[1],f=new Locomotive.Models.ContentEntry(a.options[""+e+"_new_entry"]),g=new Locomotive.Views.Shared.Fields.HasManyView({model:a.model,name:e,new_entry:f,inverse_of:d,index:c});if(g.ui_enabled())return a._has_many_field_views.push(g),a.$("#"+a.model.paramRoot+"_"+e+"_input label").after(g.render().el)})},b.prototype.enable_many_to_many_fields=function(){var a=this;return _.each(this
.model.get("many_to_many_custom_fields"),function(b){var c,d;c=b[0],d=new Locomotive.Views.Shared.Fields.ManyToManyView({model:a.model,name:c,all_entries:a.options["all_"+c+"_entries"]});if(d.ui_enabled())return a._many_to_many_field_views.push(d),a.$("#"+a.model.paramRoot+"_"+c+"_input label").after(d.render().el)})},b.prototype.slugify_label_field=function(){return this.$("li.input.highlighted > input[type=text]").slugify({target:this.$("#content_entry__slug")})},b.prototype.refresh_file_fields=function(){var a=this;return _.each(this._file_field_views,function(a){return a.refresh()})},b.prototype.refresh=function(){var a=this;return this.$("li.input.toggle input[type=checkbox]").checkToggle("sync"),_.each(this._file_field_views,function(a){return a.refresh()})},b.prototype.reset=function(){var a=this;return this.$("li.input.string input[type=text], li.input.text textarea, li.input.date input[type=text]").val("").trigger("change"),_.each(this.$("li.input.rte textarea.html"),function(a){return $(a).tinymce().setContent(""),$(a).trigger("change")}),_.each(this._file_field_views,function(a){return a.reset()}),this.$("li.input.toggle input[type=checkbox]").checkToggle("sync")},b.prototype.remove=function(){var a=this;return _.each(this._file_field_views,function(a){return a.remove()}),_.each(this._has_many_field_views,function(a){return a.remove()}),_.each(this._many_to_many_field_views,function(a){return a.remove()}),b.__super__.remove.apply(this,arguments)},b.prototype.tinyMCE_settings=function(){return window.Locomotive.tinyMCE.defaultSettings},b}(Locomotive.Views.Shared.FormView)}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};(a=Locomotive.Views).ContentEntries||(a.ContentEntries={}),Locomotive.Views.ContentEntries.PopupFormView=function(a){function c(){return this.reset=b(this.reset,this),c.__super__.constructor.apply(this,arguments)}return d(c,a),c.prototype.initialize=function(){return this.create_dialog(),c.__super__.initialize.call(this)},c.prototype.render=function(){return c.__super__.render.call(this),this},c.prototype.save=function(a){var b=this;return this.save_in_ajax(a,{headers:{"X-Flash":!0},on_success:function(a,c){var d;return d=new Locomotive.Models.ContentEntry(a),b.options.parent_view.insert_or_update_entry(d),b.close()}})},c.prototype.create_dialog=function(){var a,b=this;return a=998+this.options.index,this.dialog=$(this.el).dialog({autoOpen:!1,modal:!0,zIndex:a,width:770,create:function(a,c){var d;return $(".ui-widget-overlay").bind("click",function(){return b.close()}),$(b.el).prev().find(".ui-dialog-title").html(b.$("h2").html()),b.$("h2").remove(),d=b.$(".dialog-actions").appendTo($(b.el).parent()).addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),d.find("#close-link").click(function(a){return b.close(a)}),d.find("input[type=submit]").click(function(a){return b.save(a)})},open:function(a,b,c){}})},c.prototype.open=function(){var a;return a=$(this.el).parent(),this.model.isNew()?(a.find(".edit-section").hide(),a.find(".new-section").show()):(a.find(".new-section").hide(),a.find(".edit-section").show()),this.clear_errors(),$(this.el).dialog("open")},c.prototype.close=function(a){return a!=null&&a.stopPropagation()&a.preventDefault(),this.clear_errors(),$(this.el).dialog("close")},c.prototype.center=function(){return $(this.el).dialog("option","position","center")},c.prototype.reset=function(a){return this.model.set(a.attributes),a.isNew()?(this.model.id=null,c.__super__.reset.call(this)):this.refresh()},c.prototype.slugify_label_field=function(){},c.prototype.enable_has_many_fields=function(){},c.prototype.enable_many_to_many_fields=function(){},c.prototype.tinyMCE_settings=function(){return window.Locomotive.tinyMCE.popupSettings},c}(Locomotive.Views.ContentEntries.FormView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).ContentEntries||(a.ContentEntries={}),Locomotive.Views.ContentEntries.EditView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.save=function(a){var b=this;return this.save_in_ajax(a,{on_success:function(a,c){return b.model.update_attributes(a),b.refresh_file_fields()}})},b}(Locomotive.Views.ContentEntries.FormView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).ContentEntries||(a.ContentEntries={}),Locomotive.Views.ContentEntries.IndexView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.el="#content",b.prototype.render=function(){return this.make_sortable(),this},b.prototype.make_sortable=function(){var a;return a=this,this.$("ul#entries-list.sortable").sortable({handle:"span.handle",items:"li.item",axis:"y",update:function(b,c){return a.call_sort($(this))}})},b.prototype.call_sort=function(a){return $.rails.ajax({url:a.attr("data-url"),type:"post",dataType:"json",data:{entries:_.map(a.sortable("toArray"),function(a){return a.replace("entry-","")}),_method:"put"},success:this.on_successful_sort,error:this.on_failed_sort})},b.prototype.on_successful_sort=function(a,b,c){return $.growl("success",c.getResponseHeader("X-Message"))},b.prototype.on_failed_sort=function(a,b,c){return $.growl("error",c.getResponseHeader("X-Message"))},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).ContentEntries||(a.ContentEntries={}),Locomotive.Views.ContentEntries.NewView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.save=function(a){return this.save_in_ajax(a,{on_success:function(a,b){return window.location.href=b.getResponseHeader("location")}})},b}(Locomotive.Views.ContentEntries.FormView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).ContentTypes||(a.ContentTypes={}),Locomotive.Views.ContentTypes.FormView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.el="#content",b.prototype.events={submit:"save"},b.prototype.initialize=function(){return this.model=new Locomotive.Models.ContentType(this.options.content_type),window.foo=this.model,Backbone.ModelBinding.bind(this)},b.prototype.render=function(){return b.__super__.render.call(this),this.render_custom_fields(),this.slugify_name(),this.enable_liquid_editing(),this.enable_public_submission_checkbox(),this.enable_order_by_toggler(),this},b.prototype.render_custom_fields=function(){return this.custom_fields_view=new Locomotive.Views.ContentTypes.CustomFieldsView({model:this.model,inverse_of_list:this.options.inverse_of_list}),this.$("#custom_fields_input").append(this.custom_fields_view.render().el)},b.prototype.slugify_name=function(){return this.$("#content_type_name").slugify({target:this.$("#content_type_slug"),sep:"_"})},b.prototype.enable_liquid_editing=function(){var a,b=this;return a=this.$("#content_type_raw_item_template"),this.editor=CodeMirror.fromTextArea(a.get()[0],{mode:"liquid",autoMatchParens:!1,lineNumbers:!1,passDelay:50,tabMode:"shift",theme:"default medium",onChange:function(a){return b.model.set({raw_item_template:a.getValue()})}})},b.prototype.enable_public_submission_checkbox=function(){var a=this;return this._enable_checkbox("public_submission_enabled",{on_callback:function(){return a.$("#content_type_public_submission_accounts_input").show()},off_callback:function(){return a.$("#content_type_public_submission_accounts_input").hide()}})},b.prototype.enable_order_by_toggler=function(){var a=this;return this.$("#content_type_order_by_input").bind("change",function(b){var c;return c=a.$("#content_type_order_direction_input"),$(b.target).val()==="_position"?c.hide():c.show()})},b.prototype.show_error=function(a,c,d){var e=this;if(a!=="entries_custom_fields")return b.__super__.show_error.apply(this,arguments);if(_.isEmpty(c))return;return _.each(_.keys(c),function(a){var b,f;f=c[a];if(a==="base")return d=$('<div class="inline-errors"><p>'+f[0]+"</p></div>"),e.$("#custom_fields_input .list").after(d);b=e.custom_fields_view.find_entry_view(a);if(b!=null)return b.show_error(f[0])})},b.prototype.remove=function(){return this.custom_fields_view.remove(),b.__super__.remove.apply(this,arguments)},b}(Locomotive.Views.Shared.FormView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).ContentTypes||(a.ContentTypes={}),Locomotive.Views.ContentTypes.CustomFieldEntryView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.tagName="li",b.prototype.className="custom-field",b.prototype.events={"click a.toggle":"toggle","click a.remove":"remove"},b.prototype.initialize=function(){var a=this;return this.inverse_of_list=this.options.parent_view.options.inverse_of_list,this.model.bind("change",function(b){a.model.hasChanged("type")&&a.switch_to_type();if(a.model.hasChanged("class_name")&&a.model.get("class_name")!=null)return a.fetch_inverse_of_list()})},b.prototype.render=function(){return $(this.el).html(ich.custom_field_entry(this.model.toJSON())),this.model.isNew()||this.fetch_inverse_of_list(),Backbone.ModelBinding.bind(this,{all:"class"}),this.make_fields_editable(),this.enable_behaviours(),this.switch_to_type(),this},b.prototype.enable_behaviours=function(){var a;return a=this.$(".required-input input[type=checkbox]"),a.checkToggle({on_label:a.attr("data-on-label"),off_label:a.attr("data-off-label")}),this.$("li.input.toggle input[type=checkbox]").checkToggle(),this.render_select_options_view()},b.prototype.switch_to_type=function(){this.$("li.input.extra").hide();switch(this.model.get("type")){case"select":return this.$("li.input.select-options").show();case"text":return this.$("li.input.text-formatting").show();case"belongs_to":return this.$("li.input.localized").hide(),this.$("li.input.class-name").show();case"has_many":case"many_to_many":return this.$("li.input.localized").hide(),this.$("li.input.class-name").show(),this.$("li.input.inverse-of").show(),this.$("li.input.ui-enabled").show()}},b.prototype.fetch_inverse_of_list=function(){var a=this;return this.$("li.input.inverse-of select option").remove(),_.each(this.inverse_of_list[this.model.get("type")],function(b){var c;if(b.class_name===a.model.get("class_name"))return c=new Option(b.label,b.name,b.class_name===a.model.get("inverse_of")||a.inverse_of_list.length===1),a.$("li.input.inverse-of select").append(c)})},b.prototype.render_select_options_view=function(){return this.select_options_view=new Locomotive.Views.ContentTypes.SelectOptionsView({model:this.model,collection:this.model.get("select_options")}),this.$("#content_type_contents_custom_field_select_options_input").append(this.select_options_view.render().el)},b.prototype.make_fields_editable=function(){return this.$(".label-input input[type=text], .type-input select").editableField()},b.prototype.toggle=function(a){var b;return a.stopPropagation()&a.preventDefault(),b=this.$("ol"),b.is(":hidden")?(this.$("a.toggle").addClass("open"),b.slideDown()):(this.$("a.toggle").removeClass("open"),b.slideUp())},b.prototype.show_error=function(a){var b;return b=$('<span class="inline-errors">'+a+"</span>"),this.$(".required-input").after(b)},b.prototype.remove=function(a){a.stopPropagation()&a.preventDefault();if(confirm($(a.target).attr("data-confirm")))return this.$(".label-input input[type=text], .type-input select").editableField("destroy"),b.__super__.remove.call(this),this.options.parent_view.remove_entry(this.model,this)},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).ContentTypes||(a.ContentTypes={}),Locomotive.Views.ContentTypes.CustomFieldsView=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}var b;return c(d,a),d.prototype.tagName="div",d.prototype.className="list",b=[],d.prototype.events={"click .new-entry a.add":"add_entry","keypress .new-entry input[type=text]":"add_on_entry_from_enter"},d.prototype.initialize=function(){return _.bindAll(this,"refresh_position_entries")},d.prototype.render=function(){return $(this.el).html(ich.custom_fields_list(this.model.toJSON())),this.render_entries(),this.make_list_sortable(),this},d.prototype.make_list_sortable=function(){return this.sortable_list=this.$("> ul").sortable({handle:".handle",items:"li.custom-field",axis:"y",update:this.refresh_position_entries})},d.prototype.refresh_position_entries=function(){return _.each(this._entry_views,function(a){return a.model.set({position:$(a.el).index()})})},d.prototype.find_entry_view=function(a){return _.find(this._entry_views,function(b){return a.length>3?b.model.id===a:b.model.get("position")===parseInt(a)})},d.prototype.add_entry=function(a){var b,c,d;a.stopPropagation()&a.preventDefault(),c=this.$("> .new-entry input[name=label]"),d=this.$("> .new-entry select");if(c.val()!=="")return b=new Locomotive.Models.CustomField({label:c.val(),type:d.val()}),this.model.get("entries_custom_fields").add(b),this._insert_entry(b),this.$("> .empty").hide(),this.sortable_list.sortable("refresh"),c.val("")},d.prototype.add_on_entry_from_enter=function(a){if(a.keyCode!==13)return;return this.add_entry(a)},d.prototype.remove_entry=function(a,b){a.isNew()?this.model.get("entries_custom_fields").remove(a):a.set({_destroy:!0}),this._entry_views=_.reject(this._entry_views,function(a){return a===b}),this.refresh_position_entries();if(this._entry_views.length===0)return this.$("> .empty").show()},d.prototype.render_entries=function(){var a=this;return this.model.get("entries_custom_fields").length===0?this.$("> .empty").show():this.model.get("entries_custom_fields").each(function(b){return a._insert_entry(b)})},d.prototype._insert_entry=function(a){var b;return b=new Locomotive.Views.ContentTypes.CustomFieldEntryView({model:a,parent_view:this}),(this._entry_views||(this._entry_views=[])).push(b),this.$("> ul").append(b.render().el),this.refresh_position_entries()},d}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).ContentTypes||(a.ContentTypes={}),Locomotive.Views.ContentTypes.EditView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.save=function(a){var b=this;return this.save_in_ajax(a,{on_success:function(a,c){return _.each(a.entries_custom_fields,function(a){var c;c=b.model.get("entries_custom_fields").detect(function(b){return b.get("name")===a.name});if(c.isNew())return c.set({id:a._id,_id:a._id})})}})},b}(Locomotive.Views.ContentTypes.FormView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).ContentTypes||(a.ContentTypes={}),Locomotive.Views.ContentTypes.NewView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.save=function(a){return this.save_in_ajax(a,{on_success:function(a,b){return window.location.href=b.getResponseHeader("location")}})},b.prototype.enable_liquid_editing=function(){return!0},b}(Locomotive.Views.ContentTypes.FormView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).ContentTypes||(a.ContentTypes={}),Locomotive.Views.ContentTypes.SelectOptionsView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.tagName="div",b.prototype.className="list",b.prototype.events={"click a.add":"add_entry","click span.name":"edit_entry","click a.remove":"remove_entry"},b.prototype.initialize=function(){return _.bindAll(this,"refresh_position_entries","_insert_entry"),this.collection.bind("add",this._insert_entry)},b.prototype.render=function(){return $(this.el).html(ich.select_options_list()),this.prompt_message=this.$("> ul").attr("data-prompt"),this.render_entries(),this.make_list_sortable(),this},b.prototype.render_entries=function(){return this.collection.each(this._insert_entry)},b.prototype.make_list_sortable=function(){return this.sortable_list=this.$("> ul").sortable({handle:"a.drag",items:"li.entry",update:this.refresh_position_entries})},b.prototype.refresh_position_entries=function(){var a=this;return this.$("> ul li.entry").each(function(b,c){var d;return d=a.collection.getByCid($(c).attr("data-cid")),d.set({position:b})})},b.prototype.add_entry=function(a){var b;a.stopPropagation()&a.preventDefault(),b=prompt(this.prompt_message);if(b!=="")return this.collection.add([{name:b}])},b.prototype.edit_entry=function(a){var b,c,d,e;a.stopPropagation()&a.preventDefault(),d=$(a.target),e=d.closest("li"),c=this.collection.getByCid(e.attr("data-cid"));if((b=prompt(this.prompt_message,c.get("name")))!=="")return c.set({name:b}),d.html(b)},b.prototype.remove_entry=function(a){var b,c,d;a.stopPropagation()&a.preventDefault(),b=$(a.target),d=b.closest("li"),c=this.collection.getByCid(d.attr("data-cid"));if(confirm(b.attr("date-confirm")))return c.isNew()?this.collection.remove(c):c.set({_destroy:!0}),d.remove()},b.prototype._insert_entry=function(a){var b;return b=ich.select_option_entry(a.toJSON()),b.attr("data-cid",a.cid),this.$("> ul").append(b),this.refresh_position_entries},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).Sites||(a.Sites={}),Locomotive.Views.Sites.DomainsView=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}var b;return c(d,a),d.prototype.tagName="div",d.prototype.className="list",b=[],d.prototype.events={"click .new-entry a.add":"add_entry","keypress .new-entry input[type=text]":"add_on_entry_from_enter"},d.prototype.render=function(){return $(this.el).html(ich.domains_list(this.model.toJSON())),this.render_entries(),this.enable_ui_effects(),this},d.prototype.add_entry=function(a){var b,c;a.stopPropagation()&a.preventDefault(),c=this.$(".new-entry input[name=domain]");if(c.val()!=="")return b=new Locomotive.Models.Domain({name:c.val()}),this.model.get("domains").push(b),this._insert_entry(b),this.$("ul li.domain:last input[type=text]").editableField(),this.$(".empty").hide(),c.val("")},d.prototype.add_on_entry_from_enter=function(a){if(a.keyCode!==13)return;return this.add_entry(a)},d.prototype.change_entry=function(a,b){return a.set({name:b})},d.prototype.remove_entry=function(a){var b,c=this;b=_.reject(this.model.get("domains"),function(b){return b===a}),this.model.set({domains:b});if(this.model.get("domains").length===0)return this.$(".empty").show()},d.prototype.render_entries=function(){var a=this;return this.model.get("domains").length===0?this.$(".empty").show():(_.each(this.model.get("domains"),function(b){return a._insert_entry(b)}),this.show_errors())},d.prototype.show_errors=function(){var a=this;return _.each(this.options.errors.domain||[],function(b){return a.show_error(b)})},d.prototype.show_error=function(a){return _.each(this._entry_views||[],function(b){var c;if((new RegExp("^"+b.model.get("name"))).test(a))return c=$("<span></span>").addClass("inline-errors").html(a),b.$("input[type=text].path").after(c)})},d.prototype.enable_ui_effects=function(){return this.$(".domain input[type=text]").editableField()},d.prototype._insert_entry=function(a){var b;return b=new Locomotive.Views.Sites.DomainEntryView({model:a,parent_view:this}),(this._entry_views||(this._entry_views=[])).push(b),this.$("ul").append(b.render().el)},d}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).CurrentSite||(a.CurrentSite={}),Locomotive.Views.CurrentSite.EditView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.el="#content",b.prototype.events={submit:"save"},b.prototype.initialize=function(){return this.model=new Locomotive.Models.CurrentSite(this.options.site),Backbone.ModelBinding.bind(this,{checkbox:"class"}),window.foo=this.model},b.prototype.render=function(){return b.__super__.render.call(this),this.add_toggle_mode_for_locales(),this.make_locales_sortable(),this.render_domains(),this.render_memberships(),this.enable_liquid_editing()},b.prototype.add_toggle_mode_for_locales=function(){return this.$("#site_locales_input .list input[type=checkbox]").bind("change",function(a){var b;return b=$(a.target),b.is(":checked")?b.closest(".entry").addClass("selected"):b.closest(".entry").removeClass("selected")})},b.prototype.make_locales_sortable=function(){var a=this;return this.sortable_locales_list=this.$("#site_locales_input .list").sortable({items:".entry",tolerance:"pointer",update:function(){var b;return b=_.map(a.$("#site_locales_input .list input:checked"),function(a){return $(a).val()}),a.model.set({locales:b})}})},b.prototype.render_domains=function(){return this.domains_view=new Locomotive.Views.Sites.DomainsView({model:this.model,errors:this.options.errors}),this.$("#site_domains_input label").after(this.domains_view.render().el)},b.prototype.render_memberships=function(){return this.memberships_view=new Locomotive.Views.Sites.MembershipsView({model:this.model}),this.$("#site_memberships_input").append(this.memberships_view.render().el)},b.prototype.enable_liquid_editing=function(){var a,b=this;if($("#site_robots_txt").length)return a=this.$("#site_robots_txt"),this.editor=CodeMirror.fromTextArea(a.get()[0],{mode:"liquid",autoMatchParens:!1,lineNumbers:!1,passDelay:50,tabMode:"shift",theme:"default",onChange:function(a){return b.model.set({robots_txt:a.getValue()})}})},b.prototype.save=function(a){if(this.model.includes_domain(window.location.host))return this.save_in_ajax(a)},b.prototype.show_error=function(a,c,d){return a==="domains"?this.domains_view.show_error(c):b.__super__.show_error.apply(this,arguments)},b.prototype.remove=function(){return this.domains_view.remove(),this.memberships_view.remove(),b.__super__.remove.apply(this,arguments)},b}(Locomotive.Views.Shared.FormView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).EditableElements||(a.EditableElements={}),Locomotive.Views.EditableElements.ControlView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.tagName="li",b.prototype.className="control input",b.prototype.render=function(){return $(this.el).html(ich.editable_control_input(this.model.toJSON())),this.bind_model(),this},b.prototype.after_render=function(){},b.prototype.refresh=function(){return this.bind_model()},b.prototype.bind_model=function(){return Backbone.ModelBinding.bind(this,{select:"class"})},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).EditableElements||(a.EditableElements={}),Locomotive.Views.EditableElements.EditAllView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.id="editable-elements",b.prototype.tagName="div",b.prototype._editable_elements_views=[],b.prototype.render=function(){return window.bar=this,this.collection.isEmpty()?$(this.el).hide():(this.blocks=this.collection.blocks(),$(this.el).html(ich.editable_elements_edit({blocks:this.blocks})),this.render_elements(),this.enable_nav()),this},b.prototype.after_render=function(){var a=this;return _.each(this._editable_elements_views,function(a){return a.after_render()})},b.prototype.refresh=function(){var a=this;return _.each(this._editable_elements_views,function(b){return b.model=a.collection.get(b.model.get("id")),b.refresh()})},b.prototype.unbind_model=function(){var a=this;return _.each(this._editable_elements_views,function(a){return Backbone.ModelBinding.unbind(a)})},b.prototype.render_elements=function(){var a,b=this;return a=0,_.each(this.blocks,function(c){var d;return d=b.collection.by_block(c.name),_.each(d,function(d){var e,f;return d.set({index:a}),f=function(){switch(d.get("type")){case"EditableShortText":return Locomotive.Views.EditableElements.ShortTextView;case"EditableLongText":return Locomotive.Views.EditableElements.LongTextView;case"EditableFile":return Locomotive.Views.EditableElements.FileView;case"EditableControl":return Locomotive.Views.EditableElements.ControlView}}(),e=new f({model:d}),b.$("#block-"+c.index+" > fieldset > ol").append(e.render().el),b._editable_elements_views.push(e),a+=1})})},b.prototype.enable_nav=function(){var a=this;return this.$(".nav a").click(function(b){var c,d;return b.stopPropagation()&b.preventDefault(),d=$(b.target),c=parseInt(d.attr("href").match(/block-(.+)/)[1]),a.$(".wrapper ul li.block").hide(),a.$("#block-"+c).show(),a._hide_last_separator(),d.parent().find(".on").removeClass("on"),d.addClass("on")})},b.prototype._hide_last_separator=function(){var a=this;return _.each(this.$("fieldset"),function(a){return $(a).find("li.last").removeClass("last"),$(_.last($(a).find("li.input:visible"))).addClass("last")})},b.prototype.remove=function(){var a=this;return _.each(this._editable_elements_views,function(a){return a.remove()}),this._editable_elements_views.length=0,b.__super__.remove.apply(this,arguments)},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).EditableElements||(a.EditableElements={}),Locomotive.Views.EditableElements.FileView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.tagName="li",b.prototype.className="file input",b.prototype.states={change:!1,"delete":!1},b.prototype.events={"click a.change":"toggle_change","click a.delete":"toggle_delete"},b.prototype.render=function(){var a=this;return $(this.el).html(ich.editable_file_input(this.model.toJSON())),this.$("input[type=file]").bind("change",function(b){var c;c=$(b.target)[0];if(c.files!=null)return a.model.set({source:c.files[0]})}),this},b.prototype.after_render=function(){},b.prototype.refresh=function(){return this.$("input[type=file]").unbind("change"),this.states={change:!1,"delete":!1},this.render()},b.prototype.toggle_change=function(a){var b=this;return this._toggle(a,"change",{on_change:function(){return b.$("a:first").hide()&b.$("input[type=file]").show()&b.$("a.delete").hide()},on_cancel:function(){return b.model.set({source:null}),b.$("a:first").show()&b.$("input[type=file]").val("").hide()&b.$("a.delete").show()}})},b.prototype.toggle_delete=function(a){var b=this;return this._toggle(a,"delete",{on_change:function(){return b.$("a:first").addClass("deleted")&b.$("a.change").hide(),b.$("input[type=hidden].remove-flag").val("1"),b.model.set({remove_source:!0})},on_cancel:function(){return b.$("a:first").removeClass("deleted")&b.$("a.change").show(),b.$("input[type=hidden].remove-flag").val("0"),b.model.set({remove_source:!1})}})},b.prototype._toggle=function(a,b,c){var d,e;return a.stopPropagation()&a.preventDefault(),d=$(a.target),e=d.attr("data-alt-label"),this.states[b]?c.on_cancel():c.on_change(),d.attr("data-alt-label",d.html()),d.html(e),this.states[b]=!this.states[b]},b.prototype.remove=function(){return this.$("input[type=file]").unbind("change"),b.__super__.remove.apply(this,arguments)},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).EditableElements||(a.EditableElements={}),Locomotive.Views.EditableElements.ShortTextView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.tagName="li",b.prototype.className="text input short",b.prototype.render=function(){var a=this;return $(this.el).html(ich.editable_text_input(this.model.toJSON())),this.$("textarea").bind("keyup",function(b){var c;return c=$(b.target),a.model.set({content:c.val()})}),this},b.prototype.after_render=function(){},b.prototype.refresh=function(){},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).EditableElements||(a.EditableElements={}),Locomotive.Views.EditableElements.LongTextView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.tagName="li",b.prototype.className="text input html",b.prototype.render=function(){return $(this.el).html(ich.editable_text_input(this.model.toJSON())),this},b.prototype.after_render=function(){var a,b=this;return a=_.extend({},this.tinymce_settings(),{oninit:function(a){return $.cmd("S",function(){return b.model.set({content:a.getBody().innerHTML}),$(b.el).parents("form").trigger("submit")},[],{ignoreCase:!0,document:a.dom.doc})},onchange_callback:function(a){return b.model.set({content:a.getBody().innerHTML})}}),this.$("textarea").tinymce(a)},b.prototype.tinymce_settings=function(){return window.Locomotive.tinyMCE.defaultSettings},b.prototype.refresh=function(){},b.prototype.remove=function(){return this.$("textarea").tinymce().destroy(),b.__super__.remove.apply(this,arguments)},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).InlineEditor||(a.InlineEditor={}),Locomotive.Views.InlineEditor.ApplicationView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.el="body",b.prototype.initialize=function(){return b.__super__.initialize.apply(this,arguments),this.iframe=this.$("#page iframe"),_.bindAll(this,"_$"),this.toolbar_view=new Locomotive.Views.InlineEditor.ToolbarView({target:this.iframe}),this.content_assets_picker_view=new Locomotive.Views.ContentAssets.PickerView({collection:new Locomotive.Models.ContentAssetsCollection})},b.prototype.render=function(){return b.__super__.render.apply(this,arguments),this.enable_iframe_autoheight(),this.toolbar_view.render()},b.prototype.enable_iframe_autoheight=function(){var a,b=this;return a=this.iframe,a.load(function(){var c;return b._$("meta[name=inline-editor]").size()>0?(c=a.contents(),c.resize(function(){var b;b=$(this);if(b.outerHeight(!0)>a.outerHeight(!0))return a.css({height:b.outerHeight(!0)})}),c.resize()):(b.toolbar_view.show_status("disabled",!0).hide_editing_mode_block(),b.enhance_iframe_links())})},b.prototype.set_page=function(a){return this.page=new Locomotive.Models.Page(a),this.toolbar_view.model=this
.page,this.enhance_iframe(),this.toolbar_view.refresh()},b.prototype.enhance_iframe=function(){var a,b=this;return a=this.iframe[0].contentWindow,a.Aloha.settings.locale=window.locale,window.document.title=a.document.title,this.enhance_iframe_links(a.Aloha.jQuery),a.Aloha.bind("aloha-editable-deactivated",function(a,c){return b.toolbar_view.notify(c.editable)})},b.prototype.enhance_iframe_links=function(a){var b;return b=this.toolbar_view,a||(a=this._$),a("a").each(function(){var c,d;c=a(this),d=c.attr("href");if(d!=null&&d.indexOf("#")!==0&&/^(www|http)/.exec(d)===null&&/(\/_edit)$/.exec(d)===null&&/^\/sites\//.exec(d)===null)return d==="/"&&(d="/index"),d.indexOf("_edit")>0||(d.indexOf("?")>0?c.attr("href",d.replace("?","/_edit?")):c.attr("href",""+d+"/_edit")),c.bind("click",function(){return b.show_status("loading"),window.history.pushState("Object","Title",c.attr("href").replace("_edit","_admin"))})})},b.prototype._$=function(a){return $(a,this.iframe[0].contentWindow.document)},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).InlineEditor||(a.InlineEditor={}),Locomotive.Views.InlineEditor.ToolbarView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.el="#toolbar .inner",b.prototype.events={"change .editing-mode input[type=checkbox]":"toggle_editing_mode","click  .back a":"back","click  .element-actions a.save":"save_changes","click  .element-actions a.cancel":"cancel_changes"},b.prototype.render=function(){return b.__super__.render.apply(this,arguments),this.enable_editing_mode_checkbox(),this.enable_content_locale_picker(),this},b.prototype.notify=function(a){var b;return window.bar=a,b=a.obj.attr("data-element-id"),this.model.get("editable_elements").get(b).set({content:a.getContents()}),this.$(".element-actions").show(),this.hide_editing_mode_block()},b.prototype.show_status=function(a,b){var c;return b||(b=!1),c=this.$("h1").attr("data-"+a+"-status"),this.$("h1").html(c).removeClass().addClass(a),b&&$.growl("error",c),this},b.prototype.save_changes=function(a){var b,c=this;return a.stopPropagation()&a.preventDefault(),b=_.clone(this.model.attributes),this.model.save({},{success:function(a,d,e){return a.attributes=b,c.$(".element-actions").hide(),c.show_editing_mode_block()},error:function(a,b){return c.$(".element-actions").hide()}})},b.prototype.cancel_changes=function(a){return a.stopPropagation()&a.preventDefault(),this.options.target[0].contentWindow.location.href=this.options.target[0].contentWindow.location.href},b.prototype.back=function(a){return a.stopPropagation()&a.preventDefault(),this.model?window.location.href=this.model.get("edit_url"):window.location.href=window.Locomotive.mounted_on+"/pages"},b.prototype.show_editing_mode_block=function(){return this.$(".editing-mode").show()},b.prototype.hide_editing_mode_block=function(){return this.$(".editing-mode").hide()},b.prototype.toggle_editing_mode=function(a){if(this.editable_elements()===null)return;return $(a.target).is(":checked")?this.editable_elements().aloha():this.editable_elements().removeClass("aloha-editable-highlight").mahalo()},b.prototype.editable_elements=function(){return this.options.target[0].contentWindow.Aloha?this.options.target[0].contentWindow.Aloha.jQuery(".editable-long-text, .editable-short-text"):null},b.prototype.enable_editing_mode_checkbox=function(){return this.$(".editing-mode input[type=checkbox]").checkToggle({on_label_color:"#fff",off_label_color:"#bbb"})},b.prototype.enable_content_locale_picker=function(){var a,b,c,d=this;c=this.options.target[0].contentWindow,a=this.$("#content-locale-picker-link"),b=$("#content-locale-picker");if(b.size()===0)return;return a.bind("click",function(a){return a.stopPropagation()&a.preventDefault(),b.toggle()}),b.find("li").bind("click",function(e){var f,g;return f=d.get_locale_attributes(a),g=d.get_locale_attributes($(e.target).closest("li")),d.set_locale_attributes(a,g),d.set_locale_attributes($(e.target).closest("li"),f),b.toggle(),window.content_locale=g[1],c.location.href="/"+d.model.get("localized_fullpaths")[g[1]]+"/_edit"})},b.prototype.get_locale_attributes=function(a){return[a.find("img").attr("src"),a.find("span.text").html()]},b.prototype.set_locale_attributes=function(a,b){return a.find("img").attr("src",b[0]),a.find("span.text").html(b[1])},b.prototype.refresh=function(){return this.$("h1").html(this.model.get("title")).removeClass(),this.$(".editing-mode input[type=checkbox]").is(":checked")&&this.$(".editing-mode div.switchArea").trigger("click"),this.$(".element-actions").hide(),this.show_editing_mode_block()},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).MyAccount||(a.MyAccount={}),Locomotive.Views.MyAccount.EditView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.el="#content",b.prototype.events={submit:"save"},b.prototype.initialize=function(){return this.model=new Locomotive.Models.CurrentAccount(this.options.account),Backbone.ModelBinding.bind(this)},b.prototype.render=function(){return b.__super__.render.call(this)},b.prototype.save=function(a){if(this.model.get("locale")===window.locale)return this.save_in_ajax(a)},b}(Locomotive.Views.Shared.FormView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).Pages||(a.Pages={}),Locomotive.Views.Pages.FormView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.el="#content",b.prototype.events={"change   #page_parent_id":"change_page_url","click    a#image-picker-link":"open_image_picker",submit:"save"},b.prototype.initialize=function(){return _.bindAll(this,"insert_image"),this.model=new Locomotive.Models.Page(this.options.page),window.foo=this.model,this.touched_url=!1,this.image_picker_view=new Locomotive.Views.ThemeAssets.ImagePickerView({collection:new Locomotive.Models.ThemeAssetsCollection,on_select:this.insert_image}),Backbone.ModelBinding.bind(this),this.editable_elements_view=new Locomotive.Views.EditableElements.EditAllView({collection:this.model.get("editable_elements")})},b.prototype.render=function(){return b.__super__.render.call(this),this.slugify_title(),this.listen_for_url_changes(),this.enable_response_type_select(),this.enable_templatized_checkbox(),this.enable_redirect_checkbox(),this.enable_other_checkboxes(),this.enable_liquid_editing(),this.render_editable_elements(),this},b.prototype.open_image_picker=function(a){return a.stopPropagation()&a.preventDefault(),this.image_picker_view.editor=this.editor,this.image_picker_view.render()},b.prototype.insert_image=function(a){var b;return b="{{ '"+a+"' | theme_image_url }}",this.editor.replaceSelection(b),this.image_picker_view.close()},b.prototype.enable_liquid_editing=function(){var a,b=this;a=this.$("#page_raw_template");if(a.size()>0)return this.editor=CodeMirror.fromTextArea(a.get()[0],{mode:"liquid",autoMatchParens:!1,lineNumbers:!1,passDelay:50,tabMode:"shift",theme:"default",onChange:function(a){return b.model.set({raw_template:a.getValue()})}})},b.prototype.after_inputs_fold=function(){return this.editor.refresh()},b.prototype.render_editable_elements=function(){return this.$(".formtastic fieldset.inputs:first").before(this.editable_elements_view.render().el),this.editable_elements_view.after_render()},b.prototype.reset_editable_elements=function(){return this.editable_elements_view.remove(),this.editable_elements_view.collection=this.model.get("editable_elements"),this.render_editable_elements()},b.prototype.refresh_editable_elements=function(){return this.editable_elements_view.unbind_model(),this.editable_elements_view.collection=this.model.get("editable_elements"),this.editable_elements_view.refresh()},b.prototype.slugify_title=function(){var a=this;return this.$("#page_title").slugify({target:this.$("#page_slug")}),this.$("#page_slug").bind("change",function(b){return a.touched_url=!0})},b.prototype.listen_for_url_changes=function(){var a=this;return setInterval(function(){if(a.touched_url)return a.change_page_url()&(a.touched_url=!1)},2e3)},b.prototype.change_page_url=function(){var a=this;return $.rails.ajax({url:this.$("#page_slug").attr("data-url"),type:"get",dataType:"json",data:{parent_id:this.$("#page_parent_id").val(),slug:this.$("#page_slug").val()},success:function(b){a.$("#page_slug_input .inline-hints").html(b.url).effect("highlight");if(b.templatized_parent)return a.$("li#page_slug_input").show(),a.$("li#page_templatized_input, li#page_target_klass_name_input").hide();if(!a.model.get("redirect"))return a.$("li#page_templatized_input").show()}})},b.prototype.enable_response_type_select=function(){var a=this;return this.$("li#page_response_type_input").change(function(b){return $(b.target).val()==="text/html"?a.$("li#page_redirect_input, li#page_redirect_url_input").show():(a.model.set({redirect:!1}),a.$("li#page_redirect_input, li#page_redirect_url_input").hide())})},b.prototype.enable_templatized_checkbox=function(){var a=this;this._enable_checkbox("templatized",{features:["slug","redirect","listed"],on_callback:function(){return a.$("li#page_target_klass_name_input").show()},off_callback:function(){return a.$("li#page_target_klass_name_input").hide()}});if(this.model.get("templatized_from_parent")===!0)return this.$("li#page_templatized_input").hide()},b.prototype.enable_redirect_checkbox=function(){var a=this;return this._enable_checkbox("redirect",{features:["templatized","cache_strategy"],on_callback:function(){return a.$("li#page_redirect_url_input").show()},off_callback:function(){return a.$("li#page_redirect_url_input").hide()}})},b.prototype.enable_other_checkboxes=function(){var a=this;return _.each(["published","listed"],function(b){return a.$("li#page_"+b+"_input input[type=checkbox]").checkToggle()})},b}(Locomotive.Views.Shared.FormView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).Pages||(a.Pages={}),Locomotive.Views.Pages.EditView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.save=function(a){var b,c=this;return a.stopPropagation()&a.preventDefault(),b=$(a.target).trigger("ajax:beforeSend"),this.clear_errors(),this.model.save({},{success:function(a,d,e){return b.trigger("ajax:complete"),a._normalize(),a.get("template_changed")===!0?c.reset_editable_elements():c.refresh_editable_elements()},error:function(a,d){var e;return b.trigger("ajax:complete"),e=JSON.parse(d.responseText),c.show_errors(e)}})},b}(Locomotive.Views.Pages.FormView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).Pages||(a.Pages={}),Locomotive.Views.Pages.IndexView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.el="#content",b.prototype.render=function(){return this.index_view=new Locomotive.Views.Pages.ListView,this.index_view.render(),this},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).Pages||(a.Pages={}),Locomotive.Views.Pages.ListView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.el="#pages-list",b.prototype.render=function(){return this.make_foldable(),this.make_sortable(),this},b.prototype.make_foldable=function(){return this.$("ul.folder img.toggler").toggleMe()},b.prototype.make_sortable=function(){var a;return a=this,this.$("ul.folder").sortable({handle:"em",axis:"y",update:function(b,c){return a.call_sort($(this))}})},b.prototype.call_sort=function(a){return $.rails.ajax({url:a.attr("data-url"),type:"post",dataType:"json",data:{children:_.map(a.sortable("toArray"),function(a){return a.replace("item-","")}),_method:"put"},success:this.on_successful_sort,error:this.on_failed_sort})},b.prototype.on_successful_sort=function(a,b,c){return $.growl("success",c.getResponseHeader("X-Message"))},b.prototype.on_failed_sort=function(a,b,c){return $.growl("error",c.getResponseHeader("X-Message"))},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).Pages||(a.Pages={}),Locomotive.Views.Pages.NewView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.save=function(a){return this.save_in_ajax(a,{on_success:function(a,b){return window.location.href=b.getResponseHeader("location")}})},b}(Locomotive.Views.Pages.FormView)}.call(this),function(){var a,b,c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};(a=Locomotive.Views).Shared||(a.Shared={}),(b=Locomotive.Views.Shared).Fields||(b.Fields={}),Locomotive.Views.Shared.Fields.FileView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype.tagName="span",b.prototype.className="file",b.prototype.states={change:!1,"delete":!1},b.prototype.events={"click a.change":"toggle_change","click a.delete":"toggle_delete"},b.prototype.template=function(){return ich[""+this.options.name+"_file_input"]},b.prototype.render=function(){var a,b,c=this;return b=this.model.get(""+this.options.name+"_url")||"",a={filename:b.split("/").pop(),url:b},$(this.el).html(this.template()(a)),this.$("input[type=file]").bind("change",function(a){var b,d,e;d=$(a.target)[0];if(d.files!=null)return e=$(d).attr("name"),b={},b[e.replace(""+c.model.paramRoot+"[","").replace(/]$/,"")]=d.files[0],c.model.set(b)}),this},b.prototype.refresh=function(){return this.$("input[type=file]").unbind("change"),this.states={change:!1,"delete":!1},this.render()},b.prototype.reset=function(){return this.model.set_attribute(this.options.name,null),this.model.set_attribute(""+this.options.name+"_url",null),this.refresh()},b.prototype.toggle_change=function(a){var b=this;return this._toggle(a,"change",{on_change:function(){return b.$("a:first").hide()&b.$("input[type=file]").show()&b.$("a.delete").hide()},on_cancel:function(){return b.$("a:first").show()&b.$("input[type=file]").hide()&b.$("a.delete").show()}})},b.prototype.toggle_delete=function(a){var b=this;return this._toggle(a,"delete",{on_change:function(){return b.$("a:first").addClass("deleted")&b.$("a.change").hide(),b.$("input[type=hidden].remove-flag").val("1"),b.model.set_attribute("remove_"+b.options.name,!0)},on_cancel:function(){return b.$("a:first").removeClass("deleted")&b.$("a.change").show(),b.$("input[type=hidden].remove-flag").val("0"),b.model.set_attribute("remove_"+b.options.name,!1)}})},b.prototype._toggle=function(a,b,c){var d,e;return a.stopPropagation()&a.preventDefault(),d=$(a.target),e=d.attr("data-alt-label"),this.states[b]?c.on_cancel():c.on_change(),d.attr("data-alt-label",d.html()),d.html(e),this.states[b]=!this.states[b]},b.prototype.remove=function(){return this.$("input[type=file]").unbind("change"),b.__super__.remove.apply(this,arguments)},b}(Backbone.View)}.call(this),function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}},d={}.hasOwnProperty,e=function(a,b){function e(){this.constructor=a}for(var c in b)d.call(b,c)&&(a[c]=b[c]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};(a=Locomotive.Views).Shared||(a.Shared={}),(b=Locomotive.Views.Shared).Fields||(b.Fields={}),Locomotive.Views.Shared.Fields.HasManyView=function(a){function b(){return this.get_entry_from_element=c(this.get_entry_from_element,this),b.__super__.constructor.apply(this,arguments)}return e(b,a),b.prototype.tagName="div",b.prototype.className="list",b.prototype.events={"click p.actions a.add":"open_new_entry_view","click ul span.actions a.edit":"edit_entry","click ul span.actions a.remove":"remove_entry"},b.prototype.template=function(){return ich[""+this.options.name+"_list"]},b.prototype.entry_template=function(){return ich[""+this.options.name+"_entry"]},b.prototype.initialize=function(){return _.bindAll(this,"refresh_position_entries"),this.collection=this.model.get(this.options.name),this.build_target_entry_view()},b.prototype.render=function(){return $(this.el).html(this.template()()),this.insert_entries(),this.make_entries_sortable(),this},b.prototype.ui_enabled=function(){return this.template()!=null},b.prototype.insert_entries=function(){var a=this;return this.collection.length>0?this.collection.each(function(b){return a.insert_entry(b)}):this.$(".empty").show()},b.prototype.insert_entry=function(a){var b;return this.collection.get(a.get("_id"))==null&&this.collection.add(a),this.$(".empty").hide(),b=$(this.entry_template()({label:a.get("_label")})),b.data("data-entry-id",a.id),this.$("> ul").append(b)},b.prototype.make_entries_sortable=function(){return this.sortable_list=this.$("> ul").sortable({handle:".handle",items:"li",axis:"y",update:this.refresh_position_entries})},b.prototype.refresh_position_entries=function(){var a=this;return this.$("> ul > li").each(function(b,c){var d,e;return e=$(c).data("data-entry-id"),d=a.collection.get(e),d.set_attribute("position_in_"+a.options.inverse_of,b)})},b.prototype.build_target_entry_view=function(){return this.target_entry_view=new Locomotive.Views.ContentEntries.PopupFormView({el:$("#"+this.options.name+"-template-entry"),parent_view:this,model:this.options.new_entry.clone(),index:this.options.index}),this.target_entry_view.render()},b.prototype.edit_entry=function(a){var b;return a.stopPropagation()&a.preventDefault(),b=this.get_entry_from_element($(a.target)),this.target_entry_view.reset(b),this.target_entry_view.open()},b.prototype.update_entry=function(a){var b,c;return b=$(_.detect(this.$("> ul > li"),function(b){return $(b).data("data-entry-id")===a.id})),this.collection.get(a.id).set(a.attributes),c=$(this.entry_template()({label:a.get("_label")})),c.data("data-entry-id",a.id),b.replaceWith(c)},b.prototype.insert_or_update_entry=function(a){return this.collection.get(a.id)!=null?this.update_entry(a):this.insert_entry(a)},b.prototype.remove_entry=function(a){var b;a.stopPropagation()&a.preventDefault();if(confirm($(a.target).attr("data-confirm")))return b=this.get_entry_from_element($(a.target)),b.set({_destroy:!0}),$(a.target).closest("li").remove(),this.$("> ul > li").size()===0&&this.$(".empty").show(),this.refresh_position_entries()},b.prototype.open_new_entry_view=function(a){return a.stopPropagation()&a.preventDefault(),this.target_entry_view.reset(this.options.new_entry.clone()),this.target_entry_view.open()},b.prototype.get_entry_from_element=function(a){var b,c;return b=$(a).closest("li"),c=$(b).data("data-entry-id"),this.collection.get(c)},b}(Backbone.View)}.call(this),function(){var a,b,c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};(a=Locomotive.Views).Shared||(a.Shared={}),(b=Locomotive.Views.Shared).Fields||(b.Fields={}),Locomotive.Views.Shared.Fields.ManyToManyView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype.tagName="div",b.prototype.className="list",b.prototype.events={"click .new-entry a.add":"add_entry","keypress .new-entry select":"add_entry","click ul span.actions a.remove":"remove_entry"},b.prototype.template=function(){return ich[""+this.options.name+"_list"]},b.prototype.entry_template=function(){return ich[""+this.options.name+"_entry"]},b.prototype.initialize=function(){return _.bindAll(this,"refresh_position_entries"),this.collection=this.model.get(this.options.name),this.all_entries=this.options.all_entries},b.prototype.render=function(){return $(this.el).html(this.template()()),this.insert_entries(),this.make_entries_sortable(),this.refresh_select_field(),this},b.prototype.ui_enabled=function(){return this.template()!=null},b.prototype.insert_entries=function(){var a=this;return this.collection.length>0?this.collection.each(function(b){return a.insert_entry(b)}):this.$(".empty").show()},b.prototype.insert_entry=function(a){var b;return this.collection.get(a.get("_id"))==null&&this.collection.add(a),this.$(".empty").hide(),b=$(this.entry_template()({label:a.get("_label")})),b.data("data-entry-id",a.id),this.$("> ul").append(b)},b.prototype.make_entries_sortable=function(){return this.sortable_list=this.$("> ul").sortable({handle:".handle",items:"li",axis:"y",update:this.refresh_position_entries})},b.prototype.refresh_position_entries=function(){var a=this;return this.$("> ul > li").each(function(b,c){var d,e;return e=$(c).data("data-entry-id"),d=a.collection.get(e),d.set_attribute("__position",b)})},b.prototype.add_entry=function(a){var b,c;a.stopPropagation()&a.preventDefault(),c=this.$(".new-entry select").val(),b=this.get_entry_from_id(c);if(b==null)return;return this.insert_entry(b),this.refresh_select_field()},b.prototype.remove_entry=function(a){var b;a.stopPropagation()&a.preventDefault();if(confirm($(a.target).attr("data-confirm")))return b=this.get_entry_from_element($(a.target)),this.collection.remove(b),$(a.target).closest("li").remove(),this.$("> ul > li").size()===0&&this.$(".empty").show(),this.refresh_position_entries()&this.refresh_select_field()},b.prototype.refresh_select_field=function(){var a=this;return this.$(".new-entry select optgroup, .new-entry select option").remove(),_.each(this.all_entries,function(b){var c,d;if(_.isArray(b.entries))return c=$("<optgroup/>").attr("label",b.name),_.each(b.entries,function(b){var d;if(a.collection.get(b._id)==null)return d=new Option(b._label,b._id,!1),c.append(d)}),a.$(".new-entry select").append(c);if(a.collection.get(b._id)==null)return d=new Option(b._label,b._id,!1),a.$(".new-entry select").append(d)})},b.prototype.get_entry_from_element=function(a){var b,c;return b=$(a).closest("li"),c=$(b).data("data-entry-id"),this.collection.get(c)},b.prototype.get_entry_from_id=function(a){var b,c=this;return b=null,_.each(this.all_entries,function(c){if(_.isArray(c.entries))return b||(b=_.detect(c.entries,function(b){return b._id===a}));if(c._id===a)return b=c}),b!=null?new Locomotive.Models.ContentEntry(b):null},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).Shared||(a.Shared={}),Locomotive.Views.Shared.ListItemView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.tagName="li",b.prototype.events={"click a.remove":"remove_item"},b.prototype.template=function(){},b.prototype.render=function(){return $(this.el).html(this.template()(this.model.toJSON())),this},b.prototype.remove_item=function(a){a.stopPropagation()&a.preventDefault();if(confirm($(a.target).attr("data-confirm")))return this.model.destroy()},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).Shared||(a.Shared={}),Locomotive.Views.Shared.ListView=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}var b;return c(d,a),d.prototype.tagName="div",b=[],d.prototype.initialize=function(){return _.bindAll(this,"insert_item","remove_item"),this.collection.bind("add",this.insert_item),this.collection.bind("remove",this.remove_item)},d.prototype.template=function(){},d.prototype.item_view_class=function(){},d.prototype.render=function(){return $(this.el).html(this.template()()),this.render_items(),this},d.prototype.render_items=function(){var a=this;return this.collection.length===0?this.$(".no-items").show():this.collection.each(function(b){return a.insert_item(b)})},d.prototype.insert_item=function(a){var b,c;return b=this.item_view_class(),c=new b({model:a,parent_view:this}),(this._item_views||(this._item_views=[])).push(c),this.$(".no-items").hide(),this.$("ul").append(c.render().el)},d.prototype.remove_item=function(a){var b;this.collection.length===0&&this.$(".no-items").show(),b=_.find(this._item_views,function(b){return b.model===a});if(b!=null)return b.remove()},d.prototype.remove=function(){var a=this;return _.each(this._item_views,function(a){return a.remove()}),d.__super__.remove.apply(this,arguments)},d}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).Sites||(a.Sites={}),Locomotive.Views.Sites.DomainEntryView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.tagName="li",b.prototype.className="domain",b.prototype.events={"change input[type=text]":"change","click a.remove":"remove"},b.prototype.render=function(){return $(this.el).html(ich.domain_entry(this.model.toJSON())),this},b.prototype.change=function(a){var b;return b=$(a.target).val(),this.options.parent_view.change_entry(this.model,b)},b.prototype.remove=function(a){return a.stopPropagation()&a.preventDefault(),this.$("input[type=text]").editableField("destroy"),this.options.parent_view.remove_entry(this.model),b.__super__.remove.call(this)},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).Sites||(a.Sites={}),Locomotive.Views.Sites.MembershipEntryView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.className="entry",b.prototype.events={"change select":"change","click a.remove":"remove"},b.prototype.render=function(){var a;return a=this.model.toJSON(),a.index=this.options.index,$(this.el).html(ich.membership_entry(a)),$(this.el).attr("data-role",this.model.get("role")),this.$("select").val(this.model.get("role")),this},b.prototype.change=function(a){var b;return b=$(a.target).val(),this.options.parent_view.change_entry(this.model,b)},b.prototype.remove=function(a){return a.stopPropagation()&a.preventDefault(),this.$("select").editableField("destroy"),this.options.parent_view.remove_entry(this.model),b.__super__.remove.call(this)},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).Sites||(a.Sites={}),Locomotive.Views.Sites.MembershipsView=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}var b;return c(d,a),d.prototype.tagName="div",d.prototype.className="list",b=[],d.prototype.render=function(){return this.render_entries(),this.enable_ui_effects(),this},d.prototype.change_entry=function(a,b){return a.set({role:b})},d.prototype.remove_entry=function(a){return a.set({_destroy:!0})},d.prototype.render_entries=function(){var a=this;return this.model.get("memberships").each(function(b,c){return a._insert_entry(b,c)})},d.prototype.enable_ui_effects=function(){return this.$(".entry select").editableField()},d.prototype._insert_entry=function(a,b){var c;return c=new Locomotive.Views.Sites.MembershipEntryView({model:a,parent_view:this,index:b}),(this._entry_views||(this._entry_views=[])).push(c),$(this.el).append(c.render().el)},d}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).Sites||(a.Sites={}),Locomotive.Views.Sites.NewView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.el="#content",b.prototype.events={submit:"save"},b.prototype.initialize=function(){return this.model=new Locomotive.Models.Site,Backbone.ModelBinding.bind(this)},b.prototype.render=function(){return b.__super__.render.call(this),this.render_domains()},b.prototype.render_domains=function(){return this.domains_view=new Locomotive.Views.Sites.DomainsView({model:this.model,errors:this.options.errors}),this.$("#site_domains_input label").after(this.domains_view.render().el)},b.prototype.save=function(a){return this.save_in_ajax(a,{on_success:function(a,b){return window.location.href=b.getResponseHeader("location")}})},b.prototype.show_error=function(a,c,d){return a==="domains"?this.domains_view.show_error(c):b.__super__.show_error.apply(this,arguments)},b.prototype.remove=function(){return this.domains_view.remove(),b.__super__.remove.apply(this,arguments)},b}(Locomotive.Views.Shared.FormView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).Snippets||(a.Snippets={}),Locomotive.Views.Snippets.FormView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.el="#content",b.prototype.events={"click    a#image-picker-link":"open_image_picker",submit:"save"},b.prototype.initialize=function(){return _.bindAll(this,"insert_image"),this.model=new Locomotive.Models.Snippet(this.options.snippet),this.image_picker_view=new Locomotive.Views.ThemeAssets.ImagePickerView({collection:new Locomotive.Models.ThemeAssetsCollection,on_select:this.insert_image}),Backbone.ModelBinding.bind(this)},b.prototype.render=function(){return b.__super__.render.call(this),this.slugify_name(),this.enable_liquid_editing(),this},b.prototype.slugify_name=function(){return this.$("#snippet_name").slugify({target:this.$("#snippet_slug")})},b.prototype.open_image_picker=function(a){return a.stopPropagation()&a.preventDefault(),this.image_picker_view.editor=this.editor,this.image_picker_view.render()},b.prototype.insert_image=function(a){var b;return b="{{ '"+a+"' | theme_image_url }}",this.editor.replaceSelection(b),this.image_picker_view.close()},b.prototype.enable_liquid_editing=function(){var a,b=this;return a=this.$("#snippet_template"),this.editor=CodeMirror.fromTextArea(a.get()[0],{mode:"liquid",autoMatchParens:!1,lineNumbers:!1,passDelay:50,tabMode:"shift",theme:"default medium",onChange:function(a){return b.model.set({template:a.getValue()})}})},b.prototype.after_inputs_fold=function(){return this.editor.refresh()},b}(Locomotive.Views.Shared.FormView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).Snippets||(a.Snippets={}),Locomotive.Views.Snippets.EditView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.save=function(a){return this.save_in_ajax(a)},b}(Locomotive.Views.Snippets.FormView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).Snippets||(a.Snippets={}),Locomotive.Views.Snippets.ListItemView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.template=function(){return ich.snippet_item},b}(Locomotive.Views.Shared.ListItemView
)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).Snippets||(a.Snippets={}),Locomotive.Views.Snippets.ListView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.className="box",b.prototype.initialize=function(){return this.collection=new Locomotive.Models.SnippetsCollection(this.options.collection),b.__super__.initialize.apply(this,arguments)},b.prototype.template=function(){return ich.snippets_list},b.prototype.item_view_class=function(){return Locomotive.Views.Snippets.ListItemView},b}(Locomotive.Views.Shared.ListView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).Snippets||(a.Snippets={}),Locomotive.Views.Snippets.NewView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.save=function(a){return this.save_in_ajax(a,{on_success:function(a,b){return window.location.href=b.getResponseHeader("location")}})},b}(Locomotive.Views.Snippets.FormView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).ThemeAssets||(a.ThemeAssets={}),Locomotive.Views.ThemeAssets.FormView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.el="#content",b.prototype.events={"click    a#image-picker-link":"open_image_picker",submit:"save"},b.prototype.initialize=function(){return _.bindAll(this,"insert_image"),this.model=new Locomotive.Models.ThemeAsset(this.options.theme_asset),window.foo=this.model,this.image_picker_view=new Locomotive.Views.ThemeAssets.ImagePickerView({on_select:this.insert_image}),Backbone.ModelBinding.bind(this)},b.prototype.render=function(){return b.__super__.render.call(this),this.enable_toggle_between_file_and_text(),this.enable_source_editing(),this.bind_source_mode(),this.enable_source_file(),this},b.prototype.enable_toggle_between_file_and_text=function(){var a=this;return this.$("div.hidden").hide(),this.model.set({performing_plain_text:this.$("#theme_asset_performing_plain_text").val()}),this.$(".selector > a.alt").click(function(b){return b.stopPropagation()&b.preventDefault(),a.$("#file-selector").is(":hidden")?a.$("#text-selector").slideUp("normal",function(){return a.$("#file-selector").slideDown(),a.model.set({performing_plain_text:!1}),a.$("input#theme_asset_performing_plain_text").val(!1)}):a.$("#file-selector").slideUp("normal",function(){return a.$("#text-selector").slideDown("normal",function(){return a.editor.refresh()}),a.model.set({performing_plain_text:!0}),a.$("#theme_asset_performing_plain_text").val(!0)})})},b.prototype.enable_source_file=function(){var a=this;return this.$(".formtastic #theme_asset_source").bind("change",function(b){var c;c=$(b.target)[0];if(c.files!=null)return a.model.set({source:c.files[0]})})},b.prototype.show_error=function(a,c,d){switch(a){case"source":return this.$(this.model.get("performing_plain_text")?"#theme_asset_plain_text_input .CodeMirror":"#theme_asset_source").after(d);default:return b.__super__.show_error.apply(this,arguments)}},b.prototype.open_image_picker=function(a){return a.stopPropagation()&a.preventDefault(),this.image_picker_view.editor=this.editor,this.image_picker_view.render()},b.prototype.insert_image=function(a){var b;return b="{{ '"+a+"' | theme_image_url }}",this.editor.replaceSelection(b),this.image_picker_view.close()},b.prototype.source_mode=function(){return this.model.get("plain_text_type")==="javascript"?"javascript":"css"},b.prototype.enable_source_editing=function(){var a,b=this;a=this.$("#theme_asset_plain_text");if(a.size()===0)return;return this.editor=CodeMirror.fromTextArea(a.get()[0],{mode:this.source_mode(),autoMatchParens:!1,lineNumbers:!1,passDelay:50,tabMode:"shift",theme:"default",onChange:function(a){return b.model.set({plain_text:a.getValue()})}})},b.prototype.bind_source_mode=function(){var a=this;return this.$("#theme_asset_plain_text_type").bind("change",function(b){return a.editor.setOption("mode",a.source_mode())})},b.prototype.after_inputs_fold=function(){if(this.editor!=null)return this.editor.refresh()},b}(Locomotive.Views.Shared.FormView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).ThemeAssets||(a.ThemeAssets={}),Locomotive.Views.ThemeAssets.EditView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.save=function(a){var b=this;return this.save_in_ajax(a,{on_success:function(a,c){var d;window.response=a,window.xhr=c,d=b.$(".inner > p.help"),d.find("b").html(a.dimensions),d.find("a").html(a.url).attr("href",a.url),window.editor=b.editor;if(a.plain_text!=null)return b.editor.setValue(a.plain_text)}})},b}(Locomotive.Views.ThemeAssets.FormView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).ThemeAssets||(a.ThemeAssets={}),Locomotive.Views.ThemeAssets.ImagePickerView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.events={"click ul.list a":"select_asset"},b.prototype.initialize=function(){return this.collection||(this.collection=new Locomotive.Models.ThemeAssetsCollection),b.__super__.initialize.apply(this,arguments)},b.prototype.template=function(){return ich.theme_image_picker},b.prototype.fetch_assets=function(){return this.collection.fetch({data:{content_type:"image"}})},b.prototype.build_uploader=function(a,b){var c=this;return b.bind("click",function(b){return b.stopPropagation()&b.preventDefault(),a.click()}),a.bind("change",function(a){return _.each(a.target.files,function(a){var b;return b=new Locomotive.Models.ThemeAsset({source:a}),b.save({},{headers:{"X-Flash":!0},success:function(a){return c.collection.add(a)},error:function(){return c.shake()}})})})},b.prototype.select_asset=function(a){a.stopPropagation()&a.preventDefault();if(this.options.on_select)return this.options.on_select($(a.target).html())},b.prototype.add_asset=function(a){return this.$("ul.list").append(ich.theme_asset(a.toJSON())),this._refresh()},b}(Locomotive.Views.Shared.AssetPickerView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).ThemeAssets||(a.ThemeAssets={}),Locomotive.Views.ThemeAssets.IndexView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.el="#content",b.prototype._lists_views=[],b.prototype.initialize=function(){return _.bindAll(this,"insert_asset")},b.prototype.render=function(){return this.build_uploader(),this.render_snippets(),this.render_images(),this.render_js_and_css(),this.render_fonts(),this.render_media(),this},b.prototype.build_uploader=function(){var a,b,c,d=this;return a=this.$("#theme-assets-quick-upload"),b=a.find("input[type=file]"),c=a.find("a.new"),a.formSubmitNotification(),c.bind("click",function(a){return a.stopPropagation()&a.preventDefault(),b.click()}),b.bind("change",function(b){return a.trigger("ajax:beforeSend"),_.each(b.target.files,function(b){var c;return c=new Locomotive.Models.ThemeAsset({source:b}),c.save({},{success:function(b,c,e){return a.trigger("ajax:complete"),d.insert_asset(b)},error:function(){return a.trigger("ajax:complete")},headers:{"X-Flash":!0}})})})},b.prototype.insert_asset=function(a){var b;return b=this.pick_list_view(a.get("content_type")),b.collection.add(a)},b.prototype.render_snippets=function(){return this.render_list("snippets",this.options.snippets,Locomotive.Views.Snippets.ListView)},b.prototype.render_images=function(){return this.render_list("images",this.options.images)},b.prototype.render_js_and_css=function(){return this.render_list("js-and-css",this.options.js_and_css_assets,Locomotive.Views.ThemeAssets.ListView,ich.js_and_css_list)},b.prototype.render_fonts=function(){return this.render_list("fonts",this.options.fonts,Locomotive.Views.ThemeAssets.ListView,ich.fonts_list)},b.prototype.render_media=function(){return this.render_list("media",this.options.media,Locomotive.Views.ThemeAssets.ListView,ich.media_list)},b.prototype.render_list=function(a,b,c,d){var e;if(this.$("#"+a+"-anchor").size()===0)return;return c||(c=Locomotive.Views.ThemeAssets.ListView),e=new c({collection:b,type:a}),d!=null&&(e.template=function(){return d}),this.$("#"+a+"-anchor").replaceWith(e.render().el),(this._lists_views||(this._lists_views=[])).push(e)},b.prototype.pick_list_view=function(a){var b,c=this;return b=function(){switch(a){case"image":return"images";case"javascript":case"stylesheet":return"js-and-css";case"media":return"media";case"font":return"fonts"}}(),_.find(this._lists_views,function(a){return a.options.type===b})},b.prototype.remove=function(){var a=this;return _.each(this._lists_views,function(a){return a.remove()}),b.__super__.remove.apply(this,arguments)},b}(Backbone.View)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).ThemeAssets||(a.ThemeAssets={}),Locomotive.Views.ThemeAssets.ListItemView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.template=function(){return ich.editable_theme_asset_item},b}(Locomotive.Views.Shared.ListItemView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).ThemeAssets||(a.ThemeAssets={}),Locomotive.Views.ThemeAssets.ListView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.className="box",b.prototype.initialize=function(){return this.collection=new Locomotive.Models.ThemeAssetsCollection(this.options.collection),b.__super__.initialize.apply(this,arguments)},b.prototype.template=function(){return ich.images_list},b.prototype.item_view_class=function(){return Locomotive.Views.ThemeAssets.ListItemView},b}(Locomotive.Views.Shared.ListView)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};(a=Locomotive.Views).ThemeAssets||(a.ThemeAssets={}),Locomotive.Views.ThemeAssets.NewView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.save=function(a){return this.save_in_ajax(a,{on_success:function(a,b){return window.location.href=b.getResponseHeader("location")}})},b}(Locomotive.Views.ThemeAssets.FormView)}.call(this);