(function(){window.Locomotive={mounted_on:window.Locomotive.mounted_on,Models:{},Collections:{},Views:{}},window.Locomotive.Views.Memberships={}}).call(this),function(){var e;window.Aloha=(e=window.Aloha)!=null?e:window.Aloha={},window.Aloha.settings={logLevels:{error:!0,warn:!0,info:!1,debug:!1},errorhandling:!0,plugins:{format:{config:["b","i","u","del","sub","sup","p","title","h1","h2","h3","h4","h5","h6","pre","removeFormat"],editables:{".editable-short-text":["b","i","u"]}},link:{config:["a"],editables:{".editable-short-text":[]}},list:{config:["ul"],editables:{".editable-short-text":[]}},image:{ui:{insert:!1,crop:!1}}},i18n:{available:["en","fr","pt-BR","es","de","no","ru","nl"]},sidebar:{disabled:!0}}}.call(this),function(){String.prototype.trim=function(){return this.replace(/^\s+/g,"").replace(/\s+$/g,"")},String.prototype.repeat=function(e){for(var t=0,n="";t<e;t++)n+=this;return n},String.prototype.truncate=function(e){return this.length>e?this.slice(0,e-3)+"...":this},String.prototype.slugify=function(e){typeof e=="undefined"&&(e="_");var t=new RegExp("[^\\w\\"+e+"]","g"),n=new RegExp("[\\"+e+"]{2,}","g");return this.replace(/\s/g,e).replace(t,"").replace(n,e).toLowerCase()},window.addParameterToURL=function(e,t,n){typeof n=="undefined"&&(n=document),e=encodeURIComponent(e),t=encodeURIComponent(t);var r=n.location.search.substr(1).split("&"),i=r.length,s;while(i--){s=r[i].split("=");if(s[0]==e){s[1]=t,r[i]=s.join("=");break}}i<0&&(r[r.length]=[e,t].join("=")),n.location.search=r.join("&")},window.addJavascript=function(e,t,n){var r=e.createElement("script");r.type="text/javascript",r.src=t,n&&n.onload&&(r.onload=n.onload,delete n.onload);for(var i in n)r.setAttribute(i,n[i]);e.body.appendChild(r)},window.addStylesheet=function(e,t,n){var r=e.createElement("link");r.style="text/css",r.href=t,r.media="screen",r.rel="stylesheet",e.head.appendChild(r)},$.ui.dialog.prototype.overlayEl=function(){return this.overlay.$el}}(),$.growl.settings.noticeTemplate='<div class="notice %title%">  <p>%message%</p></div>',$.growl.settings.dockCss={position:"fixed",bottom:"20px",left:"0px",width:"100%",zIndex:5e4},function(){Handlebars.registerHelper("each_with_index",function(e,t){var n,r,i,s,o;i="";for(s=0,o=e.length;s<o;s++)r=e[s],n=e[r],n._index=r,i+=t(n);return i})}.call(this),function(){window.Locomotive.tinyMCE={defaultSettings:{theme:"advanced",skin:"locomotive",plugins:"safari,jqueryinlinepopups,locomotive_media,fullscreen",extended_valid_elements:"iframe[width|height|frameborder|allowfullscreen|src|title]",theme_advanced_buttons1:"fullscreen,code,|,bold,italic,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,bullist,numlist,|,outdent,indent,blockquote,|,link,unlink,|,locomotive_media",theme_advanced_buttons2:"formatselect,fontselect,fontsizeselect",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",height:"300",width:"709",convert_urls:!1,fullscreen_new_window:!1,fullscreen_settings:{theme_advanced_path_location:"top"}},minimalSettings:{theme:"advanced",skin:"locomotive",plugins:"safari,jqueryinlinepopups,locomotive_media",theme_advanced_buttons1:"code,|,bold,italic,strikethrough,|,fontselect,fontsizeselect,|,link,unlink,|,locomotive_media",theme_advanced_buttons2:"",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",height:"20",width:"709",convert_urls:!1},popupSettings:{theme:"advanced",skin:"locomotive",plugins:"safari,jqueryinlinepopups,locomotive_media,fullscreen",extended_valid_elements:"iframe[width|height|frameborder|allowfullscreen|src|title]",theme_advanced_buttons1:"fullscreen,code,|,bold,italic,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,bullist,numlist,|,outdent,indent,blockquote,|,link,unlink,|,locomotive_media",theme_advanced_buttons2:"formatselect,fontselect,fontsizeselect",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",height:"300",width:"545",convert_urls:!1,fullscreen_new_window:!1,fullscreen_settings:{theme_advanced_path_location:"top"}}}}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Locomotive.Models.Account=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.paramRoot="account",n.prototype.urlRoot=""+Locomotive.mounted_on+"/accounts",n}(Backbone.Model),Locomotive.Models.CurrentAccount=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.url=""+Locomotive.mounted_on+"/my_account",n}(Locomotive.Models.Account)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Locomotive.Models.ContentAsset=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.paramRoot="content_asset",n.prototype.urlRoot=""+Locomotive.mounted_on+"/content_assets",n.prototype.initialize=function(){return this.prepare()},n.prototype.prepare=function(){return this.set({image:this.get("content_type")==="image"}),this},n}(Backbone.Model),Locomotive.Models.ContentAssetsCollection=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.model=Locomotive.Models.ContentAsset,n.prototype.url=""+Locomotive.mounted_on+"/content_assets",n}(Backbone.Collection)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Locomotive.Models.ContentEntry=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.paramRoot="content_entry",n.prototype.urlRoot=""+Locomotive.mounted_on+"/content_types/:slug/entries",n.prototype.initialize=function(){var e=this;return this.urlRoot=this.urlRoot.replace(":slug",this.get("content_type_slug")),_.each(this.get("has_many_custom_fields"),function(t){var n,r;return r=t[0],n=new Locomotive.Models.ContentEntriesCollection(e.get(r)),e.set_attribute(r,n)}),_.each(this.get("many_to_many_custom_fields"),function(t){var n,r;return r=t[0],n=new Locomotive.Models.ContentEntriesCollection(e.get(r)),n.comparator=function(e){return e.get("__position")||0},e.set_attribute(r,n)})},n.prototype.set_attribute=function(e,t){var n;return n={},n[e]=t,this.set(n)},n.prototype.update_attributes=function(e){var t=this;return _.each(e.file_custom_fields,function(n){var r;return r=""+n+"_url",t.set_attribute(r,e[r]),t.set_attribute("remove_"+n,!1)})},n.prototype.toMinJSON=function(){var e=this;return _.tap({},function(t){return _.each(e.attributes,function(e,n){if(n==="id"||n==="_destroy"||n.indexOf("position_in_")===0)return t[n]=e})})},n.prototype.toJSON=function(){var e=this;return _.tap(n.__super__.toJSON.apply(this,arguments),function(t){return t._slug===null&&(t._slug=""),_.each(_.keys(t),function(n){if(!_.include(e.get("safe_attributes"),n))return delete t[n]}),_.each(e.get("has_many_custom_fields"),function(n){var r;r=n[0];if(e.get(r).length>0)return t[""+r+"_attributes"]=e.get(r).toMinJSON()}),_.each(e.get("many_to_many_custom_fields"),function(n){var r,i;return r=n[0],i=n[1],t[i]=e.get(r).sort().map(function(e){return e.id})})})},n}(Backbone.Model),Locomotive.Models.ContentEntriesCollection=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.model=Locomotive.Models.ContentEntry,n.prototype.url=""+Locomotive.mounted_on+"/content_types/:slug/entries",n.prototype.toMinJSON=function(){var e=this;return this.map(function(e){return e.toMinJSON()})},n}(Backbone.Collection)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Locomotive.Models.ContentType=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.paramRoot="content_type",n.prototype.urlRoot=""+Locomotive.mounted_on+"/content_types",n.prototype.initialize=function(){return this._normalize()},n.prototype._normalize=function(){return this.set({entries_custom_fields:new Locomotive.Models.CustomFieldsCollection(this.get("entries_custom_fields"))})},n.prototype.toJSON=function(){var e=this;return _.tap(n.__super__.toJSON.apply(this,arguments),function(t){delete t.entries_custom_fields;if(e.get("entries_custom_fields")!=null&&e.get("entries_custom_fields").length>0)return t.entries_custom_fields_attributes=e.get("entries_custom_fields").toJSONForSave()})},n}(Backbone.Model),Locomotive.Models.ContentTypesCollection=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.model=Locomotive.Models.ContentType,n.prototype.url=""+Locomotive.mounted_on+"/content_types",n}(Backbone.Collection)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Locomotive.Models.CustomField=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.initialize=function(){this._normalize();if(this.get("name")==null)return this.set({name:this.get("label").slugify()})},n.prototype._normalize=function(){return this.set({select_options:new Locomotive.Models.CustomFieldSelectOptionsCollection(this.get("select_options"))})},n.prototype._undesired_fields=["select_options","type_text","text_formatting_text","inverse_of_text","class_name_text","undefined_text","undefined","created_at","updated_at"],n.prototype._relationship_fields=["class_name","inverse_of","ui_enabled"],n.prototype.is_relationship_type=function(){return _.include(["belongs_to","has_many","many_to_many"],this.get("type"))},n.prototype.toJSONForSave=function(){var e=this;return _.tap({},function(t){var n,r,i;i=e.toJSON();for(n in i)r=i[n],_.include(e._undesired_fields,n)||(_.include(e._relationship_fields,n)?e.is_relationship_type()&&(t[n]=r):t[n]=r);if(e.get("select_options")!=null&&e.get("select_options").length>0)return t.select_options_attributes=e.get("select_options").toJSONForSave()})},n}(Backbone.Model),Locomotive.Models.CustomFieldsCollection=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.model=Locomotive.Models.CustomField,n.prototype.toJSONForSave=function(){var e=this;return this.map(function(e){return e.toJSONForSave()})},n}(Backbone.Collection)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Locomotive.Models.CustomFieldSelectOption=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.toJSONForSave=function(){var e=this;return _.tap({},function(t){var n,r,i,s;i=e.toJSON(),s=[];for(n in i)r=i[n],_.include(["created_at","updated_at"],n)?s.push(void 0):s.push(t[n]=r);return s})},n}(Backbone.Model),Locomotive.Models.CustomFieldSelectOptionsCollection=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.model=Locomotive.Models.CustomFieldSelectOption,n.prototype.toJSONForSave=function(){var e=this;return this.map(function(e){return e.toJSONForSave()})},n}(Backbone.Collection)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Locomotive.Models.Domain=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n}(Backbone.Model)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Locomotive.Models.EditableElement=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.toJSONForSave=function(){var e=this;return _.tap({},function(t){var n,r,i;i=e.toJSON();for(n in i)r=i[n],_.include(["id","source","content","remove_source"],n)&&(t[n]=r);return e.get("type")==="EditableFile"?delete t.content:delete t.source})},n}(Backbone.Model),Locomotive.Models.EditableElementsCollection=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.model=Locomotive.Models.EditableElement,n.prototype.blocks=function(){var e,t=this;return e=_.uniq(this.map(function(e,t){return e.get("block_name")})),_.tap([],function(t){return _.each(e,function(e,n){return t.push({name:e,index:n})})})},n.prototype.by_block=function(e){return this.filter(function(t){return t.get("block_name")===e})},n.prototype.toJSONForSave=function(){var e=this;return this.map(function(e){return e.toJSONForSave()})},n}(Backbone.Collection)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Locomotive.Models.Membership=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.toJSONForSave=function(){var e=this;return _.tap({},function(t){var n,r,i,s;i=e.toJSON(),s=[];for(n in i)r=i[n],_.include(["id","_id","role","_destroy"],n)?s.push(t[n]=r):s.push(void 0);return s})},n}(Backbone.Model),Locomotive.Models.MembershipsCollection=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.model=Locomotive.Models.Membership,n.prototype.toJSONForSave=function(){var e=this;return this.map(function(e){return e.toJSONForSave()})},n}(Backbone.Collection)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Locomotive.Models.Page=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.paramRoot="page",n.prototype.urlRoot=""+Locomotive.mounted_on+"/pages",n.prototype.initialize=function(){return this._normalize(),this.set({edit_url:""+Locomotive.mounted_on+"/pages/"+this.id+"/edit"})},n.prototype._normalize=function(){return this.set({editable_elements:new Locomotive.Models.EditableElementsCollection(this.get("editable_elements")||[])})},n.prototype.toJSON=function(){var e=this;return _.tap(n.__super__.toJSON.apply(this,arguments),function(t){_.each(["fullpath","localized_fullpaths","templatized_from_parent","target_klass_name_text","content_type_id_text","edit_url","parent_id_text","response_type_text"],function(e){return delete t[e]}),delete t.editable_elements,e.get("editable_elements")!=null&&e.get("editable_elements").length>0&&(t.editable_elements=e.get("editable_elements").toJSONForSave()),delete t.target_klass_name;if(e.get("templatized")===!0)return t.target_klass_name=e.get("target_klass_name")})},n}(Backbone.Model),Locomotive.Models.PagesCollection=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n}(Backbone.Collection)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Locomotive.Models.Site=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.paramRoot="site",n.prototype.urlRoot=""+Locomotive.mounted_on+"/sites",n.prototype.initialize=function(){var e,t,n=this;return e=_.map(this.get("domains_without_subdomain"),function(e){return new Locomotive.Models.Domain({name:e})}),t=new Locomotive.Models.MembershipsCollection(this.get("memberships")),this.set({domains:e,memberships:t})},n.prototype.includes_domain=function(e){return e===this.domain_with_domain()||_.any(this.get("domains"),function(t){return t.get("name")===e})},n.prototype.domain_with_domain=function(){return""+this.get("subdomain")+"."+this.get("domain_name")},n.prototype.toJSON=function(){var e=this;return _.tap(n.__super__.toJSON.apply(this,arguments),function(t){return delete t.memberships,e.get("memberships")!=null&&e.get("memberships").length>0&&(t.memberships_attributes=e.get("memberships").toJSONForSave()),delete t.domains,t.domains=_.map(e.get("domains"),function(e){return e.get("name")})})},n}(Backbone.Model),Locomotive.Models.CurrentSite=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.url=""+Locomotive.mounted_on+"/current_site",n}(Locomotive.Models.Site)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Locomotive.Models.Snippet=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.paramRoot="snippet",n.prototype.urlRoot=""+Locomotive.mounted_on+"/snippets",n}(Backbone.Model),Locomotive.Models.SnippetsCollection=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.model=Locomotive.Models.Snippet,n.prototype.url=""+Locomotive.mounted_on+"/snippets",n}(Backbone.Collection)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Locomotive.Models.ThemeAsset=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.paramRoot="theme_asset",n.prototype.urlRoot=""+Locomotive.mounted_on+"/theme_assets",n}(Backbone.Model),Locomotive.Models.ThemeAssetsCollection=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.model=Locomotive.Models.ThemeAsset,n.prototype.url=""+Locomotive.mounted_on+"/theme_assets",n}(Backbone.Collection)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Locomotive.Views.ApplicationView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.el="body",n.prototype.render=function(){return this.render_flash_messages(this.options.flash),this.add_submenu_behaviours(),this.center_ui_dialog(),this.enable_sites_picker(),this.enable_content_locale_picker(),this.options.view!=null&&(this.view=new this.options.view(this.options.view_data||{}),this.view.render()),window.Locomotive.tinyMCE.defaultSettings.language=window.locale,window.Locomotive.tinyMCE.minimalSettings.language=window.locale,this},n.prototype.render_flash_messages=function(e){return _.each(e,function(e){return $.growl(e[0],e[1])})},n.prototype.center_ui_dialog=function(){return $(window).resize(function(){return $(".ui-dialog-content:visible").dialog("option","position","center")})},n.prototype.add_submenu_behaviours=function(){var e;$("#submenu ul li.hoverable").each(function(){var e,t,n;return n=null,e=$(this),(t=e.find(".popup")).removeClass("popup").addClass("submenu-popup").bind("show",function(){return e.find("a").addClass("hover")&t.css({top:e.offset().top+e.height()-2,left:e.offset().left-parseInt(t.css("padding-left"))}).show()}).bind("hide",function(){return e.find("a").removeClass("hover")&$(this).hide()}).bind("mouseleave",function(){return t.trigger("hide")}).bind("mouseenter",function(){return clearTimeout(n)}),$(document.body).append(t),e.hover(function(){return t.trigger("show")},function(){return n=window.setTimeout(function(){return t.trigger("hide")},30)})}),e=$("#submenu > ul").attr("class");if(e!=="")return $("#submenu > ul > li."+e).addClass("on")},n.prototype.enable_sites_picker=function(){var e,t,n;t=this.$("#sites-picker-link"),n=this.$("#sites-picker");if(n.size()===0)return;return e=t.position().left+t.parent().position().left-(n.width()-t.width()),n.css("left",e),t.bind("click",function(e){return e.stopPropagation()&e.preventDefault(),n.toggle()})},n.prototype.enable_content_locale_picker=function(){var e,t;e=this.$("#content-locale-picker-link"),t=this.$("#content-locale-picker");if(t.size()===0)return;return e.bind("click",function(e){return e.stopPropagation()&e.preventDefault(),t.toggle()}),t.find("li").bind("click",function(e){var t;return t=$(this).attr("data-locale"),window.addParameterToURL("content_locale",t)})},n.prototype.unique_dialog_zindex=function(){var e;return(e=window.Locomotive).jQueryModals||(e.jQueryModals=0),998+window.Locomotive.jQueryModals++},n}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).ContentAssets||(e.ContentAssets={}),Locomotive.Views.ContentAssets.PickerItemView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.tagName="li",t.prototype.className="asset",t.prototype.events={"click h4 a, .icon, .image":"select_asset","click a.remove":"remove_asset"},t.prototype.render=function(){return $(this.el).html(ich.content_asset(this.model.toJSON())),this},t.prototype.select_asset=function(e){return e.stopPropagation()&e.preventDefault(),this.on_select(this.model)},t.prototype.on_select=function(){if(this.options.parent.options.on_select)return this.options.parent.options.on_select(this.model)},t.prototype.remove_asset=function(e){var t;e.stopPropagation()&e.preventDefault(),t=$(e.target).attr("data-confirm")||$(e.target).parent().attr("data-confirm");if(confirm(t))return this.model.destroy()},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).Shared||(e.Shared={}),Locomotive.Views.Shared.AssetPickerView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.tag="div",t.prototype.initialize=function(){return _.bindAll(this,"add_assets","add_asset","remove_asset"),this.collection.bind("reset",this.add_assets),this.collection.bind("add",this.add_asset),this.collection.bind("remove",this.remove_asset)},t.prototype.render=function(){return $(this.el).html(this.template()()),this.create_dialog(),this},t.prototype.template=function(){},t.prototype.fetch_assets=function(){},t.prototype.build_uploader=function(e,t){},t.prototype.create_dialog=function(){var e=this;return this.dialog||(this.dialog=$(this.el).dialog({autoOpen:!1,modal:!0,zIndex:window.application_view.unique_dialog_zindex(),width:650,create:function(t,n){var r,i,s;return $(e.el).prev().find(".ui-dialog-title").html(e.$("h2").html()),e.$("h2").remove(),r=e.$(".dialog-actions").appendTo($(e.el).parent()).addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),r.find("#close-link").click(function(t){return e.close(t)}),i=r.find("input[type=file]"),s=r.find("#upload-link"),e.build_uploader(i,s)},open:function(t,n,r){return $(e.el).dialog("overlayEl").bind("click",function(){return e.close()})}}))},t.prototype.open=function(){return $(this.el).dialog("open")},t.prototype.close=function(e){return e!=null&&e.stopPropagation()&e.preventDefault(),$(this.el).dialog("overlayEl").unbind("click"),$(this.el).dialog("close")},t.prototype.shake=function(){return $(this.el).parents(".ui-dialog").effect("shake",{times:4},100)},t.prototype.center=function(){return $(this.el).dialog("option","position","center")},t.prototype.add_assets=function(e){var t=this;return e.each(function(e){return t.add_asset(e,!0)}),this._refresh()},t.prototype.add_asset=function(e,t){},t.prototype.remove_asset=function(e){},t.prototype._move_to_last_asset=function(){var e;e=this.$("ul.list li.clear").position();if(e!=null)return this.$("ul.list").animate({scrollTop:e.top},100)},t.prototype._refresh=function(){this.collection.length===0?this.$("ul.list").hide()&this.$("p.no-items").show():(this.$("p.no-items").hide()&this.$("ul.list").show(),this._on_refresh());if(this.dialog!=null)return this.center()},t.prototype._on_refresh=function(){},t.prototype._reset=function(){},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).ContentAssets||(e.ContentAssets={}),Locomotive.Views.ContentAssets.PickerView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.number_items_per_row=4,t.prototype._item_views=[],t.prototype.template=function(){return ich.content_asset_picker},t.prototype.fetch_assets=function(){var e=this;return this._reset(),this.collection.fetch({success:function(){return e.open()}})},t.prototype.build_uploader=function(e,t){var n=this;return t.bind("click",function(t){return t.stopPropagation()&t.preventDefault(),e.click()}),e.bind("change",function(e){return _.each(e.target.files,function(e){var t;return t=new Locomotive.Models.ContentAsset({source:e}),t.save({},{headers:{"X-Flash":!0},success:function(e,t){return n.collection.add(e.prepare())},error:function(){return n.shake()}})})})},t.prototype.add_asset=function(e,t){var n;n=new Locomotive.Views.ContentAssets.PickerItemView({model:e,parent:this}),(this._item_views||(this._item_views=[])).push(n),this.$("ul.list .clear").before(n.render().el),this._refresh();if(t!==!0)return this._move_to_last_asset()},t.prototype.remove_asset=function(e){var t;return t=_.find(this._item_views,function(t){return t.model===e}),t!=null&&t.remove(),this._refresh()},t.prototype._on_refresh=function(){var e;return e=this,this.$("ul.list li.asset").each(function(t){return(t+1)%e.number_items_per_row===0?$(this).addClass("last"):$(this).removeClass("last")})},t.prototype._reset=function(){return _.each(this._item_views||[],function(e){return e.remove()}),t.__super__._reset.call(this)},t}(Locomotive.Views.Shared.AssetPickerView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).Shared||(e.Shared={}),Locomotive.Views.Shared.FormView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.el="#content",t.prototype.render=function(){return this.make_title_editable(),this._hide_last_separator(),this.make_inputs_foldable(),this.enable_save_with_keys_combination(),this.enable_form_notifications(),this},t.prototype.save=function(e){},t.prototype.save_in_ajax=function(e,t){var n,r,i=this;return e.stopPropagation()&e.preventDefault(),n=$(e.target).trigger("ajax:beforeSend"),this.clear_errors(),t||(t={headers:{},on_success:null,on_error:null}),r=_.clone(this.model.attributes),this.model.save({},{headers:t.headers,silent:!0,success:function(e,i,s){n.trigger("ajax:complete"),e.attributes=r;if(t.on_success)return t.on_success(i,s)},error:function(e,r){var s;n.trigger("ajax:complete"),s=JSON.parse(r.responseText),i.show_errors(s);if(t.on_error)return t.on_error()}})},t.prototype.make_title_editable=function(){var e,t,n=this;t=this.$("h2 a.editable");if(t.size()>0)return e=this.$("#"+t.attr("rel")),e.parent().hide(),t.click(function(n){var r;n.stopPropagation()&n.preventDefault(),r=prompt(t.attr("title"),t.html());if(r&&r!=="")return t.html(r),e.val(r).trigger("change")})},t.prototype.make_inputs_foldable=function(){var e;return e=this,this.$(".formtastic fieldset.foldable.folded ol").hide(),this.$(".formtastic fieldset.foldable legend").click(function(){var t,n;return n=$(this).parent(),t=$(this).next(),n.hasClass("folded")?(n.removeClass("folded"),t.slideDown(100,function(){return e.after_inputs_fold(n)})):t.slideUp(100,function(){return n.addClass("folded")})})},t.prototype.enable_save_with_keys_combination=function(){var e=this;return $.cmd("S",function(){return e.$("form input[type=submit]").trigger("click")},[],{ignoreCase:!0})},t.prototype.enable_form_notifications=function(){return this.$("form").formSubmitNotification()},t.prototype.after_inputs_fold=function(){},t.prototype.clear_errors=function(){return this.$(".inline-errors").remove()},t.prototype.show_errors=function(e){var t,n,r,i;i=[];for(t in e)r=e[t],_.isString(r[0])?(n=$('<div class="inline-errors"><p>'+r[0]+"</p></div>"),i.push(this.show_error(t,r[0],n))):i.push(this.show_error(t,r));return i},t.prototype.show_error=function(e,t,n){var r,i;i=this.$("#"+this.model.paramRoot+"_"+e),i.size()===0&&(i=this.$("#"+this.model.paramRoot+"_"+e+"_id"));if(i.size()>0)return r=i.parent().find(".error-anchor"),r.size()===0&&(r=i),r.after(n);return},t.prototype._enable_checkbox=function(e,t){var n,r=this;return t||(t={}),n=t.model_name||this.model.paramRoot,this.$("li#"+n+"_"+e+"_input input[type=checkbox]").checkToggle({on_callback:function(){return _.each(t.features,function(e){return this.$("li#"+n+"_"+e+"_input").hide()}),t.on_callback!=null&&t.on_callback(),r._hide_last_separator()},off_callback:function(){return _.each(t.features,function(e){return this.$("li#"+n+"_"+e+"_input").show()}),t.off_callback!=null&&t.off_callback(),r._hide_last_separator()}})},t.prototype._hide_last_separator=function(){var e=this;return _.each(this.$("fieldset"),function(e){return $(e).find("li.last").removeClass("last"),$(_.last($(e).find("li.input:visible"))).addClass("last")})},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).ContentEntries||(e.ContentEntries={}),Locomotive.Views.ContentEntries.FormView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.el="#content",t.prototype._file_field_views=[],t.prototype._has_many_field_views=[],t.prototype._many_to_many_field_views=[],t.prototype.events={submit:"save"},t.prototype.initialize=function(){return this.model||(this.model=new Locomotive.Models.ContentEntry(this.options.content_entry)),Backbone.ModelBinding.bind(this)},t.prototype.render=function(){return t.__super__.render.call(this),this.enable_checkboxes(),this.enable_datepickers(),this.enable_richtexteditor(),this.enable_file_fields(),this.enable_has_many_fields(),this.enable_many_to_many_fields(),this.slugify_label_field(),this},t.prototype.enable_checkboxes=function(){return this.$("li.input.toggle input[type=checkbox]").checkToggle()},t.prototype.enable_datepickers=function(){return this.$("li.input.date input[type=text]").datepicker()},t.prototype.enable_richtexteditor=function(){var e=this;return _.each(this.$("li.input.rte textarea.html"),function(t){var n;return n=_.extend({},e.tinyMCE_settings(),{oninit:function(n){return $.cmd("S",function(){return n.save(),$(t).trigger("changeSilently"),e.$("form").trigger("submit")},[],{ignoreCase:!0,document:n.dom.doc})},onchange_callback:function(e){return e.save(),$(t).trigger("changeSilently")}}),$(t).tinymce(n)})},t.prototype.enable_file_fields=function(){var e=this;return _.each(this.model.get("file_custom_fields"),function(t){var n;return n=new Locomotive.Views.Shared.Fields.FileView({model:e.model,name:t}),e._file_field_views.push(n),e.$("#"+e.model.paramRoot+"_"+t+"_input label").after(n.render().el)})},t.prototype.enable_has_many_fields=function(){var e=this;if(!this.model.isNew())return _.each(this.model.get("has_many_custom_fields"),function(t){var n,r,i,s;r=t[0],n=t[1],i=new Locomotive.Models.ContentEntry(e.options[""+r+"_new_entry"]),s=new Locomotive.Views.Shared.Fields.HasManyView({model:e.model,name:r,new_entry:i,inverse_of:n});if(s.ui_enabled())return e._has_many_field_views.push(s),e.$("#"+e.model.paramRoot+"_"+r+"_input label"
).after(s.render().el)})},t.prototype.enable_many_to_many_fields=function(){var e=this;return _.each(this.model.get("many_to_many_custom_fields"),function(t){var n,r;n=t[0],r=new Locomotive.Views.Shared.Fields.ManyToManyView({model:e.model,name:n,all_entries:e.options["all_"+n+"_entries"]});if(r.ui_enabled())return e._many_to_many_field_views.push(r),e.$("#"+e.model.paramRoot+"_"+n+"_input label").after(r.render().el)})},t.prototype.slugify_label_field=function(){return this.$("li.input.highlighted > input[type=text]").slugify({target:this.$("#content_entry__slug")})},t.prototype.refresh_file_fields=function(){var e=this;return _.each(this._file_field_views,function(e){return e.refresh()})},t.prototype.refresh=function(){var e=this;return this.$("li.input.toggle input[type=checkbox]").checkToggle("sync"),_.each(this._file_field_views,function(e){return e.refresh()})},t.prototype.reset=function(){var e=this;return this.$("li.input.string input[type=text], li.input.text textarea, li.input.date input[type=text]").val("").trigger("change"),_.each(this.$("li.input.rte textarea.html"),function(e){return $(e).tinymce().setContent(""),$(e).trigger("change")}),_.each(this._file_field_views,function(e){return e.reset()}),this.$("li.input.toggle input[type=checkbox]").checkToggle("sync")},t.prototype.remove=function(){var e=this;return _.each(this._file_field_views,function(e){return e.remove()}),_.each(this._has_many_field_views,function(e){return e.remove()}),_.each(this._many_to_many_field_views,function(e){return e.remove()}),t.__super__.remove.apply(this,arguments)},t.prototype.tinyMCE_settings=function(){return window.Locomotive.tinyMCE.defaultSettings},t}(Locomotive.Views.Shared.FormView)}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};(e=Locomotive.Views).ContentEntries||(e.ContentEntries={}),Locomotive.Views.ContentEntries.PopupFormView=function(e){function n(){return this.reset=t(this.reset,this),n.__super__.constructor.apply(this,arguments)}return r(n,e),n.prototype.initialize=function(){return this.create_dialog(),n.__super__.initialize.call(this)},n.prototype.render=function(){return n.__super__.render.call(this),this},n.prototype.save=function(e){var t=this;return this.save_in_ajax(e,{headers:{"X-Flash":!0},on_success:function(e,n){var r;return r=new Locomotive.Models.ContentEntry(e),t.options.parent_view.insert_or_update_entry(r),t.close()}})},n.prototype.create_dialog=function(){var e=this;return this.dialog=$(this.el).dialog({autoOpen:!1,modal:!0,zIndex:window.application_view.unique_dialog_zindex(),width:770,create:function(t,n){var r;return $(e.el).prev().find(".ui-dialog-title").html(e.$("h2").html()),e.$("h2").remove(),r=e.$(".dialog-actions").appendTo($(e.el).parent()).addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),r.find("#close-link").click(function(t){return e.close(t)}),r.find("input[type=submit]").click(function(t){return e.save(t)})},open:function(t,n,r){return $(e.el).dialog("overlayEl").bind("click",function(){return e.close()})}})},n.prototype.open=function(){var e;return e=$(this.el).parent(),this.model.isNew()?(e.find(".edit-section").hide(),e.find(".new-section").show()):(e.find(".new-section").hide(),e.find(".edit-section").show()),this.clear_errors(),$(this.el).dialog("open")},n.prototype.close=function(e){return e!=null&&e.stopPropagation()&e.preventDefault(),this.clear_errors(),$(this.el).dialog("overlayEl").unbind("click"),$(this.el).dialog("close")},n.prototype.center=function(){return $(this.el).dialog("option","position","center")},n.prototype.reset=function(e){return this.model.set(e.attributes),e.isNew()?(this.model.id=null,n.__super__.reset.call(this)):this.refresh()},n.prototype.slugify_label_field=function(){},n.prototype.enable_has_many_fields=function(){},n.prototype.enable_many_to_many_fields=function(){},n.prototype.tinyMCE_settings=function(){return window.Locomotive.tinyMCE.popupSettings},n}(Locomotive.Views.ContentEntries.FormView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).ContentEntries||(e.ContentEntries={}),Locomotive.Views.ContentEntries.EditView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.save=function(e){var t=this;return this.save_in_ajax(e,{on_success:function(e,n){return t.model.update_attributes(e),t.refresh_file_fields()}})},t}(Locomotive.Views.ContentEntries.FormView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).ContentEntries||(e.ContentEntries={}),Locomotive.Views.ContentEntries.IndexView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.el="#content",t.prototype.render=function(){return this.make_sortable(),this},t.prototype.make_sortable=function(){var e;return e=this,this.$("ul#entries-list.sortable").sortable({handle:"span.handle",items:"li.item",axis:"y",update:function(t,n){return e.call_sort($(this))}})},t.prototype.call_sort=function(e){return $.rails.ajax({url:e.attr("data-url"),type:"post",dataType:"json",data:{entries:_.map(e.sortable("toArray"),function(e){return e.replace("entry-","")}),_method:"put"},success:this.on_successful_sort,error:this.on_failed_sort})},t.prototype.on_successful_sort=function(e,t,n){return $.growl("success",n.getResponseHeader("X-Message"))},t.prototype.on_failed_sort=function(e,t,n){return $.growl("error",n.getResponseHeader("X-Message"))},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).ContentEntries||(e.ContentEntries={}),Locomotive.Views.ContentEntries.NewView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.save=function(e){return this.save_in_ajax(e,{on_success:function(e,t){return window.location.href=t.getResponseHeader("location")}})},t}(Locomotive.Views.ContentEntries.FormView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).ContentTypes||(e.ContentTypes={}),Locomotive.Views.ContentTypes.FormView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.el="#content",t.prototype.events={submit:"save"},t.prototype.initialize=function(){return this.model=new Locomotive.Models.ContentType(this.options.content_type),Backbone.ModelBinding.bind(this)},t.prototype.render=function(){return t.__super__.render.call(this),this.render_custom_fields(),this.slugify_name(),this.enable_liquid_editing(),this.enable_public_submission_checkbox(),this.enable_order_by_toggler(),this},t.prototype.render_custom_fields=function(){return this.custom_fields_view=new Locomotive.Views.ContentTypes.CustomFieldsView({model:this.model,inverse_of_list:this.options.inverse_of_list}),this.$("#custom_fields_input").append(this.custom_fields_view.render().el)},t.prototype.slugify_name=function(){return this.$("#content_type_name").slugify({target:this.$("#content_type_slug"),sep:"_"})},t.prototype.enable_liquid_editing=function(){var e,t=this;return e=this.$("#content_type_raw_item_template"),this.editor=CodeMirror.fromTextArea(e.get()[0],{mode:"liquid",autoMatchParens:!1,lineNumbers:!1,passDelay:50,tabMode:"shift",theme:"default medium",onChange:function(e){return t.model.set({raw_item_template:e.getValue()})}})},t.prototype.enable_public_submission_checkbox=function(){var e=this;return this._enable_checkbox("public_submission_enabled",{on_callback:function(){return e.$("#content_type_public_submission_accounts_input").show()},off_callback:function(){return e.$("#content_type_public_submission_accounts_input").hide()}})},t.prototype.enable_order_by_toggler=function(){var e=this;return this.$("#content_type_order_by_input").bind("change",function(t){var n;return n=e.$("#content_type_order_direction_input"),$(t.target).val()==="_position"?n.hide():n.show()})},t.prototype.show_error=function(e,n,r){var i=this;if(e!=="entries_custom_fields")return t.__super__.show_error.apply(this,arguments);if(_.isEmpty(n))return;return _.each(_.keys(n),function(e){var t,s;s=n[e];if(e==="base")return r=$('<div class="inline-errors"><p>'+s[0]+"</p></div>"),i.$("#custom_fields_input .list").after(r);t=i.custom_fields_view.find_entry_view(e);if(t!=null)return t.show_error(s[0])})},t.prototype.remove=function(){return this.custom_fields_view.remove(),t.__super__.remove.apply(this,arguments)},t}(Locomotive.Views.Shared.FormView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).ContentTypes||(e.ContentTypes={}),Locomotive.Views.ContentTypes.CustomFieldEntryView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.tagName="li",t.prototype.className="custom-field",t.prototype.events={"click a.toggle":"toggle","click a.remove":"remove"},t.prototype.initialize=function(){var e=this;return this.inverse_of_list=this.options.parent_view.options.inverse_of_list,this.model.bind("change",function(t){e.model.hasChanged("type")&&e.switch_to_type();if(e.model.hasChanged("class_name")&&e.model.get("class_name")!=null)return e.fetch_inverse_of_list()})},t.prototype.render=function(){return $(this.el).html(ich.custom_field_entry(this.model.toJSON())),this.model.isNew()||this.fetch_inverse_of_list(),Backbone.ModelBinding.bind(this,{all:"class"}),this.make_fields_editable(),this.enable_behaviours(),this.switch_to_type(),this},t.prototype.enable_behaviours=function(){var e;return e=this.$(".required-input input[type=checkbox]"),e.checkToggle({on_label:e.attr("data-on-label"),off_label:e.attr("data-off-label")}),this.$("li.input.toggle input[type=checkbox]").checkToggle(),this.render_select_options_view()},t.prototype.switch_to_type=function(){this.$("li.input.extra").hide();switch(this.model.get("type")){case"select":return this.$("li.input.select-options").show();case"text":return this.$("li.input.text-formatting").show();case"belongs_to":return this.$("li.input.localized").hide(),this.$("li.input.class-name").show();case"has_many":case"many_to_many":return this.$("li.input.localized").hide(),this.$("li.input.class-name").show(),this.$("li.input.inverse-of").show(),this.$("li.input.ui-enabled").show()}},t.prototype.fetch_inverse_of_list=function(){var e,t=this;this.$("li.input.inverse-of select option").remove(),e=this.inverse_of_list[this.model.get("type")]||[],_.each(e,function(n){var r;if(n.class_name===t.model.get("class_name"))return r=new Option(n.label,n.name,n.name===t.model.get("inverse_of")||e.length===1),t.$("li.input.inverse-of select").append(r)});if(this.model.get("inverse_of")==null&&e.length>0)return this.model.set({inverse_of:e[0].name})},t.prototype.render_select_options_view=function(){return this.select_options_view=new Locomotive.Views.ContentTypes.SelectOptionsView({model:this.model,collection:this.model.get("select_options")}),this.$("#content_type_contents_custom_field_select_options_input").append(this.select_options_view.render().el)},t.prototype.make_fields_editable=function(){return this.$(".label-input input[type=text], .type-input select").editableField()},t.prototype.toggle=function(e){var t;return e.stopPropagation()&e.preventDefault(),t=this.$("ol"),t.is(":hidden")?(this.$("a.toggle").addClass("open"),t.slideDown()):(this.$("a.toggle").removeClass("open"),t.slideUp())},t.prototype.show_error=function(e){var t;return t=$('<span class="inline-errors">'+e+"</span>"),this.$(".required-input").after(t)},t.prototype.remove=function(e){e.stopPropagation()&e.preventDefault();if(confirm($(e.target).attr("data-confirm")))return this.$(".label-input input[type=text], .type-input select").editableField("destroy"),t.__super__.remove.call(this),this.options.parent_view.remove_entry(this.model,this)},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).ContentTypes||(e.ContentTypes={}),Locomotive.Views.ContentTypes.CustomFieldsView=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}var t;return n(r,e),r.prototype.tagName="div",r.prototype.className="list",t=[],r.prototype.events={"click .new-entry a.add":"add_entry","keypress .new-entry input[type=text]":"add_on_entry_from_enter"},r.prototype.initialize=function(){return _.bindAll(this,"refresh_position_entries")},r.prototype.render=function(){return $(this.el).html(ich.custom_fields_list(this.model.toJSON())),this.render_entries(),this.make_list_sortable(),this},r.prototype.make_list_sortable=function(){return this.sortable_list=this.$("> ul").sortable({handle:".handle",items:"li.custom-field",axis:"y",update:this.refresh_position_entries})},r.prototype.refresh_position_entries=function(){return _.each(this._entry_views,function(e){return e.model.set({position:$(e.el).index()})})},r.prototype.find_entry_view=function(e){return _.find(this._entry_views,function(t){return e.length>3?t.model.id===e:t.model.get("position")===parseInt(e)})},r.prototype.add_entry=function(e){var t,n,r;e.stopPropagation()&e.preventDefault(),n=this.$("> .new-entry input[name=label]"),r=this.$("> .new-entry select");if(n.val()!=="")return t=new Locomotive.Models.CustomField({label:n.val(),type:r.val()}),this.model.get("entries_custom_fields").add(t),this._insert_entry(t),this.$("> .empty").hide(),this.sortable_list.sortable("refresh"),n.val("")},r.prototype.add_on_entry_from_enter=function(e){if(e.keyCode!==13)return;return this.add_entry(e)},r.prototype.remove_entry=function(e,t){e.isNew()?this.model.get("entries_custom_fields").remove(e):e.set({_destroy:!0}),this._entry_views=_.reject(this._entry_views,function(e){return e===t}),this.refresh_position_entries();if(this._entry_views.length===0)return this.$("> .empty").show()},r.prototype.render_entries=function(){var e=this;return this.model.get("entries_custom_fields").length===0?this.$("> .empty").show():this.model.get("entries_custom_fields").each(function(t){return e._insert_entry(t)})},r.prototype._insert_entry=function(e){var t;return t=new Locomotive.Views.ContentTypes.CustomFieldEntryView({model:e,parent_view:this}),(this._entry_views||(this._entry_views=[])).push(t),this.$("> ul").append(t.render().el),this.refresh_position_entries()},r}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).ContentTypes||(e.ContentTypes={}),Locomotive.Views.ContentTypes.EditView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.save=function(e){var t=this;return this.save_in_ajax(e,{on_success:function(e,n){return _.each(e.entries_custom_fields,function(e){var n;n=t.model.get("entries_custom_fields").detect(function(t){return t.get("name")===e.name});if(n.isNew())return n.set({id:e._id,_id:e._id})})}})},t}(Locomotive.Views.ContentTypes.FormView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).ContentTypes||(e.ContentTypes={}),Locomotive.Views.ContentTypes.NewView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.save=function(e){return this.save_in_ajax(e,{on_success:function(e,t){return window.location.href=t.getResponseHeader("location")}})},t.prototype.enable_liquid_editing=function(){return!0},t}(Locomotive.Views.ContentTypes.FormView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).ContentTypes||(e.ContentTypes={}),Locomotive.Views.ContentTypes.SelectOptionsView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.tagName="div",t.prototype.className="list",t.prototype.events={"click a.add":"add_entry","click span.name":"edit_entry","click a.remove":"remove_entry"},t.prototype.initialize=function(){return _.bindAll(this,"refresh_position_entries","_insert_entry"),this.collection.bind("add",this._insert_entry)},t.prototype.render=function(){return $(this.el).html(ich.select_options_list()),this.prompt_message=this.$("> ul").attr("data-prompt"),this.render_entries(),this.make_list_sortable(),this},t.prototype.render_entries=function(){return this.collection.each(this._insert_entry)},t.prototype.make_list_sortable=function(){return this.sortable_list=this.$("> ul").sortable({handle:"a.drag",items:"li.entry",update:this.refresh_position_entries})},t.prototype.refresh_position_entries=function(){var e=this;return this.$("> ul li.entry").each(function(t,n){var r;return r=e.collection.getByCid($(n).attr("data-cid")),r.set({position:t})})},t.prototype.add_entry=function(e){var t;e.stopPropagation()&e.preventDefault(),t=prompt(this.prompt_message);if(t!=="")return this.collection.add([{name:t}])},t.prototype.edit_entry=function(e){var t,n,r,i;e.stopPropagation()&e.preventDefault(),r=$(e.target),i=r.closest("li"),n=this.collection.getByCid(i.attr("data-cid"));if((t=prompt(this.prompt_message,n.get("name")))!=="")return n.set({name:t}),r.html(t)},t.prototype.remove_entry=function(e){var t,n,r;e.stopPropagation()&e.preventDefault(),t=$(e.target),r=t.closest("li"),n=this.collection.getByCid(r.attr("data-cid"));if(confirm(t.attr("date-confirm")))return n.isNew()?this.collection.remove(n):n.set({_destroy:!0}),r.remove()},t.prototype._insert_entry=function(e){var t;return t=ich.select_option_entry(e.toJSON()),t.attr("data-cid",e.cid),this.$("> ul").append(t),this.refresh_position_entries},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).Sites||(e.Sites={}),Locomotive.Views.Sites.DomainsView=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}var t;return n(r,e),r.prototype.tagName="div",r.prototype.className="list",t=[],r.prototype.events={"click .new-entry a.add":"add_entry","keypress .new-entry input[type=text]":"add_on_entry_from_enter"},r.prototype.render=function(){return $(this.el).html(ich.domains_list(this.model.toJSON())),this.render_entries(),this.enable_ui_effects(),this},r.prototype.add_entry=function(e){var t,n;e.stopPropagation()&e.preventDefault(),n=this.$(".new-entry input[name=domain]");if(n.val()!=="")return t=new Locomotive.Models.Domain({name:n.val()}),this.model.get("domains").push(t),this._insert_entry(t),this.$("ul li.domain:last input[type=text]").editableField(),this.$(".empty").hide(),n.val("")},r.prototype.add_on_entry_from_enter=function(e){if(e.keyCode!==13)return;return this.add_entry(e)},r.prototype.change_entry=function(e,t){return e.set({name:t})},r.prototype.remove_entry=function(e){var t,n=this;t=_.reject(this.model.get("domains"),function(t){return t===e}),this.model.set({domains:t});if(this.model.get("domains").length===0)return this.$(".empty").show()},r.prototype.render_entries=function(){var e=this;return this.model.get("domains").length===0?this.$(".empty").show():(_.each(this.model.get("domains"),function(t){return e._insert_entry(t)}),this.show_errors())},r.prototype.show_errors=function(){var e=this;return _.each(this.options.errors.domain||[],function(t){return e.show_error(t)})},r.prototype.show_error=function(e){return _.each(this._entry_views||[],function(t){var n;if((new RegExp("^"+t.model.get("name"))).test(e))return n=$("<span></span>").addClass("inline-errors").html(e),t.$("input[type=text].path").after(n)})},r.prototype.enable_ui_effects=function(){return this.$(".domain input[type=text]").editableField()},r.prototype._insert_entry=function(e){var t;return t=new Locomotive.Views.Sites.DomainEntryView({model:e,parent_view:this}),(this._entry_views||(this._entry_views=[])).push(t),this.$("ul").append(t.render().el)},r}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).CurrentSite||(e.CurrentSite={}),Locomotive.Views.CurrentSite.EditView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.el="#content",t.prototype.events={submit:"save"},t.prototype.initialize=function(){return this.model=new Locomotive.Models.CurrentSite(this.options.site),Backbone.ModelBinding.bind(this,{checkbox:"class"})},t.prototype.render=function(){return t.__super__.render.call(this),this.add_toggle_mode_for_locales(),this.make_locales_sortable(),this.render_domains(),this.render_memberships(),this.enable_liquid_editing()},t.prototype.add_toggle_mode_for_locales=function(){return this.$("#site_locales_input .list input[type=checkbox]").bind("change",function(e){var t;return t=$(e.target),t.is(":checked")?t.closest(".entry").addClass("selected"):t.closest(".entry").removeClass("selected")})},t.prototype.make_locales_sortable=function(){var e=this;return this.sortable_locales_list=this.$("#site_locales_input .list").sortable({items:".entry",tolerance:"pointer",update:function(){var t;return t=_.map(e.$("#site_locales_input .list input:checked"),function(e){return $(e).val()}),e.model.set({locales:t})}})},t.prototype.render_domains=function(){return this.domains_view=new Locomotive.Views.Sites.DomainsView({model:this.model,errors:this.options.errors}),this.$("#site_domains_input label").after(this.domains_view.render().el)},t.prototype.render_memberships=function(){return this.memberships_view=new Locomotive.Views.Sites.MembershipsView({model:this.model}),this.$("#site_memberships_input").append(this.memberships_view.render().el)},t.prototype.enable_liquid_editing=function(){var e,t=this;if($("#site_robots_txt").length)return e=this.$("#site_robots_txt"),this.editor=CodeMirror.fromTextArea(e.get()[0],{mode:"liquid",autoMatchParens:!1,lineNumbers:!1,passDelay:50,tabMode:"shift",theme:"default",onChange:function(e){return t.model.set({robots_txt:e.getValue()})}})},t.prototype.save=function(e){if(this.model.includes_domain(window.location.host))return this.save_in_ajax(e)},t.prototype.show_error=function(e,n,r){return e==="domains"?this.domains_view.show_error(n):t.__super__.show_error.apply(this,arguments)},t.prototype.remove=function(){return this.domains_view.remove(),this.memberships_view.remove(),t.__super__.remove.apply(this,arguments)},t}(Locomotive.Views.Shared.FormView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).EditableElements||(e.EditableElements={}),Locomotive.Views.EditableElements.ControlView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.tagName="li",t.prototype.className="control input",t.prototype.render=function(){return $(this.el).html(ich.editable_control_input(this.model.toJSON())),this.bind_model(),this},t.prototype.after_render=function(){},t.prototype.refresh=function(){return this.bind_model()},t.prototype.bind_model=function(){return Backbone.ModelBinding.bind(this,{select:"class"})},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).EditableElements||(e.EditableElements={}),Locomotive.Views.EditableElements.EditAllView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.id="editable-elements",t.prototype.tagName="div",t.prototype._editable_elements_views=[],t.prototype.render=function(){return window.bar=this,this.collection.isEmpty()?$(this.el).hide():(this.blocks=this.collection.blocks(),$(this.el).html(ich.editable_elements_edit({blocks:this.blocks})),this.render_elements(),this.enable_nav()),this},t.prototype.after_render=function(){var e=this;return _.each(this._editable_elements_views,function(e){return e.after_render()})},t.prototype.refresh=function(){var e=this;return _.each(this._editable_elements_views,function(t){return t.model=e.collection.get(t.model.get("id")),t.refresh()})},t.prototype.unbind_model=function(){var e=this;return _.each(this._editable_elements_views,function(e){return Backbone.ModelBinding.unbind(e)})},t.prototype.render_elements=function(){var e,t=this;return e=0,_.each(this.blocks,function(n){var r;return r=t.collection.by_block(n.name),_.each(r,function(r){var i,s;return r.set({index:e}),s=function(){switch(r.get("type")){case"EditableShortText":return Locomotive.Views.EditableElements.ShortTextView;case"EditableLongText":return Locomotive.Views.EditableElements.LongTextView;case"EditableFile":return Locomotive.Views.EditableElements.FileView;case"EditableControl":return Locomotive.Views.EditableElements.ControlView}}(),i=new s({model:r}),t.$("#block-"+n.index+" > fieldset > ol").append(i.render().el),t._editable_elements_views.push(i),e+=1})})},t.prototype.enable_nav=function(){var e=this;return this.$(".nav a").click(function(t){var n,r;return t.stopPropagation()&t.preventDefault(),r=$(t.target),n=parseInt(r.attr("href").match(/block-(.+)/)[1]),e.$(".wrapper ul li.block").hide(),e.$("#block-"+n).show(),e._hide_last_separator(),r.parent().find(".on").removeClass("on"),r.addClass("on")})},t.prototype._hide_last_separator=function(){var e=this;return _.each(this.$("fieldset"),function(e){return $(e).find("li.last").removeClass("last"),$(_.last($(e).find("li.input:visible"))).addClass("last")})},t.prototype.remove=function(){var e=this;return _.each(this._editable_elements_views,function(e){return e.remove()}),this._editable_elements_views.length=0,t.__super__.remove.apply(this,arguments)},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).EditableElements||(e.EditableElements={}),Locomotive.Views.EditableElements.FileView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.tagName="li",t.prototype.className="file input",t.prototype.states={change:!1,"delete":!1},t.prototype.events={"click a.change":"toggle_change","click a.delete":"toggle_delete"},t.prototype.render=function(){var e=this;return $(this.el).html(ich.editable_file_input(this.model.toJSON())),this.$("input[type=file]").bind("change",function(t){var n;n=$(t.target)[0];if(n.files!=null)return e.model.set({source:n.files[0]})}),this},t.prototype.after_render=function(){},t.prototype.refresh=function(){return this.$("input[type=file]").unbind("change"),this.states={change:!1,"delete":!1},this.render()},t.prototype.toggle_change=function(e){var t=this;return this._toggle(e,"change",{on_change:function(){return t.$("a:first").hide()&t.$("input[type=file]").show()&t.$("a.delete").hide()},on_cancel:function(){return t.model.set({source:null}),t.$("a:first").show()&t.$("input[type=file]").val("").hide()&t.$("a.delete").show()}})},t.prototype.toggle_delete=function(e){var t=this;return this._toggle(e,"delete",{on_change:function(){return t.$("a:first").addClass("deleted")&t.$("a.change").hide(),t.$("input[type=hidden].remove-flag").val("1"),t.model.set({remove_source:!0})},on_cancel:function(){return t.$("a:first").removeClass("deleted")&t.$("a.change").show(),t.$("input[type=hidden].remove-flag").val("0"),t.model.set({remove_source:!1})}})},t.prototype._toggle=function(e,t,n){var r,i;return e.stopPropagation()&e.preventDefault(),r=$(e.target),i=r.attr("data-alt-label"),this.states[t]?n.on_cancel():n.on_change(),r.attr("data-alt-label",r.html()),r.html(i),this.states[t]=!this.states[t]},t.prototype.remove=function(){return this.$("input[type=file]").unbind("change"),t.__super__.remove.apply(this,arguments)},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).EditableElements||(e.EditableElements={}),Locomotive.Views.EditableElements.ShortTextView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.tagName="li",t.prototype.className="text input short",t.prototype.render=function(){var e=this;return $(this.el).html(ich.editable_text_input(this.model.toJSON())),this.$("textarea").bind("keyup",function(t){var n;return n=$(t.target),e.model.set({content:n.val()})}),this},t.prototype.after_render=function(){},t.prototype.refresh=function(){},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).EditableElements||(e.EditableElements={}),Locomotive.Views.EditableElements.LongTextView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.tagName="li",t.prototype.className="text input html",t.prototype.render=function(){return $(this.el).html(ich.editable_text_input(this.model.toJSON())),this},t.prototype.after_render=function(){var e,t=this;return e=_.extend({},this.tinymce_settings(),{oninit:function(e){return $.cmd("S",function(){return t.model.set({content:e.getBody().innerHTML}),$(t.el).parents("form").trigger("submit")},[],{ignoreCase:!0,document:e.dom.doc})},onchange_callback:function(e){return t.model.set({content:e.getBody().innerHTML})}}),this.$("textarea").tinymce(e)},t.prototype.tinymce_settings=function(){return window.Locomotive.tinyMCE.defaultSettings},t.prototype.refresh=function(){},t.prototype.remove=function(){return this.$("textarea").tinymce().destroy(),t.__super__.remove.apply(this,arguments)},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).InlineEditor||(e.InlineEditor={}),Locomotive.Views.InlineEditor.ApplicationView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.el="body",t.prototype.initialize=function(){return t.__super__.initialize.apply(this,arguments),this.iframe=this.$("#page iframe"),_.bindAll(this,"_$"),this.toolbar_view=new Locomotive.Views.InlineEditor.ToolbarView({target:this.iframe}),this.content_assets_picker_view=new Locomotive.Views.ContentAssets.PickerView({collection:new Locomotive.Models.ContentAssetsCollection})},t.prototype.render=function(){return t.__super__.render.apply(this,arguments),this.enable_iframe_autoheight(),this.toolbar_view.render(),this.content_assets_picker_view.render()},t.prototype.enable_iframe_autoheight=function(){var e,t=this;return e=this.iframe,e.load(function(){var n;return t._$("meta[name=inline-editor]").size()>0?(n=e.contents(),n.resize(function(){var t;t=$(this);if(t.outerHeight(!0)>e.outerHeight(!0))return e
.css({height:t.outerHeight(!0)})}),n.resize()):(t.toolbar_view.show_status("disabled",!0).hide_editing_mode_block(),t.enhance_iframe_links())})},t.prototype.set_page=function(e){return this.page=new Locomotive.Models.Page(e),this.toolbar_view.model=this.page,this.enhance_iframe(),this.toolbar_view.refresh()},t.prototype.enhance_iframe=function(){var e,t=this;return e=this.iframe[0].contentWindow,e.Aloha.settings.locale=window.locale,window.document.title=e.document.title,this.enhance_iframe_links(e.Aloha.jQuery),e.Aloha.bind("aloha-editable-deactivated",function(e,n){return t.toolbar_view.notify(n.editable)})},t.prototype.enhance_iframe_links=function(e){var t;return t=this.toolbar_view,e||(e=this._$),e("a").each(function(){var n,r;n=e(this),r=n.attr("href");if(r!=null&&r.indexOf("#")!==0&&/^(www|http)/.exec(r)===null&&/(\/_edit)$/.exec(r)===null&&/^\/sites\//.exec(r)===null)return r==="/"&&(r="/index"),r.indexOf("_edit")>0||(r.indexOf("?")>0?n.attr("href",r.replace("?","/_edit?")):n.attr("href",""+r+"/_edit")),n.bind("click",function(){return t.show_status("loading"),window.history.pushState("Object","Title",n.attr("href").replace("_edit","_admin"))})})},t.prototype.unique_dialog_zindex=function(){var e;return(e=window.Locomotive).jQueryModals||(e.jQueryModals=0),1050+window.Locomotive.jQueryModals++},t.prototype._$=function(e){return $(e,this.iframe[0].contentWindow.document)},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).InlineEditor||(e.InlineEditor={}),Locomotive.Views.InlineEditor.ToolbarView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.el="#toolbar .inner",t.prototype.events={"change .editing-mode input[type=checkbox]":"toggle_editing_mode","click  .back a":"back","click  .element-actions a.save":"save_changes","click  .element-actions a.cancel":"cancel_changes"},t.prototype.render=function(){return t.__super__.render.apply(this,arguments),this.enable_editing_mode_checkbox(),this.enable_content_locale_picker(),this},t.prototype.notify=function(e){var t;return window.bar=e,t=e.obj.attr("data-element-id"),this.model.get("editable_elements").get(t).set({content:e.getContents()}),this.$(".element-actions").show(),this.hide_editing_mode_block()},t.prototype.show_status=function(e,t){var n;return t||(t=!1),n=this.$("h1").attr("data-"+e+"-status"),this.$("h1").html(n).removeClass().addClass(e),t&&$.growl("error",n),this},t.prototype.save_changes=function(e){var t,n=this;return e.stopPropagation()&e.preventDefault(),t=_.clone(this.model.attributes),this.model.save({},{success:function(e,r,i){return e.attributes=t,n.$(".element-actions").hide(),n.show_editing_mode_block()},error:function(e,t){return n.$(".element-actions").hide()}})},t.prototype.cancel_changes=function(e){return e.stopPropagation()&e.preventDefault(),this.options.target[0].contentWindow.location.href=this.options.target[0].contentWindow.location.href},t.prototype.back=function(e){return e.stopPropagation()&e.preventDefault(),this.model?window.location.href=this.model.get("edit_url"):window.location.href=window.Locomotive.mounted_on+"/pages"},t.prototype.show_editing_mode_block=function(){return this.$(".editing-mode").show()},t.prototype.hide_editing_mode_block=function(){return this.$(".editing-mode").hide()},t.prototype.toggle_editing_mode=function(e){if(this.editable_elements()===null)return;return $(e.target).is(":checked")?this.editable_elements().aloha():this.editable_elements().removeClass("aloha-editable-highlight").mahalo()},t.prototype.editable_elements=function(){return this.options.target[0].contentWindow.Aloha?this.options.target[0].contentWindow.Aloha.jQuery(".editable-long-text, .editable-short-text"):null},t.prototype.enable_editing_mode_checkbox=function(){return this.$(".editing-mode input[type=checkbox]").checkToggle({on_label_color:"#fff",off_label_color:"#bbb"})},t.prototype.enable_content_locale_picker=function(){var e,t,n,r=this;n=this.options.target[0].contentWindow,e=this.$("#content-locale-picker-link"),t=$("#content-locale-picker");if(t.size()===0)return;return e.bind("click",function(e){return e.stopPropagation()&e.preventDefault(),t.toggle()}),t.find("li").bind("click",function(i){var s,o;return s=r.get_locale_attributes(e),o=r.get_locale_attributes($(i.target).closest("li")),r.set_locale_attributes(e,o),r.set_locale_attributes($(i.target).closest("li"),s),t.toggle(),window.content_locale=o[1],n.location.href="/"+r.model.get("localized_fullpaths")[o[1]]+"/_edit"})},t.prototype.get_locale_attributes=function(e){return[e.find("img").attr("src"),e.find("span.text").html()]},t.prototype.set_locale_attributes=function(e,t){return e.find("img").attr("src",t[0]),e.find("span.text").html(t[1])},t.prototype.refresh=function(){return this.$("h1").html(this.model.get("title")).removeClass(),this.$(".editing-mode input[type=checkbox]").is(":checked")&&this.$(".editing-mode div.switchArea").trigger("click"),this.$(".element-actions").hide(),this.show_editing_mode_block()},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).MyAccount||(e.MyAccount={}),Locomotive.Views.MyAccount.EditView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.el="#content",t.prototype.events={submit:"save"},t.prototype.initialize=function(){return this.model=new Locomotive.Models.CurrentAccount(this.options.account),Backbone.ModelBinding.bind(this)},t.prototype.render=function(){return t.__super__.render.call(this)},t.prototype.save=function(e){if(this.model.get("locale")===window.locale)return this.save_in_ajax(e)},t}(Locomotive.Views.Shared.FormView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).Pages||(e.Pages={}),Locomotive.Views.Pages.FormView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.el="#content",t.prototype.events={"change   #page_parent_id":"change_page_url","click    a#image-picker-link":"open_image_picker",submit:"save"},t.prototype.initialize=function(){return _.bindAll(this,"insert_image"),this.model=new Locomotive.Models.Page(this.options.page),this.touched_url=!1,this.image_picker_view=new Locomotive.Views.ThemeAssets.ImagePickerView({collection:new Locomotive.Models.ThemeAssetsCollection,on_select:this.insert_image}),this.image_picker_view.render(),Backbone.ModelBinding.bind(this),this.editable_elements_view=new Locomotive.Views.EditableElements.EditAllView({collection:this.model.get("editable_elements")})},t.prototype.render=function(){return t.__super__.render.call(this),this.slugify_title(),this.listen_for_url_changes(),this.enable_response_type_select(),this.enable_templatized_checkbox(),this.enable_redirect_checkbox(),this.enable_other_checkboxes(),this.enable_liquid_editing(),this.render_editable_elements(),this},t.prototype.open_image_picker=function(e){return e.stopPropagation()&e.preventDefault(),this.image_picker_view.editor=this.editor,this.image_picker_view.fetch_assets()},t.prototype.insert_image=function(e){var t;return t="{{ '"+e+"' | theme_image_url }}",this.editor.replaceSelection(t),this.image_picker_view.close()},t.prototype.enable_liquid_editing=function(){var e,t=this;e=this.$("#page_raw_template");if(e.size()>0)return this.editor=CodeMirror.fromTextArea(e.get()[0],{mode:"liquid",autoMatchParens:!1,lineNumbers:!1,passDelay:50,tabMode:"shift",theme:"default",onChange:function(e){return t.model.set({raw_template:e.getValue()})}})},t.prototype.after_inputs_fold=function(){return this.editor.refresh()},t.prototype.render_editable_elements=function(){return this.$(".formtastic fieldset.inputs:first").before(this.editable_elements_view.render().el),this.editable_elements_view.after_render()},t.prototype.reset_editable_elements=function(){return this.editable_elements_view.remove(),this.editable_elements_view.collection=this.model.get("editable_elements"),this.render_editable_elements()},t.prototype.refresh_editable_elements=function(){return this.editable_elements_view.unbind_model(),this.editable_elements_view.collection=this.model.get("editable_elements"),this.editable_elements_view.refresh()},t.prototype.slugify_title=function(){var e=this;return this.$("#page_title").slugify({target:this.$("#page_slug")}),this.$("#page_slug").bind("change",function(t){return e.touched_url=!0})},t.prototype.listen_for_url_changes=function(){var e=this;return setInterval(function(){if(e.touched_url)return e.change_page_url()&(e.touched_url=!1)},2e3)},t.prototype.change_page_url=function(){var e=this;return $.rails.ajax({url:this.$("#page_slug").attr("data-url"),type:"get",dataType:"json",data:{parent_id:this.$("#page_parent_id").val(),slug:this.$("#page_slug").val()},success:function(t){e.$("#page_slug_input .inline-hints").html(t.url).effect("highlight");if(t.templatized_parent)return e.$("li#page_slug_input").show(),e.$("li#page_templatized_input, li#page_target_klass_name_input").hide();if(!e.model.get("redirect"))return e.$("li#page_templatized_input").show()}})},t.prototype.enable_response_type_select=function(){var e=this;return this.$("li#page_response_type_input").change(function(t){return $(t.target).val()==="text/html"?e.$("li#page_redirect_input, li#page_redirect_url_input").show():(e.model.set({redirect:!1}),e.$("li#page_redirect_input, li#page_redirect_url_input").hide())})},t.prototype.enable_templatized_checkbox=function(){var e=this;this._enable_checkbox("templatized",{features:["slug","redirect","listed"],on_callback:function(){return e.$("li#page_target_klass_name_input").show()},off_callback:function(){return e.$("li#page_target_klass_name_input").hide()}});if(this.model.get("templatized_from_parent")===!0)return this.$("li#page_templatized_input").hide()},t.prototype.enable_redirect_checkbox=function(){var e=this;return this._enable_checkbox("redirect",{features:["templatized","cache_strategy"],on_callback:function(){return e.$("li#page_redirect_url_input").show()},off_callback:function(){return e.$("li#page_redirect_url_input").hide()}})},t.prototype.enable_other_checkboxes=function(){var e=this;return _.each(["published","listed"],function(t){return e.$("li#page_"+t+"_input input[type=checkbox]").checkToggle()})},t}(Locomotive.Views.Shared.FormView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).Pages||(e.Pages={}),Locomotive.Views.Pages.EditView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.save=function(e){var t,n=this;return e.stopPropagation()&e.preventDefault(),t=$(e.target).trigger("ajax:beforeSend"),this.clear_errors(),this.model.save({},{success:function(e,r,i){return t.trigger("ajax:complete"),e._normalize(),e.get("template_changed")===!0?n.reset_editable_elements():n.refresh_editable_elements()},error:function(e,r){var i;return t.trigger("ajax:complete"),i=JSON.parse(r.responseText),n.show_errors(i)}})},t}(Locomotive.Views.Pages.FormView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).Pages||(e.Pages={}),Locomotive.Views.Pages.IndexView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.el="#content",t.prototype.render=function(){return this.index_view=new Locomotive.Views.Pages.ListView,this.index_view.render(),this},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).Pages||(e.Pages={}),Locomotive.Views.Pages.ListView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.el="#pages-list",t.prototype.render=function(){return this.make_foldable(),this.make_sortable(),this},t.prototype.make_foldable=function(){return this.$("ul.folder img.toggler").toggleMe()},t.prototype.make_sortable=function(){var e;return e=this,this.$("ul.folder").sortable({handle:"em",axis:"y",update:function(t,n){return e.call_sort($(this))}})},t.prototype.call_sort=function(e){return $.rails.ajax({url:e.attr("data-url"),type:"post",dataType:"json",data:{children:_.map(e.sortable("toArray"),function(e){return e.replace("item-","")}),_method:"put"},success:this.on_successful_sort,error:this.on_failed_sort})},t.prototype.on_successful_sort=function(e,t,n){return $.growl("success",n.getResponseHeader("X-Message"))},t.prototype.on_failed_sort=function(e,t,n){return $.growl("error",n.getResponseHeader("X-Message"))},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).Pages||(e.Pages={}),Locomotive.Views.Pages.NewView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.save=function(e){return this.save_in_ajax(e,{on_success:function(e,t){return window.location.href=t.getResponseHeader("location")}})},t}(Locomotive.Views.Pages.FormView)}.call(this),function(){var e,t,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};(e=Locomotive.Views).Shared||(e.Shared={}),(t=Locomotive.Views.Shared).Fields||(t.Fields={}),Locomotive.Views.Shared.Fields.FileView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return r(t,e),t.prototype.tagName="span",t.prototype.className="file",t.prototype.states={change:!1,"delete":!1},t.prototype.events={"click a.change":"toggle_change","click a.delete":"toggle_delete"},t.prototype.template=function(){return ich[""+this.options.name+"_file_input"]},t.prototype.render=function(){var e,t,n=this;return t=this.model.get(""+this.options.name+"_url")||"",e={filename:t.split("/").pop(),url:t},$(this.el).html(this.template()(e)),this.$("input[type=file]").bind("change",function(e){var t,r,i;r=$(e.target)[0];if(r.files!=null)return i=$(r).attr("name"),t={},t[i.replace(""+n.model.paramRoot+"[","").replace(/]$/,"")]=r.files[0],n.model.set(t)}),this},t.prototype.refresh=function(){return this.$("input[type=file]").unbind("change"),this.states={change:!1,"delete":!1},this.render()},t.prototype.reset=function(){return this.model.set_attribute(this.options.name,null),this.model.set_attribute(""+this.options.name+"_url",null),this.refresh()},t.prototype.toggle_change=function(e){var t=this;return this._toggle(e,"change",{on_change:function(){return t.$("a:first").hide()&t.$("input[type=file]").show()&t.$("a.delete").hide()},on_cancel:function(){return t.$("a:first").show()&t.$("input[type=file]").hide()&t.$("a.delete").show()}})},t.prototype.toggle_delete=function(e){var t=this;return this._toggle(e,"delete",{on_change:function(){return t.$("a:first").addClass("deleted")&t.$("a.change").hide(),t.$("input[type=hidden].remove-flag").val("1"),t.model.set_attribute("remove_"+t.options.name,!0)},on_cancel:function(){return t.$("a:first").removeClass("deleted")&t.$("a.change").show(),t.$("input[type=hidden].remove-flag").val("0"),t.model.set_attribute("remove_"+t.options.name,!1)}})},t.prototype._toggle=function(e,t,n){var r,i;return e.stopPropagation()&e.preventDefault(),r=$(e.target),i=r.attr("data-alt-label"),this.states[t]?n.on_cancel():n.on_change(),r.attr("data-alt-label",r.html()),r.html(i),this.states[t]=!this.states[t]},t.prototype.remove=function(){return this.$("input[type=file]").unbind("change"),t.__super__.remove.apply(this,arguments)},t}(Backbone.View)}.call(this),function(){var e,t,n=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty,i=function(e,t){function i(){this.constructor=e}for(var n in t)r.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};(e=Locomotive.Views).Shared||(e.Shared={}),(t=Locomotive.Views.Shared).Fields||(t.Fields={}),Locomotive.Views.Shared.Fields.HasManyView=function(e){function t(){return this.get_entry_from_element=n(this.get_entry_from_element,this),t.__super__.constructor.apply(this,arguments)}return i(t,e),t.prototype.tagName="div",t.prototype.className="list",t.prototype.events={"click p.actions a.add":"open_new_entry_view","click ul span.actions a.edit":"edit_entry","click ul span.actions a.remove":"remove_entry"},t.prototype.template=function(){return ich[""+this.options.name+"_list"]},t.prototype.entry_template=function(){return ich[""+this.options.name+"_entry"]},t.prototype.initialize=function(){return _.bindAll(this,"refresh_position_entries"),this.collection=this.model.get(this.options.name),this.build_target_entry_view()},t.prototype.render=function(){return $(this.el).html(this.template()()),this.insert_entries(),this.make_entries_sortable(),this},t.prototype.ui_enabled=function(){return this.template()!=null},t.prototype.insert_entries=function(){var e=this;return this.collection.length>0?this.collection.each(function(t){return e.insert_entry(t)}):this.$(".empty").show()},t.prototype.insert_entry=function(e){var t;return this.collection.get(e.get("_id"))==null&&this.collection.add(e),this.$(".empty").hide(),t=$(this.entry_template()({label:e.get("_label")})),t.data("data-entry-id",e.id),this.$("> ul").append(t)},t.prototype.make_entries_sortable=function(){return this.sortable_list=this.$("> ul").sortable({handle:".handle",items:"li",axis:"y",update:this.refresh_position_entries})},t.prototype.refresh_position_entries=function(){var e=this;return this.$("> ul > li").each(function(t,n){var r,i;return i=$(n).data("data-entry-id"),r=e.collection.get(i),r.set_attribute("position_in_"+e.options.inverse_of,t)})},t.prototype.build_target_entry_view=function(){return this.target_entry_view=new Locomotive.Views.ContentEntries.PopupFormView({el:$("#"+this.options.name+"-template-entry"),parent_view:this,model:this.options.new_entry.clone()}),this.target_entry_view.render()},t.prototype.edit_entry=function(e){var t;return e.stopPropagation()&e.preventDefault(),t=this.get_entry_from_element($(e.target)),this.target_entry_view.reset(t),this.target_entry_view.open()},t.prototype.update_entry=function(e){var t,n;return t=$(_.detect(this.$("> ul > li"),function(t){return $(t).data("data-entry-id")===e.id})),this.collection.get(e.id).set(e.attributes),n=$(this.entry_template()({label:e.get("_label")})),n.data("data-entry-id",e.id),t.replaceWith(n)},t.prototype.insert_or_update_entry=function(e){return this.collection.get(e.id)!=null?this.update_entry(e):this.insert_entry(e)},t.prototype.remove_entry=function(e){var t;e.stopPropagation()&e.preventDefault();if(confirm($(e.target).attr("data-confirm")))return t=this.get_entry_from_element($(e.target)),t.set({_destroy:!0}),$(e.target).closest("li").remove(),this.$("> ul > li").size()===0&&this.$(".empty").show(),this.refresh_position_entries()},t.prototype.open_new_entry_view=function(e){return e.stopPropagation()&e.preventDefault(),this.target_entry_view.reset(this.options.new_entry.clone()),this.target_entry_view.open()},t.prototype.get_entry_from_element=function(e){var t,n;return t=$(e).closest("li"),n=$(t).data("data-entry-id"),this.collection.get(n)},t}(Backbone.View)}.call(this),function(){var e,t,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};(e=Locomotive.Views).Shared||(e.Shared={}),(t=Locomotive.Views.Shared).Fields||(t.Fields={}),Locomotive.Views.Shared.Fields.ManyToManyView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return r(t,e),t.prototype.tagName="div",t.prototype.className="list",t.prototype.events={"click .new-entry a.add":"add_entry","keypress .new-entry select":"add_entry","click ul span.actions a.remove":"remove_entry"},t.prototype.template=function(){return ich[""+this.options.name+"_list"]},t.prototype.entry_template=function(){return ich[""+this.options.name+"_entry"]},t.prototype.initialize=function(){return _.bindAll(this,"refresh_position_entries"),this.collection=this.model.get(this.options.name),this.all_entries=this.options.all_entries},t.prototype.render=function(){return $(this.el).html(this.template()()),this.insert_entries(),this.make_entries_sortable(),this.refresh_select_field(),this},t.prototype.ui_enabled=function(){return this.template()!=null},t.prototype.insert_entries=function(){var e=this;return this.collection.length>0?this.collection.each(function(t){return e.insert_entry(t)}):this.$(".empty").show()},t.prototype.insert_entry=function(e){var t;return this.collection.get(e.get("_id"))==null&&this.collection.add(e),this.$(".empty").hide(),t=$(this.entry_template()({label:e.get("_label")})),t.data("data-entry-id",e.id),this.$("> ul").append(t)},t.prototype.make_entries_sortable=function(){return this.sortable_list=this.$("> ul").sortable({handle:".handle",items:"li",axis:"y",update:this.refresh_position_entries})},t.prototype.refresh_position_entries=function(){var e=this;return this.$("> ul > li").each(function(t,n){var r,i;return i=$(n).data("data-entry-id"),r=e.collection.get(i),r.set_attribute("__position",t)})},t.prototype.add_entry=function(e){var t,n;e.stopPropagation()&e.preventDefault(),n=this.$(".new-entry select").val(),t=this.get_entry_from_id(n);if(t==null)return;return this.insert_entry(t),this.refresh_select_field()},t.prototype.remove_entry=function(e){var t;e.stopPropagation()&e.preventDefault();if(confirm($(e.target).attr("data-confirm")))return t=this.get_entry_from_element($(e.target)),this.collection.remove(t),$(e.target).closest("li").remove(),this.$("> ul > li").size()===0&&this.$(".empty").show(),this.refresh_position_entries()&this.refresh_select_field()},t.prototype.refresh_select_field=function(){var e=this;return this.$(".new-entry select optgroup, .new-entry select option").remove(),_.each(this.all_entries,function(t){var n,r;if(_.isArray(t.entries))return n=$("<optgroup/>").attr("label",t.name),_.each(t.entries,function(t){var r;if(e.collection.get(t._id)==null)return r=new Option(t._label,t._id,!1),n.append(r)}),e.$(".new-entry select").append(n);if(e.collection.get(t._id)==null)return r=new Option(t._label,t._id,!1),e.$(".new-entry select").append(r)})},t.prototype.get_entry_from_element=function(e){var t,n;return t=$(e).closest("li"),n=$(t).data("data-entry-id"),this.collection.get(n)},t.prototype.get_entry_from_id=function(e){var t,n=this;return t=null,_.each(this.all_entries,function(n){if(_.isArray(n.entries))return t||(t=_.detect(n.entries,function(t){return t._id===e}));if(n._id===e)return t=n}),t!=null?new Locomotive.Models.ContentEntry(t):null},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).Shared||(e.Shared={}),Locomotive.Views.Shared.ListItemView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.tagName="li",t.prototype.events={"click a.remove":"remove_item"},t.prototype.template=function(){},t.prototype.render=function(){return $(this.el).html(this.template()(this.model.toJSON())),this},t.prototype.remove_item=function(e){e.stopPropagation()&e.preventDefault();if(confirm($(e.target).attr("data-confirm")))return this.model.destroy()},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).Shared||(e.Shared={}),Locomotive.Views.Shared.ListView=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}var t;return n(r,e),r.prototype.tagName="div",t=[],r.prototype.initialize=function(){return _.bindAll(this,"insert_item","remove_item"),this.collection.bind("add",this.insert_item),this.collection.bind("remove",this.remove_item)},r.prototype.template=function(){},r.prototype.item_view_class=function(){},r.prototype.render=function(){return $(this.el).html(this.template()()),this.render_items(),this},r.prototype.render_items=function(){var e=this;return this.collection.length===0?this.$(".no-items").show():this.collection.each(function(t){return e.insert_item(t)})},r.prototype.insert_item=function(e){var t,n;return t=this.item_view_class(),n=new t({model:e,parent_view:this}),(this._item_views||(this._item_views=[])).push(n),this.$(".no-items").hide(),this.$("ul").append(n.render().el)},r.prototype.remove_item=function(e){var t;this.collection.length===0&&this.$(".no-items").show(),t=_.find(this._item_views,function(t){return t.model===e});if(t!=null)return t.remove()},r.prototype.remove=function(){var e=this;return _.each(this._item_views,function(e){return e.remove()}),r.__super__.remove.apply(this,arguments)},r}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).Sites||(e.Sites={}),Locomotive.Views.Sites.DomainEntryView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.tagName="li",t.prototype.className="domain",t.prototype.events={"change input[type=text]":"change","click a.remove":"remove"},t.prototype.render=function(){return $(this.el).html(ich.domain_entry(this.model.toJSON())),this},t.prototype.change=function(e){var t;return t=$(e.target).val(),this.options.parent_view.change_entry(this.model,t)},t.prototype.remove=function(e){return e.stopPropagation()&e.preventDefault(),this.$("input[type=text]").editableField("destroy"),this.options.parent_view.remove_entry(this.model),t.__super__.remove.call(this)},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).Sites||(e.Sites={}),Locomotive.Views.Sites.MembershipEntryView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.className="entry",t.prototype.events={"change select":"change","click a.remove":"remove"},t.prototype.render=function(){var e;return e=this.model.toJSON(),e.index=this.options.index,$(this.el).html(ich.membership_entry(e)),$(this.el).attr("data-role",this.model.get("role")),this.$("select").val(this.model.get("role")),this},t.prototype.change=function(e){var t;return t=$(e.target).val(),this.options.parent_view.change_entry(this.model,t)},t.prototype.remove=function(e){return e.stopPropagation()&e.preventDefault(),this.$("select").editableField("destroy"),this.options.parent_view.remove_entry(this.model),t.__super__.remove.call(this)},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).Sites||(e.Sites={}),Locomotive.Views.Sites.MembershipsView=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}var t;return n(r,e),r.prototype.tagName="div",r.prototype.className="list",t=[],r.prototype.render=function(){return this.render_entries(),this.enable_ui_effects(),this},r.prototype.change_entry=function(e,t){return e.set({role:t})},r.prototype.remove_entry=function(e){return e.set({_destroy:!0})},r.prototype.render_entries=function(){var e=this;return this.model.get("memberships").each(function(t,n){return e._insert_entry(t,n)})},r.prototype.enable_ui_effects=function(){return this.$(".entry select").editableField()},r.prototype._insert_entry=function(e,t){var n;return n=new Locomotive.Views.Sites.MembershipEntryView({model:e,parent_view:this,index:t}),(this._entry_views||(this._entry_views=[])).push(n),$(this.el).append(n.render().el)},r}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).Sites||(e.Sites={}),Locomotive.Views.Sites.NewView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.el="#content",t.prototype.events={submit:"save"},t.prototype.initialize=function(){return this.model=new Locomotive.Models.Site,Backbone.ModelBinding.bind(this)},t.prototype.render=function(){return t.__super__.render.call(this),this.render_domains()},t.prototype.render_domains=function(){return this.domains_view=new Locomotive.Views.Sites.DomainsView({model:this.model,errors:this.options.errors}),this.$("#site_domains_input label").after(this.domains_view.render().el)},t.prototype.save=function(e){return this.save_in_ajax(e,{on_success:function(e,t){return window.location.href=t.getResponseHeader("location")}})},t.prototype.show_error=function(e,n,r){return e==="domains"?this.domains_view.show_error(n):t.__super__.show_error.apply(this,arguments)},t.prototype.remove=function(){return this.domains_view.remove(),t.__super__.remove.apply(this,arguments)},t}(Locomotive.Views.Shared.FormView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).Snippets||(e.Snippets={}),Locomotive.Views.Snippets.FormView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.el="#content",t.prototype.events={"click    a#image-picker-link":"open_image_picker",submit:"save"},t.prototype.initialize=function(){return _.bindAll(this,"insert_image"),this.model=new Locomotive.Models.Snippet(this.options.snippet),this.image_picker_view=new Locomotive.Views.ThemeAssets.ImagePickerView({collection:new Locomotive.Models.ThemeAssetsCollection,on_select:this.insert_image}),this.image_picker_view.render(),Backbone.ModelBinding.bind(this)},t.prototype.render=function(){return t.__super__.render.call(this),this.slugify_name(),this.enable_liquid_editing(),this},t.prototype.slugify_name=function(){return this.$("#snippet_name").slugify({target:this.$("#snippet_slug")})},t.prototype.open_image_picker=function(e){return e.stopPropagation()&e.preventDefault(),this.image_picker_view.editor=this.editor,this.image_picker_view.fetch_assets()},t.prototype.insert_image=function(e){var t;return t="{{ '"+e+"' | theme_image_url }}",this.editor.replaceSelection(t),this.image_picker_view.close()},t.prototype.enable_liquid_editing=function(){var e,t=this;return e=this.$("#snippet_template"),this.editor=CodeMirror.fromTextArea(e.get()[0],{mode:"liquid",autoMatchParens:!1,lineNumbers:!1,passDelay:50,tabMode:"shift",theme:"default medium",onChange:function(e){return t.model.set({template:e.getValue()})}})},t.prototype.after_inputs_fold=function(){return this.editor.refresh()},t}(Locomotive.Views.Shared.FormView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).Snippets||(e.Snippets={}),Locomotive.Views.Snippets.EditView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.save=function(e){return this.save_in_ajax(e)},t}(Locomotive.Views.Snippets.FormView)}.call(this),function(){var e,t={}.hasOwnProperty
,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).Snippets||(e.Snippets={}),Locomotive.Views.Snippets.ListItemView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.template=function(){return ich.snippet_item},t}(Locomotive.Views.Shared.ListItemView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).Snippets||(e.Snippets={}),Locomotive.Views.Snippets.ListView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.className="box",t.prototype.initialize=function(){return this.collection=new Locomotive.Models.SnippetsCollection(this.options.collection),t.__super__.initialize.apply(this,arguments)},t.prototype.template=function(){return ich.snippets_list},t.prototype.item_view_class=function(){return Locomotive.Views.Snippets.ListItemView},t}(Locomotive.Views.Shared.ListView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).Snippets||(e.Snippets={}),Locomotive.Views.Snippets.NewView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.save=function(e){return this.save_in_ajax(e,{on_success:function(e,t){return window.location.href=t.getResponseHeader("location")}})},t}(Locomotive.Views.Snippets.FormView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).ThemeAssets||(e.ThemeAssets={}),Locomotive.Views.ThemeAssets.FormView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.el="#content",t.prototype.events={"click    a#image-picker-link":"open_image_picker",submit:"save"},t.prototype.initialize=function(){return _.bindAll(this,"insert_image"),this.model=new Locomotive.Models.ThemeAsset(this.options.theme_asset),this.image_picker_view=new Locomotive.Views.ThemeAssets.ImagePickerView({on_select:this.insert_image}),this.image_picker_view.render(),Backbone.ModelBinding.bind(this)},t.prototype.render=function(){return t.__super__.render.call(this),this.enable_toggle_between_file_and_text(),this.enable_source_editing(),this.bind_source_mode(),this.enable_source_file(),this},t.prototype.enable_toggle_between_file_and_text=function(){var e=this;return this.$("div.hidden").hide(),this.model.set({performing_plain_text:this.$("#theme_asset_performing_plain_text").val()}),this.$(".selector > a.alt").click(function(t){return t.stopPropagation()&t.preventDefault(),e.$("#file-selector").is(":hidden")?e.$("#text-selector").slideUp("normal",function(){return e.$("#file-selector").slideDown(),e.model.set({performing_plain_text:!1}),e.$("input#theme_asset_performing_plain_text").val(!1)}):e.$("#file-selector").slideUp("normal",function(){return e.$("#text-selector").slideDown("normal",function(){return e.editor.refresh()}),e.model.set({performing_plain_text:!0}),e.$("#theme_asset_performing_plain_text").val(!0)})})},t.prototype.enable_source_file=function(){var e=this;return this.$(".formtastic #theme_asset_source").bind("change",function(t){var n;n=$(t.target)[0];if(n.files!=null)return e.model.set({source:n.files[0]})})},t.prototype.show_error=function(e,n,r){switch(e){case"source":return this.$(this.model.get("performing_plain_text")?"#theme_asset_plain_text_input .CodeMirror":"#theme_asset_source").after(r);default:return t.__super__.show_error.apply(this,arguments)}},t.prototype.open_image_picker=function(e){return e.stopPropagation()&e.preventDefault(),this.image_picker_view.editor=this.editor,this.image_picker_view.fetch_assets()},t.prototype.insert_image=function(e){var t;return t="'"+e+"'",this.editor.replaceSelection(t),this.image_picker_view.close()},t.prototype.source_mode=function(){return this.model.get("plain_text_type")==="javascript"?"javascript":"css"},t.prototype.enable_source_editing=function(){var e,t=this;e=this.$("#theme_asset_plain_text");if(e.size()===0)return;return this.editor=CodeMirror.fromTextArea(e.get()[0],{mode:this.source_mode(),autoMatchParens:!1,lineNumbers:!1,passDelay:50,tabMode:"shift",theme:"default",onChange:function(e){return t.model.set({plain_text:e.getValue()})}})},t.prototype.bind_source_mode=function(){var e=this;return this.$("#theme_asset_plain_text_type").bind("change",function(t){return e.editor.setOption("mode",e.source_mode())})},t.prototype.after_inputs_fold=function(){if(this.editor!=null)return this.editor.refresh()},t}(Locomotive.Views.Shared.FormView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).ThemeAssets||(e.ThemeAssets={}),Locomotive.Views.ThemeAssets.EditView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.save=function(e){var t=this;return this.save_in_ajax(e,{on_success:function(e,n){var r;window.response=e,window.xhr=n,r=t.$(".inner > p.help"),r.find("b").html(e.dimensions),r.find("a").html(e.url).attr("href",e.url),window.editor=t.editor;if(e.plain_text!=null)return t.editor.setValue(e.plain_text)}})},t}(Locomotive.Views.ThemeAssets.FormView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).ThemeAssets||(e.ThemeAssets={}),Locomotive.Views.ThemeAssets.ImagePickerView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.events={"click ul.list a":"select_asset"},t.prototype.initialize=function(){return this.collection||(this.collection=new Locomotive.Models.ThemeAssetsCollection),t.__super__.initialize.apply(this,arguments)},t.prototype.template=function(){return ich.theme_image_picker},t.prototype.fetch_assets=function(){var e=this;return this._reset(),this.collection.fetch({data:{content_type:"image"},success:function(){return e.open()}})},t.prototype.build_uploader=function(e,t){var n=this;return t.bind("click",function(t){return t.stopPropagation()&t.preventDefault(),e.click()}),e.bind("change",function(e){return _.each(e.target.files,function(e){var t;return t=new Locomotive.Models.ThemeAsset({source:e}),t.save({},{headers:{"X-Flash":!0},success:function(e){return n.collection.add(e)},error:function(){return n.shake()}})})})},t.prototype.select_asset=function(e){e.stopPropagation()&e.preventDefault();if(this.options.on_select)return this.options.on_select($(e.target).html())},t.prototype.add_asset=function(e){return this.$("ul.list").append(ich.theme_asset(e.toJSON())),this._refresh()},t.prototype._reset=function(){return this.$("ul.list").empty()},t}(Locomotive.Views.Shared.AssetPickerView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).ThemeAssets||(e.ThemeAssets={}),Locomotive.Views.ThemeAssets.IndexView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.el="#content",t.prototype._lists_views=[],t.prototype.initialize=function(){return _.bindAll(this,"insert_asset")},t.prototype.render=function(){return this.build_uploader(),this.render_snippets(),this.render_images(),this.render_js_and_css(),this.render_fonts(),this.render_media(),this},t.prototype.build_uploader=function(){var e,t,n,r=this;return e=this.$("#theme-assets-quick-upload"),t=e.find("input[type=file]"),n=e.find("a.new"),e.formSubmitNotification(),n.bind("click",function(e){return e.stopPropagation()&e.preventDefault(),t.click()}),t.bind("change",function(t){return e.trigger("ajax:beforeSend"),_.each(t.target.files,function(t){var n;return n=new Locomotive.Models.ThemeAsset({source:t}),n.save({},{success:function(t,n,i){return e.trigger("ajax:complete"),r.insert_asset(t)},error:function(){return e.trigger("ajax:complete")},headers:{"X-Flash":!0}})})})},t.prototype.insert_asset=function(e){var t;return t=this.pick_list_view(e.get("content_type")),t.collection.add(e)},t.prototype.render_snippets=function(){return this.render_list("snippets",this.options.snippets,Locomotive.Views.Snippets.ListView)},t.prototype.render_images=function(){return this.render_list("images",this.options.images)},t.prototype.render_js_and_css=function(){return this.render_list("js-and-css",this.options.js_and_css_assets,Locomotive.Views.ThemeAssets.ListView,ich.js_and_css_list)},t.prototype.render_fonts=function(){return this.render_list("fonts",this.options.fonts,Locomotive.Views.ThemeAssets.ListView,ich.fonts_list)},t.prototype.render_media=function(){return this.render_list("media",this.options.media,Locomotive.Views.ThemeAssets.ListView,ich.media_list)},t.prototype.render_list=function(e,t,n,r){var i;if(this.$("#"+e+"-anchor").size()===0)return;return n||(n=Locomotive.Views.ThemeAssets.ListView),i=new n({collection:t,type:e}),r!=null&&(i.template=function(){return r}),this.$("#"+e+"-anchor").replaceWith(i.render().el),(this._lists_views||(this._lists_views=[])).push(i)},t.prototype.pick_list_view=function(e){var t,n=this;return t=function(){switch(e){case"image":return"images";case"javascript":case"stylesheet":return"js-and-css";case"media":return"media";case"font":return"fonts"}}(),_.find(this._lists_views,function(e){return e.options.type===t})},t.prototype.remove=function(){var e=this;return _.each(this._lists_views,function(e){return e.remove()}),t.__super__.remove.apply(this,arguments)},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).ThemeAssets||(e.ThemeAssets={}),Locomotive.Views.ThemeAssets.ListItemView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.template=function(){return ich.editable_theme_asset_item},t}(Locomotive.Views.Shared.ListItemView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).ThemeAssets||(e.ThemeAssets={}),Locomotive.Views.ThemeAssets.ListView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.className="box",t.prototype.initialize=function(){return this.collection=new Locomotive.Models.ThemeAssetsCollection(this.options.collection),t.__super__.initialize.apply(this,arguments)},t.prototype.template=function(){return ich.images_list},t.prototype.item_view_class=function(){return Locomotive.Views.ThemeAssets.ListItemView},t}(Locomotive.Views.Shared.ListView)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(e=Locomotive.Views).ThemeAssets||(e.ThemeAssets={}),Locomotive.Views.ThemeAssets.NewView=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.save=function(e){return this.save_in_ajax(e,{on_success:function(e,t){return window.location.href=t.getResponseHeader("location")}})},t}(Locomotive.Views.ThemeAssets.FormView)}.call(this);